
BEGIN_PROLOG


dunefd_geo:
{

 # Various configurations for FD-related geometries

 Name:     "dune10kt"   #note: this does not need to change with GDML file
			#unless it is important that DetId be 34kt.
			#  At this point, 34kt is no different than 10kt,
			#  and there are no other FD detector IDs. 9/7/13

 # Choose GDML file

 GDML:      "dune10kt_v1.gdml"
 ROOT:      "dune10kt_v1.gdml"
# GDML:      "dune10kt_v1_workspace.gdml"
# ROOT:      "dune10kt_v1_workspace.gdml"
# GDML:      "dune10kt_v1_45deg.gdml"
# ROOT:      "dune10kt_v1_45deg.gdml"
# GDML:      "dune10kt_v1_45deg_workspace.gdml"
# ROOT:      "dune10kt_v1_45deg_workspace.gdml"
# GDML:      "dune10kt_v1_3mmPitch.gdml"
# ROOT:      "dune10kt_v1_3mmPitch.gdml"
# GDML:      "dune10kt_v1_3mmPitch_workspace.gdml"
# ROOT:      "dune10kt_v1_3mmPitch_workspace.gdml"
# GDML:      "lbne10kt.gdml"
# ROOT:      "lbne10kt.gdml"
# GDML:      "lbne34kt.gdml"
# ROOT:      "lbne34kt.gdml"
# GDML:      "lbne4apa36deg.gdml"
# ROOT:      "lbne4apa36deg.gdml"   # *45deg.gdml or *36deg.gdml

 SortingParameters:	{ChannelsPerOpDet:	1}

 SurfaceY:         0.0e2               # in cm, vertical distance to the surface
 #SurfaceY: 147828                       # Underground option. 4850 feet to cm. from DocDb-3833


 DisableWiresInG4: true
}

dune10kt_geo:
{
 Name:      "dune10kt_v1"
 
 GDML:      "dune10kt_v1.gdml"
 ROOT:      "dune10kt_v1.gdml"

 SortingParameters:	{ChannelsPerOpDet:	1}

 SurfaceY: 147828                       # Underground option. 4850 feet to cm. from DocDb-3833

 DisableWiresInG4:   true

}

dunedphase10kt_geo:
{
 Name:      "dunedphase10kt_v2"
 
 GDML:      "dunedphase10kt_v2.gdml"
 ROOT:      "dunedphase10kt_v2.gdml"

 SortingParameters:	{ChannelsPerOpDet:	1}

 SurfaceY: 147828                       # Underground option. 4850 feet to cm. from DocDb-3833

 DisableWiresInG4:   true
}

dunedphase10kt_driftY_geo:
{
 Name:      "dunedphase10kt_v2_driftY"
 
 GDML:      "dunedphase10kt_v2_driftY.gdml"
 ROOT:      "dunedphase10kt_v2_driftY.gdml"

 SortingParameters:	{ChannelsPerOpDet:	1}

 SurfaceY: 147828                       # Underground option. 4850 feet to cm. from DocDb-3833

 DisableWiresInG4:   true
}

dunedphase10kt_driftY_HalfFoiled_geo: @local::dunedphase10kt_driftY_geo
dunedphase10kt_driftY_HalfFoiled_geo.Name: "dunedphase10kt_v2_driftY_HalfFoil"
dunedphase10kt_driftY_HalfFoiled_geo.GDML: "dunedphase10kt_v2_driftY_HalfFoil.gdml"
dunedphase10kt_driftY_HalfFoiled_geo.ROOT: "dunedphase10kt_v2_driftY_HalfFoil.gdml"

protodunedphase_geo:
{
 Name:      "protodunedphase"

 GDML:      "protodunedphase.gdml"
 ROOT:      "protodunedphase.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
} 

protodunedphase_driftY_geo:
{
 Name:      "protodunedphase_driftY"

 GDML:      "protodunedphase_driftY.gdml"
 ROOT:      "protodunedphase_driftY.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
} 

protodunedphase_driftY_uniform_geo:
{
 Name:      "protodunedphase_driftY_uniform"

 GDML:      "protodunedphase_driftY_uniform.gdml"
 ROOT:      "protodunedphase_driftY_uniform.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
} 

dphase3x1x1_geo:
{
 Name:      "3x1x1dphase"

 GDML:      "3x1x1dphase.gdml"
 ROOT:      "3x1x1dphase.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
}

dphase3x1x1_driftY_geo:
{
 Name:      "3x1x1dphase_driftY"

 GDML:      "3x1x1dphase_driftY.gdml"
 ROOT:      "3x1x1dphase_driftY.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
}

dune10kt_workspace_geo: @local::dune10kt_geo
dune10kt_workspace_geo.Name: "dune10kt_v1_workspace"
dune10kt_workspace_geo.GDML: "dune10kt_v1_workspace.gdml"
dune10kt_workspace_geo.ROOT: "dune10kt_v1_workspace.gdml"

dune10kt_1x2x6_v1_geo: @local::dune10kt_geo
dune10kt_1x2x6_v1_geo.Name: "dune10kt_v1_1x2x6"
dune10kt_1x2x6_v1_geo.GDML: "dune10kt_v1_1x2x6.gdml"
dune10kt_1x2x6_v1_geo.ROOT: "dune10kt_v1_1x2x6.gdml"

dune10kt_1x2x6_v3_geo: @local::dune10kt_geo
dune10kt_1x2x6_v3_geo.Name: "dune10kt_v3_1x2x6"
dune10kt_1x2x6_v3_geo.GDML: "dune10kt_v3_1x2x6.gdml"
dune10kt_1x2x6_v3_geo.ROOT: "dune10kt_v3_1x2x6.gdml"

dune10kt_1x2x6_v3_geo: @local::dune10kt_geo
dune10kt_1x2x6_v3_geo.Name: "dune10kt_v3_1x2x6"
dune10kt_1x2x6_v3_geo.GDML: "dune10kt_v3_1x2x6.gdml"
dune10kt_1x2x6_v3_geo.ROOT: "dune10kt_v3_1x2x6.gdml"

dune10kt_1x2x6_v4_geo: @local::dune10kt_geo
dune10kt_1x2x6_v4_geo.Name: "dune10kt_v4_1x2x6"
dune10kt_1x2x6_v4_geo.GDML: "dune10kt_v4_1x2x6.gdml"
dune10kt_1x2x6_v4_geo.ROOT: "dune10kt_v4_1x2x6.gdml"

dune10kt_1x2x6_geo: @local::dune10kt_1x2x6_v4_geo


dunedphase10kt_workspace_geo: @local::dunedphase10kt_geo
dunedphase10kt_workspace_geo.Name: "dunedphase10kt_v2_workspace"
dunedphase10kt_workspace_geo.GDML: "dunedphase10kt_v2_workspace.gdml"
dunedphase10kt_workspace_geo.ROOT: "dunedphase10kt_v2_workspace.gdml"

dunedphase10kt_workspace4x2_geo: @local::dunedphase10kt_geo
dunedphase10kt_workspace4x2_geo.Name: "dunedphase10kt_v2_workspace4x2"
dunedphase10kt_workspace4x2_geo.GDML: "dunedphase10kt_v2_workspace4x2.gdml"
dunedphase10kt_workspace4x2_geo.ROOT: "dunedphase10kt_v2_workspace4x2.gdml"




dunedphase10kt_driftY_workspace_geo: @local::dunedphase10kt_driftY_geo
dunedphase10kt_driftY_workspace_geo.Name: "dunedphase10kt_v2_driftY_workspace"
dunedphase10kt_driftY_workspace_geo.GDML: "dunedphase10kt_v2_driftY_workspace.gdml"
dunedphase10kt_driftY_workspace_geo.ROOT: "dunedphase10kt_v2_driftY_workspace.gdml"

dunedphase10kt_driftY_workspace4x2_geo: @local::dunedphase10kt_driftY_geo
dunedphase10kt_driftY_workspace4x2_geo.Name: "dunedphase10kt_v2_driftY_workspace4x2"
dunedphase10kt_driftY_workspace4x2_geo.GDML: "dunedphase10kt_v2_driftY_workspace4x2.gdml"
dunedphase10kt_driftY_workspace4x2_geo.ROOT: "dunedphase10kt_v2_driftY_workspace4x2.gdml"

dunedphase10kt_driftY_workspace3x3_geo: @local::dunedphase10kt_driftY_geo
dunedphase10kt_driftY_workspace3x3_geo.Name: "dunedphase10kt_v2_driftY_workspace3x3"
dunedphase10kt_driftY_workspace3x3_geo.GDML: "dunedphase10kt_v2_driftY_workspace3x3.gdml"
dunedphase10kt_driftY_workspace3x3_geo.ROOT: "dunedphase10kt_v2_driftY_workspace3x3.gdml"




dune10kt_45deg_workspace_geo: @local::dune10kt_geo
dune10kt_45deg_workspace_geo.Name: "dune10kt_v1_45deg_workspace"
dune10kt_45deg_workspace_geo.GDML: "dune10kt_v1_45deg_workspace.gdml"
dune10kt_45deg_workspace_geo.ROOT: "dune10kt_v1_45deg_workspace.gdml"

dune10kt_45deg_1x2x6_geo: @local::dune10kt_geo
dune10kt_45deg_1x2x6_geo.Name: "dune10kt_v1_45deg_1x2x6"
dune10kt_45deg_1x2x6_geo.GDML: "dune10kt_v1_45deg_1x2x6.gdml"
dune10kt_45deg_1x2x6_geo.ROOT: "dune10kt_v1_45deg_1x2x6.gdml"


dune10kt_3mmpitch_workspace_geo: @local::dune10kt_geo
dune10kt_3mmpitch_workspace_geo.Name: "dune10kt_v1_3mmpitch_workspace"
dune10kt_3mmpitch_workspace_geo.GDML: "dune10kt_v1_3mmpitch_workspace.gdml"
dune10kt_3mmpitch_workspace_geo.ROOT: "dune10kt_v1_3mmpitch_workspace.gdml"

dune10kt_3mmpitch_1x2x6_geo: @local::dune10kt_geo
dune10kt_3mmpitch_1x2x6_geo.Name: "dune10kt_v1_3mmpitch_1x2x6"
dune10kt_3mmpitch_1x2x6_geo.GDML: "dune10kt_v1_3mmpitch_1x2x6.gdml"
dune10kt_3mmpitch_1x2x6_geo.ROOT: "dune10kt_v1_3mmpitch_1x2x6.gdml"

#Updated CRT locations, shorter grid-anode distance, 1.5 cm outer volume
protodunev6_geo: @local::dune10kt_geo
protodunev6_geo.Name: "protodune" # will be made lower case anyway
protodunev6_geo.GDML: "protodune_v6.gdml"
protodunev6_geo.ROOT: "protodune_v6.gdml"

#ARAPUCA geometry
protodunev7_geo: @local::dune10kt_geo
protodunev7_geo.Name: "protodunev7" # will be made lower case anyway
protodunev7_geo.GDML: "protodune_v7.gdml"
protodunev7_geo.ROOT: "protodune_v7.gdml"

protodune_geo: @local::protodunev7_geo

iceberg_geo: @local::dune10kt_geo
iceberg_geo.Name: "iceberg" # will be made lower case anyway
iceberg_geo.GDML: "iceberg_v1.gdml"
iceberg_geo.ROOT: "iceberg_v1.gdml"

dune35t_geo:
{
 Name:     "dune35t4apa_v6"

 # Choose GDML file and set detector version similarly
 GDML:         "dune35t4apa_v6.gdml"
 ROOT:         "dune35t4apa_v6.gdml"
 SortingParameters: { 
    DetectorVersion: "dune35t4apa_v6"
    ChannelsPerOpDet:	12
 } 

 SurfaceY:           0.0e2               #in cm, vertical distance to the surface
 DisableWiresInG4:   true

}

larnd_geo:
{
 Name:     "larnd"

 GDML:     "larnd.gdml"
 ROOT:     "larnd.gdml"

 SortingParameters:	{ChannelsPerOpDet:	1}
 SurfaceY:           5578               #183ft in cm, vertical distance to the surface
 DisableWiresInG4:   true
}


dune_geometry_helper:
{
 service_provider : DUNEGeometryHelper
}



END_PROLOG
BEGIN_PROLOG

standard_detproperties :
{
 service_provider: "DetectorPropertiesServiceStandard"

 # Drift properties 
 Temperature:      91                #Kelvin
 Efield:           [0.5,0.66,0.8 ]   #kV/cm
 Electronlifetime: 750               #microseconds
 
 SternheimerA:     0.1956  # Ar Sternheimer parameter a.
 SternheimerK:     3.0000  # Ar Sternheimer parameter k.
 SternheimerX0:    0.2000  # Ar Sternheimer parameter x0.
 SternheimerX1:    3.0000  # Ar Sternheimer parameter x0.
 SternheimerCbar:  5.2146  # Ar Sternheimer parameter Cbar.

 DriftVelFudgeFactor: 1.
 
 ElectronsToADC:    1.208041e-3  # in ADC/e; 6241.5 electrons = 1fC = 7.54 ADC counts for ArgoNeuT
 NumberTimeSamples: 2048         # ticks of the clock per readout frame
 TimeOffsetU:       -5.193
 TimeOffsetV:       0.585
 TimeOffsetZ:       0
 ReadOutWindowSize: 2048

 SimpleBoundaryProcess: true  #enable opticalBoundaryProcessSimple instead of G4 default

}

# be sure to make the necessary changes when microboone and
# lbne have different electronics simulations from argoneut

END_PROLOG

BEGIN_PROLOG


dunefd_detproperties:                   @local::standard_detproperties
# dunefd_detproperties.SamplingRate:      500.         #in ns
dunefd_detproperties.Temperature:       87
dunefd_detproperties.Electronlifetime:  3.0e3
dunefd_detproperties.Efield:           [0.5,0.666,0.8]  #(predicted for microBooNE)
dunefd_detproperties.ElectronsToADC:    6.8906513e-3 # 1fC = 43.008 ADC counts for DUNE fd
dunefd_detproperties.NumberTimeSamples: 4492         # drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
dunefd_detproperties.ReadOutWindowSize: 4492         # drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
dunefd_detproperties.TimeOffsetU:       0.
dunefd_detproperties.TimeOffsetV:       0.
dunefd_detproperties.TimeOffsetZ:       0.

dunefddphase_detproperties:                   @local::standard_detproperties
# dunefddphase_detproperties.SamplingRate:    400.          # in ns
dunefddphase_detproperties.Temperature:       87            # in K
dunefddphase_detproperties.Electronlifetime:  3.0e3         # in us
dunefddphase_detproperties.Efield:            [0.5,4.0,0.0] # in kV/cm
dunefddphase_detproperties.ElectronsToADC:    5.1267e-04    # 
dunefddphase_detproperties.NumberTimeSamples: 20000         # drift length/drift velocity*sampling rate
dunefddphase_detproperties.ReadOutWindowSize: 20000         # drift length/drift velocity*sampling rate
dunefddphase_detproperties.TimeOffsetX:       0.
dunefddphase_detproperties.TimeOffsetY:       0.
dunefddphase_detproperties.TimeOffsetZ:       0.

protodunedphase_detproperties:                   @local::standard_detproperties
protodunedphase_detproperties.Temperature:       87            # in K
protodunedphase_detproperties.Electronlifetime:  3.0e3         # in us
protodunedphase_detproperties.Efield:            [0.5,4.0,0.0] # in kV/cm
protodunedphase_detproperties.ElectronsToADC:    1.02534e-03   # 
protodunedphase_detproperties.NumberTimeSamples: 10000         # 10000 before beam + 10000 after beam
protodunedphase_detproperties.ReadOutWindowSize: 10000         # 10000 before beam + 10000 after beam
protodunedphase_detproperties.TimeOffsetX:       0.
protodunedphase_detproperties.TimeOffsetY:       0.
protodunedphase_detproperties.TimeOffsetZ:       0.

dphase3x1x1_detproperties: 		@local::standard_detproperties
dphase3x1x1_detproperties.Temperature:       87            # in K
dphase3x1x1_detproperties.Electronlifetime:  3.0e3         # in us
dphase3x1x1_detproperties.Efield:            [0.5,4.0,0.0] # in kV/cm
dphase3x1x1_detproperties.ElectronsToADC:    1.02534e-03   # 
dphase3x1x1_detproperties.NumberTimeSamples: 1667
dphase3x1x1_detproperties.ReadOutWindowSize: 1667
#dphase3x1x1_detproperties.TimeOffsetX:       0.
dphase3x1x1_detproperties.TimeOffsetY:       0.
dphase3x1x1_detproperties.TimeOffsetZ:       0.

dune35t_detproperties:                   @local::standard_detproperties
# dune35t_detproperties.SamplingRate:      500.         #in ns
dune35t_detproperties.Temperature:       87
dune35t_detproperties.Electronlifetime:  3.0e3
# dune35t_detproperties.Efield:          [0.5,0.666,0.8]  #(predicted for microBooNE)
dune35t_detproperties.Efield:            [0.25,0.782,1.734] # Run was at half field
dune35t_detproperties.ElectronsToADC:    6.8906513e-3 # 1fC = 43.008 ADC counts for DUNE 35t
dune35t_detproperties.NumberTimeSamples: 5200
dune35t_detproperties.ReadOutWindowSize: 5200
dune35t_detproperties.TimeOffsetU:       0.
dune35t_detproperties.TimeOffsetV:       0.
dune35t_detproperties.TimeOffsetZ:       0.

dune35t_milliblock_detproperties:         @local::dune35t_detproperties
dune35t_milliblock_detproperties.NumberTimeSamples: 15000
dune35t_milliblock_detproperties.ReadOutWindowSize: 15000

# Implement new 6000 tick readout window (500 before trigger)
protodune_detproperties:                   @local::standard_detproperties
protodune_detproperties.Temperature:       87.68
protodune_detproperties.Electronlifetime:  35.0e3
protodune_detproperties.Efield:           [0.4867,0.666,0.8]  #(predicted for microBooNE)
protodune_detproperties.ElectronsToADC:    6.8906513e-3 # 1fC = 43.008 ADC counts for DUNE fd
protodune_detproperties.NumberTimeSamples: 6000         # 1 drift window = 4492 = drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
protodune_detproperties.ReadOutWindowSize: 6000         # 1 drift window = 4492 = drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
protodune_detproperties.TimeOffsetU:       0.
protodune_detproperties.TimeOffsetV:       0.
protodune_detproperties.TimeOffsetZ:       0.




protodunesp_detproperties :
 {
 service_provider: "DetectorPropertiesServiceProtoDUNEsp" 



 GetHVDriftfromSamweb: true   #will attempt to look up nominal drift HV voltage from samweb metadata
 GetReadOutWindowSizefromSamweb: true #will attempt to look up readout window size samweb metadata
 UseRunDependentTemperature: true #will updated temperature using run number to account for the varition during datataking 

  # Drift properties 
Temperature:      87.68           #Kelvin
Efield:           [0.4867,0.619423,0.776903,1.72178]     #calc from 180KV drift and wire biases will be overwritten if GetHVvaluefromTable is enabled
Electronlifetime: 35.0e3               #microseconds
SternheimerA:     0.1956  # Ar Sternheimer parameter a.
SternheimerK:     3.0000  # Ar Sternheimer parameter k.
SternheimerX0:    0.2000  # Ar Sternheimer parameter x0.
SternheimerX1:    3.0000  # Ar Sternheimer parameter x0.
SternheimerCbar:  5.2146  # Ar Sternheimer parameter Cbar.  
SimpleBoundaryProcess: true  #enable opticalBoundaryProcessSimple instead of G4 default
ElectronsToADC:    6.8906513e-3 # 1fC = 43.008 ADC counts for DUNE fd
NumberTimeSamples: 6000         # 1 drift window = 4492 = drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
ReadOutWindowSize: 6000         # 1 drift window = 4492 = drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
TimeOffsetU:       0.
TimeOffsetV:       0.
TimeOffsetZ:       0.

}


END_PROLOG
BEGIN_PROLOG

standard_properties:
{
 service_provider: "LArPropertiesServiceStandard"

 # For following parameters, see http://pdg.lbl.gov/AtomicNuclearProperties/
 RadiationLength:  19.55   # g/cm^2
 AtomicNumber:     18      # Ar atomic number.
 AtomicMass:       39.948  # Ar atomic mass (g/mol).
 ExcitationEnergy: 188.0   # Ar mean excitation energy (eV).

# Argon39DecayRate: 0.00141 # decays per cm^3 per second.  Assumes 1.01 Bq/kg and a density of 1.396 g/cc
# The following parameter was formerly used to steer an ad-hoc 39Ar decay model as part of the G4 step.
# Users are now recommended to use the radiological generator: see larsim/EventGenerators/radiological_gen.fcl
# As of February 2017, this value is no longer used.
 Argon39DecayRate: 0.0

 # Optical properties
 # Fast and slow scintillation emission spectra, from [J Chem Phys vol 91 (1989) 1469]
 FastScintEnergies:    [ 6.0,  6.7,  7.1,  7.4,  7.7, 7.9,  8.1,  8.4,  8.5,  8.6,  8.8,  9.0,  9.1,  9.4,  9.8,  10.4,  10.7]
 SlowScintEnergies:    [ 6.0,  6.7,  7.1,  7.4,  7.7, 7.9,  8.1,  8.4,  8.5,  8.6,  8.8,  9.0,  9.1,  9.4,  9.8,  10.4,  10.7]
 FastScintSpectrum:    [ 0.0,  0.04, 0.12, 0.27, 0.44, 0.62, 0.80, 0.91, 0.92, 0.85, 0.70, 0.50, 0.31, 0.13, 0.04,  0.01, 0.0]
 SlowScintSpectrum:    [ 0.0,  0.04, 0.12, 0.27, 0.44, 0.62, 0.80, 0.91, 0.92, 0.85, 0.70, 0.50, 0.31, 0.13, 0.04,  0.01, 0.0]
 ScintResolutionScale: 1.     # resolution factor used by G4 scintillation
 ScintFastTimeConst:   6.     # fast scintillation time constant (ns)
 ScintSlowTimeConst:   1590.  # slow scintillation time constant (ns)
 ScintBirksConstant:   0.069  # birks constant for LAr (1/MeV cm)
 ScintYield:           24000. # total scintillation yield (ph/Mev)
 ScintPreScale:        0.03   # Scale factor to reduce number of photons simulated
                              # Later QE should be corrected for this scale
 ScintYieldRatio:      0.3    # fast / slow scint ratio (needs revisitting)
 ScintByParticleType:  false  # whether to use different yields and
                              # quenching per particle in fast op sim
 EnableCerenkovLight: true    # whether to switch on cerenkov light (slow)




 # Scintillation yields and fast/slow ratios per particle type
 MuonScintYield:          24000
 MuonScintYieldRatio:     0.23
 PionScintYield:          24000
 PionScintYieldRatio:     0.23
 ElectronScintYield:      20000
 ElectronScintYieldRatio: 0.27
 KaonScintYield:          24000
 KaonScintYieldRatio:     0.23
 ProtonScintYield:        19200
 ProtonScintYieldRatio:   0.29
 AlphaScintYield:         16800
 AlphaScintYieldRatio:    0.56


 # Refractive index as a function of energy (eV) from arXiv:2002.09346
 RIndexEnergies: [ 1.18626, 1.68626, 2.18626, 2.68626, 3.18626, 3.68626, 4.18626, 4.68626, 5.18626, 5.68626, 6.18626, 6.68626, 7.18626, 7.68626, 8.18626, 8.68626, 9.18626, 9.68626, 10.1863, 10.6863, 11.1863 ]
 RIndexSpectrum: [ 1.24664, 1.2205, 1.22694, 1.22932, 1.23124, 1.23322, 1.23545, 1.23806, 1.24116, 1.24489, 1.24942, 1.25499, 1.26197, 1.2709, 1.28263, 1.29865, 1.32169, 1.35747, 1.42039, 1.56011, 2.16626 ]

 # absorption length as function of energy
 AbsLengthEnergies: [ 4,     5,     6,     7,     8,     9,     10,    11   ]
 AbsLengthSpectrum: [ 2000., 2000., 2000., 2000., 2000., 2000., 2000., 2000.]

 # Rayleigh scattering length (cm) @ 90K as a function of energy (eV) from arXiv:2002.09346

RayleighEnergies: [ 1.18626, 1.68626, 2.18626, 2.68626, 3.18626, 3.68626, 4.18626, 4.68626, 5.18626, 5.68626, 6.18626, 6.68626, 7.18626, 7.68626, 8.18626, 8.68626, 9.18626, 9.68626, 10.1863, 10.6863, 11.1863 ]
RayleighSpectrum: [ 1200800, 390747, 128633, 54969.1, 27191.8, 14853.7, 8716.9, 5397.42, 3481.37, 2316.51, 1577.63, 1092.02, 763.045, 534.232, 371.335, 252.942, 165.38, 99.9003, 51.2653, 17.495, 0.964341 ]

 # Surface reflectivity data - vector of energy spectrum per
 #   surface type
 ReflectiveSurfaceEnergies:           [ 7, 9, 10 ]
 ReflectiveSurfaceNames:            [ "STEEL_STAINLESS_Fe7Cr2Ni" ]
 ReflectiveSurfaceReflectances:     [ [ 0.25, 0.25, 0.25 ] ]
 ReflectiveSurfaceDiffuseFractions: [ [ 0.5,  0.5,  0.5  ] ]

 # Information related with the simulation of the Wavelength Shifter (TPB)
 LoadExtraMatProperties: false

 # TPB - WLS
 TpbTimeConstant: 2.5 #wls time constant in s J. Lumin 81(1999) 285

 # WLS - TPB properties original tpb [0.0, 0.0, 0.0, 0.0588,0.235, 0.853, 1.0,1.0,0.9259,0.704,0.0296,0.011, 0.0,0.0, 0.]
 TpbEmmisionEnergies: [0.05,1.0,1.5, 2.25, 2.481, 2.819, 2.952,2.988,3.024, 3.1, 3.14,3.1807, 3.54, 5.5, 50.39]
 TpbEmmisionSpectrum: [0.0, 0.0, 0.0, 0.0588,0.235, 0.853, 1.0,1.0,0.9259,0.704,0.0296,0.011, 0.0,0.0, 0.]
 TpbAbsorptionEnergies: [0.05,1.77,2.0675, 7.42, 7.75, 8.16, 8.73, 9.78,10.69, 50.39]
 TpbAbsorptionSpectrum: [100000.0,100000.0, 100000.0,0.001,0.00000000001,0.00000000001, 0.00000000001, 0.00000000001, 0.00000000001, 0.00000000001]

}

END_PROLOG

BEGIN_PROLOG

dune35t_properties:                  @local::standard_properties

dunefd_properties:                   @local::standard_properties
# Load TPB properties for photon simulation
dunefd_properties.LoadExtraMatProperties: true 

dunefddphase_properties:             @local::standard_properties

END_PROLOG
BEGIN_PROLOG

standard_larfft:
{
 FFTSize:    0   # Default to the readout window size
 FFTOption: ""   # Add option "P" for planning.
 FitBins:   20   # Number of bins of correlation used for peak fit
}

END_PROLOG

BEGIN_PROLOG


dunefd_larfft:           @local::standard_larfft
dunefd_larfft.FitBins:   5

dune35t_larfft:            @local::standard_larfft
dune35t_larfft.FitBins:    5

# Note: going much higher on the FitBins introduces an 
# undesired time offset in dune wires


END_PROLOG

BEGIN_PROLOG

standard_debug:
{
 debugModules: [ "*" ]     # list individual module names here if you only want output from specific modules
 destinations:
 {	
  debugmsg:
  {
   type:      "file"       # record the messages in a file, could also be cout, cerr, archive, dds
   filename:  "debug.log"  # name of the file in which to place the messages
   threshold: "DEBUG"      # threshold of what level of messages to use
   categories:             # place to list named categories, if you want to customize, 
                           # I think the categories are what are the strings given to mf::LogXXX() commands
   {
     default:              # treat all unspecified categories using these values
     {
      limit:       10      # only show the first n messages and then back off exponentially
      reportEvery: 20      # report every nth message
      timespan:    600     # if more than this many seconds have elapsed without a message, print one
     }
   } # end categories
  } # end debugmsg
 } # end destinations
} # end standard_debug

# see comments for standard_debug configuration to figure out what each value is
standard_info:
{ 
 destinations:
 {  
  infomsg:
  {
   type:      "cout"	
   threshold: "INFO"
   categories:                                      
   {
     default:             
     {
      limit:       1000   
      timespan:    600    
     }
     RecoBaseDefaultCtor:
     {
      limit: 5
      timespan: 1000
     }
     GeometryBadInputPoint:
     {
      limit: 5
      timespan: 1000
     }
   } # end categories
  } # end infomsg
 } # end destinations
} # end standard_info

# see comments for standard_debug configuration to figure out what each value is
standard_warning:
{ 
 destinations:
 {  
  warningmsg:
  {
   type:      "cout"	
   threshold: "WARNING"
   categories: 
   {
     default:             
     {
      limit:       1000   
      timespan:    60    
     }
     RecoBaseDefaultCtor:
     {
      limit: 5
      timespan: 1000
     }
     GeometryBadInputPoint:
     {
      limit: 5
      timespan: 1000
     }
   } # end categories
  } # end warningmsg
 } # end destinations
} # end standard_warning

# see comments for standard_debug configuration to figure out what each value is
standard_error:
{ 
 destinations:
 {  
  errormsg:
  {
   type:      "cerr"	
   threshold: "ERROR"
   categories: 
   {
     default: {} 
   } # end categories
  } # end errormsg
 } # end destinations
} # end standard_error

END_PROLOG

BEGIN_PROLOG

#for now the parameter sets for the different experiments are all the same

standard_largeantparameters:
{
 OpticalSimVerbosity:      0       #verbosity of optical simulation, soon to be depricated
 ParticleKineticEnergyCut: 0.01e-3  #in GeV
 StoreTrajectories:        true
 VisualizationEnergyCut:   10.e-3  #depricated, in GeV
 VisualizeNeutrals:        false   #depricated
 UseCustomPhysics:         false   #Whether to use a custom list of physics processes or the default
 ModifyProtonCut:          false   #Whether to modify the default proton cut
 NewProtonCut:             0.0     #new ProtonCut value, ModifyProtonCut must be set to set new value
 KeepEMShowerDaughters:    false   #save secondary, tertiary, etc particles in EM showers
 LongitudinalDiffusion:    6.2e-9  #in cm^2/ns
 TransverseDiffusion:      16.3e-9 #in cm^2/ns
 ElectronClusterSize:      600.0   #number of ionization electrons to drift in a unit
 MinNumberOfElCluster:     0	   #minimum number of electron clusters
 EnabledPhysics:           [ "Em", "SynchrotronAndGN", "Ion", "Hadron",
                             "Decay", "HadronElastic", "Stopping", "NeutronTrackingCut" ]
 CosmogenicK0Bias:         0 # 0 is off. N is the number of secondaries to produce.
 CosmogenicXSMNBiasOn:     0 # 0 is off. 1 works. 2 still in development.
 CosmogenicXSMNBiasFactor: 1 # Not more than 5-ish cuz of numerical instabilities.
 DisableWireplanes:        false #if set true, charge drift simulation does not run - used for optical sim jobs OR just when you don't wanna drift the e's.
 SkipWireSignalInTPCs:     []     # put here TPC id's which should not receive ionization electrons - used to simulate TPC geom volumes which are actually dead LAr volumes in protoDUNE
 UseModBoxRecomb:          true   # use Modified Box recombination instead of Birks

 #* Recombination factor coefficients come from Nucl.Instrum.Meth.A523:275-286,2004
 #* * @f$ dE/dx @f$ is given by the voxel energy deposition, but have to convert it to MeV/cm from GeV/voxel width
 #* * electric field: @f$ E @f$ in kV/cm
 #* * @f$ R = A/(1 + (dE/dx)*k/E) @f$
 #* * @f$ A = 0.800 \pm 0.003 @f$
 #* * @f$ k = 0.0486 @f$ needs to be scaled with Electric field
 RecombA: 0.800      #< _A_ constant.
 Recombk: 0.0486     #< _k_ constant, in g/(MeV cm&sup2;)*kV/cm.

 #* Recombination factor coefficients come from Nucl.Instrum.Meth.A523:275-286,2004
 #* * @f$ dE/dx @f$ is given by the voxel energy deposition, but have to convert it to MeV/cm from GeV/voxel width
 #* * electric field: @f$ E @f$ in kV/cm
 #* * `kModBoxB` needs to be scaled with the electric field.
 ModBoxA: 0.930
 ModBoxB: 0.212

 # The following parameters specify details of wireplanes or similar
 #  areas with optically parameterized transmissions (Ben J 2013)

 #  volume names to be associated with an optical wireplane model
 OpticalParamVolumes:      ["volTPCPlaneVert_PV"]

 #  specification of which model to use for each volume
 OpticalParamModels:       ["OverlaidWireplanes"]

 # orientation of each wireplane set
 #  0 = Xdrift, 1 = Ydrift, 2 = Zdrift
 OpticalParamOrientations: [0]

 # This a set of floats which is specific to the particular model used.
 # For overlaid wireplanes, should be a vector of vectors of
 #                                 [plane angle, pitch/mm, wire diameter/mm]
 #
 # This format is chosen to allow for future extensions to the model
 #  for, eg, DUNE wireplane development.
 #
 OpticalParamParameters:   [ [ [60,  3, 0.15],
 	 		       [-60, 3, 0.15],
                               [0,   3, 0.15] ] ]
 UseLitePhotons: false
}

jp250L_largeantparameters:     @local::standard_largeantparameters
bo_largeantparameters:         @local::standard_largeantparameters
argoneut_largeantparameters:   @local::standard_largeantparameters
# The following line is already in simulationservices_microboone.fcl
# and so it should not also be included here, for clarity's sake.
#microboone_largeantparameters: @local::standard_largeantparameters
dune35t_largeantparameters:    @local::standard_largeantparameters
dunefd_largeantparameters:   @local::standard_largeantparameters

standard_larvoxelcalculator:
{
 VoxelSizeX:     0.03    #in cm
 VoxelSizeY:     0.03    #in cm
 VoxelSizeZ:     0.03    #in cm
 VoxelSizeT:     5000.0  #in ns
 VoxelOffsetX:   0.0     #in cm
 VoxelOffsetY:   0.0     #in cm
 VoxelOffsetZ:   0.0     #in cm
 VoxelOffsetT:   -2500.0 #in ns
 VoxelEnergyCut: 1.e-6   #in GeV
}

bo_larvoxelcalculator:         @local::standard_larvoxelcalculator
jp250L_larvoxelcalculator:     @local::standard_larvoxelcalculator
argoneut_larvoxelcalculator:   @local::standard_larvoxelcalculator
# The following line is already in simulationservices_microboone.fcl
# and so it should not also be included here, for clarity's sake.
#microboone_larvoxelcalculator: @local::standard_larvoxelcalculator
dune35t_larvoxelcalculator:    @local::standard_larvoxelcalculator
dunefd_larvoxelcalculator:     @local::standard_larvoxelcalculator

END_PROLOG

BEGIN_PROLOG


dunefd_largeantparameters:   @local::standard_largeantparameters
dunefd_larvoxelcalculator:   @local::standard_larvoxelcalculator
dunefd_largeantparameters.UseLitePhotons: true

protodune_largeantparameters:   @local::standard_largeantparameters
protodune_largeantparameters.UseCustomPhysics: true
protodune_largeantparameters.EnabledPhysics: [
         "Em",
         "FastOptical",
         "SynchrotronAndGN",
         "Ion",
         "Hadron",
         "Decay",
         "HadronElastic",
         "Stopping"
        ] # removed NeutronTrackingCut so neutrons from cosmics generator can appear throughout the full readout window

protodune_larvoxelcalculator:   @local::standard_larvoxelcalculator
protodune_largeantparameters.UseLitePhotons: true

dune35t_largeantparameters:   @local::dunefd_largeantparameters
dune35t_largeantparameters.UseModBoxRecomb: true
dune35t_larvoxelcalculator:   @local::dunefd_larvoxelcalculator


END_PROLOG
# signalservices_dune.fcl
#
# David Adams
# January 2016
#
# 28jan2016: Modify filter to fix problems with baseline for deconvoluted signals.
#            See https://cdcvs.fnal.gov/redmine/issues/11475.

BEGIN_PROLOG

dunefd_signalshapingservice: {

  DeconNorm: 200
  ADCPerPCAtLowestASICGain: 13160 #ADC/pC (2.8 ADC/mV * 4.7 mV/fC * 1000)
  # ASICGains:           [4.7, 7.8, 14, 25]
  ASICGainInMVPerFC:  [ 14, 14, 14 ] #mV/fC for Ind & col planes
  ShapeTimeConst:  [ 2.0, 2.0, 2.0 ] #Gain and Peaking time (microseconds)

  # Noise Factor - rms ADCs @ lowest ASIC Gain (4.7 mV/fC)
  NoiseFactVec:         [[ 1.12, 0.86, 0.60, 0.55 ], [ 1.12, 0.86, 0.60, 0.55 ], [ 0.89, 0.66, 0.48, 0.43 ]]
  # to turn off noise
  # NoiseFactVec:         [[ 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0 ]]


  #FieldBins:        75 # for UseFunctionFieldShape: true
  FieldBins:        400
  InputFieldRespSamplingPeriod: 100. # in nano second

  Col3DCorrection:  2.5
  Ind3DCorrection:  1.5
  ColFieldRespAmp:  1.0
  IndUFieldRespAmp:  1.0
  IndVFieldRespAmp:  1.0

  FieldResponseTOffset: [-32.5e3, -32.5e3, -32.5e3] # in ns, time offset of field response shape
  CalibResponseTOffset: [0.0, 0.0, 0.0] # in ns time offset to align all three planes


  # For IndFilter and ColFilter, frequency (x) is measured in
  # cycles/microsecond.  The conversion to frequency bin depends on FFT size
  # samping rate.

  #dla IndUFilter:       "(x>0.0)*gaus(0)*exp(-0.5*pow(x/[3],[4]))"
  IndUFilter:       "gaus(0)*exp(-0.5*pow(x/[3],[4]))"
  # IndUFilterParams: [ .454, 0.0, 0.1875, 0.25, 8.0 ]
  #IndUFilterParams: [ 0.05, 0.0, 0.1875, 0.25, 8.0 ]
  IndUFilterParams: [ 1.73, 1.69, 1.55, 0.19, 3.75 ]

  #dla IndVFilter:       "(x>0.0)*gaus(0)*exp(-0.5*pow(x/[3],[4]))"
  IndVFilter:       "gaus(0)*exp(-0.5*pow(x/[3],[4]))"
  # IndVFilterParams: [ .454, 0.0, 0.1875, 0.25, 8.0 ]
  #IndVFilterParams: [ 0.05, 0.0, 0.1875, 0.25, 8.0 ]
  #dla IndVFilterParams: [ 1.74, 1.46, 1.33, 0.23, 4.89 ]
  IndVFilterParams: [ 1.73, 1.69, 1.55, 0.19, 3.75 ]


  #dla ColFilter:       "(x>0)*[0]*exp(-0.5*(((x-[1])/[2])^2)^[3])"
  ColFilter:       "[0]*exp(-0.5*(((x-[1])/[2])^2)^[3])"
  # ColFilterParams: [ 79258.0, 0.0, 0.1875, 1.5 ]
  #ColFilterParams: [ 0.0792580, 0.0, 0.1875, 1.5 ]
  ColFilterParams: [ 1.03, 0.08, 0.15, 2.17 ]

  GetFilterFromHisto:   false

  FilterFunctionFname:  "uboone_filters_v0.1.root"
  FilterHistoName:	"noisefilter_%d"


  UseFunctionFieldShape: false
  UseHistogramFieldShape: true
  FieldResponseFname:     "FieldResponse/dune35t_response_v1.0.root"
  FieldResponseHistoName: "FieldResponse"

  IndUFieldShape: "[0]*(1.0+[3]*tanh(x-[4]))*([4]-x)*exp(-0.5*((x-[4])/[2])^2.0)"
  IndUFieldParams:  [.00843,.1534,1.77,0.,0.5]    #last parameter needs to be half of FFT vector, correct for in code
  IndVFieldShape: "[0]*(1.0+[3]*tanh(x-[4]))*([4]-x)*exp(-0.5*((x-[4])/[2])^2.0)"
  IndVFieldParams:  [.00843,.1534,1.77,0.,0.5]    #last parameter needs to be half of FFT vector, correct for in code
  ColFieldShape: "x^[2]/(1.0+(x/[0])^[1])"
  ColFieldParams: [ 8.0,16.0,.75 ]

  DebugFieldShape: false
}

# 35t is the same for now

dune35t_signalshapingservice:   @local::dunefd_signalshapingservice
### Previous default settings
#dune35t_signalshapingservice.ADCPerPCAtLowestASICGain: 11700 #ADC/pC   (For correct Digitization)
#dune35t_signalshapingservice.ASICGainInMVPerFC: [7.8, 7.8, 7.8] #mV/fC for Ind & col planes
#dune35t_signalshapingservice.ShapeTimeConst:  [ 2.0, 2.0, 2.0 ] #Gain and Peaking time (microseconds)
### Bringing in line with data settings, 8th Sept 2016
dune35t_signalshapingservice.ASICGainInMVPerFC: [ 14.0, 14.0, 14.0] #mV/fC for Ind & col planes
dune35t_signalshapingservice.ShapeTimeConst:    [ 3.0 , 3.0 , 3.0 ] #Gain and Peaking time (microseconds)
#
# 3x1x1, protoDUNE and DUNE dual-phase signal service
#

# ProtoDUNE single phase
protodunesp_signalshapingservice: @local::dunefd_signalshapingservice
protodunesp_signalshapingservice.ColFilter: "(x>0.0)*gaus"
protodunesp_signalshapingservice.ColFilterParams: [ 1.0, 0.0, 0.1 ]
protodunesp_signalshapingservice.IndUFilter: "(x>0.0)*gaus"
protodunesp_signalshapingservice.IndUFilterParams: [ 1.0, 0.0, 0.1 ]
protodunesp_signalshapingservice.IndVFilter: "(x>0.0)*gaus"
protodunesp_signalshapingservice.IndVFilterParams: [ 1.0, 0.0, 0.1 ]


dunefddphase_signalshapingservice:
{
  AreaNorm:  35.64   # in units (ADC x us) / fC	
  ADCpermV:  1.0     # ADC conversion factor (not used at the moment)
  AmpENC:    1000.0  # noise in electrons from TDR
  DeconNorm: 70.0
  ShapeFunc: "1/([0]-[1]) * ( exp(-(x)/[0]) - exp(-(x)/[1]) )"
  ShapeFuncParams: [0.5, 4.0]
  RespSamplingPeriod: 400. # in nano second
 
  AddFieldFunction: false
  ColFieldFunction: "x*[0]"
  ColFieldFunctionParams: [1.0]
  ColFieldRespAmp: 1.0

  ColFilter:       "[0]*exp(-1.2*(((x-[1])/[2])^2)^[3])"
  ColFilterParams: [ 1.0, 0.0, 0.136, 2.5 ]
  #FieldFunctionParameters: [1.0, 1.0, 1.0, 1.0] #0 step width #1 step height #2 slow/fast (could be taken from E field) #Tau (could be taken from field and temperature). 0 and Tau in us
}

# ProtoDUNE dual phase
protodunedphase_signalshapingservice: @local::dunefddphase_signalshapingservice
protodunedphase_signalshapingservice.ColFilter: "(x>0.0)*gaus"
protodunedphase_signalshapingservice.ColFilterParams: [ 1.0, 0.0, 0.1 ]

# 3x1x1 dual phase TPC
dunedphase3x1x1_signalshapingservice: @local::dunefddphase_signalshapingservice
dunedphase3x1x1_signalshapingservice.AreaNorm:   16.84 
dunedphase3x1x1_signalshapingservice.AreaNorm1m: 23.58
dunedphase3x1x1_signalshapingservice.ShapeFunc: "[0]*exp((x-[1])/[2]) / ( 1 + exp((x-[1])/[3]))"        #obtained from pulsed waveform fit
dunedphase3x1x1_signalshapingservice.ShapeFuncParams: [1.21581, 0.864873, 0.288648, 0.27413]		#obtained from pulsed waveform fit
dunedphase3x1x1_signalshapingservice.ShapeFunc1m: "[0]*exp((x-[1])/[2]) / ( 1 + exp((x-[1])/[3]))"      #obtained from pulsed waveform fit
dunedphase3x1x1_signalshapingservice.ShapeFuncParams1m: [1.46135, 1.0228, 0.336029, 0.29685]		#obtained from pulsed waveform fit

END_PROLOG
BEGIN_PROLOG

no_mag:
{
FieldDescriptions: [ { UseField:         0  # 0--off 1--Constant field
                                            # 2--Field map (not implemented)
                       ConstantField:    [ 0.0, 0.0, 0.0 ]
                       MagnetizedVolume: "volWorld" } ]
}

no_mag_larsoft: @local::no_mag

END_PROLOG
BEGIN_PROLOG

standard_database:
{
  DBHostName:		"fnalpgsdev.fnal.gov"
  DBName:		"uboonedaq_dev"
  DBUser:		"uboonedaq_reader"
  Port:			5436
  PassFileName:		".pswd"
  ToughErrorTreatment:  false                #if true, throw cet::exception at DB connection error
  ShouldConnect:        false
  TableName:    	"main_run"
}

END_PROLOG

BEGIN_PROLOG


dunefd_database:               @local::standard_database
dunefd_database.DBName:	       "dune_dev"
dunefd_database.DBUser:	       "dune_reader"
dunefd_database.Port:	       5438
dunefd_database.PassFileName:  ".lpswd"
dunefd_database.ShouldConnect: false # enable it when DB is available
dunefd_database.ToughErrorTreatment: false # enable it when DB is available too

dune35t_database:               @local::standard_database
dune35t_database.DBName:        "dune_dev"
dune35t_database.DBUser:        "dune_reader"
dune35t_database.Port:          5438
dune35t_database.PassFileName:  ".lpswd"
dune35t_database.ShouldConnect: false # enable it when DB is available
dune35t_database.ToughErrorTreatment: false # enable it when DB is available too


END_PROLOG
BEGIN_PROLOG

PIProv: {
  G4ModuleLabel: "largeant"
  EveIdCalculator: "EmEveIdCalculator"
}
standard_particleinventoryservice: {
  ParticleInventory: @local::PIProv
}

jp250L_particleinventoryservice:     @local::standard_particleinventoryservice
bo_particleinventoryservice:         @local::standard_particleinventoryservice
argoneut_particleinventoryservice:   @local::standard_particleinventoryservice
microboone_particleinventoryservice: @local::standard_particleinventoryservice
#dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
#dunefd_particleinventoryservice:     @local::standard_particleinventoryservice

END_PROLOG



BEGIN_PROLOG

providerBKConf:{
 G4ModuleLabel:            "largeant" # module that produced the sim::Particle objects
 SimChannelModuleLabel:    "largeant" # module that produced the sim::SimChannel objects, if not provided defaults to using the G4ModuleLabel
 MinimumHitEnergyFraction: 0.1        # minimum fraction of energy a G4 trackID contributes to a hit to be 
                                      # counted in hit based efficiency and purity calculations
}

standard_backtrackerservice:

{
 BackTracker: @local::providerBKConf
}

jp250L_backtrackerservice:     @local::standard_backtrackerservice

bo_backtrackerservice:         @local::standard_backtrackerservice

argoneut_backtrackerservice:   @local::standard_backtrackerservice

microboone_backtrackerservice: @local::standard_backtrackerservice

#dune35t_backtrackerservice:    @local::standard_backtrackerservice

#dunefd_backtrackerservice:     @local::standard_backtrackerservice

END_PROLOG


BEGIN_PROLOG

dune35t_backtrackerservice:    @local::standard_backtrackerservice
dunefd_backtrackerservice:     @local::standard_backtrackerservice

END_PROLOG
BEGIN_PROLOG

PIProv: {
  G4ModuleLabel: "largeant"
  EveIdCalculator: "EmEveIdCalculator"
}
standard_particleinventoryservice: {
  ParticleInventory: @local::PIProv
}

jp250L_particleinventoryservice:     @local::standard_particleinventoryservice
bo_particleinventoryservice:         @local::standard_particleinventoryservice
argoneut_particleinventoryservice:   @local::standard_particleinventoryservice
microboone_particleinventoryservice: @local::standard_particleinventoryservice
#dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
#dunefd_particleinventoryservice:     @local::standard_particleinventoryservice

END_PROLOG



BEGIN_PROLOG

dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
dunefd_particleinventoryservice:     @local::standard_particleinventoryservice
#dune35t_particleinventoryservice.ParticleInventory.EveIdCalculator: "EveIdCalculator"
#dunefd_particleinventoryservice.ParticleInventory.EveIdCalculator: "EveIdCalculator"

END_PROLOG
BEGIN_PROLOG

PIProv: {
  G4ModuleLabel: "largeant"
  EveIdCalculator: "EmEveIdCalculator"
}
standard_particleinventoryservice: {
  ParticleInventory: @local::PIProv
}

jp250L_particleinventoryservice:     @local::standard_particleinventoryservice
bo_particleinventoryservice:         @local::standard_particleinventoryservice
argoneut_particleinventoryservice:   @local::standard_particleinventoryservice
microboone_particleinventoryservice: @local::standard_particleinventoryservice
#dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
#dunefd_particleinventoryservice:     @local::standard_particleinventoryservice

END_PROLOG


BEGIN_PROLOG

providerPBKConf:{
 G4ModuleLabel:            "largeant" # module that produced the sim::Particle and sim::SimChannel objects
 MinimumHitEnergyFraction: 0.1        # minimum fraction of energy a G4 trackID contributes to a hit to be 
                                      # counted in hit based efficiency and purity calculations
 Delay:                    0          #This number is the difference between when light arrives at the detector, and the time recorded in OpHits. This number is experiment specific and should be set by each experiment. 
}

standard_photonbacktrackerservice:
{
 PhotonBackTracker: @local::providerPBKConf
}

END_PROLOG


#
# File:    seedservice_dune.fcl
# Desc:    custom configurations of NuRandomService for DUNE
# Author:  Gianluca Petrillo (petrillo@fnal.gov)
# Date:    February 13th, 2015
# Version: 1.0
# 
# The default configuration is the "random" policy, that defies the goal of the
# seed service altogether.
# 
# Changes:
# 13022015 (petrillo@fnal.gov) [v1.0]
#   first version; not many choices here
# 
#

#
# File:    NuRandomService.fcl
# Brief:   Default configuration for random seed service
# Author:  Gianluca Petrillo (petrillo@fnal.gov)
# Date:    February 5th, 2015
# Version: 1.0
# 
# The default configuration for the seed service uses the autoIncrement policy.
# 
# Use this as:
# 
# services.NuRandomService: @local::standard_NuRandomService
# 
# 
# Changes:
# 20150205 (petrillo@fnal.gov) [v1.0]
#   first version
#

BEGIN_PROLOG


autoincrement_NuRandomService: {
  # policy: autoIncrement
  # each time a seed is requested, a counter is increased and its value returned
  # as seed; the first seed returned is baseSeed
  policy            :    "autoIncrement"
  
  # this is the first seed that is returned;
  # override it with:
  # 
  # services.NuRandomService.baseSeed: MySeed
  # 
  baseSeed          : 2829
  
  # since this is a generic configuration and we don't know how many seeds there
  # are going to be around, we just skip the range check
  checkRange        : false
  
  # print into the log all seeds at the end of the job
  endOfJobSummary   :  true
} # autoincrement_NuRandomService


linearmapping_NuRandomService: {
  # policy: linearIncrement
  # each time a seed is requested, a counter is increased and its value returned
  # as seed; the first seed returned is nJob x maxUniqueEngines
  policy            :    "linearMapping"
  
  # this is the number of this job in an absolute batch count; override it with:
  # 
  # services.NuRandomService.nJob: NJOB
  #
  nJob            :  1
  maxUniqueEngines: 20
  
  # make sure that we don't try to use more engines than we are allowed;
  # that would mean overlapping random seeds with the next job
  checkRange      :  true
  
  # print into the log all seeds at the end of the job
  endOfJobSummary   :  true
} # linearmapping_NuRandomService


random_NuRandomService: {
  # policy: random
  # each time a seed is requested, a random number is returned.
  # 
  policy            :    "random"
  
  # if you really want this sequence of seeds to be reproducible,
  # insert here a seed for the random seed generator
  # baseSeed          : 64429
  
  # print into the log all seeds at the end of the job
  endOfJobSummary   :  true
} # random_NuRandomService


per_event_NuRandomService: {
  # policy: perEvent
  # on each event, the seed is computed from event information
  # 
  policy            :    "perEvent"
  
  # print into the log all seeds at the end of the job
  endOfJobSummary   :  false
} # per_event_NuRandomService


# choose our autoIncrement configuration as "standard"
standard_NuRandomService: @local::autoincrement_NuRandomService


END_PROLOG


BEGIN_PROLOG

# 
# the random policy extracts unpredictable, random seeds in a way similar to the
# behaviour that existed before NuRandomService.
# You don't want this for production.
# 
dune_seedservice: @local::random_NuRandomService # from seedservice.fcl


END_PROLOG
BEGIN_PROLOG

# the "standard" values are supposed to be good for ArgoNeuT
standard_detectorclocks:
{
  service_provider: "DetectorClocksServiceStandard"
  
  TrigModuleName:    ""
  InheritClockConfig: true
  G4RefTime:         0     # G4 time [us] where electronics clock counting start
  TriggerOffsetTPC:  0     # Time offset for TPC readout start time w.r.t. trigger [us]
  FramePeriod:       405.504 # Frame period [us]; 2048 * 198 ns
  ClockSpeedTPC:     5.0505  # TPC clock speed in MHz; 1 / 198.0 ns
  ClockSpeedOptical: 64    # Optical clock speed in MHz
  ClockSpeedTrigger: 16    # Trigger clock speed in MHz
  ClockSpeedExternal:31.25 # External clock speed in MHz
  DefaultTrigTime:   0     # Default trigger time in electronics clock [us]
  DefaultBeamTime:   0     # Default beam gate time in electronics clock [us]
}

END_PROLOG

BEGIN_PROLOG

dunefd_detectorclocks: @local::standard_detectorclocks

# dunefd_detectorclocks.TrigModuleName:      ""
dunefd_detectorclocks.InheritClockConfig:   false
dunefd_detectorclocks.G4RefTime:            0.  # G4 time [us] where electronics clock counting start
dunefd_detectorclocks.TriggerOffsetTPC:     0.  # Time [us] for TPC readout start w.r.t. trigger time
dunefd_detectorclocks.FramePeriod:       1600.  # Frame period [us]
dunefd_detectorclocks.ClockSpeedTPC:        2.  # TPC clock speed in MHz
dunefd_detectorclocks.ClockSpeedOptical:   62.5 # Optical clock speed in MHz
dunefd_detectorclocks.ClockSpeedTrigger:   16.  # Trigger clock speed in MHz
dunefd_detectorclocks.DefaultTrigTime:      0.  # Default trigger time [us].
dunefd_detectorclocks.DefaultBeamTime:      0.  # Default beam time [us].


dunefddphase_detectorclocks: @local::standard_detectorclocks
# dunefddphase_detectorclocks.TrigModuleName:      ""
dunefddphase_detectorclocks.InheritClockConfig:   false
dunefddphase_detectorclocks.G4RefTime:            0.    # G4 time [us] where electronics clock counting start
dunefddphase_detectorclocks.TriggerOffsetTPC:     0.    # Time [us] for TPC readout start w.r.t. trigger time
dunefddphase_detectorclocks.FramePeriod:          8000. # Frame period [us]
dunefddphase_detectorclocks.ClockSpeedTPC:        2.5   # TPC clock speed in MHz
dunefddphase_detectorclocks.ClockSpeedOptical:    250.  # Optical clock speed in MHz
dunefddphase_detectorclocks.ClockSpeedTrigger:    16.   # Trigger clock speed in MHz
dunefddphase_detectorclocks.DefaultTrigTime:      0.    # Default trigger time [us].
dunefddphase_detectorclocks.DefaultBeamTime:      0.    # Default beam time [us].

protodunedphase_detectorclocks: @local::dunefddphase_detectorclocks
protodunedphase_detectorclocks.FramePeriod:         4000. # Frame period [us]
protodunedphase_detectorclocks.ClockSpeedOptical:   62.5  # Optical clock speed in MHz

dune35t_detectorclocks: @local::standard_detectorclocks

# dune35t_detectorclocks.TrigModuleName:      ""
dune35t_detectorclocks.InheritClockConfig:   false
dune35t_detectorclocks.G4RefTime:            0. # G4 time [us] where electronics clock counting start
dune35t_detectorclocks.TriggerOffsetTPC:     0. # Time [us] for TPC readout start w.r.t. trigger time
dune35t_detectorclocks.FramePeriod:       2600. # Frame period [us]
dune35t_detectorclocks.ClockSpeedTPC:        2. # TPC clock speed in MHz
dune35t_detectorclocks.ClockSpeedOptical:  128. # Optical clock speed in MHz
dune35t_detectorclocks.ClockSpeedTrigger:   16. # Trigger clock speed in MHz
dune35t_detectorclocks.DefaultTrigTime:      0. # Default trigger time [us].
dune35t_detectorclocks.DefaultBeamTime:      0. # Default beam time [us].

# Implement new 6000 tick readout window (500 before trigger, or 250 us)
protodune_detectorclocks: @local::standard_detectorclocks

protodune_detectorclocks.InheritClockConfig:   false
protodune_detectorclocks.G4RefTime:            -250. # G4 time [us] where electronics clock counting start
protodune_detectorclocks.TriggerOffsetTPC:  -250. # Time [us] for TPC readout start w.r.t. trigger time (500 ticks)
protodune_detectorclocks.FramePeriod:       1600. # Frame period [us]
protodune_detectorclocks.ClockSpeedTPC:        2. # TPC clock speed in MHz
protodune_detectorclocks.ClockSpeedOptical:  150. # Optical clock speed in MHz
protodune_detectorclocks.ClockSpeedTrigger:   16. # Trigger clock speed in MHz
protodune_detectorclocks.DefaultTrigTime:     250. # Default trigger time [us].
protodune_detectorclocks.DefaultBeamTime:     250. # Default beam time [us].

dunedphase3x1x1_detectorclocks: @local::dunefddphase_detectorclocks
dunedphase3x1x1_detectorclocks.ClockSpeedOptical:  250. # Optical clock speed in MHz

END_PROLOG
# Contains information required for:
# Timing parameterisation for VUV photons (propagation time)

BEGIN_PROLOG

# VUV/DIRECT LIGHT: TIMING PARAMETERISATION
# Parameters of the Landau + Exponential (<= 350 cm) and Landau (> 350 cm) models
# Landau parameters
Distances_landau_generic: [0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 525, 550]
Norm_over_entries_generic: [ [4.64837, 4.64837, 2.86581, 1.4143, 0.974871, 0.71311, 0.55772, 0.461078, 0.411807, 0.364951, 0.325477, 0.297132, 0.297132, 0.297132, 0.297132, 0.297132,0.297132, 0.297132,
		0.297132, 0.297132, 0.297132, 0.297132, 0.297132],
		[3.43562, 3.43562, 1.61042, 0.981127, 0.64465, 0.476552, 0.369063, 0.310461, 0.264819, 0.231387, 0.215373, 0.199128, 0.189638, 0.170387, 0.159308, 0.151498,0.140134, 0.135217, 0.131114, 0.129511, 0.126329, 0.12452, 0.124595] ]
Mpv_generic: [	[2.73373, 2.73373, 3.599, 5.80141, 7.57883, 9.56959, 11.6047, 13.6676, 15.6126, 17.5389, 19.492, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254,
		21.3254, 21.3254],
		[2.19076, 2.19076, 4.0163, 5.86531, 8.09466, 10.4547, 12.9261, 15.2731, 17.7939, 20.6664, 22.99, 25.7017, 27.9139, 30.9469, 33.6378, 36.1413, 39.8435, 42.1625, 44.6396, 46.5133, 48.6331, 50.6754, 53.3949] ]
Width_generic: [ [0.198303, 0.198303, 0.347397, 0.562874, 0.750881, 0.998318, 1.2622, 1.55553, 1.79799, 2.05579, 2.3295, 2.57611, 2.57611, 2.57611, 2.57611, 2.57611,2.57611, 2.57611, 2.57611, 2.57611,
		2.57611, 2.57611, 2.57611],
		[0.305766, 0.305766, 0.508544, 0.747765, 1.12059, 1.57047, 2.07501, 2.54661, 3.09789, 3.79078, 4.19731, 4.74438, 5.09894, 5.83702, 6.36225, 6.80253, 8.278, 8.717, 9.2568, 9.7239, 10.5865, 11.3262, 11.8423] ]
# Exponential parameters
Distances_exp_generic: [0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375]
Slope_generic: [ [-0.181318, -0.181318, -0.148935, -0.126243, -0.10837, -0.0860558, -0.0759728, -0.0706126, -0.0672814, -0.0622897, -0.0577351, -0.0546709, -0.0546709, -0.0546709, -0.0546709, -0.0546709],
			[-0.169274, -0.169274, -0.119906, -0.0983691, -0.0781793, -0.0659805, -0.0587059, -0.0545288, -0.0514041, -0.0489773, -0.047259, -0.0454668, -0.0439597, -0.0415122, -0.0396851, -0.0378005] ]
Expo_over_Landau_norm_generic: [ [0.0149644, 0.0149644, 0.0337403, 0.0967895, 0.152669, 0.181732, 0.23025, 0.290033, 0.338948, 0.372986, 0.404828, 0.441243, 0.441243, 0.441243, 0.441243, 0.441243],
							[0.0252807, 0.0252807, 0.0638727, 0.113343, 0.165669, 0.216794, 0.274868, 0.325299, 0.38959, 0.466117, 0.515046, 0.578897, 0.621872, 0.689713, 0.742833, 0.773619] ]


# *************************************************************************************************
#  VUV time model, generic for all experiments (at first order)
# *************************************************************************************************

common_vuv_timing_parameterization:
{
  # Timing parameterisaion:
  #
  # Parameters of the Landau + Exponential (<= 350 cm) and Landau (> 350 cm) models
  # Landau parameters
  Distances_landau: @local::Distances_landau_generic
  Norm_over_entries: @local::Norm_over_entries_generic
  Mpv: @local::Mpv_generic
  Width: @local::Width_generic

  # Exponential parameters
  Distances_exp: @local::Distances_exp_generic
  Slope: @local::Slope_generic

  # Normalisations
  Expo_over_Landau_norm:  @local::Expo_over_Landau_norm_generic

  # Discretisation step size in cm
  step_size: 1.
  # Min and maximum distance in cm parameterisations are generated for (only generated when required to prevent long initial loading time)
  max_d: 2500.
  min_d: 25.
  # VUV group velocity in cm/ns
  vuv_vgroup_mean: 13.5
  vuv_vgroup_max: 18.
  # Distance in cm from "Landau + Expo" -> "Single Landau" model
  inflexion_point_distance: 350.

  # angular bin size in deg, must correspond to parameterisation set
  angle_bin_timing_vuv: 45
}


END_PROLOG










BEGIN_PROLOG

standard_photonvisibilityservice:
{

  NX: 75
  NY: 75
  NZ: 400
  UseCryoBoundary: true
  Interpolate: false

  DoNotLoadLibrary: false

  LibraryBuildJob: false

  #LibraryFile: "PhotonPropagation/LibraryData/lib8984855.root"
  LibraryFile: "PhotonPropagation/LibraryData/uboone_photon_library_v4.root"

 #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}

microboone_photonvisibilityservice: @local::standard_photonvisibilityservice

protodunedp_photonvisibilityservice_buildlib:
{

  NX: 29
  NY: 24
  NZ: 24
  UseCryoBoundary: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"

 #These are not used when usecryoboundary=true
  XMin: -420.5
  XMax: 304.5
  YMin: -300
  YMax: 300
  ZMin: 0
  ZMax: 600
}
#Bea

standard_photonvisibilityservice_buildlib:
{

  NX: 75
  NY: 75
  NZ: 400
  UseCryoBoundary: true
  Interpolate: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"


 #These are not used  when usecryoboundary=true
  XMin: 100
  XMax: 110
  YMin: -100
  YMax: 100
  ZMin: 500
  ZMax: 600

}


standard_photonvisibilityservice_par:
{
  NX: 125
  NY: 1
  NZ: 1
  UseCryoBoundary: false
  Interpolate: false
  DUNE10ktParameterization: true
  DoNotLoadLibrary: true

  LibraryBuildJob: false

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"
  XMin: -627
  XMax: -389
  YMin: -1.
  YMax: 1.
  ZMin: -1.00
  ZMax: 1.00

}

standard_library_vuv_prop_timing_photonvisibilityservice:
{
   # Start from the standard visibility service
   @table::standard_photonvisibilityservice

   # Flag to enable time parameterizations
   IncludePropTime: true

   # Generic VUV timing parameterization
   @table::common_vuv_timing_parameterization

}



END_PROLOG


# Contains information required for:
# Timing parameterisation Visible photons
# Corrections for semi-analytic number of hits models for VUV and visible light

# *************************************************************************************************
#          PARAMETERS SETS FOR SEMI-ANALYTIC SIMULATION ARE DEFINED HERE                        
# *************************************************************************************************     
BEGIN_PROLOG

# VUV/DIRECT LIGHT: TIMING PARAMETERISATION
# DUNE-SP
# Parameters of the Landau + Exponential (<= 400 cm) and Landau (> 400 cm) models
# Landau parameters
Distances_landau_dune: [0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 525, 550, 575, 600, 625, 650, 675, 700, 725]
Norm_over_entries_dune: [ [27.41, 27.41, 2.57134, 1.47775, 0.96034, 0.668723, 0.487808, 0.362789, 0.277659, 0.224883, 0.185199, 0.159048, 0.143393, 0.134121, 0.125978, 0.115751,
						   0.0921523, 0.0907023, 0.0856498, 0.0814134, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844],
						  [3.79032, 3.79032, 1.25862, 0.928939, 0.566822, 0.319336, 0.331336, 0.219171, 0.178579, 0.135635, 0.119011, 0.109138, 0.0991792, 0.091753, 0.0787281, 0.0743768,
						   0.0663083, 0.0648284, 0.0608437, 0.0572599, 0.0561134, 0.0543579, 0.0529609, 0.0519021, 0.0510434, 0.0504866, 0.0503902, 0.0507405, 0.0503883, 0.0497511] ]	
Mpv_dune: [ [1.77134, 1.77134, 3.85131, 5.593, 7.46645, 9.44108, 11.5899, 13.8189, 16.2753, 18.8619, 21.6428, 24.4828, 27.189, 29.6607, 32.3706, 35.2212, 41.4392, 43.2475, 45.939, 48.5748,
			 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841],
			[1.91282, 1.91282, 4.31774, 5.90297, 8.90329, 11.8104, 12.9629, 17.0555, 19.5031, 24.7774, 27.175, 29.8128, 33.5619, 36.6553, 43.0021, 46.059, 52.6953, 55.1056, 59.9728, 65.2979,
			 67.9593, 71.0675, 74.7855, 79.689, 85.3232, 90.818, 97.0409, 103.2, 111.306, 117.6] ]
Width_dune: [ [0.10303, 0.10303, 0.313506, 0.525492, 0.716541, 0.969894, 1.29961, 1.73657, 2.30482, 2.94669, 3.71951, 4.53258, 5.24435, 5.79945, 6.53951, 7.34736, 12.0305, 12.4263, 13.4917,
			   14.7245, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202],
			[0, 0.281535, 0.633816, 0.80694, 1.46701, 2.32209, 2.20895, 3.56751, 4.23966, 6.11748, 6.97923, 7.82035, 9.05225, 10.1422, 12.6053, 13.6305, 17.7093, 18.3244, 19.9961, 22.1072,
			 23.4653, 25.3052, 27.5297, 30.5683, 34.8304, 39.7456, 45.1447, 51.3363, 58.4681, 63.0122] ]
# Exponential parameters
Distances_exp_dune: [0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375]
Slope_dune: [ [-0.205783, -0.205783, -0.157344, -0.124546, -0.0949427, -0.0640574, -0.0509928, -0.0421876, -0.0360771, -0.0327956, -0.02997, -0.0280924, -0.0269181, -0.0259104, -0.0248679, -0.0233511],
			  [-0.157151, -0.157151, -0.10447, -0.0875509, -0.0605052, -0.0435416, -0.040128, -0.0325951, -0.0292046, -0.0255942, -0.0241776, -0.0226607, -0.0213594, -0.02037, -0.0181767, -0.0172752]	]
Expo_over_Landau_norm_dune:[ [0.00276789, 0.00276789, 0.0362807, 0.081067, 0.111523, 0.106485, 0.123852, 0.144239, 0.168534, 0.201111, 0.234443, 0.269284, 0.300041, 0.320541, 0.342403, 0.356125],
							 [0.0242526, 0.0242526, 0.086063, 0.101552, 0.134787, 0.171863, 0.152519, 0.203461, 0.224872, 0.279135, 0.304123, 0.317034, 0.341433, 0.360053, 0.382877, 0.391287]	]

dune_vuv_timing_parameterization:
{
  # Timing parameterisaion:
  #
  # Parameters of the Landau + Exponential (<= 400 cm) and Landau (> 400 cm) models
  # Landau parameters
  Distances_landau: @local::Distances_landau_dune
  Norm_over_entries: @local::Norm_over_entries_dune
  Mpv: @local::Mpv_dune
  Width: @local::Width_dune

  # Exponential parameters
  Distances_exp: @local::Distances_exp_dune
  Slope: @local::Slope_dune

  # Normalisations
  Expo_over_Landau_norm:  @local::Expo_over_Landau_norm_dune
  
  # Discretisation step size in cm
  step_size: 1.
  # Min and maximum distance in cm parameterisations are generated for (only generated when required to prevent long initial loading time)
  max_d: 2500.
  min_d: 25.
  # VUV group velocity in cm/ns
  vuv_vgroup_mean: 13.5
  vuv_vgroup_max: 18.
  # Distance in cm from "Landau + Expo" -> "Single Landau" model
  inflexion_point_distance: 400.

  # angular bin size in deg, must correspond to parameterisation set 
  angle_bin_timing_vuv: 45
}

# VISIBLE/REFLECTED LIGHT: TIMING PARAMETERISATION
# DUNE-SP
Distances_refl_dune: [38, 63, 88, 113, 138, 163, 188, 213, 238, 263, 288, 313, 338, 353, 358]
Distances_radial_refl_dune: [9.9, 155.0, 253.8, 360.4, 493.2, 594.6, 695.0, 793.2, 830.7]
Cut_off_dune: [
	[	[238.142, 262.539, 282.467, 304.103, 313.013, 337.946, 351.788, 370.942, 376.018, 399.713, 402.083, 408.105, 417.89, 412.451, 411.424],
		[234.078, 262.073, 276.731, 296.061, 311.584, 335.31, 343.996, 359.014, 388.386, 382.394, 405.658, 389.855, 391.849, 417.002, 391.142],
		[233.826, 252.701, 276.161, 295.549, 310.688, 335.343, 333.014, 337.877, 356.375, 365.452, 402.048, 391.411, 387.041, 413.637, 398.582],
		[225.568, 247.426, 269.423, 286.49, 303.236, 312.539, 326.313, 352.405, 354.358, 365.515, 378.07, 386.568, 398.617, 402.382, 395.867],
		[206.919, 228.745, 245.808, 264.952, 278.443, 288.442, 310.195, 322.811, 338.748, 343.625, 353.131, 355.457, 366.05, 369.961, 378.918],
		[195.67, 212.402, 231.2, 246.909, 260.37, 281.104, 290.402, 307.977, 319.123, 326.379, 335.987, 353.426, 346.63, 361.703, 363.194],
		[179.417, 194.449, 215.019, 226.811, 243.818, 255.429, 269.983, 283.393, 295.032, 322.433, 315.948, 318.471, 334.817, 334.004, 326.318],
		[154.088, 172.471, 186.44, 202.967, 218.924, 230.281, 238.207, 258.663, 271.877, 286.323, 291.957, 311.479, 303.508, 312.419, 309.705],
		[149.199, 155.503, 178.764, 184.767, 202.839, 224.528, 215.482, 254.813, 263.972, 284.013, 267.734, 296.432, 262.43, 290.437, 297.707]
	],
	[	[246.114, 267.915, 289.986, 310.104, 324.638, 338.566, 350.776, 359.952, 376.386, 397.82, 394.869, 401.497, 405.346, 414.755, 415.781],
		[241.62, 263.039, 289.868, 305.077, 313.714, 340.302, 356.721, 357.657, 371.048, 380.499, 398.234, 418.922, 405.413, 409.476, 417.102],
		[235.542, 261.916, 282.016, 291.492, 310.319, 327.492, 344.385, 347.677, 365.039, 377.724, 381.374, 386.969, 401.347, 400.177, 392.453],
		[231.138, 253.043, 267.715, 288.464, 302.387, 319.26, 336.987, 348.065, 356.25, 367.535, 380.868, 392.95, 401.268, 393.072, 398.283],
		[209.369, 229.45, 250.276, 264.609, 278.103, 297.421, 307.095, 318.774, 334.469, 347.171, 355.64, 367.906, 371.06, 370.87, 362.123],
		[196.244, 215.249, 230.764, 250.963, 266.498, 279.546, 291.107, 303.001, 318.605, 328.869, 342.382, 359.313, 366.458, 369.223, 358.119],
		[184.429, 199.611, 215.199, 233.223, 248.347, 259.588, 273.831, 280.22, 301.123, 309.877, 324.337, 322.588, 336.158, 348.089, 342.262],
		[163.799, 173.141, 186.3, 209.323, 218.793, 239.084, 248.589, 263.359, 280.873, 296.201, 302.956, 300.096, 338.428, 320.21, 347.723],
		[159.08, 168.789, 187.417, 191.038, 210.331, 228.405, 242.7, 236.532, 269.892, 260.173, 294.648, 297.787, 275.243, 302.138, 290.968]
	],
	[	[250.152, 271.721, 292.124, 311.523, 329.303, 343.734, 362.045, 366.858, 382.884, 400.433, 406.645, 409.91, 417.259, 428.088, 407.686],
		[252.276, 275.258, 288.838, 310.399, 327.316, 339.202, 351.951, 368.195, 375.032, 393.038, 393.904, 404.939, 417.412, 420.595, 422.597],
		[251.722, 266.857, 286.031, 308.488, 323.711, 346.602, 343.121, 357.83, 374.251, 381.872, 372.149, 387.304, 409.728, 411.447, 410.004],
		[240.087, 259.048, 275.438, 295.691, 305.374, 326.708, 336.045, 348.531, 358.766, 373.367, 382.088, 387.178, 391.358, 405.445, 395.087],
		[224.314, 240.819, 254.926, 275.897, 288.594, 299.172, 314.15, 330.417, 336.821, 344.778, 365.24, 371.447, 385.373, 375.14, 374.112],
		[205.355, 224.417, 239.403, 258.428, 271.66, 287.509, 297.811, 313.956, 320.703, 334.091, 344.374, 361.311, 366.204, 365.306, 367.546],
		[190.018, 208.128, 221.75, 239.984, 252.689, 266.927, 274.063, 294.34, 301.445, 320.925, 322.24, 323.328, 341.146, 346.377, 349.755],
		[170.674, 189.917, 202.617, 213.842, 236.233, 248.568, 258.162, 262.287, 276.896, 294.559, 316.76, 324.476, 311.464, 327.771, 331.841],
		[169.668, 183.312, 187.508, 200.981, 212.417, 236.757, 269.173, 245.208, 258.3, 271.882, 295.175, 301.368, 339.273, 303.657, 369.413]
	],
	[	[268.411, 287.711, 310.138, 327.283, 341.435, 357.335, 362.876, 376.574, 393.192, 405.168, 411.973, 415.355, 441.712, 432.722, 418.311],
		[266.584, 286.971, 305.596, 320.476, 337.923, 351.821, 366.981, 374.848, 385.234, 393.006, 404.982, 413.931, 425.926, 421.121, 425.801],
		[261.993, 280.575, 299.544, 318.33, 325.544, 344.972, 356.23, 373.51, 387.219, 396.378, 398.942, 411.78, 411.588, 415.474, 421.921],
		[252.691, 272.887, 290.423, 307.003, 321.859, 335.324, 348.868, 359.32, 369.915, 382.051, 390.864, 399.574, 406.162, 413.715, 408.825],
		[231.161, 250.362, 267.743, 282.66, 299.151, 311.695, 325.55, 339.417, 342.855, 360.101, 366.804, 376.354, 385.595, 383.735, 387.496],
		[223.802, 242.346, 258.778, 274.166, 289.391, 302.706, 314.21, 326.552, 339.073, 346.064, 358.127, 368.062, 370.487, 380.508, 379.736],
		[209.682, 226.531, 241.313, 256.21, 264.927, 281.465, 295.416, 309.286, 321.698, 328.597, 337.654, 353.108, 351.508, 359.492, 361.487],
		[187.512, 201.319, 218.477, 233.414, 244.586, 256.582, 279.252, 279.741, 295.446, 293.343, 320.52, 336.582, 339.989, 343.045, 340.432],
		[180.437, 197.944, 213.83, 224.059, 234.645, 247.69, 267.21, 282.661, 286.906, 313.713, 293.626, 312.821, 325.558, 328.303, 321.306]
	],
	[	[289.914, 310.613, 329.894, 346.834, 362.554, 372.419, 384.793, 393.546, 402.812, 411.007, 419.004, 430.365, 441.083, 441.259, 437.297],
		[286.756, 307.854, 324.357, 340.695, 354.491, 364.467, 379.269, 391.891, 402.363, 408.025, 419.366, 428.493, 434.019, 440.659, 436.065],
		[279.033, 296.285, 313.944, 331.667, 345.103, 354.968, 369.805, 382.226, 386.45, 396.353, 400.613, 407.224, 424.528, 432.519, 432.064],
		[273.681, 292.67, 310.219, 324.72, 342.19, 353.709, 365.811, 377.256, 386.862, 394.211, 401.592, 409.289, 416.512, 419.69, 423.459],
		[252.821, 275.881, 290.547, 305.052, 318.76, 335.804, 344.923, 356.796, 366.782, 381.396, 387.095, 399.874, 405.188, 395.59, 396.829],
		[241.638, 258.4, 275.728, 290.884, 304.633, 317.739, 328.808, 340.59, 348.825, 362.143, 368.125, 377.143, 385.422, 385.222, 386.957],
		[226.83, 244.956, 259.492, 274.426, 289.393, 302.835, 314.495, 322.783, 335.687, 355.561, 357.564, 357.478, 371.557, 378.319, 370.383],
		[212.082, 228.509, 236.565, 253.59, 267.431, 283.445, 284.471, 304.654, 296.006, 315.46, 308.214, 337.028, 363.737, 356.049, 373.881],
		[196.033, 212.916, 223.279, 251.964, 242.766, 263.733, 291.691, 279.277, 297.816, 324.128, 314.101, 307.537, 333.769, 315.3, 342.75]
	],
	[	[317.145, 339.108, 351.234, 370.602, 384.28, 396.29, 409.31, 413.407, 421.532, 434.873, 439.394, 443.384, 451.087, 456.285, 457.325],
		[315.413, 335.463, 348.423, 362.104, 377.276, 389.744, 403.802, 411.179, 422.892, 432.348, 438.45, 441.921, 448.542, 452.471, 451.429],
		[305.073, 328.132, 342.54, 362.058, 375.405, 385.718, 393.883, 408.134, 414.017, 418.398, 429.967, 435.605, 443.127, 440.059, 443.341],
		[300.377, 320.323, 338.408, 353.011, 366.344, 379.359, 389.862, 399.703, 411.283, 420.3, 424.452, 432.673, 434.343, 444.682, 440.862],
		[287.98, 307.368, 323.144, 334.702, 354.845, 362.485, 376.778, 389.867, 390.533, 407.059, 409.517, 425.574, 422.651, 423.41, 429.774],
		[276.238, 294.784, 309.133, 324.364, 337.144, 350.274, 361.762, 373.534, 382.108, 391.929, 401.297, 405.202, 413.818, 419.689, 416.02],
		[262.281, 279.619, 295.647, 310.085, 319.474, 334.1, 341.682, 356.275, 365.639, 373.632, 379.667, 386.258, 401.139, 396.662, 401.901],
		[245.975, 256.794, 270.759, 286.402, 294.829, 310.752, 311.267, 339.42, 343.369, 350.604, 366.277, 361.594, 368.364, 355.674, 369.305],
		[235.344, 257.089, 258.486, 281.143, 284.383, 303.073, 306.858, 326.585, 338.617, 321.156, 322.864, 329.046, 359.368, 355.674, 369.305]
	],
	[	[334.426, 352.052, 370.23, 385.701, 403.089, 408.619, 422.697, 433.641, 439.893, 445.838, 454.844, 458.215, 476.382, 464.554, 470.144],
		[340.243, 356.894, 377.823, 394.276, 405.493, 419.526, 434.314, 440.167, 443.042, 458.305, 468.73, 465.418, 472.132, 470.263, 462.614],
		[339.215, 362.833, 378.653, 395.823, 407.574, 422.286, 436.592, 441.063, 452.994, 456.981, 467.009, 470.162, 469.083, 459.116, 467.666],
		[344.218, 361.56, 381.444, 395.986, 411.238, 423.926, 432.097, 440.824, 447.115, 453.197, 458.719, 456.588, 457.549, 456.965, 458.706],
		[329.449, 354.474, 368.595, 384.864, 398.536, 404.866, 418.107, 418.085, 423.491, 437.099, 437.718, 438.779, 426.195, 417.562, 433.152],
		[318.299, 340.232, 356.692, 372.494, 381.415, 389.127, 399.887, 407.163, 416.273, 425.423, 425.546, 424.873, 427.99, 421.374, 426.463],
		[304.056, 324.602, 339.293, 354.503, 368.104, 371.605, 380.829, 394.825, 400.773, 399.075, 404.887, 395.319, 435.121, 421.374, 426.463],
		[289.905, 307.94, 320.584, 333.673, 342.04, 355.414, 350.113, 355.944, 374.679, 361.003, 344.637, 344.637, 344.637, 344.637, 344.637],
		[275.799, 301.852, 298.569, 322.502, 323.555, 313.801, 355.564, 356.182, 352.22, 361.003, 344.637, 344.637, 344.637, 344.637, 344.637]
	],
	[	[334.426, 352.052, 370.23, 385.701, 403.089, 408.619, 422.697, 433.641, 439.893, 445.838, 454.844, 458.215, 476.382, 464.554, 470.144],
		[340.243, 356.894, 377.823, 394.276, 405.493, 419.526, 434.314, 440.167, 443.042, 458.305, 468.73, 465.418, 472.132, 470.263, 462.614],
		[365.256, 359.335, 415.055, 443.803, 424.261, 416.686, 440.291, 418.294, 444.172, 459.347, 468.73, 465.418, 472.132, 470.263, 462.614],
		[360.086, 378.063, 406.997, 424.072, 432.338, 440.556, 433.113, 452.443, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[353.058, 373.677, 388.688, 397.716, 412.013, 421.769, 428.094, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[345.571, 367.631, 372.833, 394.278, 397.663, 403.512, 434.616, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[334.075, 347.187, 361.561, 384.265, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[317.175, 328.915, 321.654, 347.725, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[297.486, 328.915, 321.654, 347.725, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614]
	],
	[	[334.426, 352.052, 370.23, 385.701, 403.089, 408.619, 422.697, 433.641, 439.893, 445.838, 454.844, 458.215, 476.382, 464.554, 470.144],
		[340.243, 356.894, 377.823, 394.276, 405.493, 419.526, 434.314, 440.167, 443.042, 458.305, 468.73, 465.418, 472.132, 470.263, 462.614],
		[365.256, 359.335, 415.055, 443.803, 424.261, 416.686, 440.291, 418.294, 444.172, 459.347, 468.73, 465.418, 472.132, 470.263, 462.614],
		[360.086, 378.063, 406.997, 424.072, 432.338, 440.556, 433.113, 452.443, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[353.058, 373.677, 388.688, 397.716, 412.013, 421.769, 428.094, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[345.571, 367.631, 372.833, 394.278, 397.663, 403.512, 434.616, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[334.075, 347.187, 361.561, 384.265, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[317.175, 328.915, 321.654, 347.725, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[297.486, 328.915, 321.654, 347.725, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614]
	] 
	]
Tau_dune: [
		[	[5.96457, 5.07719, 4.99409, 4.04206, 3.53897, 3.0151, 2.77687, 2.46537, 2.36831, 2.28361, 2.26549, 2.17181, 2.12092, 3.06882, 3.0436],
			[5.80839, 5.17184, 4.87524, 4.17199, 3.46809, 2.91644, 2.75975, 2.56292, 2.26832, 2.21301, 2.24002, 2.28156, 2.1818, 3.1583, 3.04179],
			[5.87934, 5.23502, 5.15792, 4.09652, 3.54772, 3.10177, 2.73277, 2.47171, 2.39474, 2.16523, 2.18489, 1.99915, 2.25365, 2.97022, 3.02243],
			[6.00006, 5.26829, 5.13125, 4.17978, 3.37219, 3.04936, 2.75519, 2.43612, 2.22506, 2.13109, 2.00007, 1.99631, 1.98842, 2.94804, 2.90546],
			[5.95748, 5.05141, 4.91095, 3.8922, 3.22227, 2.68021, 2.41203, 2.0989, 1.85643, 1.73013, 1.61917, 1.64845, 1.63141, 2.7203, 2.67036],
			[5.30483, 4.56571, 4.44116, 3.55242, 2.78611, 2.18762, 2.04502, 1.84214, 1.57797, 1.44502, 1.38835, 1.4049, 1.44472, 2.30442, 2.31722],
			[5.20936, 4.57521, 4.40278, 3.40163, 2.56094, 1.99053, 1.81989, 1.66047, 1.35575, 1.09994, 1.1028, 1.09432, 1.03686, 2.00878, 2.03789],
			[4.71532, 3.72214, 3.64817, 2.99707, 2.30805, 1.50375, 1.09049, 1.15702, 0.905575, 0.803875, 0.682886, 0.569838, 0.564455, 1.61338, 1.34808],
			[4.61481, 3.5, 3.48475, 2.63262, 2.20024, 1.3916, 0.912768, 0.831398, 0.6641, 0.683397, 0.342592, 0.459747, 0.543871, 1.19306, 1.00357]
		],
		[	[6.0354, 5.31897, 5.19515, 4.25833, 3.61615, 3.18563, 2.88475, 2.60235, 2.53525, 2.21919, 2.25335, 2.34856, 2.25909, 3.19966, 3.22475],
			[6.0464, 5.32945, 5.1932, 4.28896, 3.52898, 3.23512, 2.86296, 2.59209, 2.36866, 2.25528, 2.25007, 2.21974, 2.35047, 3.23254, 3.13224],
			[6.11222, 5.35441, 5.16441, 4.24574, 3.68976, 3.23508, 2.83299, 2.63325, 2.27689, 2.15337, 2.09911, 2.17209, 2.2334, 3.15524, 3.07361],
			[6.09937, 5.46468, 5.22791, 4.19851, 3.5083, 3.15777, 2.81754, 2.4285, 2.26929, 2.06762, 1.98974, 2.01879, 2.06496, 3.01153, 2.88765],
			[5.88905, 5.07605, 4.83864, 3.75214, 3.07813, 2.67385, 2.35779, 2.13925, 1.89796, 1.81738, 1.65085, 1.67909, 1.63433, 2.64777, 2.43649],
			[5.2949, 4.677, 4.43335, 3.52238, 2.78443, 2.21877, 2.04896, 1.84461, 1.60476, 1.51221, 1.36126, 1.4131, 1.40436, 2.37343, 2.33066],
			[5.21743, 4.7055, 4.31696, 3.47348, 2.52611, 2.12585, 1.83055, 1.58977, 1.37549, 1.3169, 1.16925, 1.16713, 1.20449, 2.10184, 1.99436],
			[4.82782, 4.04738, 3.91726, 3.02788, 2.32794, 1.45675, 1.27683, 1.16405, 0.9229, 0.780128, 0.703169, 0.60968, 0.714072, 1.50203, 1.37557],
			[4.55414, 3.75576, 3.41954, 2.76907, 2.30544, 0.894174, 0.750302, 0.700783, 0.903002, 0.878854, 0.378455, 0.36607, 0.431089, 1.22243, 1.09718]
		],
		[	[6.30532, 5.60024, 5.34123, 4.38091, 3.72383, 3.2309, 3.00245, 2.67961, 2.53174, 2.42812, 2.27821, 2.26919, 2.26511, 3.41929, 3.25572],
			[6.33204, 5.59122, 5.3709, 4.34319, 3.70327, 3.34205, 2.99071, 2.75068, 2.47161, 2.38718, 2.28385, 2.34122, 2.3472, 3.27431, 3.25456],
			[6.51237, 5.63528, 5.41695, 4.48751, 3.77619, 3.29131, 2.98481, 2.68307, 2.47005, 2.40157, 2.26803, 2.13715, 2.37985, 3.19582, 3.14273],
			[6.38164, 5.69179, 5.39082, 4.39664, 3.63624, 3.27547, 2.88184, 2.48285, 2.31915, 2.18514, 2.10008, 2.10826, 2.11103, 3.05862, 3.01733],
			[6.17303, 5.31955, 5.07852, 4.05035, 3.24062, 2.89892, 2.56912, 2.27691, 2.00998, 1.80968, 1.79265, 1.74122, 1.82872, 2.69963, 2.78144],
			[5.5858, 4.92838, 4.57836, 3.5107, 2.81288, 2.41324, 2.20307, 1.89004, 1.71106, 1.56746, 1.45846, 1.44826, 1.50469, 2.49477, 2.42593],
			[5.51546, 4.93658, 4.58396, 3.4126, 2.60389, 2.19155, 2.02662, 1.68914, 1.42189, 1.36414, 1.17042, 1.10321, 1.24776, 2.0897, 2.03952],
			[5.06723, 4.40759, 4.10753, 3.16073, 2.18927, 1.7288, 1.63416, 1.29918, 0.997631, 0.820509, 0.789512, 0.850946, 0.736224, 1.74511, 1.60892],
			[4.65552, 3.9, 3.64344, 2.54465, 1.80187, 1.31079, 1.33674, 0.891947, 0.593747, 0.4, 0.502183, 0.682269, 0.390691, 1.49123, 1.02849]
		],
		[	[6.75642, 6.06817, 5.87681, 4.80277, 4.23382, 3.75152, 3.30471, 2.95263, 2.71149, 2.57796, 2.44351, 2.54557, 2.41178, 3.53858, 3.48403],
			[6.83135, 6.05778, 5.81198, 4.84431, 4.14284, 3.70326, 3.32696, 2.99773, 2.72409, 2.56572, 2.47494, 2.49247, 2.50532, 3.46651, 3.36307],
			[6.84789, 6.08566, 5.83316, 4.81693, 4.1458, 3.69117, 3.23996, 2.93105, 2.68579, 2.47281, 2.37393, 2.45876, 2.39122, 3.35189, 3.29926],
			[6.84636, 6.08253, 5.69911, 4.6721, 4.08545, 3.58488, 3.12926, 2.74636, 2.54662, 2.31262, 2.2613, 2.26762, 2.25569, 3.19658, 3.18455],
			[6.49128, 5.78555, 5.32809, 4.24672, 3.70856, 3.17328, 2.73308, 2.36785, 2.15334, 1.97175, 1.90532, 1.87916, 1.91024, 2.78953, 2.71248],
			[6.24264, 5.45843, 5.03932, 3.88499, 3.34187, 2.90307, 2.51025, 2.18007, 1.94563, 1.7878, 1.70413, 1.70052, 1.71355, 2.63874, 2.6075],
			[6.01898, 5.22599, 4.75741, 3.61371, 3.08217, 2.68607, 2.2824, 1.87414, 1.66293, 1.4659, 1.3717, 1.42102, 1.38114, 2.37376, 2.21817],
			[5.44261, 4.75737, 4.25017, 3.09949, 2.43497, 2.21826, 1.97049, 1.50531, 1.3505, 1.08725, 1.04406, 1.07537, 0.983351, 2.02946, 1.82382],
			[5.08645, 4.34396, 4.06995, 3.01142, 2.27373, 2.05021, 1.67649, 1.35703, 1.07818, 0.942589, 0.686917, 0.733439, 0.771787, 1.50469, 1.44095]
		],
		[	[7.84001, 7.02445, 6.74358, 5.5386, 4.90811, 4.34112, 3.82917, 3.5689, 3.23996, 2.94809, 2.88278, 2.84453, 2.80638, 4.0044, 4.18463],
			[7.96009, 6.95661, 6.78903, 5.51254, 4.86418, 4.30601, 3.81578, 3.40455, 3.13029, 2.86049, 2.81298, 2.84908, 2.74574, 4.16914, 4.05354],
			[7.64827, 6.54719, 6.17865, 5.2985, 4.59742, 4.02522, 3.50602, 3.14964, 2.90949, 2.70429, 2.57336, 2.5472, 2.47571, 3.54201, 3.61743],
			[7.92974, 6.8201, 6.53271, 5.3015, 4.6803, 4.02622, 3.5493, 3.17292, 2.88242, 2.66675, 2.57216, 2.5529, 2.54433, 3.68363, 3.55278],
			[7.50926, 6.24039, 5.87378, 4.83272, 4.22972, 3.60808, 3.16498, 2.76932, 2.41256, 2.28326, 2.1555, 2.19621, 2.18935, 3.09921, 3.0988],
			[6.90993, 5.82666, 5.38618, 4.41604, 3.76803, 3.19472, 2.75083, 2.46497, 2.16963, 2.00052, 1.92475, 1.89236, 1.95252, 2.86288, 2.78449],
			[6.79507, 5.57163, 5.20405, 4.12369, 3.58091, 2.99103, 2.54424, 2.17971, 2.01767, 1.74572, 1.69754, 1.65578, 1.60057, 2.5256, 2.40649],
			[6.31946, 5.20894, 4.51979, 3.56933, 3.16501, 2.43612, 2.08959, 1.78385, 1.62104, 1.407, 1.39481, 1.20874, 1.09917, 2.25184, 2.24809],
			[5.33467, 4.6119, 4.10264, 3.11051, 2.61035, 2.16347, 1.86028, 1.27061, 1.10083, 0.850165, 0.939195, 0.866033, 0.690194, 1.64104, 1.80895]
		],
		[	[11.9489, 11.6668, 11.4536, 8.75265, 7.29591, 5.8583, 5.18062, 4.55981, 4.05805, 3.69915, 3.63494, 3.67833, 3.57395, 6.25726, 6.16591],
			[11.5272, 10.9288, 10.6557, 7.95326, 6.82772, 5.48559, 4.81446, 4.22457, 3.79079, 3.65687, 3.44221, 3.40137, 3.45342, 5.81608, 5.80147],
			[11.6217, 11.1327, 10.4278, 7.58228, 6.26671, 5.39903, 4.82228, 4.33599, 3.68319, 3.50228, 3.29511, 3.25208, 3.46974, 5.38972, 5.08396],
			[11.3782, 10.8611, 10.2243, 7.33279, 6.34183, 5.13152, 4.48945, 3.99859, 3.55543, 3.29182, 3.15649, 3.1397, 3.21847, 5.20982, 5.26709],
			[10.1716, 9.64567, 8.83558, 6.31549, 5.35836, 4.57666, 4.08414, 3.56821, 3.23444, 2.91008, 2.83799, 2.81835, 2.76454, 4.37497, 4.30567],
			[9.48217, 8.56376, 7.79515, 5.63876, 4.8723, 4.1671, 3.60072, 3.20289, 2.8427, 2.63474, 2.45615, 2.48961, 2.44924, 3.85715, 3.66625],
			[8.46821, 7.57236, 7.05438, 5.13544, 4.3476, 3.70969, 3.22497, 2.79637, 2.51378, 2.30093, 2.18766, 2.15998, 2.01708, 3.32403, 3.09411],
			[7.18484, 5.91973, 5.55348, 4.29947, 3.67089, 3.0072, 2.66158, 2.24491, 2.00604, 1.75675, 1.8134, 1.70376, 1.64657, 2.56667, 2.67337],
			[6.23207, 5.36007, 4.89431, 3.75472, 3.11033, 2.67796, 2.23625, 1.90829, 1.82338, 1.53467, 1.44333, 1.40512, 1.27021, 2.201, 1.92327]
		],
		[	[12.8483, 12.6112, 12.1786, 10.7614, 9.50222, 8.44859, 7.11133, 6.25161, 5.71591, 5.32326, 5.00089, 5.03042, 4.35032, 8.00854, 8.23766],
			[12.7549, 12.3904, 12.0204, 10.9497, 10.2474, 8.7457, 7.96587, 7.32252, 6.306, 5.67946, 5.73712, 5.93768, 5.79708, 8.65708, 8.56371],
			[12.8645, 12.3741, 12.2352, 11.1243, 10.5757, 9.44869, 8.23989, 7.92367, 7.0601, 6.47817, 6.18098, 6.55385, 6.19273, 8.82035, 8.99372],
			[12.6959, 12.2643, 11.8785, 11.114, 10.4208, 9.2111, 8.36877, 7.85155, 7.32856, 6.84506, 6.66631, 7.00608, 6.78541, 8.93225, 8.70316],
			[12.5452, 12.1665, 11.7269, 10.5075, 9.56439, 8.71867, 7.79231, 7.45348, 6.66866, 6.28284, 6.24135, 6.26647, 6.39461, 8.55639, 8.20468],
			[12.0541, 11.3451, 11.0524, 9.65751, 8.7969, 7.42591, 6.70033, 6.20258, 5.65834, 5.27534, 5.27716, 5.42423, 5.26033, 7.49567, 7.41311],
			[11.8893, 11.1326, 10.7512, 8.99326, 7.97202, 6.8874, 5.82871, 5.46771, 4.88342, 4.59128, 4.5547, 4.84998, 4.43973, 6.89836, 6.49232],
			[11.1333, 9.90586, 8.9442, 7.35071, 6.71618, 5.3712, 4.813, 4.33659, 3.7798, 4.04402, 4.32291, 4.15208, 4.78329, 6.53315, 6.18305],
			[9.94244, 8.48604, 8.53327, 6.53562, 5.64959, 4.67588, 4.18134, 3.98564, 3.30388, 2.98186, 2.92041, 3.63641, 4.14041, 6.11911, 5.40965]
		],
		[	[12.8483, 12.6112, 12.1786, 10.7614, 9.50222, 8.44859, 7.11133, 6.25161, 5.71591, 5.32326, 5.00089, 5.03042, 4.35032, 8.00854, 8.23766],
			[12.7549, 12.3904, 12.0204, 10.9497, 10.2474, 8.7457, 7.96587, 7.32252, 6.306, 5.67946, 5.73712, 5.93768, 5.79708, 8.65708, 8.56371],
			[13.4325, 12.4414, 12.0743, 11.6842, 12.2388, 11.4144, 9.28914, 9.97593, 12.2348, 9.23503, 8.62783, 6.85223, 9.81417, 8.79908, 11.2756],
			[12.6473, 12.3558, 12.0081, 11.4888, 11.3523, 10.3128, 10.0266, 10.0789, 9.05136, 9.28551, 8.64309, 8.74761, 8.55587, 9.7955, 9.75475],
			[12.4278, 12.2977, 12.0395, 11.353, 11.5152, 10.5393, 10.037, 9.54046, 9.11765, 8.77425, 8.45984, 8.54731, 7.86723, 9.67888, 9.54721],
			[12.5007, 12.0753, 11.7489, 11.1458, 10.678, 10.0927, 9.50329, 8.96, 8.76761, 8.53607, 7.89683, 7.93522, 7.75269, 9.07914, 8.74846],
			[12.3884, 11.8697, 11.624, 10.8656, 10.6545, 9.59602, 9.52584, 8.67707, 7.70351, 7.24507, 7.2763, 7.02563, 7.10897, 7.90916, 8.13517],
			[12.1068, 11.6689, 11.471, 10.1856, 9.82679, 8.55115, 8.34593, 7.57929, 6.29319, 6.88384, 6.11757, 5.89828, 5.9847, 7.454, 7.15065],
			[12.0139, 11.3105, 10.4283, 9.12612, 9.78714, 7.83548, 7.75834, 6.48438, 6.1277, 5.22, 5.56125, 4.61427, 5.17356, 6.55659, 6.21537]
		],
		[	[12.8483, 12.6112, 12.1786, 10.7614, 9.50222, 8.44859, 7.11133, 6.25161, 5.71591, 5.32326, 5.00089, 5.03042, 4.35032, 8.00854, 8.23766],
			[12.7549, 12.3904, 12.0204, 10.9497, 10.2474, 8.7457, 7.96587, 7.32252, 6.306, 5.67946, 5.73712, 5.93768, 5.79708, 8.65708, 8.56371],
			[13.4325, 12.4414, 12.0743, 11.6842, 12.2388, 11.4144, 9.28914, 9.97593, 12.2348, 9.23503, 8.62783, 6.85223, 9.81417, 8.79908, 11.2756],
			[12.6473, 12.3558, 12.0081, 11.4888, 11.3523, 10.3128, 10.0266, 10.0789, 9.05136, 9.28551, 8.64309, 8.74761, 8.55587, 9.7955, 9.75475],
			[12.4278, 12.2977, 12.0395, 11.353, 11.5152, 10.5393, 10.037, 9.54046, 9.11765, 8.77425, 8.45984, 8.54731, 7.86723, 9.67888, 9.54721],
			[12.5007, 12.0753, 11.7489, 11.1458, 10.678, 10.0927, 9.50329, 8.96, 8.76761, 8.53607, 7.89683, 7.93522, 7.75269, 9.07914, 8.74846],
			[12.3884, 11.8697, 11.624, 10.8656, 10.6545, 9.59602, 9.52584, 8.67707, 7.70351, 7.24507, 7.2763, 7.02563, 7.10897, 7.90916, 8.13517],
			[12.1068, 11.6689, 11.471, 10.1856, 9.82679, 8.55115, 8.34593, 7.57929, 6.29319, 6.88384, 6.11757, 5.89828, 5.9847, 7.454, 7.15065],
			[12.0139, 11.3105, 10.4283, 9.12612, 9.78714, 7.83548, 7.75834, 6.48438, 6.1277, 5.22, 5.56125, 4.61427, 5.17356, 6.55659, 6.21537]
		]
	]

dune_vis_timing_parameterization:
{
  # Timing parameterisation:
  #
  # Smearing parameters
  Distances_refl: @local::Distances_refl_dune
  Distances_radial_refl: @local::Distances_radial_refl_dune
  Cut_off: @local::Cut_off_dune
  Tau: @local::Tau_dune

  # vis velocity in cm/ns
  vis_vmean: 23.99
  
  # angular bin size in deg, must correspond to parameterisation set 
  angle_bin_timing_vis: 10
}


# VUV/DIRECT LIGHT: NUMBER OF HITS CORRECTIONS UPDATED MODEL
# DUNE-SP Gaisser-Hillas 
# Note: corrections include effects of fully simulated wire planes  

# Argon - default
GH_PARS_RS100cm_flat_dune: [ [1.23286, 1.20491, 1.1597, 1.08148, 0.986607, 0.868075, 0.725637, 0.633551, 0.469717],
    						 [150.325, 150.109, 156.294, 169.271, 179.642, 212.9, 232.173, 226.557, 215.166],
			     			 [19.0558, 18.8478, 18.8757, 18.7149, 50.8662, 49.2247, 57.6717, 157.92, 172.494],
			    			 [-3000, -3000, -3000, -3000, -1000, -1000, -1000, -100, -100] ]
GH_border_RS100cm_angulo_flat_dune: [5, 15, 25, 35, 45, 55, 65, 75, 85]
GH_border_RS100cm_flat_dune: [ [-9.63855e-05, -6.82604e-05, -9.63478e-05, -0.000121181, -0.000126611, -0.000115481, -8.61492e-05, -0.000112594, -7.80935e-05],
							   [-0.0662469, -0.0504497, -0.0596321, -0.0418021, -0.0342462, -0.0531668, -0.0522639, -0.0578887, -0.0591081],
							   [-0.00593207, -0.00672713, -0.0020843, -0.00216374, 0.00901291, 0.00385402, 0.0066081, 0.0341547, 0.0446519] ]

dune_vuv_RS100cm_hits_parameterization:
{
 FlatPDCorr: true
 GH_PARS_flat: @local::GH_PARS_RS100cm_flat_dune
 GH_border_angulo_flat: @local::GH_border_RS100cm_angulo_flat_dune
 GH_border_flat: @local::GH_border_RS100cm_flat_dune
 
 DomePDCorr: false

 delta_angulo_vuv: 10

 PMT_radius: 10.16
}

# Xenon
GH_PARS_Xenon_flat_dune: [ [0.959653, 0.92975, 0.874812, 0.790038, 0.685581, 0.566253, 0.433698, 0.31073, 0.197959],
  						   [94.2397, 94.5496, 104.245, 139.412, 189.763, 192.723, 340.598, 501.523, 503.954],
  						   [385.308, 413.922, 405.968, 371.839, 330.268, 484.33, 513.097, 512.926, 253.092],
  						   [-400, -400, -400, -400, -400, -400, -400, -400, -400] ]

GH_border_Xenon_angulo_flat_dune: [5, 15, 25, 35, 45, 55, 65, 75, 85]
GH_border_Xenon_flat_dune: [ [0.000212425, 0.000200659, 0.000179874, 0.000165088, 0.00015168, 0.000122913, 8.94813e-05, 3.98645e-05, 1.24325e-13],
							 [0.151348, 0.168286, 0.153929, 0.12419, 0.0834517, 0.0955464, -0.0175567, -0.112032, -1.98752e-10],
							 [-0.114771, -0.19272, -0.182644, -0.130611, -0.115369, -0.279817, -0.276752, -0.294378, 0.0783223] ]

dune_vuv_Xenon_hits_parameterization:
{
 FlatPDCorr: true
 GH_PARS_flat: @local::GH_PARS_Xenon_flat_dune
 GH_border_angulo_flat: @local::GH_border_Xenon_angulo_flat_dune
 GH_border_flat: @local::GH_border_Xenon_flat_dune
 
 DomePDCorr: false

 delta_angulo_vuv: 10

 PMT_radius: 10.16
}


# VIS/REFLECTED LIGHT: NUMBER OF HITS CORRECTIONS & PARAMETERS
# DUNE-SP Parameters
# Note: corrections include effects of fully simulated wire planes  

# Argon - default  
VIS_distances_x_flat_dune_argon: [3, 13, 38, 63, 88, 113, 138, 163, 188, 213, 238, 263, 288, 313, 338, 353]
VIS_distances_r_flat_dune_argon: [54.1115, 154.253, 269.706, 367.262, 496.739, 605.581, 693.216, 782.765, 862.208]

VIS_correction_flat_dune_argon: [ 
	[ [1.67995, 1.5023, 1.20657, 1.02106, 0.882746, 0.776639, 0.695785, 0.629938, 0.582714, 0.545081, 0.515464, 0.493708, 0.472181, 0.45963, 0.439441, 0.419622],
	  [1.68963, 1.51982, 1.23126, 1.03816, 0.900409, 0.796292, 0.713189, 0.649865, 0.602912, 0.564819, 0.539057, 0.517199, 0.505427, 0.492089, 0.481653, 0.449229],
	  [1.73304, 1.55607, 1.26007, 1.07054, 0.934781, 0.832277, 0.759501, 0.704314, 0.658422, 0.627825, 0.606923, 0.591168, 0.584167, 0.580226, 0.563891, 0.529764],
	  [1.78193, 1.60802, 1.31866, 1.1289, 0.9946, 0.893599, 0.81836, 0.762132, 0.722593, 0.690561, 0.67056, 0.655973, 0.654003, 0.647708, 0.640756, 0.605073],
	  [1.96176, 1.77259, 1.47397, 1.2754, 1.13531, 1.02732, 0.942267, 0.880779, 0.828975, 0.794916, 0.771843, 0.751323, 0.74329, 0.744061, 0.733977, 0.70005],
	  [2.21549, 2.04521, 1.72647, 1.48965, 1.31053, 1.17082, 1.06559, 0.98202, 0.921138, 0.873365, 0.841385, 0.81795, 0.807915, 0.803652, 0.795182, 0.753378],
	  [2.3808, 2.20671, 1.89092, 1.64262, 1.4475, 1.29706, 1.17708, 1.08489, 1.01635, 0.962341, 0.926461, 0.904984, 0.894703, 0.894324, 0.890895, 0.844522],
	  [2.7039, 2.5078, 2.18003, 1.93111, 1.71334, 1.54146, 1.39972, 1.29637, 1.19956, 1.13696, 1.08587, 1.04728, 1.03061, 1.03128, 1.04224, 1.06682],
	  [3.28429, 3.14942, 2.81891, 2.46231, 2.13464, 1.86717, 1.63899, 1.46508, 1.32431, 1.22158, 1.13801, 1.07975, 1.04774, 1.0268, 1.00872, 0.934299]	  
	],
	[ [1.61717, 1.45536, 1.18141, 1.00703, 0.877535, 0.778688, 0.700656, 0.640282, 0.593421, 0.554809, 0.526049, 0.504949, 0.486008, 0.471742, 0.454623, 0.438439],
	  [1.63238, 1.47453, 1.21037, 1.02925, 0.896804, 0.79514, 0.717278, 0.658347, 0.611546, 0.575992, 0.548571, 0.52959, 0.516161, 0.505923, 0.495831, 0.470395],
	  [1.67016, 1.50472, 1.23162, 1.05456, 0.927059, 0.833322, 0.761788, 0.709941, 0.667458, 0.638414, 0.61695, 0.600871, 0.595867, 0.589934, 0.576962, 0.547778],
	  [1.72845, 1.56667, 1.29773, 1.1202, 0.992758, 0.898139, 0.826881, 0.772625, 0.73407, 0.70565, 0.685211, 0.673677, 0.669364, 0.665694, 0.661327, 0.62945],
	  [1.93974, 1.75853, 1.4716, 1.28379, 1.14714, 1.04343, 0.963162, 0.902172, 0.851864, 0.820813, 0.796031, 0.78107, 0.77271, 0.768238, 0.767237, 0.738134],
	  [2.11276, 1.94999, 1.65909, 1.44723, 1.28647, 1.16348, 1.0694, 0.995028, 0.937634, 0.896204, 0.86791, 0.850113, 0.843451, 0.841015, 0.839559, 0.805772],
	  [2.27089, 2.10995, 1.82097, 1.60253, 1.42969, 1.2978, 1.18599, 1.10159, 1.03826, 0.991185, 0.957985, 0.940432, 0.930111, 0.936145, 0.929783, 0.895972],
	  [2.675, 2.49434, 2.18241, 1.9411, 1.7415, 1.57744, 1.43963, 1.33051, 1.24657, 1.17447, 1.13066, 1.09834, 1.08741, 1.0859, 1.10706, 1.12759],
	  [2.96947, 2.85863, 2.57822, 2.2702, 1.98558, 1.75909, 1.56001, 1.40263, 1.27867, 1.18196, 1.11067, 1.05927, 1.03217, 1.0172, 0.9976, 0.934535]	  
	],
	[ [1.50825, 1.36889, 1.13392, 0.98191, 0.866922, 0.77688, 0.707548, 0.651111, 0.606337, 0.572121, 0.544768, 0.525048, 0.509095, 0.494043, 0.47836, 0.45858],
	  [1.52415, 1.38959, 1.16104, 1.00319, 0.886744, 0.794913, 0.724086, 0.670173, 0.625644, 0.593862, 0.570216, 0.551808, 0.53998, 0.532302, 0.522777, 0.495825],
	  [1.56948, 1.42471, 1.18729, 1.03115, 0.919158, 0.834466, 0.770977, 0.72419, 0.686219, 0.660066, 0.641763, 0.630002, 0.623834, 0.621193, 0.608531, 0.576298],
	  [1.64288, 1.50027, 1.26387, 1.10682, 0.992256, 0.906822, 0.84274, 0.793871, 0.758439, 0.733316, 0.71634, 0.706797, 0.70469, 0.703601, 0.697613, 0.662949],
	  [1.86287, 1.70058, 1.44341, 1.27538, 1.15264, 1.05872, 0.986552, 0.931587, 0.88889, 0.860201, 0.839109, 0.827028, 0.82099, 0.820279, 0.818245, 0.783072],
	  [1.96894, 1.83178, 1.5845, 1.40403, 1.26573, 1.15779, 1.07672, 1.01293, 0.961107, 0.927483, 0.903816, 0.891158, 0.88809, 0.89041, 0.887703, 0.850857],
	  [2.11486, 1.98106, 1.74011, 1.55249, 1.40211, 1.28869, 1.18925, 1.11334, 1.0575, 1.01646, 0.989677, 0.978543, 0.972021, 0.97899, 0.974276, 0.938631],
	  [2.4422, 2.2967, 2.05021, 1.85131, 1.67819, 1.53385, 1.41887, 1.3196, 1.24542, 1.18909, 1.14934, 1.12965, 1.12177, 1.13114, 1.14473, 1.17223],
	  [2.5988, 2.52471, 2.32597, 2.09048, 1.86465, 1.67534, 1.50487, 1.3751, 1.26983, 1.18503, 1.1275, 1.08634, 1.06218, 1.05617, 1.042, 0.977655]	  
	],
	[ [1.36203, 1.25143, 1.06416, 0.940405, 0.846393, 0.770026, 0.710644, 0.663008, 0.625575, 0.597437, 0.572537, 0.555241, 0.5426, 0.528512, 0.515126, 0.496204],
	  [1.37792, 1.27147, 1.08773, 0.961108, 0.864395, 0.789027, 0.729774, 0.681964, 0.647106, 0.619295, 0.599427, 0.585466, 0.575829, 0.57062, 0.562177, 0.533077],
	  [1.43685, 1.32193, 1.12809, 1.00146, 0.908067, 0.837362, 0.783724, 0.745501, 0.715154, 0.694964, 0.681247, 0.673038, 0.671752, 0.672051, 0.6613, 0.626777],
	  [1.56602, 1.4446, 1.24389, 1.10849, 1.00957, 0.935897, 0.880299, 0.839168, 0.809274, 0.788491, 0.775715, 0.770102, 0.771824, 0.774011, 0.770752, 0.734038],
	  [1.65725, 1.52999, 1.32736, 1.19666, 1.10039, 1.0278, 0.972371, 0.929854, 0.898858, 0.878205, 0.86608, 0.860904, 0.861646, 0.866037, 0.86557, 0.831242],
	  [1.78054, 1.67683, 1.48465, 1.34081, 1.22965, 1.14298, 1.07772, 1.0273, 0.983856, 0.959071, 0.943603, 0.93805, 0.9416, 0.947582, 0.949896, 0.911353],
	  [1.86241, 1.76882, 1.59574, 1.45292, 1.33642, 1.24684, 1.16578, 1.10885, 1.06611, 1.03589, 1.01871, 1.01663, 1.01979, 1.03478, 1.04109, 0.997536],
	  [2.02194, 1.92338, 1.76362, 1.63216, 1.522, 1.41935, 1.33986, 1.27154, 1.22612, 1.18624, 1.16734, 1.16245, 1.16453, 1.18303, 1.20928, 1.24244],
	  [2.1917, 2.15394, 2.03866, 1.88331, 1.71926, 1.57749, 1.44916, 1.34803, 1.26762, 1.20227, 1.16045, 1.13188, 1.12252, 1.12368, 1.11628, 1.04992]	  
	],
	[ [1.21192, 1.12501, 0.981162, 0.886385, 0.81395, 0.755101, 0.708174, 0.671753, 0.641806, 0.61953, 0.602772, 0.590021, 0.580067, 0.570257, 0.558218, 0.538113],
	  [1.23759, 1.15185, 1.01135, 0.912632, 0.836856, 0.778859, 0.73174, 0.695823, 0.668569, 0.649014, 0.634208, 0.625161, 0.621106, 0.617743, 0.612021, 0.582028],
	  [1.3372, 1.24048, 1.08385, 0.981411, 0.906339, 0.850626, 0.809228, 0.780127, 0.757369, 0.744707, 0.737064, 0.735092, 0.739165, 0.743367, 0.733825, 0.697567],
	  [1.39625, 1.3, 1.14429, 1.04039, 0.966035, 0.911477, 0.870675, 0.841821, 0.823572, 0.812433, 0.809316, 0.811214, 0.81902, 0.827248, 0.827171, 0.788705],
	  [1.44179, 1.34299, 1.19297, 1.09814, 1.0303, 0.980126, 0.943691, 0.917849, 0.901886, 0.893587, 0.891415, 0.897052, 0.906638, 0.916486, 0.92216, 0.88791],
	  [1.49443, 1.42303, 1.29061, 1.1906, 1.11335, 1.054, 1.01118, 0.977035, 0.952696, 0.941875, 0.937759, 0.942588, 0.955226, 0.97001, 0.976097, 0.937184],
	  [1.59488, 1.52823, 1.40851, 1.31078, 1.22903, 1.1642, 1.1103, 1.07635, 1.05194, 1.03894, 1.03624, 1.0454, 1.0604, 1.08511, 1.09897, 1.0563],
	  [1.6671, 1.60158, 1.50068, 1.41958, 1.35017, 1.28541, 1.23678, 1.2002, 1.1771, 1.16522, 1.15902, 1.17343, 1.19414, 1.22399, 1.26039, 1.28191],
	  [1.80691, 1.78974, 1.73667, 1.63844, 1.53272, 1.43474, 1.34692, 1.27759, 1.22442, 1.1885, 1.16391, 1.15584, 1.16103, 1.1786, 1.18017, 1.11401]	  
	],
	[ [1.15524, 1.07988, 0.958385, 0.879462, 0.818869, 0.77138, 0.734666, 0.705303, 0.6833, 0.667096, 0.655951, 0.649252, 0.643192, 0.63591, 0.623073, 0.601985],
	  [1.1885, 1.11803, 0.996096, 0.912411, 0.849796, 0.800743, 0.762943, 0.734867, 0.71462, 0.699669, 0.692586, 0.688702, 0.689522, 0.690546, 0.68734, 0.654688],
	  [1.21943, 1.14146, 1.01304, 0.930509, 0.872149, 0.830513, 0.800824, 0.780524, 0.769998, 0.764595, 0.76575, 0.771854, 0.779683, 0.788188, 0.783455, 0.74605],
	  [1.20788, 1.1374, 1.016, 0.939093, 0.884635, 0.847011, 0.820966, 0.805591, 0.798819, 0.798217, 0.804501, 0.816042, 0.829053, 0.845455, 0.849412, 0.807885],
	  [1.22609, 1.15651, 1.04232, 0.974567, 0.928931, 0.897108, 0.877528, 0.866212, 0.863744, 0.866935, 0.876967, 0.892472, 0.910572, 0.927446, 0.932572, 0.902381],
	  [1.2411, 1.19224, 1.09978, 1.03027, 0.978537, 0.939776, 0.916201, 0.895056, 0.892352, 0.893211, 0.902722, 0.91799, 0.938479, 0.962924, 0.974229, 0.933753],
	  [1.26582, 1.22115, 1.14423, 1.08429, 1.0345, 0.996373, 0.971323, 0.956652, 0.952058, 0.956109, 0.968782, 0.993272, 1.02211, 1.05529, 1.07656, 1.03333],
	  [1.30958, 1.26597, 1.20323, 1.15558, 1.11544, 1.08319, 1.06375, 1.04858, 1.04532, 1.05349, 1.06848, 1.0941, 1.12702, 1.17656, 1.21581, 1.2369],
	  [1.4037, 1.39983, 1.37779, 1.32183, 1.25879, 1.19901, 1.1496, 1.11269, 1.0877, 1.07653, 1.07314, 1.08548, 1.10827, 1.1378, 1.15578, 1.08895]	  
	],
	[ [1.27426, 1.19175, 1.05934, 0.973038, 0.909823, 0.861483, 0.821608, 0.792506, 0.771765, 0.757368, 0.747217, 0.742414, 0.737547, 0.731485, 0.71678, 0.692145],
	  [1.20255, 1.13089, 1.00916, 0.927784, 0.866592, 0.821308, 0.786168, 0.762307, 0.744728, 0.735681, 0.730353, 0.731412, 0.734882, 0.737942, 0.735619, 0.700012],
	  [1.11775, 1.04616, 0.93068, 0.857827, 0.808068, 0.773642, 0.75082, 0.738697, 0.73243, 0.732565, 0.738754, 0.748695, 0.762565, 0.776194, 0.769628, 0.732771],
	  [1.07179, 1.00731, 0.90292, 0.837423, 0.793408, 0.763976, 0.745886, 0.737359, 0.736678, 0.742324, 0.753317, 0.769762, 0.790495, 0.807173, 0.813678, 0.775096],
	  [1.03601, 0.974732, 0.88131, 0.827123, 0.790807, 0.768682, 0.757436, 0.752386, 0.755774, 0.765491, 0.780436, 0.799704, 0.82227, 0.842884, 0.853788, 0.823337],
	  [1.03307, 0.991846, 0.91548, 0.859529, 0.820516, 0.793129, 0.777652, 0.768362, 0.770054, 0.779399, 0.79407, 0.814441, 0.839751, 0.866729, 0.880961, 0.845997],
	  [1.03008, 0.992874, 0.929713, 0.880949, 0.843799, 0.817422, 0.802006, 0.796185, 0.79869, 0.808495, 0.827176, 0.856709, 0.884164, 0.920383, 0.943264, 0.906534],
	  [1.02415, 0.989935, 0.938482, 0.901237, 0.870795, 0.848773, 0.834976, 0.830254, 0.834168, 0.845807, 0.865375, 0.892356, 0.929334, 0.969198, 1.00822, 1.02599],
	  [1.03957, 1.03493, 1.01538, 0.973857, 0.928619, 0.889948, 0.858456, 0.837881, 0.827436, 0.826027, 0.834931, 0.852386, 0.879559, 0.910994, 0.936875, 0.913504]	  
	],
	[ [1.27426, 1.19175, 1.05934, 0.973038, 0.909823, 0.861483, 0.821608, 0.792506, 0.771765, 0.757368, 0.747217, 0.742414, 0.737547, 0.731485, 0.71678, 0.692145],
	  [1.20255, 1.13089, 1.00916, 0.927784, 0.866592, 0.821308, 0.786168, 0.762307, 0.744728, 0.735681, 0.730353, 0.731412, 0.734882, 0.737942, 0.735619, 0.700012],
	  [1.27204, 1.18739, 1.05069, 0.967695, 0.90854, 0.865532, 0.834186, 0.818909, 0.812163, 0.810419, 0.819609, 0.833564, 0.843202, 0.852653, 0.848203, 0.808108],
	  [1.16399, 1.0912, 0.971812, 0.897956, 0.847812, 0.814007, 0.793112, 0.782349, 0.77974, 0.785083, 0.797298, 0.813708, 0.836949, 0.850748, 0.858756, 0.823327],
	  [1.0813, 1.01036, 0.908115, 0.84808, 0.807807, 0.782758, 0.769239, 0.763294, 0.761293, 0.773114, 0.787471, 0.805788, 0.826063, 0.847037, 0.862569, 0.827133],
	  [1.02045, 0.976022, 0.894052, 0.833797, 0.791417, 0.761919, 0.742856, 0.734295, 0.73183, 0.737728, 0.749916, 0.76965, 0.79265, 0.817232, 0.830053, 0.807644],
	  [0.975507, 0.937157, 0.869956, 0.817599, 0.777362, 0.749731, 0.72941, 0.719385, 0.718641, 0.725071, 0.738938, 0.762324, 0.788287, 0.822578, 0.847537, 0.840179],
	  [0.966222, 0.927697, 0.869503, 0.827392, 0.792519, 0.765055, 0.749054, 0.737671, 0.736818, 0.741364, 0.756918, 0.782049, 0.816928, 0.862733, 0.911826, 0.947701],
	  [0.941417, 0.931757, 0.901292, 0.852774, 0.802177, 0.759511, 0.726692, 0.705822, 0.699634, 0.699843, 0.718528, 0.749023, 0.787584, 0.845292, 0.91141, 0.966078]	  
	],
	[ [1.27426, 1.19175, 1.05934, 0.973038, 0.909823, 0.861483, 0.821608, 0.792506, 0.771765, 0.757368, 0.747217, 0.742414, 0.737547, 0.731485, 0.71678, 0.692145],
	  [1.20255, 1.13089, 1.00916, 0.927784, 0.866592, 0.821308, 0.786168, 0.762307, 0.744728, 0.735681, 0.730353, 0.731412, 0.734882, 0.737942, 0.735619, 0.700012],
	  [1.27204, 1.18739, 1.05069, 0.967695, 0.90854, 0.865532, 0.834186, 0.818909, 0.812163, 0.810419, 0.819609, 0.833564, 0.843202, 0.852653, 0.848203, 0.808108],
	  [1.16399, 1.0912, 0.971812, 0.897956, 0.847812, 0.814007, 0.793112, 0.782349, 0.77974, 0.785083, 0.797298, 0.813708, 0.836949, 0.850748, 0.858756, 0.823327],
	  [1.0813, 1.01036, 0.908115, 0.84808, 0.807807, 0.782758, 0.769239, 0.763294, 0.761293, 0.773114, 0.787471, 0.805788, 0.826063, 0.847037, 0.862569, 0.827133],
	  [1.02045, 0.976022, 0.894052, 0.833797, 0.791417, 0.761919, 0.742856, 0.734295, 0.73183, 0.737728, 0.749916, 0.76965, 0.79265, 0.817232, 0.830053, 0.807644],
	  [0.975507, 0.937157, 0.869956, 0.817599, 0.777362, 0.749731, 0.72941, 0.719385, 0.718641, 0.725071, 0.738938, 0.762324, 0.788287, 0.822578, 0.847537, 0.840179],
	  [0.966222, 0.927697, 0.869503, 0.827392, 0.792519, 0.765055, 0.749054, 0.737671, 0.736818, 0.741364, 0.756918, 0.782049, 0.816928, 0.862733, 0.911826, 0.947701],
	  [0.941417, 0.931757, 0.901292, 0.852774, 0.802177, 0.759511, 0.726692, 0.705822, 0.699634, 0.699843, 0.718528, 0.749023, 0.787584, 0.845292, 0.91141, 0.966078]	  
	]
]

dune_vis_RS100cm_hits_parameterization:
{
 FlatPDCorr: true
 VIS_distances_x_flat: @local::VIS_distances_x_flat_dune_argon
 VIS_distances_r_flat: @local::VIS_distances_r_flat_dune_argon
 VIS_correction_flat:  @local::VIS_correction_flat_dune_argon

 DomePDCorr: false
 
 delta_angulo_vis: 10

 PMT_radius: 10.16
}

# Xenon
VIS_distances_x_flat_dune_xenon: [3, 13, 38, 63, 88, 113, 138, 163, 188, 213, 238, 263, 288, 313, 338, 353]
VIS_distances_r_flat_dune_xenon: [54.1115, 154.253, 269.706, 367.262, 496.739, 605.581, 693.216, 782.765, 862.208]

VIS_correction_flat_dune_xenon: [ 
	[ [1.42292, 1.31942, 1.14314, 1.03354, 0.954893, 0.895668, 0.850742, 0.813135, 0.784575, 0.769604, 0.758446, 0.747137, 0.748827, 0.763408, 0.776546, 0.769917],
	  [1.41836, 1.32156, 1.15245, 1.03549, 0.955398, 0.893329, 0.844977, 0.803317, 0.780003, 0.762924, 0.754932, 0.749316, 0.753423, 0.764773, 0.775107, 0.73847],
	  [1.43064, 1.32918, 1.15538, 1.04562, 0.957868, 0.902, 0.858058, 0.82298, 0.798712, 0.783286, 0.772047, 0.764398, 0.775728, 0.790624, 0.797297, 0.75866],
	  [1.46201, 1.36552, 1.20406, 1.09302, 1.01223, 0.951456, 0.905415, 0.868787, 0.844916, 0.826713, 0.817526, 0.824628, 0.829448, 0.83788, 0.832992, 0.824314],
	  [1.61987, 1.52623, 1.38658, 1.22113, 1.1464, 1.07976, 1.02709, 0.986773, 0.953123, 0.935845, 0.913943, 0.91304, 0.915525, 0.925434, 0.93213, 0.955269],
	  [1.89154, 1.78597, 1.64064, 1.48965, 1.38724, 1.29546, 1.21908, 1.16388, 1.11387, 1.08341, 1.06077, 1.04836, 1.05, 1.05101, 1.04239, 0.983244],
	  [2.05023, 1.96241, 1.79936, 1.66012, 1.5446, 1.45309, 1.36128, 1.30031, 1.24959, 1.21221, 1.18766, 1.16757, 1.16475, 1.17336, 1.15028, 1.11875],
	  [2.40085, 2.26858, 2.10522, 1.95488, 1.82863, 1.72549, 1.63033, 1.55232, 1.49184, 1.43598, 1.41357, 1.38856, 1.39596, 1.37445, 1.40755, 1.47731],
	  [3.00131, 2.96722, 2.87576, 2.69863, 2.50406, 2.32312, 2.15486, 2.01486, 1.8907, 1.79851, 1.72108, 1.65956, 1.61751, 1.59252, 1.5179, 1.49579]
	],
	[ [1.37407, 1.2769, 1.11892, 1.02321, 0.954931, 0.900042, 0.86009, 0.828382, 0.803265, 0.789315, 0.775509, 0.768375, 0.775618, 0.786733, 0.805713, 0.810876],
	  [1.36715, 1.28218, 1.12903, 1.02615, 0.954457, 0.896786, 0.854357, 0.817711, 0.797061, 0.784298, 0.773302, 0.773805, 0.780595, 0.796419, 0.810985, 0.788883],
	  [1.37248, 1.28618, 1.12822, 1.03165, 0.953403, 0.905577, 0.865954, 0.833164, 0.812087, 0.797174, 0.790532, 0.78481, 0.794702, 0.811046, 0.826019, 0.800091],
	  [1.41499, 1.33017, 1.18144, 1.08634, 1.01416, 0.959179, 0.918611, 0.886187, 0.862766, 0.847704, 0.843878, 0.850882, 0.85918, 0.868345, 0.872051, 0.872198],
	  [1.60827, 1.5209, 1.40127, 1.23055, 1.16318, 1.09904, 1.05255, 1.01438, 0.986219, 0.967248, 0.94471, 0.946333, 0.954531, 0.96617, 0.985107, 1.00816],
	  [1.79109, 1.69186, 1.56698, 1.43749, 1.34995, 1.27419, 1.20955, 1.16172, 1.12054, 1.09672, 1.08068, 1.07198, 1.07992, 1.07807, 1.0831, 1.04207],
	  [1.94105, 1.86262, 1.72586, 1.61135, 1.51152, 1.43401, 1.35988, 1.30749, 1.26334, 1.23276, 1.2112, 1.19643, 1.19967, 1.20709, 1.18601, 1.1724],
	  [2.38598, 2.2534, 2.10385, 1.96647, 1.85609, 1.75645, 1.67094, 1.59531, 1.53349, 1.4914, 1.46947, 1.45301, 1.4647, 1.44839, 1.4737, 1.55239],
	  [2.72183, 2.68984, 2.63433, 2.50323, 2.34891, 2.2024, 2.06186, 1.93903, 1.8393, 1.75606, 1.69391, 1.6483, 1.60708, 1.58162, 1.50839, 1.48248]
	],
	[ [1.2794, 1.20006, 1.07694, 1.00277, 0.950365, 0.908544, 0.87576, 0.851775, 0.83527, 0.825862, 0.818268, 0.815444, 0.823338, 0.835547, 0.858962, 0.859531],
	  [1.27703, 1.20877, 1.08646, 1.00402, 0.948941, 0.906946, 0.870997, 0.842256, 0.829672, 0.820007, 0.815418, 0.818627, 0.828569, 0.844322, 0.862867, 0.833061],
	  [1.2874, 1.21515, 1.09059, 1.01232, 0.950562, 0.915758, 0.885219, 0.862458, 0.845484, 0.836697, 0.833105, 0.831037, 0.846697, 0.862853, 0.884124, 0.848749],
	  [1.34102, 1.27211, 1.15161, 1.07866, 1.02081, 0.97755, 0.94591, 0.920072, 0.903687, 0.893782, 0.892264, 0.905507, 0.916919, 0.927907, 0.932861, 0.928055],
	  [1.53413, 1.45896, 1.35954, 1.22871, 1.16754, 1.12509, 1.08659, 1.05639, 1.03529, 1.02295, 1.00668, 1.0114, 1.02304, 1.03636, 1.05397, 1.08081],
	  [1.65867, 1.59076, 1.49496, 1.39836, 1.3354, 1.27703, 1.22807, 1.19247, 1.16281, 1.14552, 1.13656, 1.13351, 1.14515, 1.15131, 1.15634, 1.11231],
	  [1.80453, 1.74518, 1.65345, 1.57666, 1.5019, 1.44094, 1.38424, 1.34313, 1.30982, 1.28811, 1.27395, 1.2624, 1.2718, 1.28459, 1.26347, 1.24585],
	  [2.10153, 2.05328, 1.97521, 1.90129, 1.82371, 1.75283, 1.68732, 1.63021, 1.58068, 1.54824, 1.52926, 1.5136, 1.50177, 1.52156, 1.55705, 1.62856],
	  [2.36231, 2.37399, 2.39017, 2.3408, 2.23382, 2.14055, 2.03151, 1.94209, 1.86046, 1.79827, 1.74587, 1.70999, 1.67968, 1.66205, 1.59837, 1.57015]
	],
	[ [1.1587, 1.10258, 1.01763, 0.972936, 0.942476, 0.918824, 0.90139, 0.890344, 0.883709, 0.88271, 0.886015, 0.890102, 0.902704, 0.920961, 0.950356, 0.959914],
	  [1.15581, 1.11106, 1.0278, 0.974191, 0.941421, 0.916465, 0.897497, 0.88092, 0.878494, 0.878512, 0.88354, 0.891103, 0.908239, 0.932995, 0.959165, 0.932838],
	  [1.18233, 1.13225, 1.04602, 0.996879, 0.954006, 0.937118, 0.921234, 0.909001, 0.903469, 0.905103, 0.90932, 0.91506, 0.936128, 0.962579, 0.989865, 0.955045],
	  [1.27987, 1.22599, 1.13806, 1.09147, 1.05338, 1.02533, 1.00669, 0.991285, 0.984225, 0.983176, 0.989949, 1.01319, 1.02911, 1.0466, 1.05565, 1.05465],
	  [1.37098, 1.31428, 1.25887, 1.16969, 1.13438, 1.11293, 1.09334, 1.082, 1.07498, 1.07414, 1.06876, 1.08114, 1.10154, 1.12102, 1.14582, 1.17267],
	  [1.50236, 1.46554, 1.41301, 1.36147, 1.32546, 1.29033, 1.26487, 1.24705, 1.23106, 1.2259, 1.22713, 1.23504, 1.25331, 1.26746, 1.28144, 1.23209],
	  [1.60315, 1.5783, 1.53919, 1.50024, 1.47074, 1.44497, 1.40436, 1.389, 1.372, 1.3651, 1.36882, 1.37046, 1.38737, 1.41173, 1.41223, 1.37083],
	  [1.75648, 1.73054, 1.71033, 1.69857, 1.67488, 1.65189, 1.62651, 1.60748, 1.59238, 1.58493, 1.57967, 1.59267, 1.61092, 1.62596, 1.65529, 1.74053],
	  [2.00571, 2.04056, 2.13422, 2.15003, 2.11537, 2.07883, 2.01903, 1.96674, 1.92093, 1.88048, 1.85433, 1.83814, 1.83025, 1.81992, 1.76921, 1.72067]
	],
	[ [1.04658, 1.00778, 0.95966, 0.942102, 0.936297, 0.934151, 0.935516, 0.940309, 0.949998, 0.962494, 0.977172, 0.990667, 1.01269, 1.03264, 1.07541, 1.09656],
	  [1.05348, 1.02322, 0.974812, 0.949217, 0.941289, 0.936595, 0.935076, 0.933571, 0.948089, 0.959977, 0.977878, 0.996721, 1.02375, 1.05695, 1.09578, 1.07113],
	  [1.11199, 1.07678, 1.02098, 0.99726, 0.977216, 0.981083, 0.982685, 0.987138, 0.995204, 1.00864, 1.02642, 1.0376, 1.07245, 1.10808, 1.1523, 1.11488],
	  [1.1551, 1.11778, 1.07282, 1.04944, 1.03799, 1.02988, 1.02786, 1.03494, 1.04407, 1.05898, 1.07942, 1.09781, 1.13716, 1.16616, 1.19515, 1.18285],
	  [1.20648, 1.16921, 1.15214, 1.10204, 1.08995, 1.09863, 1.10272, 1.11084, 1.12357, 1.14067, 1.15096, 1.17381, 1.20943, 1.23644, 1.2713, 1.30183],
	  [1.28456, 1.26706, 1.26798, 1.25408, 1.25225, 1.25116, 1.25023, 1.25701, 1.26068, 1.27704, 1.2955, 1.31538, 1.34945, 1.37064, 1.39389, 1.34066],
	  [1.38944, 1.38761, 1.39433, 1.40126, 1.40151, 1.40766, 1.40087, 1.40847, 1.41943, 1.43345, 1.45508, 1.48215, 1.51808, 1.55559, 1.57311, 1.5031],
	  [1.46756, 1.46635, 1.4887, 1.5255, 1.54733, 1.56291, 1.5749, 1.59327, 1.60871, 1.62682, 1.65092, 1.68253, 1.72136, 1.75329, 1.78396, 1.8622],
	  [1.66989, 1.72621, 1.86738, 1.94471, 1.96866, 1.98785, 1.97897, 1.97116, 1.96262, 1.96178, 1.96451, 1.97127, 1.98368, 2.00068, 1.9676, 1.88032]
	],
	[ [1.03118, 1.00281, 0.976428, 0.980169, 0.991869, 1.00883, 1.02906, 1.05058, 1.0795, 1.11169, 1.14202, 1.17375, 1.20765, 1.23382, 1.28736, 1.3177],
	  [1.04496, 1.02017, 0.997629, 0.995814, 1.00113, 1.01321, 1.03076, 1.05255, 1.0761, 1.1072, 1.13805, 1.17251, 1.21393, 1.25785, 1.31348, 1.29418],
	  [1.04761, 1.02269, 0.996304, 0.995023, 1.0007, 1.01443, 1.03109, 1.05143, 1.07711, 1.10826, 1.1405, 1.17231, 1.21302, 1.25633, 1.3085, 1.27693],
	  [1.03766, 1.01826, 0.994187, 0.991873, 0.998316, 1.0141, 1.03499, 1.05694, 1.0847, 1.11766, 1.15486, 1.20303, 1.24369, 1.28379, 1.31056, 1.30615],
	  [1.05731, 1.03858, 1.01847, 1.02548, 1.05105, 1.06778, 1.09361, 1.12376, 1.15584, 1.19305, 1.22445, 1.2704, 1.30898, 1.34238, 1.38562, 1.409],
	  [1.10877, 1.10754, 1.14076, 1.15307, 1.18504, 1.20609, 1.22933, 1.25754, 1.28835, 1.32514, 1.36309, 1.39769, 1.45247, 1.49321, 1.52081, 1.46434],
	  [1.1436, 1.15103, 1.18693, 1.22099, 1.25743, 1.29632, 1.31765, 1.35473, 1.39353, 1.4329, 1.48052, 1.53162, 1.58169, 1.64218, 1.67934, 1.59459],
	  [1.19421, 1.20256, 1.25152, 1.317, 1.36939, 1.41774, 1.46407, 1.51032, 1.55923, 1.60923, 1.66674, 1.71655, 1.77754, 1.83076, 1.8659, 1.93086],
	  [1.34172, 1.40313, 1.56572, 1.68537, 1.75519, 1.81807, 1.85753, 1.89438, 1.93073, 1.96484, 2.00243, 2.04032, 2.08798, 2.12176, 2.12229, 2.00869]
	],
	[ [1.16989, 1.14166, 1.11952, 1.12862, 1.15072, 1.1794, 1.21092, 1.24722, 1.28841, 1.33695, 1.38336, 1.42854, 1.47133, 1.49804, 1.54741, 1.60228],
	  [1.10141, 1.07998, 1.06145, 1.06426, 1.08325, 1.10846, 1.13749, 1.16747, 1.20553, 1.25047, 1.29551, 1.34354, 1.40275, 1.45218, 1.51533, 1.50297],
	  [1.01096, 0.991787, 0.971516, 0.976379, 0.991447, 1.0196, 1.05113, 1.08405, 1.12178, 1.1661, 1.21459, 1.25266, 1.3159, 1.36625, 1.42783, 1.38305],
	  [0.969217, 0.952436, 0.942125, 0.952499, 0.972033, 0.996329, 1.02925, 1.06522, 1.10686, 1.1524, 1.20293, 1.26395, 1.32181, 1.3664, 1.3952, 1.38077],
	  [0.947213, 0.934058, 0.939794, 0.941679, 0.973627, 1.00591, 1.04379, 1.08653, 1.13184, 1.1822, 1.22609, 1.28252, 1.33969, 1.38291, 1.42353, 1.43162],
	  [0.974022, 0.978218, 1.02104, 1.04427, 1.08599, 1.11956, 1.15665, 1.20023, 1.24537, 1.2971, 1.34998, 1.39711, 1.46284, 1.52256, 1.55725, 1.50591],
	  [0.983942, 0.997837, 1.03974, 1.0837, 1.12872, 1.17995, 1.21721, 1.26786, 1.3201, 1.37515, 1.43636, 1.50599, 1.57261, 1.639, 1.69817, 1.60824],
	  [0.986637, 1.00021, 1.05809, 1.12605, 1.18612, 1.24586, 1.30626, 1.36646, 1.42805, 1.49162, 1.55908, 1.62912, 1.70098, 1.77127, 1.82632, 1.83638],
	  [1.05328, 1.11283, 1.26775, 1.3846, 1.46585, 1.54778, 1.6025, 1.66216, 1.7191, 1.77506, 1.83249, 1.89588, 1.95564, 2.01094, 2.03729, 1.92352]
	],
	[ [1.16989, 1.14166, 1.11952, 1.12862, 1.15072, 1.1794, 1.21092, 1.24722, 1.28841, 1.33695, 1.38336, 1.42854, 1.47133, 1.49804, 1.54741, 1.60228],
	  [1.10141, 1.07998, 1.06145, 1.06426, 1.08325, 1.10846, 1.13749, 1.16747, 1.20553, 1.25047, 1.29551, 1.34354, 1.40275, 1.45218, 1.51533, 1.50297],
	  [1.18138, 1.14739, 1.12995, 1.13489, 1.15539, 1.18368, 1.21695, 1.25575, 1.29879, 1.35524, 1.41206, 1.46715, 1.5353, 1.58196, 1.64623, 1.61357],
	  [1.07715, 1.05718, 1.04135, 1.0538, 1.07493, 1.10168, 1.13983, 1.17895, 1.22699, 1.2772, 1.33161, 1.41493, 1.47309, 1.51852, 1.54152, 1.53889],
	  [1.02121, 1.00515, 1.03757, 1.0002, 1.03372, 1.07104, 1.11477, 1.15716, 1.20884, 1.26404, 1.30206, 1.36415, 1.43529, 1.4845, 1.53161, 1.54125],
	  [0.991434, 0.993547, 1.04104, 1.06174, 1.09845, 1.13584, 1.17396, 1.22239, 1.26504, 1.32346, 1.38022, 1.4284, 1.49953, 1.55411, 1.60144, 1.5439],
	  [0.958746, 0.973306, 1.01366, 1.05779, 1.09917, 1.14531, 1.18026, 1.23175, 1.28569, 1.33957, 1.40024, 1.45703, 1.52317, 1.60065, 1.64575, 1.56922],
	  [0.958867, 0.972587, 1.02301, 1.08662, 1.14244, 1.19739, 1.25631, 1.31383, 1.37222, 1.43563, 1.50117, 1.56715, 1.63567, 1.70922, 1.76777, 1.7753],
	  [0.986332, 1.04235, 1.18522, 1.29253, 1.36492, 1.43449, 1.4859, 1.53936, 1.59273, 1.64912, 1.70134, 1.7577, 1.81235, 1.86855, 1.89174, 1.80892]
	],
	[ [1.16989, 1.14166, 1.11952, 1.12862, 1.15072, 1.1794, 1.21092, 1.24722, 1.28841, 1.33695, 1.38336, 1.42854, 1.47133, 1.49804, 1.54741, 1.60228],
	  [1.10141, 1.07998, 1.06145, 1.06426, 1.08325, 1.10846, 1.13749, 1.16747, 1.20553, 1.25047, 1.29551, 1.34354, 1.40275, 1.45218, 1.51533, 1.50297],
	  [1.18138, 1.14739, 1.12995, 1.13489, 1.15539, 1.18368, 1.21695, 1.25575, 1.29879, 1.35524, 1.41206, 1.46715, 1.5353, 1.58196, 1.64623, 1.61357],
	  [1.07715, 1.05718, 1.04135, 1.0538, 1.07493, 1.10168, 1.13983, 1.17895, 1.22699, 1.2772, 1.33161, 1.41493, 1.47309, 1.51852, 1.54152, 1.53889],
	  [1.02121, 1.00515, 1.03757, 1.0002, 1.03372, 1.07104, 1.11477, 1.15716, 1.20884, 1.26404, 1.30206, 1.36415, 1.43529, 1.4845, 1.53161, 1.54125],
	  [0.991434, 0.993547, 1.04104, 1.06174, 1.09845, 1.13584, 1.17396, 1.22239, 1.26504, 1.32346, 1.38022, 1.4284, 1.49953, 1.55411, 1.60144, 1.5439],
	  [0.958746, 0.973306, 1.01366, 1.05779, 1.09917, 1.14531, 1.18026, 1.23175, 1.28569, 1.33957, 1.40024, 1.45703, 1.52317, 1.60065, 1.64575, 1.56922],
	  [0.958867, 0.972587, 1.02301, 1.08662, 1.14244, 1.19739, 1.25631, 1.31383, 1.37222, 1.43563, 1.50117, 1.56715, 1.63567, 1.70922, 1.76777, 1.7753],
	  [0.986332, 1.04235, 1.18522, 1.29253, 1.36492, 1.43449, 1.4859, 1.53936, 1.59273, 1.64912, 1.70134, 1.7577, 1.81235, 1.86855, 1.89174, 1.80892]
	]
]

dune_vis_xenon_hits_parameterization:
{
 FlatPDCorr: true
 VIS_distances_x_flat: @local::VIS_distances_x_flat_dune_xenon
 VIS_distances_r_flat: @local::VIS_distances_r_flat_dune_xenon
 VIS_correction_flat:  @local::VIS_correction_flat_dune_xenon

 DomePDCorr: false
 
 delta_angulo_vis: 10

 PMT_radius: 10.16
}

END_PROLOG

BEGIN_PROLOG

##########
# 35 ton #
##########

dune35t_photonvisibilityservice:
{

  NX: 100
  NY: 100
  NZ: 100
  UseCryoBoundary: true

  DoNotLoadLibrary: false

  LibraryBuildJob: false

  LibraryFile: "PhotonPropagation/LibraryData/lib_35ton_v5_20150721.root"

 #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}

dune35t_photonvisibilityservice_buildlib: @local::dune35t_photonvisibilityservice
dune35t_photonvisibilityservice_buildlib.DoNotLoadLibrary: true
dune35t_photonvisibilityservice_buildlib.LibraryBuildJob: true
dune35t_photonvisibilityservice_buildlib.LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"	 







######################
# 1x2x6 SP Workspace #
######################

dune10kt_v1_1x2x6_photonvisibilityservice:
{

  NX: 100
  NY: 100
  NZ: 300
  UseCryoBoundary: true

  DoNotLoadLibrary: false

  LibraryBuildJob: false

  LibraryFile: "PhotonPropagation/LibraryData/lib_dune10kt_v1_1x2x6_20170412.root"
  

 #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}


dune10kt_v2_1x2x6_photonvisibilityservice:                           @local::dune10kt_v1_1x2x6_photonvisibilityservice
dune10kt_v2_1x2x6_photonvisibilityservice.LibraryFile:               "PhotonPropagation/LibraryData/lib_dune10kt_v2_1x2x6_20171113.root"


dune10kt_1x2x6_xe_photonvisibilityservice: {
   
  NX: 100
  NY: 100
  NZ: 300

  # The boundaries of the cryostat are:
  # X = [-379.662, 379.662] cm
  # Y = [-658.099, 699.599] cm
  # Z = [-302.946, 1443.53] cm
  UseCryoBoundary: false
  XMin: 0
  XMax: 379.662
  YMin: -658.09
  YMax: 699.59
  ZMin: -302.946
  ZMax: 1443.5
  ReflectOverZeroX: true

  StoreReflected: false
  StoreReflT0: false
  IncludePropTime: false

  DoNotLoadLibrary: false
  LibraryBuildJob: false

  LibraryFile: "PhotonPropagation/LibraryData/lib_dune10kt_v3_1x2x6_Xe_photonvisibilityservice.root"
}



### Visibility services with ARAPUCAs and reflector foils
dune10kt_1x2x6_refl_v1_photonvisibilityservice: {

   NX: 75
   NY: 125
   NZ: 300

   # The boundaries of the cryostat are:
   # X = [-379.662, 379.662] cm
   # Y = [-658.099, 699.599] cm
   # Z = [-302.946, 1443.53] cm
   UseCryoBoundary: false
   XMin: 0
   XMax: 379.662
   YMin: -658.09
   YMax: 699.59
   ZMin: -302.946
   ZMax: 1443.5
   ReflectOverZeroX: true

   StoreReflected: true
   StoreReflT0: true
   IncludePropTime: false

   DoNotLoadLibrary: false
   LibraryBuildJob: false

   LibraryFile: "PhotonPropagation/LibraryData/lib_dune10kt_v4_1x2x6_withfoils_lib.root"
}


##############
#
# Enable direct and reflected timing parameterization on top of a photon library.
# Works only for DUNE SP.
#
dunesp_library_vuv_vis_prop_timing_photonvisibilityservice:
{
   # This will need to be repalced in dunetpc with
   # dunesp-specific library settings
   @table::dune10kt_1x2x6_refl_v1_photonvisibilityservice

   # Flag to enable time parameterizations
   IncludePropTime: true

   # DUNE-specific VUV timing parameterization
   @table::dune_vuv_timing_parameterization

   # Flag to enable visible light simulation
   StoreReflected: true
   
   # DUNE-specific VIS parameterization
   @table::dune_vis_timing_parameterization

}

#
# Enable direct timing parameterization and Nhits model estimation.
# Works only for DUNE SP.
#
# xenon doped argon case
dunesp_Nhits_vuv_Xe_photonvisibilityservice:
{
   # Flags to enable parameterizations, disable library
   IncludePropTime: false	# timing parameterisation does not exist for Xe doped case
   UseNhitsModel: true
   DoNotLoadLibrary: true

   # Semi-analytic VUV Nhits parameters
   @table::dune_vuv_Xenon_hits_parameterization
}

#
# Enable direct and reflected timing parameterization and Nhits model estimation.
# Works only for DUNE SP.
#
# default case is 100cm Rayleigh scattering length for the VUV light
dunesp_Nhits_vuv_vis_prop_timing_RS100cm_photonvisibilityservice:
{
   # Flags to enable parameterizations, disable library
   IncludePropTime: true
   UseNhitsModel: true
   DoNotLoadLibrary: true

   # DUNE-specific VUV time parameterization
   @table::dune_vuv_timing_parameterization

   # DUNE-specific VUV semi-analytic Nhits parameters
   @table::dune_vuv_RS100cm_hits_parameterization

   # Flag to enable visible light simulation
   StoreReflected: true
 
   # DUNE-specific VIS time parameterization
   @table::dune_vis_timing_parameterization

   # DUNE-specific VIS semi-analytic Nhits parameters
   @table::dune_vis_RS100cm_hits_parameterization

}
# xenon doped argon case
dunesp_Nhits_vuv_vis_Xe_photonvisibilityservice:
{
   # DUNE-SP VUV timing and Nhits settings - note: timing is disabled, parameterisation does not exist for Xe doped case
   @table::dunesp_Nhits_vuv_Xe_photonvisibilityservice

   # Flag to enable visible light simulation
   StoreReflected: true
 
   # DUNE-specific VIS semi-analytic Nhits parameters
   @table::dune_vis_xenon_hits_parameterization
}

##############


# Make a choice here among the above for *the* FD 1x2x6 PVS
# Use the pre-defined DUNE SP configuration for paramterized simulation
# Default case is with 90cm Rayleigh scattering length @ 128nm
dune10kt_1x2x6_photonvisibilityservice: @local::dunesp_Nhits_vuv_vis_prop_timing_RS100cm_photonvisibilityservice

# Make choice here for Xenon doped FD 1x2x6 PVS
# Use pre-defined DUNE SP configuration for paramterized simulation
dune10kt_1x2x6_xenon_photonvisibilityservice: @local::dunesp_Nhits_vuv_vis_Xe_photonvisibilityservice



# Jobs for building libraries:
dune10kt_1x2x6_photonvisibilityservice_buildlib:                  @local::dune10kt_v1_1x2x6_photonvisibilityservice
dune10kt_1x2x6_photonvisibilityservice_buildlib.DoNotLoadLibrary: true
dune10kt_1x2x6_photonvisibilityservice_buildlib.LibraryBuildJob:  true
dune10kt_1x2x6_photonvisibilityservice_buildlib.LibraryFile:      "PhotonPropagation/LibraryData/Not_A_Library.root"

dune10kt_1x2x6_refl_photonvisibilityservice_buildlib:                  @local::dune10kt_1x2x6_refl_v1_photonvisibilityservice
dune10kt_1x2x6_refl_photonvisibilityservice_buildlib.DoNotLoadLibrary: true
dune10kt_1x2x6_refl_photonvisibilityservice_buildlib.LibraryBuildJob:  true
dune10kt_1x2x6_refl_photonvisibilityservice_buildlib.LibraryFile:      "PhotonPropagation/LibraryData/Not_A_Library.root"




##########################
# ProtoDUNE Single Phase #
##########################


protodunev4_photonvisibilityservice:
{

  NX: 100
  NY: 100
  NZ: 100
   
  UseCryoBoundary: true
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "PhotonPropagation/LibraryData/lib_protodune_v4_20171214.root"

  #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}




########################################
# ProtoDUNE Single Phase  with arapucas#
########################################

protodunev7_photonvisibilityservice:
{

  NX: 140
  NY: 120
  NZ: 140
   
  UseCryoBoundary: true
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "PhotonPropagation/LibraryData/lib_Protodunev7_merged_avg.root"

  #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}

# Uses a library with fewer voxels for less memory
protodunev7small_photonvisibilityservice: @local::protodunev7_photonvisibilityservice
protodunev7small_photonvisibilityservice.NX: 100
protodunev7small_photonvisibilityservice.NY: 100
protodunev7small_photonvisibilityservice.NZ: 100 
protodunev7small_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_Protodunev7_small.root"


# Uses library with 90cm Rayleigh scattering
protodunev7l90cm_photonvisibilityservice: @local::protodunev7_photonvisibilityservice
protodunev7l90cm_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_Protodunev7_90cm.root"

# Make the v7 visibility service the default

protodune_photonvisibilityservice: @local::protodunev7_photonvisibilityservice





########################
# ProtoDUNE Dual Phase #
########################

protodunedp_photonvisibilityservice_buildlib:
{

  NX: 29
  NY: 24
  NZ: 24
  UseCryoBoundary: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"

 #These are not used when usecryoboundary=true
  XMin: -420.5
  XMax: 304.5
  YMin: -300
  YMax: 300
  ZMin: 0
  ZMax: 600

  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 3
  ParametrisedTimePropagationFittedFormula: "TMath::Landau(x,[0],[1])"
}


protodunedp_photonvisibilityservice: @local::protodunedp_photonvisibilityservice_buildlib
protodunedp_photonvisibilityservice.DoNotLoadLibrary: false
protodunedp_photonvisibilityservice.LibraryBuildJob: false
protodunedp_photonvisibilityservice.Interpolate: true
#protodunedp_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_protodunedp_lightsim_nonuni_20171213.root"
#protodunedp_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_protodunedp_lightsim_20171204.root"
protodunedp_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedp_lightsim_20180420.root"


protodunedp_driftY_photonvisibilityservice:
{
  NX: 25
  NY: 25
  NZ: 25
  UseCryoBoundary: true
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_CRYO_RL91CM_v08_41_01_1e8_25x25x25_20200416.root"
  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 3
  ParametrisedTimePropagationMaxRange: 2000
}

protodunedp_driftY_RL99CM_VUVREF_photonvisibilityservice: @local::protodunedp_driftY_photonvisibilityservice
protodunedp_driftY_RL99CM_VUVREF_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_CRYO_RL99CM_VUVREF_v08_41_01_1e8_25x25x25_20200624.root"

protodunedp_driftY_RL61CM_photonvisibilityservice: @local::protodunedp_driftY_photonvisibilityservice
protodunedp_driftY_RL61CM_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_CRYO_RL61CM_v08_41_01_1e8_25x25x25_20200416.root"


protodunedp_driftY_AV_photonvisibilityservice:
{
  NX: 30
  NY: 30
  NZ: 30
  UseCryoBoundary: true
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  XMin:300    XMax: 300    YMin: -407    YMax: 300    ZMin: 0    ZMax: 600
  LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_AV_RL91CM_v08_41_01_1e8_30x30x30_20200416.root"
  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 3
  ParametrisedTimePropagationMaxRange: 2000
}
protodunedp_driftY_AV_RL61CM_photonvisibilityservice: @local::protodunedp_driftY_AV_photonvisibilityservice
protodunedp_driftY_AV_RL61CM_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_AV_RL61CM_v08_41_01_1e8_30x30x30_20200416.root"



####################
# Dual Phase 3x1x1 #
####################

dunedphase3x1x1_photonvisibilityservice_buildlib:
{

  NX: 4
  NY: 4
  NZ: 12
  UseCryoBoundary: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"

 #These are not used when usecryoboundary=true
  XMin: -50
  XMax: 50
  YMin: -50
  YMax: 50
  ZMin: 0
  ZMax: 300

  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 4
  ParametrisedTimePropagationFittedFormula: "TMath::Exp([0]*x) + [2]*TMath::Exp([1]*x)"

}

dunedphase3x1x1_photonvisibilityservice: @local::dunedphase3x1x1_photonvisibilityservice_buildlib
dunedphase3x1x1_photonvisibilityservice.DoNotLoadLibrary: false
dunedphase3x1x1_photonvisibilityservice.Interpolate: true
dunedphase3x1x1_photonvisibilityservice.LibraryBuildJob: false
#dunedphase3x1x1_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_dunedphase3x1x1_lightsim_20171213.root"
dunedphase3x1x1_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_dunedphase3x1x1_lightsim_20171213.root"





#################
# Dual Phase FD #
#################

dunefddphase_photonvisibilityservice_buildlib:
{

  NX: 16
  NY: 16
  NZ: 81
  UseCryoBoundary: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"

 #These are not used when usecryoboundary=true
  XMin: -600
  XMax: 600
  YMin: -600
  YMax: 600
  ZMin: 0
  ZMax: 6000

  ParametrisedTimePropagation: false
}


dunefddphase_photonvisibilityservice: @local::dunefddphase_photonvisibilityservice_buildlib
dunefddphase_photonvisibilityservice.DoNotLoadLibrary: false
dunefddphase_photonvisibilityservice.Interpolate: true
dunefddphase_photonvisibilityservice.LibraryBuildJob: false
#dunefddphase_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_FD_300_000_16_16_81.root"
dunefddphase_photonvisibilityservice.UseCryoBoundary: true
dunefddphase_photonvisibilityservice.NX: 15
dunefddphase_photonvisibilityservice.NY: 15
dunefddphase_photonvisibilityservice.NZ: 62
dunefddphase_photonvisibilityservice.ParametrisedTimePropagationMaxRange: 1000
dunefddphase_photonvisibilityservice.ParametrisedTimePropagationNParameters: 3
dunefddphase_photonvisibilityservice.ParametrisedTimePropagation: true
#dunefddphase_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_dunedp_1M_15x15x62_20180913.root"#not use this old library
dunefddphase_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_dunedp_1M_15x15x62_20181122.root"




####################################
# S2 visibility service parameters #
####################################

dunedphase3x1x1_photonvisibilityserviceS2:
{
  NX: 1
  NY: 4
  NZ: 12
  UseCryoBoundary: false
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "libext_dunedphase3x1x1_lightsim_S2_20171213.root"
 #These are not used when usecryoboundary=true
  XMin: 50
  XMax: 52
  YMin: -50
  YMax: 50
  ZMin: 0
  ZMax: 300
  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 4
}

protodunedp_photonvisibilityserviceS2:
{

  NX: 1
  NY: 24
  NZ: 24
  UseCryoBoundary: false
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "libext_protodunedp_lightsim_S2_20171220.root"
 #These are not used when usecryoboundary=true
  XMin: 296
  XMax: 302
  YMin: -300
  YMax: 300
  ZMin: 0
  ZMax: 300
  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 3
}

END_PROLOG
BEGIN_PROLOG

# Standard configurations for art's built-in FileCatalogMetadata service.
# Metadata fields are standard, but values are still dune-specific.

art_file_catalog:
{
  # Note sam application name is taken from "process_name" fcl parameter in main job file.
  applicationFamily:   "art"
  applicationVersion:  "development"
  group:               "dune"
  runType:             "physics"
  fileType:            "unknown"
}

art_file_catalog_mc:           @local::art_file_catalog
art_file_catalog_mc.fileType:  "mc"

art_file_catalog_data:           @local::art_file_catalog
art_file_catalog_data.fileType:  "data"

# standard configurations for the TFileMetadataDUNE service

dune_tfile_metadata:
{
  JSONFileName:          "ana_hist.root.json"
  GenerateTFileMetadata: true
  dataTier:              "root-tuple"
  fileFormat:            "root"
}

END_PROLOG
BEGIN_PROLOG

###################################################################
# Added July-2013: These are the parameters/modules associated with
# the MicroBooNE PMT ADCs.
###################################################################

standard_opdigiproperties:
{
  SampleFreq:    64       # ADC sampling frequency in MHz
  TimeBegin:     0        # Where readout frame starts, relative to simulation t0 in micro-seconds
  TimeEnd:       1600     # Where readout frame ends, relative to simulation t0 in micro-seconds

  # Parameter of PMT & shaper
  UseEmpiricalGain:        false # boolean control to load empirical gain or not
  QE:                      0.01  # Quantum efficiency
  DarkRate:                1.e4  # Dark noise rate in Hz
  GainSpread:              0.05  # Intrinsic spread in each PMT's gain in fraction (percentile/100)
  GainSpread_PMT2PMT:      0.05  # PMT-to-PMT spread in the gain mean values in fraction (percentile/100)
  HighGainMean:            20    # ADC count per p.e.
  LowGainMean:             2     # ADC count per p.e.
  
  # Option to provide empirical data files
  HighGainFile:            "OpticalDetector/toyHighGain.txt"   # PMT high gain given in a file
  LowGainFile:             "OpticalDetector/toyLowGain.txt"    # PMT low gain given in a file
  GainSpreadFile:          "OpticalDetector/toyGainSpread.txt" # PMT intrinsic gain spread in a file

  # Parameter of digitizer
  SaturationScale:         4097  # waveform saturation point
  PedFlucRate:             1.e7  # Rate of ADC count fluctuation in Hz
  PedFlucAmp:              1     # Amplitude of ADC count fluctuation
  ADCBaseline:             2048  # ADC Basline
  ADCBaseSpread:           3.4   # ADC Basline mean spread in double
  
  # Parameters for waveform generation
  UseEmpiricalShape: false # true = use text file SPE shape, false = use an analytical model
  WFLength:          2     # Maximum Duration of sahpe sampling period [us]
  PERescale:         0.2   # Rescaling factor to be applied on file input 
  WaveformFile:  "OpticalDetector/toyWaveform.txt" # a toy text file for SPE shape
  
  # Parameters for analytical waveform
  WFPowerFactor:           10    # "(n-1)" factor in shape
  WFTimeConstant:          0.006 # 60 ns
  VoltageAmpForSPE:        0.04  # 40mV/p.e.  
}


standard_opdigiproperties_3windows: @local::standard_opdigiproperties
standard_opdigiproperties_3windows.TimeBegin: -1600
standard_opdigiproperties_3windows.TimeEnd:    4800


standard_opdetresponse:
{
   service_provider:        DefaultOpDetResponse
}


END_PROLOG
BEGIN_PROLOG

PIProv: {
  G4ModuleLabel: "largeant"
  EveIdCalculator: "EmEveIdCalculator"
}
standard_particleinventoryservice: {
  ParticleInventory: @local::PIProv
}

jp250L_particleinventoryservice:     @local::standard_particleinventoryservice
bo_particleinventoryservice:         @local::standard_particleinventoryservice
argoneut_particleinventoryservice:   @local::standard_particleinventoryservice
microboone_particleinventoryservice: @local::standard_particleinventoryservice
#dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
#dunefd_particleinventoryservice:     @local::standard_particleinventoryservice

END_PROLOG


BEGIN_PROLOG

providerPBKConf:{
 G4ModuleLabel:            "largeant" # module that produced the sim::Particle and sim::SimChannel objects
 MinimumHitEnergyFraction: 0.1        # minimum fraction of energy a G4 trackID contributes to a hit to be 
                                      # counted in hit based efficiency and purity calculations
 Delay:                    0          #This number is the difference between when light arrives at the detector, and the time recorded in OpHits. This number is experiment specific and should be set by each experiment. 
}

standard_photonbacktrackerservice:
{
 PhotonBackTracker: @local::providerPBKConf
}

END_PROLOG



BEGIN_PROLOG


#
## dune photon backtracker
#

dune_providerPBKConf:{
   G4ModuleLabel:            "largeant" # module that produced the sim::Particle and sim::SimChannel objects
   MinimumHitEnergyFraction: 0.1        # minimum fraction of energy a G4 trackID contributes to a hit to be
   Delay:                    260          #This number is the difference between when light arrives at the detector, and the time recorded in OpHits. This number is experiment specific and should be set by each experiment.
}

dunefd_photonbacktrackerservice:
{
  PhotonBackTracker: @local::dune_providerPBKConf
}

dune35t_photonbacktrackerservice:
{
  PhotonBackTracker: @local::dune_providerPBKConf
}

##
# FD op det response services, nominal and reference
##

dunefd_opdetresponse_iuradiator:
{
   
   service_provider:        DUNEOpDetResponse
   
   WavelengthCutLow:        0 
   WavelengthCutHigh:       10000
   
   LightGuideAttenuation:   true

   # New IU Radiator Parameters from arXiv:1710.11233
   # Pending a new library to go along with them
   QuantumEfficiency:       0.00287 # 0.0041 * 70% for mesh transmission
   LambdaShort:                4.3 # cm
   LambdaLong:               225.0 # cm
   FracShort:                 0.29
   FracLong:                  0.71
   
   LongAxis:                z
   
   # Convert geometry to readout channels
   # when reading in fast simulation
   ChannelConversion:       fast

   # QE here includes:
   #   Measured response at SiPM end, corrected for 12-SiPM coverage: 0.005
   #   Mesh transmission: 70%
   #   Attenuation in bars already in library response

}

dunefd_opdetresponse_arapuca:
{
   
   service_provider:        DUNEOpDetResponse
   
   QuantumEfficiency:       0.035 # 3.5% efficiency, no corrections
   
   WavelengthCutLow:        0 
   WavelengthCutHigh:       10000
   
   # No light guide attenuation
   LightGuideAttenuation:   false
   LambdaShort:             0
   LambdaLong:              0
   FracShort:               0
   FracLong:                0
   LongAxis:                z
   
   # No need to convert ARAPUCA channels
   ChannelConversion:       none
}

# Use the IU radiator design by default
dunefd_opdetresponse: @local::dunefd_opdetresponse_arapuca
protodune_opdetresponse: @local::dunefd_opdetresponse_iuradiator



##
# 35ton op det response service
##

dune35t_opdetresponse:
{
   service_provider:        DUNE35tonOpDetResponse
   QuantumEfficiency:       0.0023 #0.0016/0.6961, the normalization factor for the bars in DUNE35tOpDetResponse_service
   WavelengthCutLow:        0 
   WavelengthCutHigh:       10000
   LightGuideAttenuation:   true

   LongAxis:                y
   
   # Convert geometry to readout channels
   # when reading in fast simulation
   ChannelConversion:       fast

   # QE here includes:
   #   SiPMQE: 35%
   #   SiPM Coverage: 71%
   #   Surface Conversion: 2% (conservative estimate for new bars)
   #   Mesh transmission: 83%
   #   Attenuation in bars already in library response

}

dunedphase3x1x1_opdigiproperties:
{
  SampleFreq:    250       # ADC sampling frequency in MHz
  TimeBegin:     -200        # Where readout frame starts, relative to simulation t0 in micro-seconds
  TimeEnd:       800     # Where readout frame ends, relative to simulation t0 in micro-seconds
  # Parameter of PMT & shaper
  UseEmpiricalGain:        false # boolean control to load empirical gain or not
  QE:                      0.2  # Quantum efficiency
  DarkRate:                1.7e3  # Dark noise rate in Hz - as stablished in arXiv:1806.04571
  GainSpread:              0.05  # Intrinsic spread in each PMT's gain in fraction (percentile/100)
  GainSpread_PMT2PMT:      0.05  # PMT-to-PMT spread in the gain mean values in fraction (percentile/100)
  HighGainMean:            20    # ADC count per p.e.
  LowGainMean:             2     # ADC count per p.e

  # Option to provide empirical data files
  HighGainFile:            ""   # PMT high gain given in a file
  LowGainFile:             ""    # PMT low gain given in a file
  GainSpreadFile:          "" # PMT intrinsic gain spread in a file
  # Parameter of digitizer
  SaturationScale:         4096  # waveform saturation point
  PedFlucRate:             1.e7  # Rate of ADC count fluctuation in Hz
  PedFlucAmp:              1     # Amplitude of ADC count fluctuation
  ADCBaseline:             100  # ADC Basline
  ADCBaseSpread:           3.4   # ADC Basline mean spread in double

  # Parameters for waveform generation
  UseEmpiricalShape: true # true = use text file SPE shape, false = use an analytical model
  WFLength:          2     # Maximum Duration of sahpe sampling period [us]
  PERescale:         4.1   # Rescaling factor to be applied on file input 4.1 for a gain of 1.e6
  WaveformFile:  "PhotonPropagation/PMTResponse/protoDUNEDP_waveform_20180927.txt" # a toy text file for SPE shape

  # Parameters for analytical waveform
  WFPowerFactor:           10    # "(n-1)" factor in shape
  WFTimeConstant:          0.006 # 60 ns
  VoltageAmpForSPE:        0.04  # 40mV/p.e.
  WaveformChargeNormalized: true
}

protodunedphase_opdigiproperties:           @local::dunedphase3x1x1_opdigiproperties
protodunedphase_opdigiproperties.QE: 0.036  #
protodunedphase_opdigiproperties.SampleFreq: 62.5  #  https://www.caen.it/products/v1740/
protodunedphase_opdigiproperties.TimeBegin: -4000  #
protodunedphase_opdigiproperties.TimeEnd: 4000  #

dunefddphase_opdigiproperties:           @local::dunedphase3x1x1_opdigiproperties
dunefddphase_opdigiproperties.QE: 0.12  # as stablished in arxiv:1807.07123
END_PROLOG
# channelmapping_dune.fcl
#
# David Adams
# May 2016
#
# Configurations for the ChannelMappingService.

BEGIN_PROLOG

# For 35t data, we use the service provided in lbne_raw_data.
dune35t_channelmapping: {
  service_provider:  Dune35tChannelMappingService
}

END_PROLOG
#
# Channel filter service configuration for DUNE
#
#
BEGIN_PROLOG

dune35t_channel_status_may2016: {
# implements IChannelStatusService
service_provider: SimpleChannelStatusService

#THIS IS A LIST OF OFFLINE CHANNEL NUMBERS WHICH SUFFER FROM BAD STUCK CODES, THEY CAN BE ADDED TO THE BAD CHANNEL LIST IF REQUIRED.
#858, 861, 943, 952, 980, 1413, 1442, 1992
#OFFLINE CHANNEL NUMBERS HIGHLIGHTED AS BAD BY DAN WAHL AND AARON. ALSO HAND SELECTED FROM THE EVENT DISPLAY. COLLECTION PLANE CORRECT
#AS OF 05/03.
  BadChannels: [
    4,
   39,
   51,
   84,
   92,
  110,
  120,
  145,
  146,
  204,
  213,
  240,
  357,
  432,
  433,
  446,
  496,
  451,
  500,
  520,
  524,
  530,
  547,
  574,
  575,
  576,
  577,
  578,
  579,
  580,
  581,
  582,
  583,
  611,
  632,
  656,
  657,
  658,
  659,
  660,
  661,
  662,
  663,
  664,
  665,
  666,
  693,
  694,
  730,
  732,
  744,
  809,
  828,
  829,
  830,
  831,
  832,
  833,
  834,
  835,
  836,
  837,
  838,
  839,
  840,
  841,
  842,
  843,
  844,
  845,
  846,
  847,
  848,
  849,
  850,
  851,
  852,
  853,
  854,
  855,
  884,
  886,
  887,
  888,
  889,
  890,
  891,
  892,
  893,
  894,
  895,
  896,
  897,
  898,
  899,
  900,
  901,
  902,
  903,
  904,
  905,
  906,
  907,
  908,
  909,
  910,
  911,
  965,
  992,
  993,
  1021,
  1062,
  1105,
  1134,
  1145,
  1149,
  1206,
  1209,
  1240,
  1259,
  1272,
  1440,
  1461,
  1486,
  1494,
  1495,
  1496,
  1497,
  1498,
  1499,
  1500,
  1501,
  1502,
  1503,
  1504,
  1505,
  1506,
  1507,
  1510,
  1546,
  1555,
  1556,
  1557,
  1558,
  1559,
  1560,
  1561,
  1562,
  1563,
  1564,
  1565,
  1566,
  1567,
  1568,
  1569,
  1570,
  1571,
  1599,
  1607,
  1617,
  1625,
  1646,
  1660,
  1671,
  1679,
  1694,
  1716,
  1717,
  1718,
  1719,
  1720,
  1721,
  1722,
  1723,
  1724,
  1725,
  1726,
  1727,
  1728,
  1729,
  1730,
  1731,
  1732,
  1733,
  1740,
  1741,
  1742,
  1824,
  1825,
  1826,
  1827,
  1828,
  1829,
  1830,
  1831,
  1832,
  1833,
  1834,
  1835,
  1836,
  1837,
  1880,
  1881,
  1882,
  1883,
  1884,
  1885,
  1886,
  1887,
  1888,
  1889,
  1890,
  1891,
  1892,
  1893,
  1894,
  1895,
  1896,
  1897,
  1898,
  1899,
  1900,
  1901,
  1902,
  1903,
  1904,
  1905,
  1906,
  1907,
  1936,
  1950,
  1951,
  1952,
  1953,
  1954,
  1955,
  1956,
  1957,
  1958,
  1959,
  1960,
  1961,
  1962,
  1963,
  2029,
  2034,
  2035,
  2036,
  2037,
  2038,
  2039,
  2040,
  2041,
  2042,
  2043,
  2044,
  2045,
  2046,
  2047
]

#ONLINE CHANNEL NUMBERS HIGHLIGHTED AS BAD BY DAN AND AARON.
#BadChannels: [
#25,   
#27,   
#29,   
#31,	  
#38,   
#63,   
#78,   
#83,   
#85,   
#244,  
#253,  
#262,  
#281,  
#283,  
#285,  
#337,  
#339,  
#341,  
#383,	 
#406,  
#413,  
#415,  
#427,  
#448,  
#449,  
#450,  
#451,  
#464,  
#543,  
#555,  
#589,  
#595,  
#597,	 
#598,  
#631,  
#678,  
#721,  
#723,	 
#751,  
#817,  
#829,  
#851,  
#853,	 
#923,  
#925,  
#927,  
#1083, 
#1091, 
#1094, 
#1107, 
#1109, 
#1155, 
#1193, 
#1194, 
#1206, 
#1209, 
#1222, 
#1307, 
#1356, 
#1363, 
#1365, 
#1435, 
#1469, 
#1475, 
#1492, 
#1495, 
#1520, 
#1559, 
#1563, 
#1565, 
#1567, 
#1584,	
#1606, 
#1619, 
#1621,	
#1659, 
#1665, 
#1675, 
#1678, 
#1680, 
#1682, 
#1686, 
#1693, 
#1695,	
#1696, 
#1707, 
#1708, 
#1711, 
#1726, 
#1727, 
#1742, 
#1743, 
#1744,	
#1758, 
#1775, 
#1786, 
#1787,
#1790,
#1791, 
#1815, 
#1817, 
#1819, 
#1821, 
#1823,	
#1837, 
#1846, 
#1849, 
#1859, 
#1861, 
#1873, 
#1875, 
#1877, 
#1919,	
#1947, 
#1968,	
#1981, 
#1990, 
#2001,	
#2003,	
#2032, 
#2038, 
#2047  
#]		

  NoisyChannels: []
} 

# Bad channel list from David Adams
# January 2017
# Many runs over the course of my dataset list were studied.
# Channels are typically declared bad if any fail.
# Notes made when runs look good before or after power failure.
# Bad channels from the wahl list (above) are retained and have less indentation.
# Annotation:
#   SB - Four-consecutive sticky code fraction is greater than 30%
#   NSB - Four-consectuve non-sticky code repeat fraction is greater than 5%
#   RMS>X - RMS with 3*RMS truncation is greater than X

dune35t_channel_status_dla: {
# implements IChannelStatusService
service_provider: SimpleChannelStatusService

  BadChannels: [
# APA 0u 0-143
       2,   # SB
    4,      # NSB
       9,   # NSB
      31,   # SB
      36,   # RMS>=45
   39,      # RMS=2
   51,      # RMS=1
      65,   # SB
      80,   # RMS>=40
   84,      # RMS=2
      88,   # SB (OK for 2nd half)
      92,   # SB (OK for 2nd half)
   92,      # RMS=2
     100,   # SB
     101,   # SB
     102,   # SB
     103,   # SB
     104,   # SB
     105,   # SB
     106,   # SB
     111,   # RMS>=40
  110,      # RMS=5
     117,   # NSB
  120,
# APA 0v 144-287
  145,      # RMS=3
  146,      # RMS=1
     147,   # RMS>=50
     148,   # NSB
     183,   # SB
  204,      # SB, RMS=2
  213,      # RMS=3
     215,   # SB, RMS=40
     216,   # RMS=6
     217,   # RMS=6
     218,   # RMS=6
     219,   # RMS=40
     238,   # SB (2nd half OK)
     236,   # SB (2nd half OK)
  240,      # RMS=3
     249,   # SB
     252,   # NSB
     253,   # SB
     254,   # SB
     255,   # SB
     256,   # NSB
     257,   # SB
     258,   # SB
     259,   # SB
     260,   # SB
     280,   # SB
     287,   # RMS>=45
# APA 0z1  288-399
     319,   # SB
     346,   # SB (intermittent)
     347,   # SB (intermittent)
     348,   # SB (intermittent)
  357,      # NSB
# APA 0z2  400-511
     400,   # RMS>35
     401,   # RMS>35, sticks on 0x1
     402,   # RMS>35
     403,   # RMS>35
     404,   # RMS>35
     405,   # RMS>35
     406,   # RMS>35
     407,   # RMS>35
     408,   # RMS>35
     409,   # RMS>35
     410,   # RMS>35
     411,   # RMS>35
  432,      # RMS=5
  433,      # RMS=3
     434,   # SB (intermittent)
     441,   # SB (intermittent)
     444,   # SB
  446,      # RMS=5
  451,      # RMS=2
     458,   # SB (intermittent)
     460,   # SB (intermittent)
     469,   # SB (intermittent)
     493,   # SB (intermittent)
  496,      # SB (intermittent), RMS OK
  500,      # RMS=2
# APA 1u  512-655
     513,   # SB
     517,   # SB
  520,      # SB, RMS=0
  524,      # NSB, RMS = 1
  530,      # RMS=2
     533,   # SB
     538,   # SB, RMS=2
     539,   # SB, RMS=1
  547,      # RMS=2
     548,   # SB
     560,   # SB
     561,   # SB
     564,   # SB, RMS>30
     565,   # RMS>30
     566,   # NSB, RMS>50,RMS=1
     567,   # NSB
     568,   # NSB
     569,   # NSB
     560,   # NSB
     571,   # NSB
     572,   # NSB
     573,   # NSB
  574,      # RMS>50
  575,      # RMS>50
  576,      # RMS>50
  577,      # RMS>50
  578,      # RMS>50
  579,      # RMS>50
  580,      # RMS>50
  581,      # RMS>50
  582,      # RMS>50
  583,      # RMS>50
  611,      # RMS=3
     619,   # SB
     620,   # RMS=6
     621,   # RMS=6dd
     622,   # RMS=6
     623,   # SB
     626,   # SB
  632,      # RMS=0
     649,   # SB
     650,   # SB
     651,   # SB
     652,   # SB
     653,   # SB
     654,   # SB
# APA 1v  656-799
  656,      # NSB, RMS>50
  657,      # RMS>50
  658,      # RMS>50
  659,      # RMS>50
  660,      # RMS>50
  661,      # RMS>50
  662,      # RMS>50
  663,      # RMS>50
  664,      # RMS>50
  665,      # RMS>50
  666,      # SB OK, RMS OK
     669,   # SB
     675,   # SB
     692,   # RMS>40
  693,      # SB OK, RMS OK
  694,
     728,   # NSB
     729,   # SB, RMS=3
  730,      # SB, RMS=3
     731,   # SB, RMS=3
  732,      # NSB
     736,   # SB
     738,   # RMS>50 (intermittent)
  744,      # SB OK, RMS OK
     760,   # SB
     771,   # SB (OK for 1st half)
     776,   # SB (OK for 1st half)
     788,   # SB
     792,   # SB
# APA 1z1 800-911
     804,   # SB (OK for 1st half)
  809,      # RMS=1
     819,   # SB
     821,   # SB
     822,   # SB (OK for 1st half)
     826,   # SB
  828,      # RMS=2
  829,      # RMS=2
  830,      # RMS=2
  831,      # RMS=2
  832,      # RMS=2
  833,      # RMS=2
  834,      # RMS=2
  835,      # RMS=2
  836,      # RMS=2
  837,      # RMS=2
  838,      # RMS=2
  839,      # RMS=2
  840,      # RMS=2
  841,      # RMS=2
  842,      # RMS=2
  843,      # RMS=2
  844,      # RMS=2
  845,      # RMS=2
  846,      # RMS=2
  847,      # RMS=2
  848,      # RMS=2
  849,      # RMS=2
  850,      # RMS=2
  851,      # RMS=2
  852,      # RMS=2
  853,      # RMS=2
  854,      # RMS=2
  855,      # RMS=2
     856,   # SB
     857,   # SB
     858,   # SB
     859,   # SB
     860,   # SB
     861,   # SB
     862,   # SB
     863,   # SB
     864,   # SB
     865,   # SB
     866,   # SB
     867,   # SB
     868,   # SB
     869,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
  884,      # RMS>50
     885,   # RMS>50
  886,      # RMS>50
  887,      # RMS>50
  888,      # RMS>50
  889,      # RMS>50
  890,      # RMS>50
  891,      # RMS>50
  892,      # RMS>50
  893,      # RMS>50
  894,      # RMS>50
  895,      # RMS>50
  896,      # RMS>50
  897,      # RMS>50
  898,      # RMS>50
  899,      # RMS>50
  900,      # RMS>50
  901,      # RMS>50
  902,      # RMS>50
  903,      # RMS>50
  904,      # RMS>50
  905,      # RMS>50
  906,      # RMS>50
  907,      # RMS>50
  908,      # RMS>50
  909,      # RMS>50
  910,      # RMS>50
  911,      # RMS>50
# APA 1z2 912-1023
     940,   # SB (OK for 1st half)
     943,   # SB
     948,   # SB
     952,   # SB
  965,      # RMS=3
     978,   # SB
     980,   # SB
  992,      # RMS=0
  993,      # RMS=1
    1016,   # SB
  1021,     # RMS=1
    1023,   # SB (OK for 1st half)
# APA 2u 1024-1167
    1025,   # SB
    1026,   # SB
    1047,   # SB (OK for 2nd half of run)
    1051,   # SB (OK for 1st half of run)
    1055,   # SB
    1058,   # NSB
  1062,     # SB OK
    1063,   # SB (OK for 2nd half of run)
    1077,   # SB
    1087,   # SB
    1088,   # SB
    1089,   # SB
    1090,   # SB
    1091,   # SB
    1092,   # SB
    1093,   # SB
    1094,   # SB
    1095,   # NSB
    1097,   # SB OK, RMS=8, missing intermediate freq noise
    1102,   # SB (OK for 2nd half of run)
  1105,     # SB OK
    1122,   # SB (OK for 2nd half of run)
    1126,   # SB (OK for 1st half of run)
  1134,     # NSB
    1141,   # SB
  1145,     # SB OK
  1149,     # SB
    1160,   # SB
    1161,   # SB
    1162,   # SB
    1163,   # SB
    1164,   # SB
    1165,   # SB
    1166,   # SB
# APA 2v 1168-1311
    1169,   # SB
    1170,   # SB
    1171,   # SB
    1172,   # SB
    1173,   # SB
    1174,   # SB
    1175,   # SB
    1176,   # SB
    1189,   # SB, OK for 1st half of run
    1194,   # SB
    1204,   # NSB
    1205,   # SB
  1206,     # wahl, NSB, RMS=2
    1207,   # SB, OK for 1st half of run
    1208,   # NSB
  1209,     # wahl, SB, RMS=8 for run 13843
    1210,   # SB, OK for 2nd half of run
    1211,   # NSB
    1216,   # SB, OK for 2nd half of run
    1217,   # SB, OK for 2nd half of run
    1226,   # SB
  1240,     # wahl, SB OK, RMS=0
    1241,   # SB
    1242,   # SB
    1243,   # SB
    1244,   # SB
    1245,   # SB
    1246,   # SB
    1247,   # SB
    1254,   # SB, OK for 1st half of run
    1255,   # SB, OK for 2nd half of run
  1259,     # wahl, SB OK, RMS=3
  1272,     # wahl, SB OK, RMS=9
    1273,   # SB
    1279,   # SB
    1295,   # SB
    1298,   # SB, OK for 1st half of run
    1299,   # NSB
    1310,   # SB
# APA 2z1 1312-1423
    1312,   # NSB
    1313,   # NSB
    1314,   # NSB
    1315,   # NSB
    1316,   # NSB
    1317,   # NSB
    1318,   # NSB
    1319,   # NSB
    1320,   # NSB
    1321,   # NSB
    1322,   # NSB
    1323,   # NSB
    1324,   # NSB
    1325,   # NSB
    1340,   # SB
    1358,   # SB, OK for 2nd half of run
    1378,   # SB
    1382,   # SB
    1388,   # SB
    1397,   # SB, OK for 1st half of run
    1407,   # SB, OK for 1st half of run
    1413,   # SB, OK for 2nd half of run
    1421,   # SB
# APA 2z2 1424-1535
    1430,   # SB, OK for 1st half of run
    1439,   # SB
    1439,   # SB
  1440,     # wahl, SB
    1442,   # SB
    1447,   # SB, OK for 1st half
    1450,   # SB
    1458,   # SB
  1461,
    1468,   # SB, OK for 1st half of run
    1472,   # SB, OK for 1st half of run
    1472,   # SB
    1478,   # SB
  1486,     # wahl, SB
  1494,     # wahl, RMS low and jumpy
  1495,     # wahl, RMS low and jumpy
  1496,     # wahl, RMS low and jumpy
  1497,     # wahl, RMS low and jumpy
  1498,     # wahl, RMS low and jumpy
  1499,     # wahl, RMS low and jumpy
  1500,     # wahl, RMS low and jumpy
  1501,     # wahl, RMS low and jumpy
  1502,     # wahl, RMS low and jumpy
  1503,     # wahl, RMS low and jumpy
  1504,     # wahl
  1505,     # wahl, RMS low and jumpy
  1506,     # wahl, RMS low and jumpy
  1507,     # wahl, RMS low and jumpy
  1510,     # wahl, NSB
    1511,   # SB, OK for 2nd half
    1520,   # SB, OK for 2nd half
    1528,   # SB
# APA 3u 1536-1679
  1546,     # NSB, RMS=1
    1547,   # NSB, RMS=5
    1554,   # RMS=0
  1555,     # RMS=0
  1556,     # RMS=0
  1557,     # RMS=0
  1558,     # RMS=0
  1559,     # RMS=0
  1560,     # RMS=0
  1561,     # RMS=0
  1562,     # RMS=0
  1563,     # RMS=0
  1564,     # RMS=0
  1565,     # RMS=0
  1566,     # RMS=0
  1567,     # RMS=0
  1568,     # RMS=0
  1569,     # RMS=0
  1570,     # RMS=0
  1571,     # RMS=0
    1574,   # RMS=7
    1575,   # RMS>45
    1588,   # SB
    1589,   # RMS>40
  1599,     # RMS=2
    1606,   # SB
  1607,     # RMS=1
  1617,     # RMS=2
    1621,   # SB
  1625,     # RMS=2
    1637,   # SB (OK for 1st half)
    1638,   # SB (OK for 1st half)
    1639,   # SB (OK for 1st half)
    1640,   # SB (OK for 1st half)
    1641,   # SB (OK for 1st half)
    1642,   # SB (OK for 1st half)
    1643,   # SB (OK for 1st half)
  1646,     # RMS=5
    1647,   # RMS>45
  1660,     # RMS=2
    1661,   # RMS>45
  1671,     # NSB, RMS=2
    1672,   # SB (OK for 2nd half)
    1673,   # SB (OK for 2nd half)
    1674,   # SB (OK for 2nd half)
    1675,   # SB (OK for 2nd half)
    1676,   # SB (OK for 2nd half)
    1677,   # SB (OK for 2nd half)
    1678,   # SB (OK for 2nd half)
  1679,     # RMS=2
# APA 3v 1680-1823
  1694,     # RMS=3
  1716,     # RMS=0
  1717,     # RMS=0
  1718,     # RMS=0
  1719,     # RMS=0
  1720,     # RMS=0
  1721,     # RMS=0
  1722,     # RMS=0
  1723,     # RMS=0
  1724,     # RMS=0
  1725,     # RMS=0
  1726,     # RMS=0
  1727,     # RMS=0
  1728,     # RMS=0
  1729,     # RMS=0
  1730,     # RMS=0
  1731,     # RMS=0
  1732,     # RMS=0
  1733,     # RMS=0
  1740,     # RMS=2
  1741,     # RMS=2
  1742,     # RMS=2
    1752,   # NSB
    1753,   # SB, RMS=3
    1754,   # SB
    1755,   # SB
    1756,   # NSB
    1757,   # SB
    1758,   # SB
    1759,   # SB
    1788,   # NSB (intermittent)
    1792,   # NSB (intermittent)
# APA 3z1 1824-1935
  1824,     # RMS=2
  1825,     # RMS=2
  1826,     # RMS=2
  1827,     # RMS=2
  1828,     # RMS=2
  1829,     # RMS=2
  1830,     # RMS=2
  1831,     # RMS=2
  1832,     # RMS=2
  1833,     # RMS=2
  1834,     # RMS=2
  1835,     # RMS=2
  1836,     # RMS=2
  1837,     # RMS=2
    1843,   # SB (OK for 1st half)
    1866,   # SB
    1870,   # SB
  1880,     # RMS=0
  1881,     # RMS=0
  1882,     # RMS=0
  1883,     # RMS=0
  1884,     # RMS=0
  1885,     # RMS=0
  1886,     # RMS=0
  1887,     # RMS=0
  1888,     # RMS=0
  1889,     # RMS=0
  1890,     # RMS=0
  1891,     # RMS=0
  1892,     # RMS=0
  1893,     # RMS=0
  1894,     # RMS=0
  1895,     # RMS=0
  1896,     # RMS=0
  1897,     # RMS=0
  1898,     # RMS=0
  1899,     # RMS=0
  1900,     # RMS=0
  1901,     # RMS=0
  1902,     # RMS=0
  1903,     # RMS=0
  1904,     # RMS=0
  1905,     # RMS=0
  1906,     # RMS=0
  1907,     # RMS=0
    1909,   # SB (1st half OK)
# APA 3z2 1936-2047
  1936,     # RMS=2
    1946,   # SB
    1948,   # SB (OK for 2nd half)
  1950,     # RMS=2
  1951,     # RMS=2
  1952,     # RMS=2
  1953,     # RMS=2
  1954,     # RMS=2
  1955,     # RMS=2
  1956,     # RMS=2
  1957,     # RMS=2
  1958,     # RMS=2
  1959,     # RMS=2
  1960,     # RMS=2
  1961,     # RMS=2
  1962,     # RMS=2
  1963,     # RMS=2
    1974,   # SB (OK for 1st half)
    1992,   # SB
    1995,   # SB (OK for 2nd half)
    2004,   # SB
  2029,     # RMS=3
  2034,     # RMS=2
  2035,     # RMS=2
  2036,     # RMS=2
  2037,     # RMS=2
  2038,     # RMS=2
  2039,     # RMS=2
  2040,     # RMS=2
  2041,     # RMS=2
  2042,     # RMS=2
  2043,     # RMS=2
  2044,     # RMS=2
  2045,     # RMS=2
  2046,     # RMS=2
  2047      # RMS=2
]

  NoisyChannels: []
} 

dunedphase3x1x1_channel_status: {
# implements IChannelStatusService
service_provider: SimpleChannelStatusService

# list of bad channels:
                    BadChannels:   [
#view 0
0,    #blind
#49,
#77, 
#122,
159,  #blind
160,  #blind
#172,
#178,
#183,
#184,
#216,
#218,
#288,
319,  #blind
#view 1
320,  #blind
#477,
479,  #blind
480,  #blind
#550,
#569,
639,  #blind
640,  #blind
#674,
799,  #blind
800,  #blind
#828,
959,  #blind
960,  #blind
#1144,
1119, #blind
1120, #blind
#1275,
1279  #blind
]

# list of bad noisy channels:
                    NoisyChannels: [
#plane 0:
41    #constantly high noise
#plane 1:
]

                       } 

dunefd_channel_status: {
# implements IChannelStatusService
service_provider: SimpleChannelStatusService

# list of bad channels:
                    BadChannels:   [
]

# list of bad noisy channels:
                    NoisyChannels: [
]

                       } 

END_PROLOG
# channelstatus_pdsp.fcl
#
# David Adams
# October 2018
#
# Bad and noisy channels for protDUNE single phase.

# Include bad channel maps.
# channelstatus_pdsp_2081.fcl
#
# David Adams
# October 2018
#
# Bad and noisy channels for protDUNE single phase.

BEGIN_PROLOG

pdsp_channel_status_2018: {
 
  # implements IChannelStatusService
  service_provider: SimpleChannelStatusService

  # list of bad channels:
  BadChannels:   [
    # CE group: Inactive FE
     4411,  # femb515x12
     4412,  # femb515x13
     9990,  # femb605x10
    11842,  # femb120x03
    # CE group: Broken connection
        1,  # femb311u39
      400,  # femb301u40
      401,  # femb301u39
      800,  # femb320v01
      801,  # femb320v02
      876,  # femb319v37
     1200,  # femb310v01
     2961,  # femb501u39
     5321,  # femb216u39
     5363,  # femb217u37
     6132,  # femb215v13
     7058,  # femb213x03
     7295,  # femb202x01
     7681,  # femb611u39
     8080,  # femb601u40
     8328,  # femb607u32
     8480,  # femb620v01
     9282,  # femb620x03
     9283,  # femb620x04
     9736,  # femb611x25
     9854,  # femb602x02
    10800,  # femb105u40
    11024,  # femb110u16
    11457,  # femb110v18
    11459,  # femb110v20
    11463,  # femb110v24
    11469,  # femb110v30: bad in 4875-185-1500, ok in 5803-76-3200
    11517,  # femb109v38
    11669,  # femb105v30
    11679,  # femb105v40
    12756,  # femb110x44
    12801,  # femb411u39
    13001,  # femb416u39
    13081,  # femb418u39
    # CE group: ENC > 2000e
     4410,  # femb515x11: High noise, no signal 5008-76
    #-----
    # CE group excessive sticky
    #femb318x
     1719,  # femb318x24
     5125,  # femb211u35
     7551,  # femb208x33
     7190,  # femb211x39
     7194,  # femb211x43
     7918,  # femb616u02, sticky pedestal (three peaks)
    #-----
    # CE group: good.
    # femb311
        2,  # femb311u38, no signal
        4,  # femb311u36, very sticky pedestal 5308-76
     1632,  # femb320x33, very sticky pedestal 5308-76
     2169,  # femb302x07, Mostly stuck on one bad code, 5308-76
     2450,  # femb308x14, Very noisy (1000 ADC) in run 5759 (20nov2019)
     3541,  # femb516v22, very sticky--signal near zero half the time (5308-81)
     3543,  # femb516v24, very sticky--signal near zero half the time (5308-81)
     3661,  # femb513v22, most signal near zero (5308-81)
     3663,  # femb513v24, most signal near zero (5308-81)
     4061,  # femb503v22, most signal near zero (5308-81)
     4063,  # femb503v24, most signal near zero (5308-81)
     4141,  # femb501v22, signal near zero half the time (5308-81)
     4143,  # femb501v24, signal sometimes near zero (5308-81)
     4377,  # femb516x26, very sticky pedestal
     4379,  # femb516x28, very sticky pedestal
     4381,  # femb516x30, very sticky pedestal
     4383,  # femb516x32, very sticky pedestal
     4385,  # femb516x34, very sticky pedestal
     4387,  # femb516x36, very sticky pedestal
     4521,  # femb513x26, very sticky pedestal
     4523,  # femb513x28, very sticky pedestal
     4525,  # femb513x30, very sticky pedestal
     4527,  # femb513x32, very sticky pedestal
     4529,  # femb513x34, very sticky pedestal
     4531,  # femb513x36, very sticky pedestal
     4652,  # femb501x36, very sticky pedestal
     4654,  # femb501x34, very sticky pedestal
     4656,  # femb501x32, very sticky pedestal
     4658,  # femb501x30, very sticky pedestal
     4660,  # femb501x28, very sticky pedestal
     4748,  # femb503x36, very sticky pedestal
     4750,  # femb503x34, very sticky pedestal
     4752,  # femb503x32, very sticky pedestal
     4754,  # femb503x30, very sticky pedestal
     4756,  # femb503x28, very sticky pedestal
     4758,  # femb503x26, very sticky pedestal
     5361,  # femb217u39, no signal
     7680,  # femb611u40: No signal in 5308-76, end wire
     8501,  # femb620v22, very sticky pedestal
     8503,  # femb620v24, very sticky pedestal
     8821,  # femb612v22, very sticky pedestal
     8823,  # femb612v24, very sticky pedestal
     9261,  # femb601v22, very sticky pedestal
     9263,  # femb601v24, very sticky pedestal
     9305,  # femb620x26, very sticky pedestal
     9307,  # femb620x28, very sticky pedestal
     9309,  # femb620x30, very sticky pedestal
     9311,  # femb620x32, very sticky pedestal
     9313,  # femb620x34, very sticky pedestal
     9315,  # femb620x36, very sticky pedestal
     9689,  # femb612x26, very sticky pedestal
     9691,  # femb612x28, very sticky pedestal
     9693,  # femb612x30, very sticky pedestal
     9695,  # femb612x32, very sticky pedestal
     9697,  # femb612x34, very sticky pedestal
     9699,  # femb612x36, very sticky pedestal
     9772,  # femb601x26, very sticky pedestal
     9774,  # femb601x28, very sticky pedestal
     9776,  # femb601x30, very sticky pedestal
     9778,  # femb601x32, very sticky pedestal
     9780,  # femb601x34, very sticky pedestal
     9782,  # femb601x36, very sticky pedestal
    10102,  # femb608x42, mostly stuck on one code
    10189,  # femb609x03, mostly stuck on one code
    10697,  # femb102u23, mostly stuck on a few classic codes
    10907,  # femb107u13, mostly stuck on one code
    11203,  # femb116v04, stuck on many classic codes
    11270,  # femb115v31, stuck on many classic codes
    11902,  # femb119x15, stuck on two classic codes
    12324,  # femb101x44, stuck on many classic codes
    12333,  # femb101x35, stuck on many classic codes
    12744,  # femb109x08, stuck on many classic codes
    13363,  # femb405u37, very noisy, nosignal 5308-76-4800

    #-----
    # These 16 channels are an intermitently bad ASIC.
    # Matt W. 19oct2018.
    # femb316u
      200,   # femb316u40
      202,   # femb316u38
      204,   # femb316u36
      206,   # femb316u34
      208,   # femb316u32
    # femb316v
      991,   # femb316v32
      993,   # femb316v34
      995,   # femb316v36
      997,   # femb316v38
      999,   # femb316v40
    # femb316x
     1829,   # femb316x38
     1831,   # femb316x40
     1833,   # femb316x42
     1835,   # femb316x44
     1837,   # femb316x46
     1839    # femb316x48
    #-----
  ]

  # list of bad noisy channels:
  NoisyChannels: [
    # CE group: ENC > 2000e
     9569,
    # CE group: sticky.
     2318,
    # DLA sticky
    # femb311u
        4,
    # femb313u
       94,
    # femb319u
      325,  # femb319u35, 2020-02-27: Mostly stuck on one bad code 5141, 5795, 8764, ...
    # femb302u
      442,
      447,
      453,
      455,
      456,
      472,
      477,
    # femb304u
      571,
      573,
    # femb302v
     1534,
     1539,
     1546,
    # femb315x
     1864,
     #1864,  # acceptable??
    # femb302x
     2135,
     2146,
     2158,
     2161,
    # femb513u
     2674,  # 2-value pedestal
   # femb518u
     2833,  # Noisy adc pedestal
   # femb516x
     4377,  # Pedestal very sticky
   # femb503x
     4654,  # sticky pedestal
     4658,  # sticky pedestal
     4662,  # sticky pedestal
   # femb503x
     4752,  # sticky pedestal
   # femb214u
     5271,  # sticky pedestal
   # femb217u
     5377,  # sticky pedestal
   # femb218u
     5400,  # sticky pedestal
     5423,  # sticky pedestal
   # femb201x
     7220, # Pedestal stuck on 980
   # femb203x
     7334, # Pedestal stuck on 980,981
   # femb204x
     7347, # Pedestal stuck on 979
   # femb207x
     7396, # Sticky pedestal
   # femb607x
     8341 # Sticky pedestal
  ]

}

END_PROLOG
# channelstatus_pdsp.fcl
#
# David Adams
# October 2018
#
# Bad and noisy channels for protDUNE single phase.

# Include old bad channel maps.
# channelstatus_pdsp_2081.fcl
#
# David Adams
# October 2018
#
# Bad and noisy channels for protDUNE single phase.

BEGIN_PROLOG

pdsp_channel_status_2018: {
 
  # implements IChannelStatusService
  service_provider: SimpleChannelStatusService

  # list of bad channels:
  BadChannels:   [
    # CE group: Inactive FE
     4411,  # femb515x12
     4412,  # femb515x13
     9990,  # femb605x10
    11842,  # femb120x03
    # CE group: Broken connection
        1,  # femb311u39
      400,  # femb301u40
      401,  # femb301u39
      800,  # femb320v01
      801,  # femb320v02
      876,  # femb319v37
     1200,  # femb310v01
     2961,  # femb501u39
     5321,  # femb216u39
     5363,  # femb217u37
     6132,  # femb215v13
     7058,  # femb213x03
     7295,  # femb202x01
     7681,  # femb611u39
     8080,  # femb601u40
     8328,  # femb607u32
     8480,  # femb620v01
     9282,  # femb620x03
     9283,  # femb620x04
     9736,  # femb611x25
     9854,  # femb602x02
    10800,  # femb105u40
    11024,  # femb110u16
    11457,  # femb110v18
    11459,  # femb110v20
    11463,  # femb110v24
    11469,  # femb110v30: bad in 4875-185-1500, ok in 5803-76-3200
    11517,  # femb109v38
    11669,  # femb105v30
    11679,  # femb105v40
    12756,  # femb110x44
    12801,  # femb411u39
    13001,  # femb416u39
    13081,  # femb418u39
    # CE group: ENC > 2000e
     4410,  # femb515x11: High noise, no signal 5008-76
    #-----
    # CE group excessive sticky
    #femb318x
     1719,  # femb318x24
     5125,  # femb211u35
     7551,  # femb208x33
     7190,  # femb211x39
     7194,  # femb211x43
     7918,  # femb616u02, sticky pedestal (three peaks)
    #-----
    # CE group: good.
    # femb311
        2,  # femb311u38, no signal
        4,  # femb311u36, very sticky pedestal 5308-76
     1632,  # femb320x33, very sticky pedestal 5308-76
     2169,  # femb302x07, Mostly stuck on one bad code, 5308-76
     2450,  # femb308x14, Very noisy (1000 ADC) in run 5759 (20nov2019)
     3541,  # femb516v22, very sticky--signal near zero half the time (5308-81)
     3543,  # femb516v24, very sticky--signal near zero half the time (5308-81)
     3661,  # femb513v22, most signal near zero (5308-81)
     3663,  # femb513v24, most signal near zero (5308-81)
     4061,  # femb503v22, most signal near zero (5308-81)
     4063,  # femb503v24, most signal near zero (5308-81)
     4141,  # femb501v22, signal near zero half the time (5308-81)
     4143,  # femb501v24, signal sometimes near zero (5308-81)
     4377,  # femb516x26, very sticky pedestal
     4379,  # femb516x28, very sticky pedestal
     4381,  # femb516x30, very sticky pedestal
     4383,  # femb516x32, very sticky pedestal
     4385,  # femb516x34, very sticky pedestal
     4387,  # femb516x36, very sticky pedestal
     4521,  # femb513x26, very sticky pedestal
     4523,  # femb513x28, very sticky pedestal
     4525,  # femb513x30, very sticky pedestal
     4527,  # femb513x32, very sticky pedestal
     4529,  # femb513x34, very sticky pedestal
     4531,  # femb513x36, very sticky pedestal
     4652,  # femb501x36, very sticky pedestal
     4654,  # femb501x34, very sticky pedestal
     4656,  # femb501x32, very sticky pedestal
     4658,  # femb501x30, very sticky pedestal
     4660,  # femb501x28, very sticky pedestal
     4748,  # femb503x36, very sticky pedestal
     4750,  # femb503x34, very sticky pedestal
     4752,  # femb503x32, very sticky pedestal
     4754,  # femb503x30, very sticky pedestal
     4756,  # femb503x28, very sticky pedestal
     4758,  # femb503x26, very sticky pedestal
     5361,  # femb217u39, no signal
     7680,  # femb611u40: No signal in 5308-76, end wire
     8501,  # femb620v22, very sticky pedestal
     8503,  # femb620v24, very sticky pedestal
     8821,  # femb612v22, very sticky pedestal
     8823,  # femb612v24, very sticky pedestal
     9261,  # femb601v22, very sticky pedestal
     9263,  # femb601v24, very sticky pedestal
     9305,  # femb620x26, very sticky pedestal
     9307,  # femb620x28, very sticky pedestal
     9309,  # femb620x30, very sticky pedestal
     9311,  # femb620x32, very sticky pedestal
     9313,  # femb620x34, very sticky pedestal
     9315,  # femb620x36, very sticky pedestal
     9689,  # femb612x26, very sticky pedestal
     9691,  # femb612x28, very sticky pedestal
     9693,  # femb612x30, very sticky pedestal
     9695,  # femb612x32, very sticky pedestal
     9697,  # femb612x34, very sticky pedestal
     9699,  # femb612x36, very sticky pedestal
     9772,  # femb601x26, very sticky pedestal
     9774,  # femb601x28, very sticky pedestal
     9776,  # femb601x30, very sticky pedestal
     9778,  # femb601x32, very sticky pedestal
     9780,  # femb601x34, very sticky pedestal
     9782,  # femb601x36, very sticky pedestal
    10102,  # femb608x42, mostly stuck on one code
    10189,  # femb609x03, mostly stuck on one code
    10697,  # femb102u23, mostly stuck on a few classic codes
    10907,  # femb107u13, mostly stuck on one code
    11203,  # femb116v04, stuck on many classic codes
    11270,  # femb115v31, stuck on many classic codes
    11902,  # femb119x15, stuck on two classic codes
    12324,  # femb101x44, stuck on many classic codes
    12333,  # femb101x35, stuck on many classic codes
    12744,  # femb109x08, stuck on many classic codes
    13363,  # femb405u37, very noisy, nosignal 5308-76-4800

    #-----
    # These 16 channels are an intermitently bad ASIC.
    # Matt W. 19oct2018.
    # femb316u
      200,   # femb316u40
      202,   # femb316u38
      204,   # femb316u36
      206,   # femb316u34
      208,   # femb316u32
    # femb316v
      991,   # femb316v32
      993,   # femb316v34
      995,   # femb316v36
      997,   # femb316v38
      999,   # femb316v40
    # femb316x
     1829,   # femb316x38
     1831,   # femb316x40
     1833,   # femb316x42
     1835,   # femb316x44
     1837,   # femb316x46
     1839    # femb316x48
    #-----
  ]

  # list of bad noisy channels:
  NoisyChannels: [
    # CE group: ENC > 2000e
     9569,
    # CE group: sticky.
     2318,
    # DLA sticky
    # femb311u
        4,
    # femb313u
       94,
    # femb319u
      325,  # femb319u35, 2020-02-27: Mostly stuck on one bad code 5141, 5795, 8764, ...
    # femb302u
      442,
      447,
      453,
      455,
      456,
      472,
      477,
    # femb304u
      571,
      573,
    # femb302v
     1534,
     1539,
     1546,
    # femb315x
     1864,
     #1864,  # acceptable??
    # femb302x
     2135,
     2146,
     2158,
     2161,
    # femb513u
     2674,  # 2-value pedestal
   # femb518u
     2833,  # Noisy adc pedestal
   # femb516x
     4377,  # Pedestal very sticky
   # femb503x
     4654,  # sticky pedestal
     4658,  # sticky pedestal
     4662,  # sticky pedestal
   # femb503x
     4752,  # sticky pedestal
   # femb214u
     5271,  # sticky pedestal
   # femb217u
     5377,  # sticky pedestal
   # femb218u
     5400,  # sticky pedestal
     5423,  # sticky pedestal
   # femb201x
     7220, # Pedestal stuck on 980
   # femb203x
     7334, # Pedestal stuck on 980,981
   # femb204x
     7347, # Pedestal stuck on 979
   # femb207x
     7396, # Sticky pedestal
   # femb607x
     8341 # Sticky pedestal
  ]

}

END_PROLOG

BEGIN_PROLOG

pdsp_channel_status_nov2019: {
 
  # implements IChannelStatusService
  service_provider: SimpleChannelStatusService

  # list of bad channels:
  BadChannels:   [
    # CE group: Inactive FE
     4411,  # femb515x12
     4412,  # femb515x13
     9990,  # femb605x10
    11842,  # femb120x03
    # CE group: Broken connection
        1,  # femb311u39
      400,  # femb301u40
      401,  # femb301u39
      800,  # femb320v01
      801,  # femb320v02
      876,  # femb319v37
     1200,  # femb310v01
     2961,  # femb501u39
     5321,  # femb216u39
     5363,  # femb217u37
     6132,  # femb215v13
     7058,  # femb213x03
     7295,  # femb202x01
     7681,  # femb611u39
     7715,  # femb611u05 Very, very noisy in run 10527 (nov 2019)
     8080,  # femb601u40
     8328,  # femb607u32
     8480,  # femb620v01
     9282,  # femb620x03
     9283,  # femb620x04
     9736,  # femb611x25
     9854,  # femb602x02
    10033,  # femb106x15  low RMS, no response to pulser in 10493 (nov 2019)
    10800,  # femb105u40
    11001,  # femb110u39  v. low RMS in run 10419, 10527; no sig in 10527; responds to pulser (nov 2019)
    11011,  # femb110x39  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11014,  # femb110u26  v. low RMS in run 10419, 10527; no sig in 10527; responds to pulser (nov 2019)
    11013,  # femb110x37  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11015,  # femb110x35  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11017,  # femb110x33  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11018,  # femb110u32  v. low RMS in run 10404, 10527; no sig in 10527; responds to pulser (nov 2019)
    11019,  # femb110x31  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11024,  # femb110u16
    11457,  # femb110v18
    11459,  # femb110v20
    11460,  # femb110v21  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11462,  # femb110v23  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11463,  # femb110v24  (looks good in 10527 event 1 tick 1000)
    11464,  # femb110v25  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11466,  # femb110v27  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11467,  # femb110v28  v. low RMS in 10417; no signal in 10527 (nov 2019)
    11468,  # femb110v29  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11469,  # femb110v30: bad in 4875-185-1500, ok in 5803-76-3200; bad in 10527
    11501,  # femb109v22  v. low RMS in 10417; no signal in 10527 (nov 2019)
    11517,  # femb109v38
    12765,  # femb110x35  bad in run 10417 (nov 2019)
    11669,  # femb105v30
    12756,  # femb110x44
    12756,  # femb110x44
    12767,  # femb110x33  bad in run 10417 (nov 2019)
    12769,  # femb110x31  bad in run 10417 (nov 2019)
    12771,  # femb110x29  bad in run 10417 (nov 2019)
    12773,  # femb110x27  bad in run 10417 (nov 2019)
    12775,  # femb110x25  bad in run 10417 (nov 2019)
    12801,  # femb411u39
    13001,  # femb416u39
    13081,  # femb418u39
    # CE group: ENC > 2000e
     4410,  # femb515x11: High noise, no signal 5008-76
    #-----
    # CE group excessive sticky
    #femb318x
     1719,  # femb318x24
     5125,  # femb211u35
     7551,  # femb208x33
     7190,  # femb211x39
     7194,  # femb211x43
     7918,  # femb616u02, sticky pedestal (three peaks)
    #-----
    # CE group: good.
    # femb311
        2,  # femb311u38, no signal
        4,  # femb311u36, very sticky pedestal 5308-76
     1632,  # femb320x33, very sticky pedestal 5308-76
     2169,  # femb302x07, Mostly stuck on one bad code, 5308-76
     2450,  # femb308x14, Very noisy (1000 ADC) in run 5759 (nov 2019)
     3541,  # femb516v22, very sticky--signal near zero half the time (5308-81)
     3543,  # femb516v24, very sticky--signal near zero half the time (5308-81)
     3661,  # femb513v22, most signal near zero (5308-81)
     3663,  # femb513v24, most signal near zero (5308-81)
     4061,  # femb503v22, most signal near zero (5308-81)
     4063,  # femb503v24, most signal near zero (5308-81)
     4141,  # femb501v22, signal near zero half the time (5308-81)
     4143,  # femb501v24, signal sometimes near zero (5308-81)
     4377,  # femb516x26, very sticky pedestal
     4379,  # femb516x28, very sticky pedestal
     4381,  # femb516x30, very sticky pedestal
     4383,  # femb516x32, very sticky pedestal
     4385,  # femb516x34, very sticky pedestal
     4387,  # femb516x36, very sticky pedestal
     4521,  # femb513x26, very sticky pedestal
     4523,  # femb513x28, very sticky pedestal
     4525,  # femb513x30, very sticky pedestal
     4527,  # femb513x32, very sticky pedestal
     4529,  # femb513x34, very sticky pedestal
     4531,  # femb513x36, very sticky pedestal
     4652,  # femb501x36, very sticky pedestal
     4654,  # femb501x34, very sticky pedestal
     4656,  # femb501x32, very sticky pedestal
     4658,  # femb501x30, very sticky pedestal
     4660,  # femb501x28, very sticky pedestal
     4658,  # femb501x26, very sticky pedestal
     4748,  # femb503x36, very sticky pedestal
     4750,  # femb503x34, very sticky pedestal
     4752,  # femb503x32, very sticky pedestal
     4754,  # femb503x30, very sticky pedestal
     4756,  # femb503x28, very sticky pedestal
     4758,  # femb503x26, very sticky pedestal
     5361,  # femb217u39, no signal
     7680,  # femb611u40: No signal in 5308-76, end wire
     8501,  # femb620v22, very sticky pedestal
     8503,  # femb620v24, very sticky pedestal
     8821,  # femb612v22, very sticky pedestal
     8823,  # femb612v24, very sticky pedestal
     9261,  # femb601v22, very sticky pedestal
     9263,  # femb601v24, very sticky pedestal
     9305,  # femb620x26, very sticky pedestal
     9307,  # femb620x28, very sticky pedestal
     9309,  # femb620x30, very sticky pedestal
     9311,  # femb620x32, very sticky pedestal
     9313,  # femb620x34, very sticky pedestal
     9315,  # femb620x36, very sticky pedestal
     9689,  # femb612x26, very sticky pedestal
     9691,  # femb612x28, very sticky pedestal
     9693,  # femb612x30, very sticky pedestal
     9695,  # femb612x32, very sticky pedestal
     9697,  # femb612x34, very sticky pedestal
     9699,  # femb612x36, very sticky pedestal
     9772,  # femb601x26, very sticky pedestal
     9774,  # femb601x28, very sticky pedestal
     9776,  # femb601x30, very sticky pedestal
     9778,  # femb601x32, very sticky pedestal
     9780,  # femb601x34, very sticky pedestal
     9782,  # femb601x36, very sticky pedestal
    10102,  # femb608x42, mostly stuck on one code
    10189,  # femb609x03, mostly stuck on one code
    10697,  # femb102u23, mostly stuck on a few classic codes
    10907,  # femb107u13, mostly stuck on one code
    11203,  # femb116v04, stuck on many classic codes
    11270,  # femb115v31, stuck on many classic codes
    11902,  # femb119x15, stuck on two classic codes
    12324,  # femb101x44, stuck on many classic codes
    12333,  # femb101x35, stuck on many classic codes
    12744,  # femb109x08, stuck on many classic codes
    13363,  # femb405u37, very noisy, nosignal 5308-76-4800

    #-----
    # These 16 channels are an intermitently bad ASIC.
    # Matt W. 19oct2018.
    # femb316u
      200,   # femb316u40
      202,   # femb316u38
      204,   # femb316u36
      206,   # femb316u34
      208,   # femb316u32
    # femb316v
      991,   # femb316v32
      993,   # femb316v34
      995,   # femb316v36
      997,   # femb316v38
      999,   # femb316v40
    # femb316x
     1829,   # femb316x38
     1831,   # femb316x40
     1833,   # femb316x42
     1835,   # femb316x44
     1837,   # femb316x46
     1839    # femb316x48
    #-----
  ]

  # list of bad noisy channels:
  NoisyChannels: [
    # CE group: ENC > 2000e
     9569,
    # CE group: sticky.
     2318,
    # DLA sticky
    # femb311u
        4,
    # femb313u
       94,
    # femb319u
      325,  # femb319u35, 2020-02-27: Mostly stuck on one bad code 5141, 5795, 8764, ...
    # femb302u
      442,
      447,
      453,
      455,
      456,
      472,
      477,
    # femb304u
      571,
      573,
    # femb302v
     1534,
     1539,
     1546,
    # femb315x
     1864,
     #1864,  # acceptable??
    # femb302x
     2135,
     2146,
     2158,
     2161,
    # femb513u
     2674,  # 2-value pedestal
   # femb518u
     2833,  # Noisy adc pedestal
   # femb516x
     4377,  # Pedestal very sticky
   # femb503x
     4654,  # sticky pedestal
     4658,  # sticky pedestal
     4662,  # sticky pedestal
   # femb503x
     4752,  # sticky pedestal
   # femb214u
     5271,  # sticky pedestal
   # femb217u
     5377,  # sticky pedestal
   # femb218u
     5400,  # sticky pedestal
     5423,  # sticky pedestal
   # femb201x
     7220, # Pedestal stuck on 980
   # femb203x
     7334, # Pedestal stuck on 980,981
   # femb204x
     7347, # Pedestal stuck on 979
   # femb207x
     7396, # Sticky pedestal
   # femb607x
     8341, # Sticky pedestal
   # femb112x
   #  12252,  # nov 2019 pulser area is very noisy
   # femb102x
   #  12382   # nov 2019 pulser area is very noisy
     4473,  # femb514x26  Nonlinear response in nov 2019 calibration
     9641   # femb613x26  Nonlinear response in nov 2019 calibration
  ]

}

# Add channels with bad calibration pulser.
# Channel 4413 had bad fit in feb2019 calib but looks ok in nov.
pdsp_channel_status_nov2019_goodpulser: @local::pdsp_channel_status_nov2019
pdsp_channel_status_nov2019_goodpulser.BadChannels: [
  @sequence::pdsp_channel_status_nov2019_goodpulser.BadChannels,
  4232, 4234, 4236, 4238, 4240, 4242,   # femb519x (apa5z, feb2018 values in fix01)
  4472, 4474, 4476, 4478, 4480, 4482,   # femb514x (apa5z, feb2018 values in fix01)
  9545, 9547, 9549, 9551, 9553, 9555,   # femb615x (apa5z, feb2018 values in fxi01)
  4473,                                 # femb514x
  9260,                                 # femb601v (feb2018 values in fix01)
  9641                                  # femb613x
]

END_PROLOG

BEGIN_PROLOG

pdsp_channel_status: @local::pdsp_channel_status_2018
#pdsp_channel_status: @local::pdsp_channel_status_nov2019

END_PROLOG
# pedestals_dune.fcl
#
# David Adams
# March 2016
#
# File now holds the full service configuration instead of only the provider.

BEGIN_PROLOG

dune_dbpeds: {
}

dune_fixedpeds: {
  service_provider: FixedDetPedestalService
  FixedDetPedestal: {
    PedMeanU: 1800.0
    PedMeanV: 1800.0
    PedMeanZ:  500.0
    PedRmsU:     2.5
    PedRmsV:     2.5
    PedRmsZ:     2.5
    PedMeanErrU: 0.1
    PedMeanErrV: 0.1
    PedMeanErrZ: 0.1
    PedRmsErrU:  0.1
    PedRmsErrV:  0.1
    PedRmsErrZ:  0.1
  }
}

dunedp_fixedpeds: {
  service_provider: DPhaseFixedDetPedestalService
  FixedDetPedestal: {
    PedMeanX: 10.0
    PedMeanY: 10.0
    PedMeanZ: 10.0
    PedRmsX:     1.0
    PedRmsY:     1.0
    PedRmsZ:     1.0
    PedMeanErrX: 0.1
    PedMeanErrY: 0.1
    PedMeanErrZ: 0.1
    PedRmsErrX:  0.1
    PedRmsErrY:  0.1
    PedRmsErrZ:  0.1
  }
}

END_PROLOG
# dunetpc/dune/Daq/daq_dune.fcl
#
# David Adams
# February 2016

BEGIN_PROLOG

#***********************************************************************

# 35-ton online/offline channel mapping.

chmap35t: {
  service_provider: FileChannelMappingService
  FileName:         "rce_channel_map_dune35t.txt"
  FilePathEnv:      FW_SEARCH_PATH
  LogLevel:         1
}

#***********************************************************************

END_PROLOG
# detsimmodules_dune.fcl
#
#
# David Adams
# April 2016
#
# This FCL prolog file holds a minimal default configuration for the
# DetSim module and configuration options for the services used by that
# module.
#
# See dunetpc/fcl/dune35t/detsim/standard_detsim_dune35t for top-level
# FCL that uses this configuration.

BEGIN_PROLOG

standard_simwire:
{
  module_type:        "SimWire"
  DriftEModuleLabel:  "largeant"
  NoiseFact:           0.0132      # Noise Scale
  NoiseWidth:         62.4         # Exponential Noise width (kHz)
  LowCutoff:           7.5         # Low frequency filter cutoff (kHz)
  FieldBins:          75
  Col3DCorrection:    2.5
  Ind3DCorrection:    1.5
  ColFieldRespAmp:    0.0354
  IndFieldRespAmp:    0.018
  ShapeTimeConst:     [ 3000., 900. ]
  CompressionType:    "none"
}


standard_simwireana:
{ 
 module_type:       "SimWireAna"
 DetSimModuleLabel: "daq"
}
# extra comment to test check-in

microboone_simwire:  
{ 
 module_type:        "SimWireMicroBooNE"
 DriftEModuleLabel:  "largeant"
 NoiseFact:          0.0132       #Noise Scale
 #NoiseFact:          0.15       #Noise Scale to use with histogram
 NoiseWidth:         62.4         #Exponential Noise width (kHz)
 LowCutoff:          7.5          #Low frequency filter cutoff (kHz)
 CompressionType:    "none"       #could also be none
 GetNoiseFromHisto:   false  
 NoiseFileFname:      "uboone_noise_v0.1.root"
 NoiseHistoName:      "NoiseFreq"    

}
microboone_simwireana: @local::standard_simwireana

standard_wienerfilterana: 
{
 module_type:        "WienerFilterAna"
 DetSimModuleLabel:  "daq"
}

bo_wienerfilterana:         @local::standard_wienerfilterana
argoneut_wienerfilterana:   @local::standard_wienerfilterana
microboone_wienerfilterana: @local::standard_wienerfilterana



END_PROLOG

BEGIN_PROLOG

#***********************************************************************

# DetSim module

dune_detsim: {
  module_type:       "SimWireDUNE"
  SimChannelLabel:   "largeant"
  NoiseOn:           false
  PedestalOn:        false
  DistortOn:         false
  SuppressOn:        false
  KeepEmptyChannels: false
  AdcSimulator:      "adcsim_ideal"
}

#***********************************************************************

# SimChannelExtractService converts GEANT output to TPC signals.

# Simple single-phase extractor.
scxgeneric: {
  service_provider: GenericSimChannelExtractService
}

# Signal extractor service for dune dual-phase detector
scxdp: {
  service_provider: DPhaseSimChannelExtractService
}

# Single-phase extractor with special handling of signal near and beyond
# TPC active boundaries.
scx35t: {
  service_provider: Dune35tSimChannelExtractService
  FractHorizGapUCollect: [ 0.1, 0.0 ]
  FractHorizGapUMiss: [ 0.8, 0.0 ]
  FractHorizGapVCollect: [ 0.1, 0.0 ]
  FractHorizGapVMiss: [ 0.8, 0.0 ]
  FractHorizGapZMiss: [ 0.8, 0.0 ]
  FractUUCollect: [ 0.5, 0.0 ]
  FractUUMiss: [ 0.2, 0.0 ]
  FractUVCollect: [ 0.1, 0.0 ]
  FractUVMiss: [ 0.2, 0.0 ]
  FractVUCollect: [ 0.5, 0.0 ]
  FractVUMiss: [ 0.2, 0.0 ]
  FractVVCollect: [ 0.1, 0.0 ]
  FractVVMiss: [ 0.2, 0.0 ]
  FractVertGapUCollect: [ 0.1, 0.0 ]
  FractVertGapUMiss: [ 0.8, 0.0 ]
  FractVertGapVCollect: [ 0.1, 0.0 ]
  FractVertGapVMiss: [ 0.8, 0.0 ]
  FractVertGapZMiss: [ 0.8, 0.0 ]
  FractZUMiss: [ 0.2, 0.0 ]
  FractZVMiss: [ 0.2, 0.0 ]
}

#***********************************************************************

# ChannelNoiseService adds noise to channel-tick bins.

# Option 1 from the old DetSim module.
chnoiseold: {
  service_provider: ExponentialChannelNoiseService
  NoiseNormU: 3.16
  NoiseNormV: 3.16
  NoiseNormZ: 3.16
  NoiseWidthU: 2000
  NoiseWidthV: 2000
  NoiseWidthZ: 2000
  LowCutoffU: 7.5
  LowCutoffV: 7.5
  LowCutoffZ: 7.5
  WhiteNoiseU: 0.0
  WhiteNoiseV: 0.0
  WhiteNoiseZ: 0.0
  NoiseArrayPoints: 1000
  OldNoiseIndex: true
}

# Option 2 from the old DetSim module.
chnoisewhite: {
  service_provider: WhiteChannelNoiseService
}

# Tune from October 2016.
# See D. Adams talk at the 26oct 35t sim/reco meeting.
# Option 1 from the old DetSim module.
chnoise35t: {
  service_provider: ExponentialChannelNoiseService
  NoiseNormU:   30.0
  NoiseNormV:   30.0
  NoiseNormZ:   15.0
  NoiseWidthU: 150.0
  NoiseWidthV: 150.0
  NoiseWidthZ: 150.0
  LowCutoffU:    0.0
  LowCutoffV:    0.0
  LowCutoffZ:    0.0
  WhiteNoiseU:   1.6
  WhiteNoiseV:   1.6
  WhiteNoiseZ:   1.6
  NoiseArrayPoints: 1000
  OldNoiseIndex: false
}

# Tune from August 2018. Based on protoDUNE run 3775.
# Requires dunetpc v07_05_00 or later.
# See https://cdcvs.fnal.gov/redmine/issues/20621.
pdsp_chnoiseAug2018: {
  service_provider: ExponentialChannelNoiseService
  NoiseNormU:   25
  NoiseNormV:   25
  NoiseNormZ:   20
  LowCutoffU: -180
  LowCutoffV: -180
  LowCutoffZ: -180
  WhiteNoiseU:  0.8
  WhiteNoiseV:  0.8
  WhiteNoiseZ:  0.8
  NoiseWidthU: 150.0
  NoiseWidthV: 150.0
  NoiseWidthZ: 150.0
  NoiseArrayPoints: 1000
  OldNoiseIndex: false
}

#Configure realistic noise service for DP detectors based on the 311 data
#A.Scarpelli andrea.scarpelli@cern.ch November 2017
#NB: Hardcoded unrotated geometry:

dprealisticnoise:{
  service_provider: DPhaseRealisticNoiseService
  NoiseModel:       "$MRB_SOURCE/dunetpc/dune/DetSim/NoiseModels/729-0_fft_mirror.root"
  RandomizeX:       15.0     #amplitude randomization sigma
  RandomizeY:       15.0     #amplitude randomization sigma
  Smooth:           1000      #smoothing factor when mirroring
  SetFirst0:        false    #set first bin of the fft model to 0
  SetBaseline:      false    #if true, baseline added to real noise model
  NoiseArrayPoints: 1000     #number of pre-generated waveforms
  OldNoiseIndex:    false    #From ExponentialChannelNoiseService. Keep false
}

dpcoherentnoise:{
  service_provider: DPhaseCoherentNoiseService
  NoiseModel:       "$MRB_SOURCE/dunetpc/dune/DetSim/NoiseModels/729-0-model-fft.root"
  AmplitudeCut:     50                       #select frequencies above this threshold
  Normalization:    1                        #amplitude normalizations
  Randomize:        [ 1, 1 ]                 #rms amplitude ( different for every channel and frequency )
  PhaseShift:       [ -1, 1 ]                #phase shift per group of channels in radiants
  ChannelGroup:     [ 0, 320, 1280 ]         #list here the first channel of every significant correlation pattern
  InchoerentNoise:  [ 0.7, 1.1, 0.7, 1.1 ]   #rms and sigma of a small incohrent noise ( or very high frequency )
  NumberOfPhases:   1000                     #number of random phases array to produce
  LogLevel:         0                        #Verbosity level
}

chnoiseprotodune: {
  service_provider: ProtoDUNEChannelNoiseService
  LowCutoffU:    0.0
  LowCutoffV:    0.0
  LowCutoffZ:    0.0
  WhiteNoiseU:   0.0
  WhiteNoiseV:   0.0
  WhiteNoiseZ:   0.0
  NoiseArrayPoints: 1000
  OldNoiseIndex: false
  WireLengthZ:    598.39
  WireLengthU:    740.06
  WireLengthV:    737.36
  EffectiveNBits: 10.6
}

#***********************************************************************


# PedestalAdditionService adds pedestals to signals.

# Takes pedestal mean and RMS and from the DetPedestalService provider.
# Incoherent noise is added with Gaussian sigma = NoiseScale*RMS.
padprovided: {
  service_provider: ProvidedPedestalAdditionService
  NoiseScale: 0.0
}

#***********************************************************************

# AdcDistortService adds distortions to the digitized signals.

# Add 35-ton stuck bits.
stuckbits: {
  service_provider: StuckBitAdcDistortionService
  StuckBitsOverflowProbHistoName: "pCorrFracOverflowVsInputLsbCell"
  StuckBitsProbabilitiesFname: "ADCStuckCodeProbabilities35t/output_produceDcScanSummaryPlots_20150827_coldTest_0p1to1p4_step0p0010.root"
  StuckBitsUnderflowProbHistoName: "pCorrFracUnderflowVsInputLsbCell"
}

#***********************************************************************

# AdcSuppressService indicates which channel-tick bins should be
# ignored (i.e. zero-suppressed).

# No suppression.
zsnone: {
  service_provider: FixedZeroSuppressService
}

# Simple window supression. Same as the old module.
zslegacy: {
  service_provider: Legacy35tZeroSuppressService
  AdcThreshold: 10.0
  TickRange: 10
  MinTickGap: 2
  SuppressStickyBits: false
}

# Algorithm developed for use with the 35-ton detector with original
# (low) thresholds.
zsonline: {
  service_provider: Dune35tZeroSuppressService
  NS:  5
  NL: 15
  ND:  5
  NT:  3
  TS:  3
  TL:  7
  TD:  5
}

# Algorithm developed for use with the 35-ton detector with high
# thresholds.
zsonline_nhi: {
  service_provider: Dune35tZeroSuppressService
  NS:  5
  NL: 15
  ND:  5
  NT:  3
  TS:  6
  TL: 10
  TD: 10
}

#***********************************************************************

# AdcCompressService applies supression and converts digititzed signals
# to the final raw data format.

# Replaces suppressed bins with value Zero.
# Use this to effectively skip compression.
cmpreplace: {
  service_provider: ReplaceCompressService
  Zero: 0
}

# Larsoft block formatting. This removes the suppressed bins.
cmpblock: {
  service_provider: "LarsoftHuffmanCompressService"
  UseBlock:         "true"
  UseHuffman:       "false"
}

# Larsoft block formatting with Larsoft Huffman compression.
cmphuffman: {
  service_provider: "LarsoftHuffmanCompressService"
  UseBlock:         "true"
  UseHuffman:       "true"
}

#***********************************************************************
# Below are configurations for the old (and soon to be obsolete) DetSim
# modules. These can be removed when the old modules
# SimWireDUNE35t_module.cc and SimWireDUNE10kt_module.cc are dropped.
#***********************************************************************

dunefd_simwire:
{
 module_type:        "SimWireDUNE10kt"
 DriftEModuleLabel:  "largeant"
 NoiseFactU:          0.0349     # Noise Scale for U plane. Reset by DLA 26apr16.
 NoiseWidthU:         2000         #Exponential Noise width (kHz) for U plane
 LowCutoffU:          7.5          #Low frequency filter cutoff (kHz) for U plane
 NoiseFactV:          0.0349     #Noise Scale for V plane, should produce RMS of 2.5 ADC counts. Reset by DLA 26apr16.
 NoiseWidthV:         2000         #Exponential Noise width (kHz) for V plane, should produce RMS of 2.5 ADC counts
 LowCutoffV:          7.5          #Low frequency filter cutoff (kHz) for V plane
 NoiseFactZ:          0.0349     #Noise Scale for Z plane, should produce RMS of 2.5 ADC counts. Reset by DLA 26apr16.
 NoiseWidthZ:         2000         #Exponential Noise width (kHz) for Z plane
 LowCutoffZ:          7.5          #Low frequency filter cutoff (kHz) for Z plane
 CompressionType:    "ZeroSuppression"       #could also be none
 #CompressionType:    ""       #could also be none
 ZeroThreshold:       10        #Threshold for zero suppression
 NearestNeighbor:     10        #Maximum distance between hits above threshold before they are separated into different blocks
 NeighboringChannels: 0        #Number of neighboring channels on either side allowed to influence zero suppression
 NoiseArrayPoints:    1000     #number of points in noise array
 NoiseOn:             1        #1 for noise on, 0 for noise off
 NoiseModel:          1        #1 for original model, 2 for a model similar to uBooNE

 CollectionPed:       400         #ADC baseline for coll plane
 CollectionPedRMS:    0        #ADC baseline RMS for coll plane
 InductionPed:        2048        #ADC baseline for ind plane
 InductionPedRMS:     0        #ADC baseline RMS for ind plane

 CollectionCalibPed:     400      #Assumed measured value for coll plane pedestal
 CollectionCalibPedRMS:  0        #Assumed measured value for coll plane pedestal RMS
 InductionCalibPed:      2048     #Assumed measured value for ind plane pedestal
 InductionCalibPedRMS:   0        #Assumed measured value for ind plane pedestal RMS

 PedestalOn:          true     #add pedestal value to ADC vector

 SimCombs:           false
 SaveEmptyChannel:   false      #if channel's ADC vector is entirely full of zeros, save it in RawDigit collection (true) or discard (false)
 SimStuckBits:       false        #simulate stuck bits

 StuckBitsProbabilitiesFname:     "ADCStuckCodeProbabilities35t/output_produceDcScanSummaryPlots_20150827_coldTest_0p1to1p4_step0p0010.root"
 StuckBitsOverflowProbHistoName:     "pCorrFracOverflowVsInputLsbCell"
 StuckBitsUnderflowProbHistoName:     "pCorrFracUnderflowVsInputLsbCell"

# random initial guesses for charge inefficiency and wrong-type collection on the induction-plane wires
# the second number is for the gap with the deflector

 FractUUCollect:        [ 0.5, 0 ]        # fraction of charge that collects on U (non-transparency) when charge drifts over the comb holding U wires
 FractUVCollect:        [ 0.1, 0 ]        # fraction of charge that collects on U (non-transparency) when charge drifts over the comb holding V wires
 FractVUCollect:        [ 0.5, 0 ]        # fraction of charge that collects on V (non-transparency) when charge drifts over the comb holding U wires
 FractVVCollect:        [ 0.1, 0 ]        # fraction of charge that collects on V (non-transparency) when charge drifts over the comb holding V wires
 FractUUMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on U when charge drifts over the comb holding U
 FractUVMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on U when charge drifts over the comb holding V
 FractVUMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on V when charge drifts over the comb holding U
 FractVVMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on V when charge drifts over the comb holding V
 FractZUMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on Z (collection) when charge drifts over the comb holding U
 FractZVMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on Z (collection) when charge drifts over the comb holding V
 FractHorizGapUMiss:    [ 0.8, 0 ]        # fraction of charge in the horizontal gap that is missing on U
 FractVertGapUMiss:     [ 0.8, 0 ]        # fraction of charge in the horizontal gaps that is missing on U
 FractHorizGapVMiss:    [ 0.8, 0 ]        # fraction of charge in the horizontal gap that is missing on V
 FractVertGapVMiss:     [ 0.8, 0 ]        # fraction of charge in the horizontal gaps that is missing on V
 FractHorizGapZMiss:    [ 0.8, 0 ]        # fraction of charge in the horizontal gap that is missing on Z
 FractVertGapZMiss:     [ 0.8, 0 ]        # fraction of charge in the horizontal gaps that is missing on Z
 FractHorizGapUCollect: [ 0.1, 0 ]        # fraction of charge in the horizontal gap that collects on U
 FractHorizGapVCollect: [ 0.1, 0 ]        # fraction of charge in the horizontal gap that collects on V
 FractVertGapUCollect:  [ 0.1, 0 ]        # fraction of charge in the vertical gap that collects on U
 FractVertGapVCollect:  [ 0.1, 0 ]        # fraction of charge in the vertical gap that collects on V
}

dunefd_simwireana:            @local::standard_simwireana
dunefd_wienerfilterana:       @local::standard_wienerfilterana


# For now treat the other dune geometries like FD

dune35t_simwire:		@local::dunefd_simwire
dune35t_simwire.PedestalOn:     true        #add pedestal value to ADC vector
dune35t_simwire.CollectionPed:  500         #ADC baseline for coll plane
dune35t_simwire.CollectionPedRMS:    0.0    #ADC baseline RMS for coll plane
dune35t_simwire.InductionPed:   1800        #ADC baseline for ind plane
dune35t_simwire.InductionPedRMS:    0.0    #ADC baseline RMS for ind plane
dune35t_simwire.CollectionCalibPed:  500         #Assumed measured value for coll plane pedestal
dune35t_simwire.CollectionCalibPedRMS:  0.0     #Assumed measured value for coll plane pedestal RMS
dune35t_simwire.InductionCalibPed:   1800        #Assumed measured value for ind plane pedestal
dune35t_simwire.InductionCalibPedRMS:   0.0        #Assumed measured value for ind plane pedestal RMS
#dune35t_simwire.CompressionType:    "none"      #no data compression for noise test

dune35t_simwire.ZeroThreshold:  5
dune35t_simwire.NoiseModel:     1
dune35t_simwire.NoiseWidthU:  2000  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.NoiseWidthV:  2000  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.NoiseWidthZ:  2000  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.NoiseFactU:   0.05  # Should produce RMS of 2.5 ADC counts
dune35t_simwire.NoiseFactV:   0.05  # Should produce RMS of 2.5 ADC counts
dune35t_simwire.NoiseFactZ:   0.05  # Should produce RMS of 2.5 ADC counts
#dune35t_simwire.NoiseFactU:   0.1  # Should produce RMS of 5 ADC counts
#dune35t_simwire.NoiseFactV:   0.1  # Should produce RMS of 5 ADC counts
#dune35t_simwire.NoiseFactZ:   0.1  # Should produce RMS of 5 ADC counts
dune35t_simwire.LowCutoffU:    7.5  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.LowCutoffV:    7.5  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.LowCutoffZ:    7.5  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.SimStuckBits:    false   # Simulate stuck bits
dune35t_simwireana:             @local::dunefd_simwireana
dune35t_wienerfilterana:        @local::dunefd_wienerfilterana
dune35t_simwire.module_type:    "SimWireDUNE35t"

dune35t_simcounter:
{
    module_type:           "SimCounter35t"
    LArGeantModuleLabel:   "largeant"
    MakeTree:              false
    BSUTriggerThreshold:   0.5 # MeV
    TSUTriggerThreshold:   0.25 # MeV
    TriggerEfficiency:     1.0
# below changed on Feb. 1 2016 to match data . .
#    ClockSpeedCounter:     31.25 # MHz
    ClockSpeedCounter:     64.0 # MHz
    CombinedTimeDelay:     160 # ns. cable length delay + various electronics delays
}

END_PROLOG
BEGIN_PROLOG

standard_spacecharge:
{
  EnableSimSpatialSCE:       false
  EnableSimEfieldSCE:        false
  EnableCalSpatialSCE:       false
  EnableCalEfieldSCE:        false
  EnableCorrSCE:			 false
  RepresentationType:       "Parametric"
  InputFilename:            "SCEoffsets.root"
  CalibrationInputFilename: "SCEoffsets.root"
  service_provider:          SpaceChargeServiceStandard
}

bo_spacecharge:         @local::standard_spacecharge
jp250L_spacecharge:     @local::standard_spacecharge
argoneut_spacecharge:   @local::standard_spacecharge
microboone_spacecharge: @local::standard_spacecharge
dune35t_spacecharge:    @local::standard_spacecharge
dunefd_spacecharge:     @local::standard_spacecharge

END_PROLOG

BEGIN_PROLOG

dunefd_spacecharge:   @local::standard_spacecharge

dunefddphase_spacecharge:   @local::standard_spacecharge

protodune_spacecharge:   				@local::standard_spacecharge
protodune_spacecharge.InputFilename:  			"SpaceChargeProtoDUNE/SCE_DataDriven_180kV_v4.root"
protodune_spacecharge.CalibrationInputFilename:	        "SpaceChargeProtoDUNE/SCE_DataDriven_180kV_v4.root"
protodune_spacecharge.RepresentationType:               "Splines_TH3"
protodune_spacecharge.service_provider:  		SpaceChargeServiceProtoDUNE

protodunedp_spacecharge:                                                  @local::standard_spacecharge
protodunedp_spacecharge.InputFilename:                    "666_short_50kV.root"
protodunedp_spacecharge.RepresentationType:       "Voxelized_TH3"
protodunedp_spacecharge.service_provider:                 SpaceChargeServiceProtoDUNEdp


dune35t_spacecharge:   @local::standard_spacecharge
dune35t_spacecharge.InputFilename:  "SpaceCharge35t/SCEoffsets_DUNE35t_E500.root"
dune35t_spacecharge.service_provider:  SpaceChargeServiceDUNE35t

dphase3x1x1_spacecharge:   @local::standard_spacecharge
dphase3x1x1_spacecharge.InputFilename:  "SpaceCharge35t/SCEOffsets_311_Fieldcage_E500.root"
dphase3x1x1_spacecharge.service_provider:  SpaceChargeService3x1x1dphase

END_PROLOG
# dataprep_dune.fcl
#
# David Adams
# August 2016
#
# This holds all the prolog for dataprep.

BEGIN_PROLOG

#***********************************************************************

# AdcChannelDataCopyService copies AdcChannelData.

adccopy: {
  service_provider: ConfigurableAdcChannelDataCopyService
  LogLevel:           1
  CopyChannel:     true
  CopyPedestal:    true
  CopyRaw:        false
  CopySamples:     true
  CopyFlags:      false
  CopyRois:       false
  CopyDigit:       true
  CopyWire:       false
  CopyDigitIndex:  true
  CopyWireIndex:  false
}

#***********************************************************************

# RawDigitExtractService pulls ADC signals (raw:RawDigit) out of the lar
# container, converts to float, flags bad channels and subtracts pedestals.

rdx_std: {
  service_provider: StandardRawDigitExtractService
  LogLevel: 1
  DigitReadTool: digitReader
  PedestalOption: 1
  FlagStuckOff: false
  FlagStuckOn: false
}

rdx_35tdata: {
  service_provider: StandardRawDigitExtractService
  LogLevel: 1
  DigitReadTool: digitReader
  PedestalOption: 1
  FlagStuckOff: true
  FlagStuckOn: true
}

#***********************************************************************

# AdcMitigationService is used to mitigate ADC signals, e.g.
# interpolate between good values to deal with stuck bits.

adcmit_dune35t: {
  service_provider: InterpolatingAdcMitigationService
  LogLevel: 1
  SkipUnderflows:      true
  SkipOverflows:       true
  MaxConsecutiveSamples:  5
  MaxConsecutiveFlag:     0
}

#***********************************************************************

# AdcSuppressService is used by AdcSuppressSignalFindingService (below).

adcsuppress_legacy35t: {
  service_provider: Legacy35tZeroSuppressService
  AdcThreshold: 30.0
  TickRange: 4
  MinTickGap: 2
  SuppressStickyBits: false
}

#***********************************************************************

# AdcSuppressSignalFindingService is used to remove noise from ADC signals.

# This implementation uses AdcSuppressService.
adcsigfind_suppress: {
  service_provider: AdcSuppressSignalFindingService
}

#***********************************************************************

# AdcNoiseRemovalService is used to remove noise from ADC signals.

adcnr_dune35tlegacy: {
}

adcnr_dunedphase3x1x1: {
  service_provider: DuneDPhase3x1x1NoiseRemovalService
  CorrMode:                         "median" # mean or median
  DoTwoPassFilter:                      false
  BinsToSkip: 				2
  Coherent32:                           true
  Coherent32Groups:                       [] # do all groups if empty list
  Coherent16:                           true
  Coherent16Groups:   [6, 7, 16, 17, 18, 19] # do all groups if empty list
  UseBasicROIForCNR:			 true
  RoiStartThreshold:                       7
  RoiEndThreshold:                         6
  RoiPadLow:                               8
  RoiPadHigh:                             40
  Flatten:                              true
  FlattenExtrapolate:			false
  LowPassFlt:                           false
  LowPassFltSecondPass:                 false
  LowPassFltFCut:                       0.5
  LowPassFltExpo:                       8
}

#***********************************************************************

# PedestalEvaluationService is used to evaluate pedestals from the
# ADC signals.

adcped_median: {
  service_provider: MedianPedestalService
  LogLevel:              1
  UseMean:            false
  SkipFlaggedSamples: true
  SkipSignals:        true
}

adcped_mean: {
  service_provider: MedianPedestalService
  LogLevel:              1
  UseMean:            true
  SkipFlaggedSamples: true
  SkipSignals:        true
}

#***********************************************************************

# AdcDeconvolutionService is used to deconvolute the ADC signals.

adcdco_dune35t: {
  service_provider: DuneDeconvolutionService
  LogLevel:              1
}

adcdco_dunefd: @local::adcdco_dune35t

adcdco_dunefddphase: {
  service_provider: DuneDPhaseDeconvolutionService
  LogLevel:              1
}

#***********************************************************************

# AdcRoiBuildingService is used to define ROIs for the ADC signals.

adcroi_dune35t: {
  service_provider: DuneRoiBuildingService
  NSigmaStart:        3.0
  NSigmaEnd:          1.0
  PadLow:              50
  PadHigh:             50
  LogLevel:             1
}

adcroi_dunefd: @local::adcroi_dune35t

adcroi_dunefddphase: {
  service_provider: DuneDPhaseRoiBuildingService
  UseFilter:                 false
  FltCoeffs:     [0.1, 0.75, 0.95]
  NSigmaStart:                 3.0
  NSigmaEnd:                   1.0
  PadLow:                       50
  PadHigh:                      50
  LogLevel:                      1
}

adcroi_keepall: {
  service_provider: KeepAllRoiBuildingService
  LogLevel:              1
}

#***********************************************************************

# AdcWireBuildingService constructs lar outputs (recob::Wire) from ADC
# signals.

adcwire_std: {
  service_provider: StandardAdcWireBuildingService
  LogLevel:              1
}

#***********************************************************************

# RawDigitPrepService is the high level service that uses the above
# services to prepare ADC signals including the conversion of
# raw::RawDigit to recob::Wire.

# Read raw data and subtract pedestals without any other preparation.
adcprep_readraw: {
  service_provider: StandardRawDigitPrepService
  LogLevel: 1
  SkipBad:               false
  SkipNoisy:             false
  DoMitigation:          false
  DoEarlySignalFinding:  false
  DoNoiseRemoval:        false
  DoPedestalAdjustment:  false
  DoDeconvolution:       false
  DoROI:                 false
  DoWires:               false
  DoIntermediateStates:  false
  DisplayTools:             []
}

# Process simulation using service-based dataprep.
adcprep_with_services_sim: {
  service_provider: StandardRawDigitPrepService
  LogLevel: 1
  SkipBad:                true
  SkipNoisy:             false
  DoMitigation:          false
  DoEarlySignalFinding:  false
  DoNoiseRemoval:        false
  DoPedestalAdjustment:  false
  DoDeconvolution:        true
  DoROI:                  true
  DoWires:                true
  DoIntermediateStates:  false
  DisplayTools:             []
}

# Process simulation using tool-based dataprep.
adcprep_with_tools_sim: {
  service_provider: ToolBasedRawDigitPrepService
  LogLevel: 3
  DoWires: true
  AdcChannelToolNames: [
    "digitReader",
    "adcSampleFiller",
    "adcVintageDeconvoluter",
    "adcThresholdSignalFinder"
  ]
  CallgrindToolNames: []
}

# Process data using tool-based dataprep.
adcprep_with_tools_data: {
  service_provider: ToolBasedRawDigitPrepService
  LogLevel: 3
  DoWires: true
  AdcChannelToolNames: [
    "digitReader",
    "adcSampleFiller",
    "adcVintageDeconvoluter",
    "adcThresholdSignalFinder"
  ]
  CallgrindToolNames: []
}

# Process DP 3x1x1 data.
adcprep_dunedphase3x1x1: {
  service_provider: StandardRawDigitPrepService
  LogLevel: 1
  SkipBad:               false
  SkipNoisy:              true
  DoMitigation:          false
  DoEarlySignalFinding:  false
  DoNoiseRemoval:         true
  DoPedestalAdjustment:  false
  DoDeconvolution:        true
  DoROI:                  true
  DoWires:                true
  DoIntermediateStates:  false
  DisplayTools:             []
}

# Process 35-ton data
adcprep_dune35tdata: {
  service_provider: StandardRawDigitPrepService
  LogLevel: 1
  SkipBad:                true
  SkipNoisy:             false
  DoMitigation:           true
  DoEarlySignalFinding:   true
  DoNoiseRemoval:         true
  DoPedestalAdjustment:  false
  DoDeconvolution:        true
  DoROI:                  true
  DoWires:                true
  DoIntermediateStates:  false
  DisplayTools:             []
}

#***********************************************************************

# Channel groups.

# Process by APA keeping all ROPs.
changroup_apa_keepall: {
  service_provider: GeoApaChannelGroupService
  LogLevel: 1
  ApaRops: []
}

# Process by APA dropping the protoDUNE cryostat-side collection plane.
changroup_apa_pd_drop_outer: {
  service_provider: GeoApaChannelGroupService
  LogLevel: 1
  ApaRops: [11, 7]
}

# Process by APA keeping only the protoDUNE TPC-side collection plane.
changroup_apa_pd_tpccoll: {
  service_provider: GeoApaChannelGroupService
  LogLevel: 1
  ApaRops: [ 8, 4]
}

changroup_rop: {
  service_provider: GeoRopChannelGroupService
}

#***********************************************************************

# DataPrepModule is the producer that calls RawDigitPrepService

# This configuration does not make use of the decoding tool.
# Input is raw::RawDigit vector DigitLabel in the event data store.
# Use with MC. Can be used with data if the decoder module is called first.
producer_adcprep_notool: {
  module_type:   "DataPrepModule"
  LogLevel:                     1
  DecoderTool:                 ""       # Non-blank reads digits with named tool.
  DigitLabel:               "daq"       # Label for input digits if decoder tool is not used
  TimeStampName:               ""       # Non-blank writes RDTimeStamps if decoder tool is used
  OutputDigitName:             ""       # Non-blank writes digits if decoder tool is used
  WireName:                    ""
  DoAssns:                   true
  DoGroups:                  true
  ChannelRanges:               []
  BeamEventLabel:              ""
  IntermediateStates:          []
  OnlineChannelMapTool:  pd_onlineChannelMapByFemb
}

# This configuration uses the decoding tool and the old module.
# All APAs are decoded in one call to the tool.
# Obsolete. Use the byAPA module instead.
producer_adcprep_tool_old: {
  module_type: "DataPrepModule"
  LogLevel:                   1
  DecoderTool:   "pdsp_decoder"      # Non-blank reads digits with named tool.
  DigitLabel:                ""       # Label for input digits if decoder tool is not used
  TimeStampName:     "dataprep"       # Non-blank writes RDTimeStamps if decoder tool is used
  OutputDigitName:           ""       # Non-blank writes digits if decoder tool is used
  WireName:                  ""
  DoAssns:                 true
  DoGroups:                true
  ChannelRanges:             []
  BeamEventLabel:            ""
  IntermediateStates:        []
  OnlineChannelMapTool:  pd_onlineChannelMapByFemb
}

# This configuration uses the decoding tool and the new byAPA module.
# All APAs are decoded in one call to the tool if ChannelGroups = ["all"]
# Use ChannelGroups = ["apas"] to process one APA at a time.
producer_adcprep_byapa: {
  module_type: "DataPrepByApaModule"
  LogLevel:                     1
  DecoderTool:     "pdsp_decoder"       # Tool that reads digits.
  OutputTimeStampName: "dataprep"       # Non-blank writes digit RDTimeStamps
  OutputDigitName:             ""       # Non-blank writes digits
  OutputWireName:      "dataprep"       # Non-blank writes wires (processed digits)
  ChannelGroups:         ["apas"]
  BeamEventLabel:              ""
  KeepChannels:                []       # Channels to keep (all if empty).
  SkipChannels:                []       # Channels to skip.
  SkipEmptyChannels:         true       # If true, empty channels are not processed and do not produce wires
  DeltaTickCount:           0.005       # If true, empty channels are not processed and do not produce wires
  ApaChannelCounts:        [2560]       # # of channels in each APA. Last value used for later values.
  OnlineChannelMapTool: pd_onlineChannelMapByFemb
}

producer_adcprep: @local::producer_adcprep_notool

#***********************************************************************

END_PROLOG
# protodune_dataprep_services.fcl
#
# David Adams
# February 2010
#
# Dataprep service configurations.
#
# Dataprep is now mostly tool-based but one important service remains:
# ToolBasedRawDigitPrepService with interface RawDigitPrepService.
# It is called by each of the dataprep modules to run an ADC channel tool
# sequence to process the TPC data.
#
# Some standard sequences are defined here.
#
###################################################################################
# Dataprep tool sequences for protoDUNE SP data.
###################################################################################

BEGIN_PROLOG

# No calibration, no noise removal.
protodune_dataprep_tools_nocal_tail: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleFiller",            # Subtract pedestal, trivial calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate",        # Mitigate FEMB302 timing
  "adcCorrectUndershootAdc"     # correct undershoot
]

# Charge calibration; no mitigation or tail or noise removal.
protodune_dataprep_tools_calib_only: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection"         # Correct gain calibration
]

# Charge calibration and mitigation, no tail or noise removal.
protodune_dataprep_tools_calib_mit: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection",        # Correct gain calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate"         # Mitigate FEMB302 timing
]

# Charge calibration, mitigation, obsolete tail removal, no noise removal.
protodune_dataprep_tools_calib_oldtail: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection",        # Correct gain calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate",        # Mitigate FEMB302 timing
  "adcCorrectUndershootKe"      # correct undershoot
]

# Charge calibration, mitigation, tail removal, no noise removal.
protodune_dataprep_tools_calib_tail: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection",        # Correct gain calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate",        # Mitigate FEMB302 timing
  "pdspTailPedRemovalZKe"       # Tail removal
]

# Charge calibration, noise removal.
protodune_dataprep_tools_calib_noiserem: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection",        # Correct gain calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate",        # Mitigate FEMB302 timing
  "pdspTailPedRemovalZKe",      # Tail removal
  "pdsp_noiseRemovalKe"         # Remove high frequency noise and coherent noise
]

# Drop ROIs, scale back to ADC and zero bad/noisy channels for wirecell processing.
protodune_dataprep_tools_wirecell: [
  @sequence::protodune_dataprep_tools_calib_noiserem,
  "adcKeepAllSignalFinder",     # Keep all signal (no ROIs)
  "adcScaleKeToAdc",            # Scale samples to nominal ADC counts
  "pdsp_RemoveBadChannels"      # Set bad channels to 0 ADC
]

###################################################################################
# Dataprep tool sequences for protoDUNE SP simulation.
###################################################################################

pdsim_dataprep_tools_vintage: [
    "digitReader",              # Read RawDigit
    "adcSampleFiller",          # Subtract pedestal, trivial calibration
    "adcVintageDeconvoluter",   # Deconvolution
    "adcThresholdSignalFinder", # ROI
    "pdsp_RemoveBadChannels"    # Set bad channels to 0 ADC
]

# ProtoDUNE sim dataprep leaving samples at ADC scale. Passthru for wirecell.
pdsim_dataprep_tools_adc: [
  "digitReader"                 # Read RawDigit
]

# ProtoDUNE sim dataprep converted to ke scale.
pdsim_dataprep_tools_calib: [
  "digitReader",                # Read RawDigit
  "adcSampleFiller",            # Subtract pedestal, trivial calibration
  "adcScaleAdcToKe"             # Scale samples to nominal ADC counts
]

# ProtoDUNE sim dataprep at ke scale with tail removal.
pdsim_dataprep_tools_oldtail: [
  @sequence::pdsim_dataprep_tools_calib,
  "adcCorrectUndershootKe"      # correct undershoot with old tool
]

# ProtoDUNE sim dataprep at ke scale with tail removal.
pdsim_dataprep_tools_tail: [
  @sequence::pdsim_dataprep_tools_calib,
  "pdspTailPedRemovalZKe"       # correct tails
]

# Drop ROIs, scale back to ADC and zero bad/noisy channels for wirecell processing.
pdsim_dataprep_tools_wirecell: [
  @sequence::pdsim_dataprep_tools_tail,
  "adcKeepAllSignalFinder",     # Keep all signal (no ROIs)
  "adcScaleKeToAdc",            # Scale samples to nominal ADC counts
  "pdsp_RemoveBadChannels"      # Set bad channels to 0 ADC
]

# Specify here the default sequence used in reconstruction of MC data.
#protodune_dataprep_tools_sim: @local::pdsim_dataprep_tools_vintage
#protodune_dataprep_tools_sim: @local::pdsim_dataprep_tools_calib
protodune_dataprep_tools_sim: @local::pdsim_dataprep_tools_tail

###################################################################################
#
END_PROLOG

# PdspChannelMapService.fcl
#
# Temporary copy until dune_raw_data is released with this prolog.

BEGIN_PROLOG

# ProtoDUNE-SP online/offline channel mapping.

pdspchannelmap: {
  FileName:         "protoDUNETPCChannelMap_RCE_v4.txt"
  FELIXFileName:    "protoDUNETPCChannelMap_FELIX_v4.txt"
  SSPFileName:      "protoDUNESSPChannelMap_v1.txt"
  LogLevel:         1
}

END_PROLOG

BEGIN_PROLOG

# Iceberg online/offline channel mapping.
# SSP map left over from PDSP for now
# include a FELIX map in case someone uses FELIX for Iceberg

icebergchannelmap: {
  FileName:         "IcebergChannelMap_RCE_v1.txt"
  FELIXFileName:    "IcebergChannelMap_FELIX_v1.txt"
  SSPFileName:      "protoDUNESSPChannelMap_v1.txt"
  LogLevel:         1
}

END_PROLOG
BEGIN_PROLOG

protodune_xyzcalib :
{
  service_provider: "XYZCalibServiceProtoDUNE"

  UseCondbXYZCorr: true
  Interpolate: false

  XCorrFileName: ""
  YZCorrFileName: ""
  NormCorrFileName: ""

  XCorrDBTag: ""
  YZCorrDBTag: ""
  NormCorrDBTag: ""

}

END_PROLOG
BEGIN_PROLOG

protodune_lifetimecalib :
{
  service_provider: "LifetimeCalibServiceProtoDUNE"

  IsMC: false
  UseCondbLifetime: false
  Interpolate: true
  LifetimeFileName: ""
  LifetimeDBTag: ""

}

END_PROLOG
BEGIN_PROLOG

#
# Applies channel-by-channel PE calibrations
#
protodunesp_photoncalibrator:
{
   service_provider: PhotonCalibratorServiceProtoDUNESP
   BadChannels:      [25, 36, 49, 51, 58, 62, 65, 72, 73, 75, 82, 101, 110, 119, 156, 160  ]
}


END_PROLOG
BEGIN_PROLOG

dune_time_tracker: { 
  printSummary : true
  dbOutput     : {
    filename   :  "time.db"
    overwrite  :  true
  }
}

dune_memory_tracker: {
  includeMallocInfo : true
  dbOutput     : {
    filename   :  "mem.db"
    overwrite  :  true
  }
}

END_PROLOG
BEGIN_PROLOG

dunefddphase_crpgain: {
   service_provider: CrpGainService
   LogLevel:       1
   CrpDefaultGain: 6
   CrpNumLem:      36
   LemViewChans:   160
   LemEffTool:     ""
}

# protodune dp LEM efficiency map for CFR-35 design
protodunedphase_crpgain:            @local::dunefddphase_crpgain
protodunedphase_crpgain.LemEffTool: "lemEfficiency"

# simple CRP gain service configuration always returns one number
single_crpgain: @local::dunefddphase_crpgain
single_crpgain.CrpNumLem: 1
single_crpgain.LemEffTool: ""


END_PROLOG

BEGIN_PROLOG

# The above *_dune.fcl include contain the parameter blocks
# for all dune geometries. All PROLOG files for dune should
# contain all of the parameters for each dune geometry so
# that they are in one place and there is only one type of
# file to include. This file is an example of that



############################
### Dune FD Single Phase ###
############################

dunefd_services: {
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 Geometry:                       @local::dune10kt_geo
 GeometryConfigurationWriter: {}
 DetectorClocksService:          @local::dunefd_detectorclocks
 DetectorPropertiesService:      @local::dunefd_detproperties
 LArPropertiesService:           @local::dunefd_properties
 LArFFT:                         @local::dunefd_larfft
 DatabaseUtil:                   @local::dunefd_database
 BackTrackerService:                    @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 PhotonBackTrackerService:              @local::dunefd_photonbacktrackerservice
 SpaceCharge:                    @local::dunefd_spacecharge
 NuRandomService:                @local::dune_seedservice
 SignalShapingServiceDUNE:       @local::dunefd_signalshapingservice
 ChannelStatusService:           @local::dunefd_channel_status
 ChannelGroupService:            @local::changroup_apa_keepall
}

dunefd_simulation_services: {
 LArFFT:                       @local::dunefd_larfft
 LArG4Parameters:              @local::dunefd_largeantparameters
 ExptGeoHelperInterface:       @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 Geometry:                     @local::dune10kt_geo
 DetectorClocksService:        @local::dunefd_detectorclocks
 DetectorPropertiesService:    @local::dunefd_detproperties
 LArPropertiesService:         @local::dunefd_properties
 DatabaseUtil:                 @local::dunefd_database
 LArVoxelCalculator:           @local::dunefd_larvoxelcalculator
 MagneticField:                @local::no_mag_larsoft
 BackTrackerService:                  @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 PhotonBackTrackerService:            @local::dunefd_photonbacktrackerservice
 SpaceCharge:                  @local::dunefd_spacecharge
 NuRandomService:              @local::dune_seedservice
 SignalShapingServiceDUNE:     @local::dunefd_signalshapingservice
 OpDetResponseInterface:       @local::dunefd_opdetresponse
 ChannelStatusService:         @local::dunefd_channel_status
}

# Reco services for 35-ton simulation.
dunefd_reco_services:                            @local::dunefd_services
dunefd_reco_services.RawDigitExtractService:     @local::rdx_std
dunefd_reco_services.RawDigitPrepService:        @local::adcprep_with_services_sim
dunefd_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefd
dunefd_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefd
dunefd_reco_services.AdcWireBuildingService:     @local::adcwire_std

# Settings for optical simulation in the FD. Optical simulation not on by default
# for FD, turned on by custom physics list and defining a photon visibility
# services is workspace g4 fhicl file.

dunefd_simulation_services.LArPropertiesService.ScintYield: 24000
dunefd_simulation_services.LArPropertiesService.ScintPreScale: 0.05
dunefd_simulation_services.LArPropertiesService.EnableCerenkovLight: false





####################################
### DUNE far detector dual phase ###
####################################

dunefddphase_services: {
 DatabaseUtil:                   @local::dunefd_database
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 ChannelStatusService:           @local::dunefd_channel_status
 LArFFT:                         @local::dunefd_larfft
 NuRandomService:                @local::dune_seedservice
 Geometry:                       @local::dunedphase10kt_geo
 DetectorClocksService:          @local::dunefddphase_detectorclocks
 DetectorPropertiesService:      @local::dunefddphase_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::dunefddphase_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::dunefddphase_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
}

dunefddphase_simulation_services: {
 BackTrackerService:                    @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 LArFFT:                         @local::dunefd_larfft
 LArG4Parameters:                @local::dunefd_largeantparameters
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 LArVoxelCalculator:             @local::dunefd_larvoxelcalculator
 MagneticField:                  @local::no_mag_larsoft
 NuRandomService:                @local::dune_seedservice
 DatabaseUtil:                   @local::dunefd_database
 OpDetResponseInterface:         @local::standard_opdetresponse
 PhotonBackTrackerService:       @local::standard_photonbacktrackerservice
 ChannelStatusService:           @local::dunefd_channel_status
 Geometry:                       @local::dunedphase10kt_geo
 DetectorClocksService:          @local::dunefddphase_detectorclocks
 DetectorPropertiesService:      @local::dunefddphase_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::dunefddphase_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::dunefddphase_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
 DetPedestalService:		 @local::dunedp_fixedpeds
}

dunefddphase_reco_services:                            @local::dunefddphase_services
dunefddphase_reco_services.BackTrackerService:                @local::dunefd_backtrackerservice
dunefddphase_reco_services.ParticleInventoryService:      @local::standard_particleinventoryservice
dunefddphase_reco_services.RawDigitExtractService:     @local::rdx_std
dunefddphase_reco_services.RawDigitPrepService:        @local::adcprep_with_services_sim
dunefddphase_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefddphase
dunefddphase_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefddphase
dunefddphase_reco_services.AdcWireBuildingService:     @local::adcwire_std
dunefddphase_reco_services.PedestalEvaluationService:  @local::adcped_median
dunefddphase_reco_services.AdcNoiseRemovalService:     @local::adcnr_dunedphase3x1x1

# Settings for optical simulation in the FD. Optical simulation not on by default
# for FD, turned on by custom physics list and defining a photon visibility
# services is workspace g4 fhicl file.

dunefddphase_simulation_services.LArPropertiesService.ScintYield: 24000
dunefddphase_simulation_services.LArPropertiesService.ScintPreScale: 1
dunefddphase_simulation_services.LArPropertiesService.EnableCerenkovLight: false
dunefddphase_simulation_services.OpDetResponseInterface.QuantumEfficiency: 0.12 # including TPB from arxiv 1807.07123



########################
### 3x1x1 dual phase ###
########################
dunedphase3x1x1_services: {
 DatabaseUtil:                   @local::dunefd_database
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 ChannelStatusService:           @local::dunedphase3x1x1_channel_status
 LArFFT:                         @local::dunefd_larfft
 NuRandomService:                @local::dune_seedservice
 Geometry:                       @local::dphase3x1x1_geo
 DetectorClocksService:          @local::dunedphase3x1x1_detectorclocks
 DetectorPropertiesService:      @local::dphase3x1x1_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::dunedphase3x1x1_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::single_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
}

dunedphase3x1x1_simulation_services: {
 BackTrackerService:                    @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 LArFFT:                         @local::dunefd_larfft
 LArG4Parameters:                @local::protodune_largeantparameters
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 LArVoxelCalculator:             @local::dunefd_larvoxelcalculator
 MagneticField:                  @local::no_mag_larsoft
 NuRandomService:                @local::dune_seedservice
 DatabaseUtil:                   @local::dunefd_database
 OpDetResponseInterface:         @local::standard_opdetresponse
 PhotonBackTrackerService:       @local::standard_photonbacktrackerservice
 ChannelStatusService:           @local::dunedphase3x1x1_channel_status
 Geometry:                       @local::dphase3x1x1_geo
 DetectorClocksService:          @local::dunedphase3x1x1_detectorclocks
 DetectorPropertiesService:      @local::dphase3x1x1_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::dunedphase3x1x1_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::single_crpgain
 SpaceCharge:                    @local::dphase3x1x1_spacecharge
 PhotonVisibilityService: 	 @local::dunedphase3x1x1_photonvisibilityservice
 PhotonVisibilityServiceS2: 	 @local::dunedphase3x1x1_photonvisibilityserviceS2
 DetPedestalService:		 @local::dunedp_fixedpeds
 OpDigiProperties: 		 @local::dunedphase3x1x1_opdigiproperties
}

dunedphase3x1x1_reco_services:                            @local::dunedphase3x1x1_services
dunedphase3x1x1_reco_services.BackTrackerService:                @local::dunefd_backtrackerservice
dunedphase3x1x1_reco_services.ParticleInventoryService:      @local::standard_particleinventoryservice
dunedphase3x1x1_reco_services.RawDigitExtractService:     @local::rdx_std
dunedphase3x1x1_reco_services.RawDigitPrepService:        @local::adcprep_dunedphase3x1x1
dunedphase3x1x1_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefddphase
dunedphase3x1x1_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefddphase
dunedphase3x1x1_reco_services.AdcWireBuildingService:     @local::adcwire_std
dunedphase3x1x1_reco_services.PedestalEvaluationService:  @local::adcped_median
dunedphase3x1x1_reco_services.AdcNoiseRemovalService:     @local::adcnr_dunedphase3x1x1

# Settings for optical simulation in the FD. Optical simulation not on by default
# for FD, turned on by custom physics list and defining a photon visibility
# services is workspace g4 fhicl file.

dunedphase3x1x1_simulation_services.LArG4Parameters.UseCustomPhysics: true
dunedphase3x1x1_simulation_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                           "FastOptical",
                                           "SynchrotronAndGN",
                                           "Ion",
                                           "Hadron",
                                           "Decay",
                                           "HadronElastic",
                                           "Stopping",
                                           "NeutronTrackingCut" ]
dunedphase3x1x1_simulation_services.LArPropertiesService.ScintYield: 		24000
dunedphase3x1x1_simulation_services.LArPropertiesService.EnableCerenkovLight: 	false
dunedphase3x1x1_simulation_services.LArPropertiesService.ScintPreScale: 	1
dunedphase3x1x1_simulation_services.OpDetResponseInterface.QuantumEfficiency: 	1.0

############################
### protoDUNE dual phase ###
############################

protodunedphase_services: {
 DatabaseUtil:                   @local::dunefd_database
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 ChannelStatusService:           @local::dunefd_channel_status
 LArFFT:                         @local::dunefd_larfft
 NuRandomService:                @local::dune_seedservice
 Geometry: 			 @local::protodunedphase_geo
 DetectorClocksService:          @local::protodunedphase_detectorclocks
 DetectorPropertiesService: 	 @local::protodunedphase_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::protodunedphase_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::dunefddphase_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
 CrpGainService:                 @local::dunefddphase_crpgain
}


protodunedphase_simulation_services: {
 BackTrackerService:                    @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 LArFFT:                         @local::dunefd_larfft
 LArG4Parameters:                @local::protodune_largeantparameters
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 LArVoxelCalculator:             @local::dunefd_larvoxelcalculator
 MagneticField:                  @local::no_mag_larsoft
 NuRandomService:                @local::dune_seedservice
 DatabaseUtil:                   @local::dunefd_database
 OpDetResponseInterface:         @local::standard_opdetresponse
 PhotonBackTrackerService:       @local::standard_photonbacktrackerservice
 ChannelStatusService:           @local::dunefd_channel_status
 Geometry: 			 @local::protodunedphase_geo
 DetectorClocksService:          @local::protodunedphase_detectorclocks
 DetectorPropertiesService: 	 @local::protodunedphase_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::protodunedphase_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::dunefddphase_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
 PhotonVisibilityService: 	 @local::protodunedp_photonvisibilityservice
 PhotonVisibilityServiceS2: 	 @local::protodunedp_photonvisibilityserviceS2
 DetPedestalService:		 @local::dunedp_fixedpeds
 CrpGainService:                 @local::dunefddphase_crpgain
 OpDigiProperties:               @local::protodunedphase_opdigiproperties
}

protodunedphase_reco_services:                         	  @local::protodunedphase_services
protodunedphase_reco_services.BackTrackerService:         @local::dunefd_backtrackerservice
protodunedphase_reco_services.ParticleInventoryService:   @local::standard_particleinventoryservice
protodunedphase_reco_services.RawDigitExtractService:     @local::rdx_std
protodunedphase_reco_services.RawDigitPrepService:        @local::adcprep_with_services_sim
protodunedphase_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefddphase
protodunedphase_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefddphase
protodunedphase_reco_services.AdcWireBuildingService:     @local::adcwire_std
protodunedphase_reco_services.PedestalEvaluationService:  @local::adcped_median
#protodunedphase_reco_services.AdcNoiseRemovalService:    @local::adcnr_dunedphase3x1x1

# Settings for optical simulation in the protodunedp. Optical simulation IS by default ON,
# turned on by custom physics list and defining a photon visibility
# services is workspace g4 fhicl file.

protodunedphase_simulation_services.LArG4Parameters.UseCustomPhysics: true
protodunedphase_simulation_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                           "FastOptical",
                                           "SynchrotronAndGN",
                                           "Ion",
                                           "Hadron",
                                           "Decay",
                                           "HadronElastic",
                                           "Stopping",
                                           "NeutronTrackingCut" ]

protodunedphase_simulation_services.OpDetResponseInterface.QuantumEfficiency: 1
protodunedphase_simulation_services.LArPropertiesService.ScintPreScale: 1
protodunedphase_simulation_services.LArPropertiesService.ScintYield: 24000
protodunedphase_simulation_services.LArPropertiesService.EnableCerenkovLight: false

protodunedphase_driftY_simulation_services: @local::protodunedphase_simulation_services
protodunedphase_driftY_simulation_services.PhotonVisibilityService: 	 @local::protodunedp_driftY_RL99CM_VUVREF_photonvisibilityservice
protodunedphase_driftY_simulation_services.Geometry: 			 @local::protodunedphase_driftY_geo


# dune10kt and dune34kt consolidated into dunefd,
# but catch any leftover cases of 10kt...
#dune10kt_services: @local::dunefd_services
#dune10kt_services.Geometry.GDML: "dune10kt.gdml"
#dune10kt_services.Geometry.ROOT: "dune10kt.gdml"
#dune10kt_simulation_services: @local::dunefd_services
#dune10kt_simulation_services.Geometry.GDML: "dune10kt.gdml"
#dune10kt_simulation_services.Geometry.ROOT: "dune10kt.gdml"





##############################
### ProtoDUNE Single Phase ###
##############################

protodune_services: {
 ExptGeoHelperInterface:       @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 Geometry:                     @local::protodune_geo
 DetectorClocksService:        @local::protodune_detectorclocks
 DetectorPropertiesService:    @local::protodune_detproperties
 LArPropertiesService:         @local::dunefd_properties
 LArFFT:                       @local::dunefd_larfft
 DatabaseUtil:                 @local::dunefd_database
 BackTrackerService:           @local::dunefd_backtrackerservice
 ParticleInventoryService:     @local::dunefd_particleinventoryservice
 PhotonBackTrackerService:     @local::dunefd_photonbacktrackerservice
 SpaceCharge:                  @local::protodune_spacecharge
 NuRandomService:              @local::dune_seedservice
 SignalShapingServiceDUNE:     @local::protodunesp_signalshapingservice
 ChannelStatusService:         @local::dunefd_channel_status
 ChannelGroupService:          @local::changroup_apa_keepall
}


protodune_rawdecoding_services: {
  ExptGeoHelperInterface:       @local::dune_geometry_helper
  GeometryConfigurationWriter: {}
  Geometry:                     @local::protodune_geo
  DetectorClocksService:        @local::protodune_detectorclocks
  DetectorPropertiesService:    @local::protodune_detproperties
  LArPropertiesService:         @local::dunefd_properties
  LArFFT:                       @local::dunefd_larfft  
  DatabaseUtil:                 @local::dunefd_database
  ChannelStatusService:         @local::dunefd_channel_status
#  ChannelGroupService:          @local::changroup_apa
  PdspChannelMapService:        @local::pdspchannelmap
}

iceberg_rawdecoding_services: {
  ExptGeoHelperInterface:       @local::dune_geometry_helper
  GeometryConfigurationWriter: {}
  Geometry:                     @local::iceberg_geo
  DetectorClocksService:        @local::protodune_detectorclocks
  DetectorPropertiesService:    @local::protodune_detproperties
  LArPropertiesService:         @local::dunefd_properties
  LArFFT:                       @local::dunefd_larfft  
  DatabaseUtil:                 @local::dunefd_database
  ChannelStatusService:         @local::dunefd_channel_status
  IcebergChannelMapService:     @local::icebergchannelmap
}

protodune_data_services: {
 ExptGeoHelperInterface:       @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 Geometry:                     @local::protodune_geo
 DetectorClocksService:        @local::protodune_detectorclocks
 DetectorPropertiesService:    @local::protodune_detproperties
 LArPropertiesService:         @local::dunefd_properties
 LArFFT:                       @local::dunefd_larfft
 DatabaseUtil:                 @local::dunefd_database
 SpaceCharge:                  @local::protodune_spacecharge
 NuRandomService:              @local::dune_seedservice
 SignalShapingServiceDUNE:     @local::protodunesp_signalshapingservice
 ChannelStatusService:         @local::pdsp_channel_status
 ChannelGroupService:          @local::changroup_apa_keepall
# Reco services for ProtoDUNE real data.
 RawDigitExtractService:       @local::rdx_std
 RawDigitPrepService:          @local::adcprep_with_services_sim
 AdcDeconvolutionService:      @local::adcdco_dunefd
 AdcRoiBuildingService:        @local::adcroi_dunefd
 AdcWireBuildingService:       @local::adcwire_std
}


protodune_simulation_services: {
 LArFFT:                       @local::dunefd_larfft
 LArG4Parameters:              @local::protodune_largeantparameters
 ExptGeoHelperInterface:       @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 Geometry:                     @local::protodune_geo
 DetectorClocksService:        @local::protodune_detectorclocks
 DetectorPropertiesService:    @local::protodune_detproperties
 LArPropertiesService:         @local::dunefd_properties
 DatabaseUtil:                 @local::dunefd_database
 LArVoxelCalculator:           @local::dunefd_larvoxelcalculator
 MagneticField:                @local::no_mag_larsoft
 SpaceCharge:                  @local::protodune_spacecharge
 NuRandomService:              @local::dune_seedservice
 SignalShapingServiceDUNE:     @local::protodunesp_signalshapingservice
 PhotonVisibilityService:      @local::protodune_photonvisibilityservice
 OpDetResponseInterface:       @local::protodune_opdetresponse
 ChannelStatusService:         @local::dunefd_channel_status
}

# Enable photon simulation for protoDUNE by default

protodune_simulation_services.LArPropertiesService.ScintYield: 24000
protodune_simulation_services.LArPropertiesService.ScintPreScale: 0.0287
protodune_simulation_services.LArPropertiesService.EnableCerenkovLight: false
protodune_simulation_services.LArG4Parameters.UseCustomPhysics: true
protodune_simulation_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                                                "FastOptical",
                                                                "SynchrotronAndGN",
                                                                "Ion",
                                                                "Hadron",
                                                                "Decay",
                                                                "HadronElastic",
                                                                "Stopping" ]


# Reco services for ProtoDUNE simulation.
protodune_reco_services:                            @local::protodune_services
protodune_reco_services.RawDigitExtractService:     @local::rdx_std
protodune_reco_services.RawDigitPrepService:        @local::adcprep_with_services_sim
protodune_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefd
protodune_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefd
protodune_reco_services.AdcWireBuildingService:     @local::adcwire_std
# Switch to tool-based dataprep for ProtoDUNE simulation.
protodune_reco_services.RawDigitPrepService:        @local::adcprep_with_tools_sim
protodune_reco_services.RawDigitPrepService.AdcChannelToolNames: @local::protodune_dataprep_tools_sim
# xyz calibration service
protodune_reco_services.XYZCalibService:            @local::protodune_xyzcalib
# lifetime calibration service
protodune_reco_services.LifetimeCalibService:       @local::protodune_lifetimecalib
# channel map service
protodune_reco_services.PdspChannelMapService:      @local::pdspchannelmap
# channel status service
protodune_reco_services.ChannelStatusService:       @local::pdsp_channel_status

# Reco services for ProtoDUNE data
protodune_data_reco_services:                       @local::protodune_reco_services
# Get rid of low frequency noise
protodune_data_reco_services.SignalShapingServiceDUNE.IndUFilter: "(x>0.01)*gaus"
protodune_data_reco_services.SignalShapingServiceDUNE.IndVFilter: "(x>0.01)*gaus"
# Use channel service for data
protodune_data_reco_services.ChannelStatusService: @local::pdsp_channel_status
# Add the photon detector calibrator service
protodune_data_reco_services.IPhotonCalibrator:    @local::protodunesp_photoncalibrator
# ProtoDUNE detector properties service
protodune_data_reco_services.DetectorPropertiesService: @local::protodunesp_detproperties
# Dataprep service.
protodune_data_reco_services.RawDigitPrepService.AdcChannelToolNames: @local::protodune_dataprep_tools_wirecell

##################################################
### Make Parallel Services for the v7 geometry ###
##################################################

protodunev7_services:  @local::protodune_services
protodunev7_services.Geometry: @local::protodunev7_geo

protodunev7_rawdecoding_services:  @local::protodune_rawdecoding_services
protodunev7_rawdecoding_services.Geometry: @local::protodunev7_geo

protodunev7_data_services:  @local::protodune_data_services
protodunev7_data_services.Geometry: @local::protodunev7_geo

protodunev7_reco_services:  @local::protodune_reco_services
protodunev7_reco_services.Geometry: @local::protodunev7_geo

protodunev7_data_reco_services:  @local::protodune_data_reco_services
protodunev7_data_reco_services.Geometry: @local::protodunev7_geo

protodunev7_simulation_services:  @local::protodune_simulation_services
protodunev7_simulation_services.Geometry: @local::protodunev7_geo
protodunev7_simulation_services.PhotonVisibilityService: @local::protodunev7_photonvisibilityservice





#######################
### 35ton Prototype ###
#######################

dune35t_basic_services: {
  ExptGeoHelperInterface:     @local::dune_geometry_helper
  GeometryConfigurationWriter: {}
  Geometry:                   @local::dune35t_geo
  DetectorClocksService:      @local::dune35t_detectorclocks
  DetectorPropertiesService:  @local::dune35t_detproperties
  LArPropertiesService:       @local::dune35t_properties
  DatabaseUtil:               @local::dune35t_database
  SpaceCharge:                @local::dune35t_spacecharge
  NuRandomService:             @local::dune_seedservice
  ChannelStatusService:       @local::dune35t_channel_status_dla
  ChannelGroupService:        @local::changroup_apa_keepall
}

# DLA Aug2016: Drop this in favor of dune35t_reco_services?
# For now, keep for use with the old reco.
dune35t_services:                            @local::dune35t_basic_services
dune35t_services.LArFFT:                     @local::dune35t_larfft
dune35t_services.BackTrackerService:                @local::dune35t_backtrackerservice
dune35t_services.ParticleInventoryService:      @local::dune35t_particleinventoryservice
dune35t_services.PhotonBackTrackerService:          @local::dune35t_photonbacktrackerservice
dune35t_services.SignalShapingServiceDUNE:   @local::dune35t_signalshapingservice

dune35t_gen_services:                        @local::dune35t_basic_services
dune35t_gen_services.MagneticField:          @local::no_mag_larsoft

dune35t_g4_services:                         @local::dune35t_gen_services
dune35t_g4_services.LArG4Parameters:         @local::dune35t_largeantparameters
dune35t_g4_services.LArVoxelCalculator:      @local::dune35t_larvoxelcalculator
dune35t_g4_services.PhotonVisibilityService: @local::dune35t_photonvisibilityservice
dune35t_g4_services.OpDetResponseInterface:  @local::dune35t_opdetresponse

##
# Settings to turn on and configure photon simulation
##

# Pre-scale the scintillation yield to save memory (correct when applying QE)
# MUST match between g4 and detsim steps
dune35t_g4_services.LArPropertiesService.ScintYield:    24000
dune35t_g4_services.LArPropertiesService.ScintPreScale: 0.0023

# disable cerenkov
dune35t_g4_services.LArPropertiesService.EnableCerenkovLight: false

# enable "FastOptical" in geant4
dune35t_g4_services.LArG4Parameters.UseCustomPhysics: true
dune35t_g4_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                                      "FastOptical",
                                                      "SynchrotronAndGN",
                                                      "Ion",
                                                      "Hadron",
                                                      "Decay",
                                                      "HadronElastic",
                                                      "Stopping",
                                                      "NeutronTrackingCut" ]

dune35t_detsim_services:                              @local::dune35t_basic_services
dune35t_detsim_services.LArFFT:                       @local::dune35t_larfft
dune35t_detsim_services.SignalShapingServiceDUNE:     @local::dune35t_signalshapingservice
dune35t_detsim_services.OpDetResponseInterface:       @local::dune35t_opdetresponse
dune35t_detsim_services.LArG4Parameters:              @local::dune35t_largeantparameters

# enable "FastOptical" in geant4
dune35t_detsim_services.LArG4Parameters.UseCustomPhysics: true
dune35t_detsim_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                                          "FastOptical",
                                                          "SynchrotronAndGN",
                                                          "Ion",
                                                          "Hadron",
                                                          "Decay",
                                                          "HadronElastic",
                                                          "Stopping",
                                                          "NeutronTrackingCut" ]

# Pre-scale the scintillation yield to save memory (correct when applying QE)
# MUST match between g4 and detsim steps
dune35t_detsim_services.LArPropertiesService.ScintPreScale:      0.0023

dune35t_simulation_services:                                      @local::dune35t_g4_services
dune35t_simulation_services.LArFFT:                               @local::dune35t_larfft
dune35t_simulation_services.SignalShapingServiceDUNE:             @local::dune35t_signalshapingservice
dune35t_simulation_services.PhotonVisibilityService:              @local::dune35t_photonvisibilityservice
dune35t_simulation_services.BackTrackerService:                          @local::dune35t_backtrackerservice
dune35t_simulation_services.ParticleInventoryService:      @local::dune35t_particleinventoryservice
dune35t_simulation_services.PhotonBackTrackerService:                    @local::dune35t_photonbacktrackerservice

# Reco services for 35-ton data.
dune35tdata_reco_services:                            @local::dune35t_basic_services
dune35tdata_reco_services.LArFFT:                     @local::dune35t_larfft
dune35tdata_reco_services.BackTrackerService:         @local::dune35t_backtrackerservice
dune35tdata_reco_services.ParticleInventoryService:   @local::dune35t_particleinventoryservice
dune35tdata_reco_services.SignalShapingServiceDUNE:   @local::dune35t_signalshapingservice
dune35tdata_reco_services.AdcChannelDataCopyService:  @local::adccopy
dune35tdata_reco_services.RawDigitExtractService:     @local::rdx_35tdata
dune35tdata_reco_services.AdcSuppressonService:       @local::adcmit_dune35t
dune35tdata_reco_services.AdcSuppressService:         @local::adcsuppress_legacy35t
dune35tdata_reco_services.AdcNSignalFindingService:   @local::adcsigfind_suppress
dune35tdata_reco_services.PedestalEvaluationService:  @local::adcped_median
dune35tdata_reco_services.AdcDeconvolutionService:    @local::adcdco_dune35t
dune35tdata_reco_services.AdcRoiBuildingService:      @local::adcroi_dune35t
dune35tdata_reco_services.AdcWireBuildingService:     @local::adcwire_std
dune35tdata_reco_services.RawDigitPrepService:        @local::adcprep_dune35tdata

# Reco services for 35-ton simulation.
dune35tsim_reco_services:                             @local::dune35tdata_reco_services
dune35tsim_reco_services.RawDigitExtractService:      @local::rdx_std
dune35tsim_reco_services.RawDigitPrepService:         @local::adcprep_with_services_sim

dune35t_milliblock_reco_services:                                 @local::dune35tsim_reco_services
dune35t_milliblock_reco_services.DetectorPropertiesService:       @local::dune35t_milliblock_detproperties

dune35t_milliblock_detsim_services:                               @local::dune35t_detsim_services
dune35t_milliblock_detsim_services.DetectorPropertiesService:     @local::dune35t_milliblock_detproperties

dune35t_milliblock_simulation_services:                           @local::dune35t_simulation_services
dune35t_milliblock_simulation_services.DetectorPropertiesService: @local::dune35t_milliblock_detproperties





########################
### Message Services ###
########################

dune_message_services: {
  debugModules: ["*"]
  destinations: {
    LogDebugFile: {
      type:       "file"
      filename:   "debug.log"
      append:     false
      threshold:  "DEBUG"
      categories:{
        default:{ limit: 0 }
      }
    }
    LogStandardOut: {
      type:       "cout"
      threshold:  "WARNING"
      categories:{
        default:{ }
        RecoBaseDefaultCtor: { limit: 0 }
        AnaBaseDefaultCtor:  { limit: 0 }
        GeometryBadInputPoint: { limit: 5 timespan: 1000}
      }
    }
    LogStandardError: {
      type:       "cerr"
      threshold:  "ERROR"
      categories:{
        default:{ }
      }
    }
  }
}

dune_message_services_prod_debug: {
  debugModules: ["*"]
  destinations: {
    LogDebugFile:      @local::dune_message_services.destinations.LogDebugFile
    LogStandardOut:    @local::dune_message_services.destinations.LogStandardOut
    LogStandardError:  @local::dune_message_services.destinations.LogStandardError
  }
}

dune_message_services_prod_debug.destinations.LogDebugFile.categories:{
  default: { }
  RecoBaseDefaultCtor: { limit: 0 }
  AnaBaseDefaultCtor:  { limit: 0 }
  Track3DKalmanSPS_GenFit: { limit: 0 }
  GeometryBadInputPoint: { limit: 5 timespan: 1000}
  SpacePointAlg: { limit: 0 }
  KalmanFilterAlg: { limit: 0 }
  Track3DKalmanHit: { limit: 0 }
  fuzzyCluster: { limit: 0}
  ChannelFilter: { limit: 0}
  HoughBaseAlg: { limit: 0}
  DBscan: {limit: 0}
  CosmicTracker: {limit: 0}
  HitCheater: {limit: 0}
  DisambigAlg35t: {limit: 0}
  ClusterCheater: {limit: 0}
  ClusterCrawlerAlg: {limit: 0}
  CaloPrtTrk: {limit: 0}
  CaloPrtHit: {limit: 0}
  BackTrackerService: {limit: 0}
  DisambigCheat: {limit: 0}
  Summary: {limit: 0}
  CosmicTracker: {limit: 0}
  ClusterMergeTQ: {limit: 0}
  LArPandora: {limit: 0}
}


dune_message_services_prod: {
  debugModules: ["*"]
  destinations: {
    LogDebugFile: {
      type:       "file"
      filename:   "debugprod.log"
      append:     false
      threshold:  "DEBUG"
      categories:{
        default:{ limit: 0 }
      }
    }
    LogStandardOut: {
      type:       "cout"
      threshold:  "INFO"
      categories:{
        ArtReport: {limit: -1}
        default:{limit: 0}
      }
    }
    LogStandardError: {
      type:       "cerr"
      threshold:  "ERROR"
      categories:{
        default:{}
      }
    }
  }
}

dune_message_services_interactive: {
  debugModules: ["*"]
  destinations: {
    LogDebugFile:      @local::dune_message_services.destinations.LogDebugFile
    LogStandardOut:    @local::dune_message_services.destinations.LogStandardOut
    LogStandardError:  @local::dune_message_services.destinations.LogStandardError
  }
}
dune_message_services_interactive.destinations.LogStandardOut.threshold:  "INFO"
dune_message_services_interactive.destinations.LogStandardOut.categories:{
  default: { limit: 0 }
}
dune_message_services_interactive.destinations.LogStandardError.threshold:  "WARNING"
dune_message_services_interactive.destinations.LogStandardError.categories: {
  default: { }
  RecoBaseDefaultCtor: { limit: 1 }
  AnaBaseDefaultCtor:  { limit: 1 }
  GeometryBadInputPoint: { limit: 5 timespan: 1000}
}

END_PROLOG
BEGIN_PROLOG

spacepointAlg:
{
  cilinderAxis:   50
  cilinderRadius: 5
  minNumberSpacePoints: 10
}

END_PROLOG
BEGIN_PROLOG

stoppingmuonAlg:
{
  # labels for data products
  TrackerTag:      "pandoraTrack"
  PFParticleTag:   "pandora"
  # cut values for cathode crossers
  length_cutoff_CC:               100
  offsetFiducialBounds_CC:        60
  thicknessStartVolume_CC:        40
  cutMinHitPeakTime_CC:           250
  cutMaxHitPeakTime_CC:           4900
  radiusBrokenTracksSearch_CC:    50
  cutCosAngleBrokenTracks_CC:     0.995
  cutCosAngleAlignment_CC:        0.995
  cutContourAPA_CC:               10

  length_cutoff_AC :              100
  offsetYStartPoint_AC:           30
  offsetZStartPoint_AC:           50
  cutMinHitPeakTime_AC:           700
  cutMaxHitPeakTime_AC:           4800
  radiusBrokenTracksSearch_AC:    10
  cutCosAngleBrokenTracks_AC:     0.995
  cutCosAngleAlignment_AC:        0.995
  cutContourAPA_AC:               10
  offsetFiducialBounds_AC:        50
}
END_PROLOG
BEGIN_PROLOG

caloHelper:
{
  TrackerTag: "pandoraTrack"
  CalorimetryTag: "pandoracalo"
  PFParticleTag: "pandora"
}

END_PROLOG
BEGIN_PROLOG

hitHelper:
{
  electronEnergyFractionToCallMichelHits:   0.7
  maxDistanceToCallMichelHits: 15
}

END_PROLOG
## protoDUNE reco on data prolog
## divide reco into two stages according to calibration: 
##   a) stage 1 with calibration sce, lifetime (protoDUNE_SP_keepup_decoder_reco_stage1.fcl) 
##   b) stage 2 with calibration yz,x,t (protoDUNE_SP_keepup_decoder_reco_stage2.fcl)


BEGIN_PROLOG


dunefd_geo:
{

 # Various configurations for FD-related geometries

 Name:     "dune10kt"   #note: this does not need to change with GDML file
			#unless it is important that DetId be 34kt.
			#  At this point, 34kt is no different than 10kt,
			#  and there are no other FD detector IDs. 9/7/13

 # Choose GDML file

 GDML:      "dune10kt_v1.gdml"
 ROOT:      "dune10kt_v1.gdml"
# GDML:      "dune10kt_v1_workspace.gdml"
# ROOT:      "dune10kt_v1_workspace.gdml"
# GDML:      "dune10kt_v1_45deg.gdml"
# ROOT:      "dune10kt_v1_45deg.gdml"
# GDML:      "dune10kt_v1_45deg_workspace.gdml"
# ROOT:      "dune10kt_v1_45deg_workspace.gdml"
# GDML:      "dune10kt_v1_3mmPitch.gdml"
# ROOT:      "dune10kt_v1_3mmPitch.gdml"
# GDML:      "dune10kt_v1_3mmPitch_workspace.gdml"
# ROOT:      "dune10kt_v1_3mmPitch_workspace.gdml"
# GDML:      "lbne10kt.gdml"
# ROOT:      "lbne10kt.gdml"
# GDML:      "lbne34kt.gdml"
# ROOT:      "lbne34kt.gdml"
# GDML:      "lbne4apa36deg.gdml"
# ROOT:      "lbne4apa36deg.gdml"   # *45deg.gdml or *36deg.gdml

 SortingParameters:	{ChannelsPerOpDet:	1}

 SurfaceY:         0.0e2               # in cm, vertical distance to the surface
 #SurfaceY: 147828                       # Underground option. 4850 feet to cm. from DocDb-3833


 DisableWiresInG4: true
}

dune10kt_geo:
{
 Name:      "dune10kt_v1"
 
 GDML:      "dune10kt_v1.gdml"
 ROOT:      "dune10kt_v1.gdml"

 SortingParameters:	{ChannelsPerOpDet:	1}

 SurfaceY: 147828                       # Underground option. 4850 feet to cm. from DocDb-3833

 DisableWiresInG4:   true

}

dunedphase10kt_geo:
{
 Name:      "dunedphase10kt_v2"
 
 GDML:      "dunedphase10kt_v2.gdml"
 ROOT:      "dunedphase10kt_v2.gdml"

 SortingParameters:	{ChannelsPerOpDet:	1}

 SurfaceY: 147828                       # Underground option. 4850 feet to cm. from DocDb-3833

 DisableWiresInG4:   true
}

dunedphase10kt_driftY_geo:
{
 Name:      "dunedphase10kt_v2_driftY"
 
 GDML:      "dunedphase10kt_v2_driftY.gdml"
 ROOT:      "dunedphase10kt_v2_driftY.gdml"

 SortingParameters:	{ChannelsPerOpDet:	1}

 SurfaceY: 147828                       # Underground option. 4850 feet to cm. from DocDb-3833

 DisableWiresInG4:   true
}

dunedphase10kt_driftY_HalfFoiled_geo: @local::dunedphase10kt_driftY_geo
dunedphase10kt_driftY_HalfFoiled_geo.Name: "dunedphase10kt_v2_driftY_HalfFoil"
dunedphase10kt_driftY_HalfFoiled_geo.GDML: "dunedphase10kt_v2_driftY_HalfFoil.gdml"
dunedphase10kt_driftY_HalfFoiled_geo.ROOT: "dunedphase10kt_v2_driftY_HalfFoil.gdml"

protodunedphase_geo:
{
 Name:      "protodunedphase"

 GDML:      "protodunedphase.gdml"
 ROOT:      "protodunedphase.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
} 

protodunedphase_driftY_geo:
{
 Name:      "protodunedphase_driftY"

 GDML:      "protodunedphase_driftY.gdml"
 ROOT:      "protodunedphase_driftY.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
} 

protodunedphase_driftY_uniform_geo:
{
 Name:      "protodunedphase_driftY_uniform"

 GDML:      "protodunedphase_driftY_uniform.gdml"
 ROOT:      "protodunedphase_driftY_uniform.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
} 

dphase3x1x1_geo:
{
 Name:      "3x1x1dphase"

 GDML:      "3x1x1dphase.gdml"
 ROOT:      "3x1x1dphase.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
}

dphase3x1x1_driftY_geo:
{
 Name:      "3x1x1dphase_driftY"

 GDML:      "3x1x1dphase_driftY.gdml"
 ROOT:      "3x1x1dphase_driftY.gdml"

 SortingParameters:    {ChannelsPerOpDet:    1}
 SurfaceY: 0.0                       # Underground option. 4850 feet to cm. from DocDb-3833
 DisableWiresInG4:   true
}

dune10kt_workspace_geo: @local::dune10kt_geo
dune10kt_workspace_geo.Name: "dune10kt_v1_workspace"
dune10kt_workspace_geo.GDML: "dune10kt_v1_workspace.gdml"
dune10kt_workspace_geo.ROOT: "dune10kt_v1_workspace.gdml"

dune10kt_1x2x6_v1_geo: @local::dune10kt_geo
dune10kt_1x2x6_v1_geo.Name: "dune10kt_v1_1x2x6"
dune10kt_1x2x6_v1_geo.GDML: "dune10kt_v1_1x2x6.gdml"
dune10kt_1x2x6_v1_geo.ROOT: "dune10kt_v1_1x2x6.gdml"

dune10kt_1x2x6_v3_geo: @local::dune10kt_geo
dune10kt_1x2x6_v3_geo.Name: "dune10kt_v3_1x2x6"
dune10kt_1x2x6_v3_geo.GDML: "dune10kt_v3_1x2x6.gdml"
dune10kt_1x2x6_v3_geo.ROOT: "dune10kt_v3_1x2x6.gdml"

dune10kt_1x2x6_v3_geo: @local::dune10kt_geo
dune10kt_1x2x6_v3_geo.Name: "dune10kt_v3_1x2x6"
dune10kt_1x2x6_v3_geo.GDML: "dune10kt_v3_1x2x6.gdml"
dune10kt_1x2x6_v3_geo.ROOT: "dune10kt_v3_1x2x6.gdml"

dune10kt_1x2x6_v4_geo: @local::dune10kt_geo
dune10kt_1x2x6_v4_geo.Name: "dune10kt_v4_1x2x6"
dune10kt_1x2x6_v4_geo.GDML: "dune10kt_v4_1x2x6.gdml"
dune10kt_1x2x6_v4_geo.ROOT: "dune10kt_v4_1x2x6.gdml"

dune10kt_1x2x6_geo: @local::dune10kt_1x2x6_v4_geo


dunedphase10kt_workspace_geo: @local::dunedphase10kt_geo
dunedphase10kt_workspace_geo.Name: "dunedphase10kt_v2_workspace"
dunedphase10kt_workspace_geo.GDML: "dunedphase10kt_v2_workspace.gdml"
dunedphase10kt_workspace_geo.ROOT: "dunedphase10kt_v2_workspace.gdml"

dunedphase10kt_workspace4x2_geo: @local::dunedphase10kt_geo
dunedphase10kt_workspace4x2_geo.Name: "dunedphase10kt_v2_workspace4x2"
dunedphase10kt_workspace4x2_geo.GDML: "dunedphase10kt_v2_workspace4x2.gdml"
dunedphase10kt_workspace4x2_geo.ROOT: "dunedphase10kt_v2_workspace4x2.gdml"




dunedphase10kt_driftY_workspace_geo: @local::dunedphase10kt_driftY_geo
dunedphase10kt_driftY_workspace_geo.Name: "dunedphase10kt_v2_driftY_workspace"
dunedphase10kt_driftY_workspace_geo.GDML: "dunedphase10kt_v2_driftY_workspace.gdml"
dunedphase10kt_driftY_workspace_geo.ROOT: "dunedphase10kt_v2_driftY_workspace.gdml"

dunedphase10kt_driftY_workspace4x2_geo: @local::dunedphase10kt_driftY_geo
dunedphase10kt_driftY_workspace4x2_geo.Name: "dunedphase10kt_v2_driftY_workspace4x2"
dunedphase10kt_driftY_workspace4x2_geo.GDML: "dunedphase10kt_v2_driftY_workspace4x2.gdml"
dunedphase10kt_driftY_workspace4x2_geo.ROOT: "dunedphase10kt_v2_driftY_workspace4x2.gdml"

dunedphase10kt_driftY_workspace3x3_geo: @local::dunedphase10kt_driftY_geo
dunedphase10kt_driftY_workspace3x3_geo.Name: "dunedphase10kt_v2_driftY_workspace3x3"
dunedphase10kt_driftY_workspace3x3_geo.GDML: "dunedphase10kt_v2_driftY_workspace3x3.gdml"
dunedphase10kt_driftY_workspace3x3_geo.ROOT: "dunedphase10kt_v2_driftY_workspace3x3.gdml"




dune10kt_45deg_workspace_geo: @local::dune10kt_geo
dune10kt_45deg_workspace_geo.Name: "dune10kt_v1_45deg_workspace"
dune10kt_45deg_workspace_geo.GDML: "dune10kt_v1_45deg_workspace.gdml"
dune10kt_45deg_workspace_geo.ROOT: "dune10kt_v1_45deg_workspace.gdml"

dune10kt_45deg_1x2x6_geo: @local::dune10kt_geo
dune10kt_45deg_1x2x6_geo.Name: "dune10kt_v1_45deg_1x2x6"
dune10kt_45deg_1x2x6_geo.GDML: "dune10kt_v1_45deg_1x2x6.gdml"
dune10kt_45deg_1x2x6_geo.ROOT: "dune10kt_v1_45deg_1x2x6.gdml"


dune10kt_3mmpitch_workspace_geo: @local::dune10kt_geo
dune10kt_3mmpitch_workspace_geo.Name: "dune10kt_v1_3mmpitch_workspace"
dune10kt_3mmpitch_workspace_geo.GDML: "dune10kt_v1_3mmpitch_workspace.gdml"
dune10kt_3mmpitch_workspace_geo.ROOT: "dune10kt_v1_3mmpitch_workspace.gdml"

dune10kt_3mmpitch_1x2x6_geo: @local::dune10kt_geo
dune10kt_3mmpitch_1x2x6_geo.Name: "dune10kt_v1_3mmpitch_1x2x6"
dune10kt_3mmpitch_1x2x6_geo.GDML: "dune10kt_v1_3mmpitch_1x2x6.gdml"
dune10kt_3mmpitch_1x2x6_geo.ROOT: "dune10kt_v1_3mmpitch_1x2x6.gdml"

#Updated CRT locations, shorter grid-anode distance, 1.5 cm outer volume
protodunev6_geo: @local::dune10kt_geo
protodunev6_geo.Name: "protodune" # will be made lower case anyway
protodunev6_geo.GDML: "protodune_v6.gdml"
protodunev6_geo.ROOT: "protodune_v6.gdml"

#ARAPUCA geometry
protodunev7_geo: @local::dune10kt_geo
protodunev7_geo.Name: "protodunev7" # will be made lower case anyway
protodunev7_geo.GDML: "protodune_v7.gdml"
protodunev7_geo.ROOT: "protodune_v7.gdml"

protodune_geo: @local::protodunev7_geo

iceberg_geo: @local::dune10kt_geo
iceberg_geo.Name: "iceberg" # will be made lower case anyway
iceberg_geo.GDML: "iceberg_v1.gdml"
iceberg_geo.ROOT: "iceberg_v1.gdml"

dune35t_geo:
{
 Name:     "dune35t4apa_v6"

 # Choose GDML file and set detector version similarly
 GDML:         "dune35t4apa_v6.gdml"
 ROOT:         "dune35t4apa_v6.gdml"
 SortingParameters: { 
    DetectorVersion: "dune35t4apa_v6"
    ChannelsPerOpDet:	12
 } 

 SurfaceY:           0.0e2               #in cm, vertical distance to the surface
 DisableWiresInG4:   true

}

larnd_geo:
{
 Name:     "larnd"

 GDML:     "larnd.gdml"
 ROOT:     "larnd.gdml"

 SortingParameters:	{ChannelsPerOpDet:	1}
 SurfaceY:           5578               #183ft in cm, vertical distance to the surface
 DisableWiresInG4:   true
}


dune_geometry_helper:
{
 service_provider : DUNEGeometryHelper
}



END_PROLOG
BEGIN_PROLOG

standard_detproperties :
{
 service_provider: "DetectorPropertiesServiceStandard"

 # Drift properties 
 Temperature:      91                #Kelvin
 Efield:           [0.5,0.66,0.8 ]   #kV/cm
 Electronlifetime: 750               #microseconds
 
 SternheimerA:     0.1956  # Ar Sternheimer parameter a.
 SternheimerK:     3.0000  # Ar Sternheimer parameter k.
 SternheimerX0:    0.2000  # Ar Sternheimer parameter x0.
 SternheimerX1:    3.0000  # Ar Sternheimer parameter x0.
 SternheimerCbar:  5.2146  # Ar Sternheimer parameter Cbar.

 DriftVelFudgeFactor: 1.
 
 ElectronsToADC:    1.208041e-3  # in ADC/e; 6241.5 electrons = 1fC = 7.54 ADC counts for ArgoNeuT
 NumberTimeSamples: 2048         # ticks of the clock per readout frame
 TimeOffsetU:       -5.193
 TimeOffsetV:       0.585
 TimeOffsetZ:       0
 ReadOutWindowSize: 2048

 SimpleBoundaryProcess: true  #enable opticalBoundaryProcessSimple instead of G4 default

}

# be sure to make the necessary changes when microboone and
# lbne have different electronics simulations from argoneut

END_PROLOG

BEGIN_PROLOG


dunefd_detproperties:                   @local::standard_detproperties
# dunefd_detproperties.SamplingRate:      500.         #in ns
dunefd_detproperties.Temperature:       87
dunefd_detproperties.Electronlifetime:  3.0e3
dunefd_detproperties.Efield:           [0.5,0.666,0.8]  #(predicted for microBooNE)
dunefd_detproperties.ElectronsToADC:    6.8906513e-3 # 1fC = 43.008 ADC counts for DUNE fd
dunefd_detproperties.NumberTimeSamples: 4492         # drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
dunefd_detproperties.ReadOutWindowSize: 4492         # drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
dunefd_detproperties.TimeOffsetU:       0.
dunefd_detproperties.TimeOffsetV:       0.
dunefd_detproperties.TimeOffsetZ:       0.

dunefddphase_detproperties:                   @local::standard_detproperties
# dunefddphase_detproperties.SamplingRate:    400.          # in ns
dunefddphase_detproperties.Temperature:       87            # in K
dunefddphase_detproperties.Electronlifetime:  3.0e3         # in us
dunefddphase_detproperties.Efield:            [0.5,4.0,0.0] # in kV/cm
dunefddphase_detproperties.ElectronsToADC:    5.1267e-04    # 
dunefddphase_detproperties.NumberTimeSamples: 20000         # drift length/drift velocity*sampling rate
dunefddphase_detproperties.ReadOutWindowSize: 20000         # drift length/drift velocity*sampling rate
dunefddphase_detproperties.TimeOffsetX:       0.
dunefddphase_detproperties.TimeOffsetY:       0.
dunefddphase_detproperties.TimeOffsetZ:       0.

protodunedphase_detproperties:                   @local::standard_detproperties
protodunedphase_detproperties.Temperature:       87            # in K
protodunedphase_detproperties.Electronlifetime:  3.0e3         # in us
protodunedphase_detproperties.Efield:            [0.5,4.0,0.0] # in kV/cm
protodunedphase_detproperties.ElectronsToADC:    1.02534e-03   # 
protodunedphase_detproperties.NumberTimeSamples: 10000         # 10000 before beam + 10000 after beam
protodunedphase_detproperties.ReadOutWindowSize: 10000         # 10000 before beam + 10000 after beam
protodunedphase_detproperties.TimeOffsetX:       0.
protodunedphase_detproperties.TimeOffsetY:       0.
protodunedphase_detproperties.TimeOffsetZ:       0.

dphase3x1x1_detproperties: 		@local::standard_detproperties
dphase3x1x1_detproperties.Temperature:       87            # in K
dphase3x1x1_detproperties.Electronlifetime:  3.0e3         # in us
dphase3x1x1_detproperties.Efield:            [0.5,4.0,0.0] # in kV/cm
dphase3x1x1_detproperties.ElectronsToADC:    1.02534e-03   # 
dphase3x1x1_detproperties.NumberTimeSamples: 1667
dphase3x1x1_detproperties.ReadOutWindowSize: 1667
#dphase3x1x1_detproperties.TimeOffsetX:       0.
dphase3x1x1_detproperties.TimeOffsetY:       0.
dphase3x1x1_detproperties.TimeOffsetZ:       0.

dune35t_detproperties:                   @local::standard_detproperties
# dune35t_detproperties.SamplingRate:      500.         #in ns
dune35t_detproperties.Temperature:       87
dune35t_detproperties.Electronlifetime:  3.0e3
# dune35t_detproperties.Efield:          [0.5,0.666,0.8]  #(predicted for microBooNE)
dune35t_detproperties.Efield:            [0.25,0.782,1.734] # Run was at half field
dune35t_detproperties.ElectronsToADC:    6.8906513e-3 # 1fC = 43.008 ADC counts for DUNE 35t
dune35t_detproperties.NumberTimeSamples: 5200
dune35t_detproperties.ReadOutWindowSize: 5200
dune35t_detproperties.TimeOffsetU:       0.
dune35t_detproperties.TimeOffsetV:       0.
dune35t_detproperties.TimeOffsetZ:       0.

dune35t_milliblock_detproperties:         @local::dune35t_detproperties
dune35t_milliblock_detproperties.NumberTimeSamples: 15000
dune35t_milliblock_detproperties.ReadOutWindowSize: 15000

# Implement new 6000 tick readout window (500 before trigger)
protodune_detproperties:                   @local::standard_detproperties
protodune_detproperties.Temperature:       87.68
protodune_detproperties.Electronlifetime:  35.0e3
protodune_detproperties.Efield:           [0.4867,0.666,0.8]  #(predicted for microBooNE)
protodune_detproperties.ElectronsToADC:    6.8906513e-3 # 1fC = 43.008 ADC counts for DUNE fd
protodune_detproperties.NumberTimeSamples: 6000         # 1 drift window = 4492 = drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
protodune_detproperties.ReadOutWindowSize: 6000         # 1 drift window = 4492 = drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
protodune_detproperties.TimeOffsetU:       0.
protodune_detproperties.TimeOffsetV:       0.
protodune_detproperties.TimeOffsetZ:       0.




protodunesp_detproperties :
 {
 service_provider: "DetectorPropertiesServiceProtoDUNEsp" 



 GetHVDriftfromSamweb: true   #will attempt to look up nominal drift HV voltage from samweb metadata
 GetReadOutWindowSizefromSamweb: true #will attempt to look up readout window size samweb metadata
 UseRunDependentTemperature: true #will updated temperature using run number to account for the varition during datataking 

  # Drift properties 
Temperature:      87.68           #Kelvin
Efield:           [0.4867,0.619423,0.776903,1.72178]     #calc from 180KV drift and wire biases will be overwritten if GetHVvaluefromTable is enabled
Electronlifetime: 35.0e3               #microseconds
SternheimerA:     0.1956  # Ar Sternheimer parameter a.
SternheimerK:     3.0000  # Ar Sternheimer parameter k.
SternheimerX0:    0.2000  # Ar Sternheimer parameter x0.
SternheimerX1:    3.0000  # Ar Sternheimer parameter x0.
SternheimerCbar:  5.2146  # Ar Sternheimer parameter Cbar.  
SimpleBoundaryProcess: true  #enable opticalBoundaryProcessSimple instead of G4 default
ElectronsToADC:    6.8906513e-3 # 1fC = 43.008 ADC counts for DUNE fd
NumberTimeSamples: 6000         # 1 drift window = 4492 = drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
ReadOutWindowSize: 6000         # 1 drift window = 4492 = drift length/drift velocity*sampling rate = (359.4 cm)/(0.16 cm/us)*(2 MHz)
TimeOffsetU:       0.
TimeOffsetV:       0.
TimeOffsetZ:       0.

}


END_PROLOG
BEGIN_PROLOG

standard_properties:
{
 service_provider: "LArPropertiesServiceStandard"

 # For following parameters, see http://pdg.lbl.gov/AtomicNuclearProperties/
 RadiationLength:  19.55   # g/cm^2
 AtomicNumber:     18      # Ar atomic number.
 AtomicMass:       39.948  # Ar atomic mass (g/mol).
 ExcitationEnergy: 188.0   # Ar mean excitation energy (eV).

# Argon39DecayRate: 0.00141 # decays per cm^3 per second.  Assumes 1.01 Bq/kg and a density of 1.396 g/cc
# The following parameter was formerly used to steer an ad-hoc 39Ar decay model as part of the G4 step.
# Users are now recommended to use the radiological generator: see larsim/EventGenerators/radiological_gen.fcl
# As of February 2017, this value is no longer used.
 Argon39DecayRate: 0.0

 # Optical properties
 # Fast and slow scintillation emission spectra, from [J Chem Phys vol 91 (1989) 1469]
 FastScintEnergies:    [ 6.0,  6.7,  7.1,  7.4,  7.7, 7.9,  8.1,  8.4,  8.5,  8.6,  8.8,  9.0,  9.1,  9.4,  9.8,  10.4,  10.7]
 SlowScintEnergies:    [ 6.0,  6.7,  7.1,  7.4,  7.7, 7.9,  8.1,  8.4,  8.5,  8.6,  8.8,  9.0,  9.1,  9.4,  9.8,  10.4,  10.7]
 FastScintSpectrum:    [ 0.0,  0.04, 0.12, 0.27, 0.44, 0.62, 0.80, 0.91, 0.92, 0.85, 0.70, 0.50, 0.31, 0.13, 0.04,  0.01, 0.0]
 SlowScintSpectrum:    [ 0.0,  0.04, 0.12, 0.27, 0.44, 0.62, 0.80, 0.91, 0.92, 0.85, 0.70, 0.50, 0.31, 0.13, 0.04,  0.01, 0.0]
 ScintResolutionScale: 1.     # resolution factor used by G4 scintillation
 ScintFastTimeConst:   6.     # fast scintillation time constant (ns)
 ScintSlowTimeConst:   1590.  # slow scintillation time constant (ns)
 ScintBirksConstant:   0.069  # birks constant for LAr (1/MeV cm)
 ScintYield:           24000. # total scintillation yield (ph/Mev)
 ScintPreScale:        0.03   # Scale factor to reduce number of photons simulated
                              # Later QE should be corrected for this scale
 ScintYieldRatio:      0.3    # fast / slow scint ratio (needs revisitting)
 ScintByParticleType:  false  # whether to use different yields and
                              # quenching per particle in fast op sim
 EnableCerenkovLight: true    # whether to switch on cerenkov light (slow)




 # Scintillation yields and fast/slow ratios per particle type
 MuonScintYield:          24000
 MuonScintYieldRatio:     0.23
 PionScintYield:          24000
 PionScintYieldRatio:     0.23
 ElectronScintYield:      20000
 ElectronScintYieldRatio: 0.27
 KaonScintYield:          24000
 KaonScintYieldRatio:     0.23
 ProtonScintYield:        19200
 ProtonScintYieldRatio:   0.29
 AlphaScintYield:         16800
 AlphaScintYieldRatio:    0.56


 # Refractive index as a function of energy (eV) from arXiv:2002.09346
 RIndexEnergies: [ 1.18626, 1.68626, 2.18626, 2.68626, 3.18626, 3.68626, 4.18626, 4.68626, 5.18626, 5.68626, 6.18626, 6.68626, 7.18626, 7.68626, 8.18626, 8.68626, 9.18626, 9.68626, 10.1863, 10.6863, 11.1863 ]
 RIndexSpectrum: [ 1.24664, 1.2205, 1.22694, 1.22932, 1.23124, 1.23322, 1.23545, 1.23806, 1.24116, 1.24489, 1.24942, 1.25499, 1.26197, 1.2709, 1.28263, 1.29865, 1.32169, 1.35747, 1.42039, 1.56011, 2.16626 ]

 # absorption length as function of energy
 AbsLengthEnergies: [ 4,     5,     6,     7,     8,     9,     10,    11   ]
 AbsLengthSpectrum: [ 2000., 2000., 2000., 2000., 2000., 2000., 2000., 2000.]

 # Rayleigh scattering length (cm) @ 90K as a function of energy (eV) from arXiv:2002.09346

RayleighEnergies: [ 1.18626, 1.68626, 2.18626, 2.68626, 3.18626, 3.68626, 4.18626, 4.68626, 5.18626, 5.68626, 6.18626, 6.68626, 7.18626, 7.68626, 8.18626, 8.68626, 9.18626, 9.68626, 10.1863, 10.6863, 11.1863 ]
RayleighSpectrum: [ 1200800, 390747, 128633, 54969.1, 27191.8, 14853.7, 8716.9, 5397.42, 3481.37, 2316.51, 1577.63, 1092.02, 763.045, 534.232, 371.335, 252.942, 165.38, 99.9003, 51.2653, 17.495, 0.964341 ]

 # Surface reflectivity data - vector of energy spectrum per
 #   surface type
 ReflectiveSurfaceEnergies:           [ 7, 9, 10 ]
 ReflectiveSurfaceNames:            [ "STEEL_STAINLESS_Fe7Cr2Ni" ]
 ReflectiveSurfaceReflectances:     [ [ 0.25, 0.25, 0.25 ] ]
 ReflectiveSurfaceDiffuseFractions: [ [ 0.5,  0.5,  0.5  ] ]

 # Information related with the simulation of the Wavelength Shifter (TPB)
 LoadExtraMatProperties: false

 # TPB - WLS
 TpbTimeConstant: 2.5 #wls time constant in s J. Lumin 81(1999) 285

 # WLS - TPB properties original tpb [0.0, 0.0, 0.0, 0.0588,0.235, 0.853, 1.0,1.0,0.9259,0.704,0.0296,0.011, 0.0,0.0, 0.]
 TpbEmmisionEnergies: [0.05,1.0,1.5, 2.25, 2.481, 2.819, 2.952,2.988,3.024, 3.1, 3.14,3.1807, 3.54, 5.5, 50.39]
 TpbEmmisionSpectrum: [0.0, 0.0, 0.0, 0.0588,0.235, 0.853, 1.0,1.0,0.9259,0.704,0.0296,0.011, 0.0,0.0, 0.]
 TpbAbsorptionEnergies: [0.05,1.77,2.0675, 7.42, 7.75, 8.16, 8.73, 9.78,10.69, 50.39]
 TpbAbsorptionSpectrum: [100000.0,100000.0, 100000.0,0.001,0.00000000001,0.00000000001, 0.00000000001, 0.00000000001, 0.00000000001, 0.00000000001]

}

END_PROLOG

BEGIN_PROLOG

dune35t_properties:                  @local::standard_properties

dunefd_properties:                   @local::standard_properties
# Load TPB properties for photon simulation
dunefd_properties.LoadExtraMatProperties: true 

dunefddphase_properties:             @local::standard_properties

END_PROLOG
BEGIN_PROLOG

standard_larfft:
{
 FFTSize:    0   # Default to the readout window size
 FFTOption: ""   # Add option "P" for planning.
 FitBins:   20   # Number of bins of correlation used for peak fit
}

END_PROLOG

BEGIN_PROLOG


dunefd_larfft:           @local::standard_larfft
dunefd_larfft.FitBins:   5

dune35t_larfft:            @local::standard_larfft
dune35t_larfft.FitBins:    5

# Note: going much higher on the FitBins introduces an 
# undesired time offset in dune wires


END_PROLOG

BEGIN_PROLOG

standard_debug:
{
 debugModules: [ "*" ]     # list individual module names here if you only want output from specific modules
 destinations:
 {	
  debugmsg:
  {
   type:      "file"       # record the messages in a file, could also be cout, cerr, archive, dds
   filename:  "debug.log"  # name of the file in which to place the messages
   threshold: "DEBUG"      # threshold of what level of messages to use
   categories:             # place to list named categories, if you want to customize, 
                           # I think the categories are what are the strings given to mf::LogXXX() commands
   {
     default:              # treat all unspecified categories using these values
     {
      limit:       10      # only show the first n messages and then back off exponentially
      reportEvery: 20      # report every nth message
      timespan:    600     # if more than this many seconds have elapsed without a message, print one
     }
   } # end categories
  } # end debugmsg
 } # end destinations
} # end standard_debug

# see comments for standard_debug configuration to figure out what each value is
standard_info:
{ 
 destinations:
 {  
  infomsg:
  {
   type:      "cout"	
   threshold: "INFO"
   categories:                                      
   {
     default:             
     {
      limit:       1000   
      timespan:    600    
     }
     RecoBaseDefaultCtor:
     {
      limit: 5
      timespan: 1000
     }
     GeometryBadInputPoint:
     {
      limit: 5
      timespan: 1000
     }
   } # end categories
  } # end infomsg
 } # end destinations
} # end standard_info

# see comments for standard_debug configuration to figure out what each value is
standard_warning:
{ 
 destinations:
 {  
  warningmsg:
  {
   type:      "cout"	
   threshold: "WARNING"
   categories: 
   {
     default:             
     {
      limit:       1000   
      timespan:    60    
     }
     RecoBaseDefaultCtor:
     {
      limit: 5
      timespan: 1000
     }
     GeometryBadInputPoint:
     {
      limit: 5
      timespan: 1000
     }
   } # end categories
  } # end warningmsg
 } # end destinations
} # end standard_warning

# see comments for standard_debug configuration to figure out what each value is
standard_error:
{ 
 destinations:
 {  
  errormsg:
  {
   type:      "cerr"	
   threshold: "ERROR"
   categories: 
   {
     default: {} 
   } # end categories
  } # end errormsg
 } # end destinations
} # end standard_error

END_PROLOG

BEGIN_PROLOG

#for now the parameter sets for the different experiments are all the same

standard_largeantparameters:
{
 OpticalSimVerbosity:      0       #verbosity of optical simulation, soon to be depricated
 ParticleKineticEnergyCut: 0.01e-3  #in GeV
 StoreTrajectories:        true
 VisualizationEnergyCut:   10.e-3  #depricated, in GeV
 VisualizeNeutrals:        false   #depricated
 UseCustomPhysics:         false   #Whether to use a custom list of physics processes or the default
 ModifyProtonCut:          false   #Whether to modify the default proton cut
 NewProtonCut:             0.0     #new ProtonCut value, ModifyProtonCut must be set to set new value
 KeepEMShowerDaughters:    false   #save secondary, tertiary, etc particles in EM showers
 LongitudinalDiffusion:    6.2e-9  #in cm^2/ns
 TransverseDiffusion:      16.3e-9 #in cm^2/ns
 ElectronClusterSize:      600.0   #number of ionization electrons to drift in a unit
 MinNumberOfElCluster:     0	   #minimum number of electron clusters
 EnabledPhysics:           [ "Em", "SynchrotronAndGN", "Ion", "Hadron",
                             "Decay", "HadronElastic", "Stopping", "NeutronTrackingCut" ]
 CosmogenicK0Bias:         0 # 0 is off. N is the number of secondaries to produce.
 CosmogenicXSMNBiasOn:     0 # 0 is off. 1 works. 2 still in development.
 CosmogenicXSMNBiasFactor: 1 # Not more than 5-ish cuz of numerical instabilities.
 DisableWireplanes:        false #if set true, charge drift simulation does not run - used for optical sim jobs OR just when you don't wanna drift the e's.
 SkipWireSignalInTPCs:     []     # put here TPC id's which should not receive ionization electrons - used to simulate TPC geom volumes which are actually dead LAr volumes in protoDUNE
 UseModBoxRecomb:          true   # use Modified Box recombination instead of Birks

 #* Recombination factor coefficients come from Nucl.Instrum.Meth.A523:275-286,2004
 #* * @f$ dE/dx @f$ is given by the voxel energy deposition, but have to convert it to MeV/cm from GeV/voxel width
 #* * electric field: @f$ E @f$ in kV/cm
 #* * @f$ R = A/(1 + (dE/dx)*k/E) @f$
 #* * @f$ A = 0.800 \pm 0.003 @f$
 #* * @f$ k = 0.0486 @f$ needs to be scaled with Electric field
 RecombA: 0.800      #< _A_ constant.
 Recombk: 0.0486     #< _k_ constant, in g/(MeV cm&sup2;)*kV/cm.

 #* Recombination factor coefficients come from Nucl.Instrum.Meth.A523:275-286,2004
 #* * @f$ dE/dx @f$ is given by the voxel energy deposition, but have to convert it to MeV/cm from GeV/voxel width
 #* * electric field: @f$ E @f$ in kV/cm
 #* * `kModBoxB` needs to be scaled with the electric field.
 ModBoxA: 0.930
 ModBoxB: 0.212

 # The following parameters specify details of wireplanes or similar
 #  areas with optically parameterized transmissions (Ben J 2013)

 #  volume names to be associated with an optical wireplane model
 OpticalParamVolumes:      ["volTPCPlaneVert_PV"]

 #  specification of which model to use for each volume
 OpticalParamModels:       ["OverlaidWireplanes"]

 # orientation of each wireplane set
 #  0 = Xdrift, 1 = Ydrift, 2 = Zdrift
 OpticalParamOrientations: [0]

 # This a set of floats which is specific to the particular model used.
 # For overlaid wireplanes, should be a vector of vectors of
 #                                 [plane angle, pitch/mm, wire diameter/mm]
 #
 # This format is chosen to allow for future extensions to the model
 #  for, eg, DUNE wireplane development.
 #
 OpticalParamParameters:   [ [ [60,  3, 0.15],
 	 		       [-60, 3, 0.15],
                               [0,   3, 0.15] ] ]
 UseLitePhotons: false
}

jp250L_largeantparameters:     @local::standard_largeantparameters
bo_largeantparameters:         @local::standard_largeantparameters
argoneut_largeantparameters:   @local::standard_largeantparameters
# The following line is already in simulationservices_microboone.fcl
# and so it should not also be included here, for clarity's sake.
#microboone_largeantparameters: @local::standard_largeantparameters
dune35t_largeantparameters:    @local::standard_largeantparameters
dunefd_largeantparameters:   @local::standard_largeantparameters

standard_larvoxelcalculator:
{
 VoxelSizeX:     0.03    #in cm
 VoxelSizeY:     0.03    #in cm
 VoxelSizeZ:     0.03    #in cm
 VoxelSizeT:     5000.0  #in ns
 VoxelOffsetX:   0.0     #in cm
 VoxelOffsetY:   0.0     #in cm
 VoxelOffsetZ:   0.0     #in cm
 VoxelOffsetT:   -2500.0 #in ns
 VoxelEnergyCut: 1.e-6   #in GeV
}

bo_larvoxelcalculator:         @local::standard_larvoxelcalculator
jp250L_larvoxelcalculator:     @local::standard_larvoxelcalculator
argoneut_larvoxelcalculator:   @local::standard_larvoxelcalculator
# The following line is already in simulationservices_microboone.fcl
# and so it should not also be included here, for clarity's sake.
#microboone_larvoxelcalculator: @local::standard_larvoxelcalculator
dune35t_larvoxelcalculator:    @local::standard_larvoxelcalculator
dunefd_larvoxelcalculator:     @local::standard_larvoxelcalculator

END_PROLOG

BEGIN_PROLOG


dunefd_largeantparameters:   @local::standard_largeantparameters
dunefd_larvoxelcalculator:   @local::standard_larvoxelcalculator
dunefd_largeantparameters.UseLitePhotons: true

protodune_largeantparameters:   @local::standard_largeantparameters
protodune_largeantparameters.UseCustomPhysics: true
protodune_largeantparameters.EnabledPhysics: [
         "Em",
         "FastOptical",
         "SynchrotronAndGN",
         "Ion",
         "Hadron",
         "Decay",
         "HadronElastic",
         "Stopping"
        ] # removed NeutronTrackingCut so neutrons from cosmics generator can appear throughout the full readout window

protodune_larvoxelcalculator:   @local::standard_larvoxelcalculator
protodune_largeantparameters.UseLitePhotons: true

dune35t_largeantparameters:   @local::dunefd_largeantparameters
dune35t_largeantparameters.UseModBoxRecomb: true
dune35t_larvoxelcalculator:   @local::dunefd_larvoxelcalculator


END_PROLOG
# signalservices_dune.fcl
#
# David Adams
# January 2016
#
# 28jan2016: Modify filter to fix problems with baseline for deconvoluted signals.
#            See https://cdcvs.fnal.gov/redmine/issues/11475.

BEGIN_PROLOG

dunefd_signalshapingservice: {

  DeconNorm: 200
  ADCPerPCAtLowestASICGain: 13160 #ADC/pC (2.8 ADC/mV * 4.7 mV/fC * 1000)
  # ASICGains:           [4.7, 7.8, 14, 25]
  ASICGainInMVPerFC:  [ 14, 14, 14 ] #mV/fC for Ind & col planes
  ShapeTimeConst:  [ 2.0, 2.0, 2.0 ] #Gain and Peaking time (microseconds)

  # Noise Factor - rms ADCs @ lowest ASIC Gain (4.7 mV/fC)
  NoiseFactVec:         [[ 1.12, 0.86, 0.60, 0.55 ], [ 1.12, 0.86, 0.60, 0.55 ], [ 0.89, 0.66, 0.48, 0.43 ]]
  # to turn off noise
  # NoiseFactVec:         [[ 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0 ], [ 0.0, 0.0, 0.0, 0.0 ]]


  #FieldBins:        75 # for UseFunctionFieldShape: true
  FieldBins:        400
  InputFieldRespSamplingPeriod: 100. # in nano second

  Col3DCorrection:  2.5
  Ind3DCorrection:  1.5
  ColFieldRespAmp:  1.0
  IndUFieldRespAmp:  1.0
  IndVFieldRespAmp:  1.0

  FieldResponseTOffset: [-32.5e3, -32.5e3, -32.5e3] # in ns, time offset of field response shape
  CalibResponseTOffset: [0.0, 0.0, 0.0] # in ns time offset to align all three planes


  # For IndFilter and ColFilter, frequency (x) is measured in
  # cycles/microsecond.  The conversion to frequency bin depends on FFT size
  # samping rate.

  #dla IndUFilter:       "(x>0.0)*gaus(0)*exp(-0.5*pow(x/[3],[4]))"
  IndUFilter:       "gaus(0)*exp(-0.5*pow(x/[3],[4]))"
  # IndUFilterParams: [ .454, 0.0, 0.1875, 0.25, 8.0 ]
  #IndUFilterParams: [ 0.05, 0.0, 0.1875, 0.25, 8.0 ]
  IndUFilterParams: [ 1.73, 1.69, 1.55, 0.19, 3.75 ]

  #dla IndVFilter:       "(x>0.0)*gaus(0)*exp(-0.5*pow(x/[3],[4]))"
  IndVFilter:       "gaus(0)*exp(-0.5*pow(x/[3],[4]))"
  # IndVFilterParams: [ .454, 0.0, 0.1875, 0.25, 8.0 ]
  #IndVFilterParams: [ 0.05, 0.0, 0.1875, 0.25, 8.0 ]
  #dla IndVFilterParams: [ 1.74, 1.46, 1.33, 0.23, 4.89 ]
  IndVFilterParams: [ 1.73, 1.69, 1.55, 0.19, 3.75 ]


  #dla ColFilter:       "(x>0)*[0]*exp(-0.5*(((x-[1])/[2])^2)^[3])"
  ColFilter:       "[0]*exp(-0.5*(((x-[1])/[2])^2)^[3])"
  # ColFilterParams: [ 79258.0, 0.0, 0.1875, 1.5 ]
  #ColFilterParams: [ 0.0792580, 0.0, 0.1875, 1.5 ]
  ColFilterParams: [ 1.03, 0.08, 0.15, 2.17 ]

  GetFilterFromHisto:   false

  FilterFunctionFname:  "uboone_filters_v0.1.root"
  FilterHistoName:	"noisefilter_%d"


  UseFunctionFieldShape: false
  UseHistogramFieldShape: true
  FieldResponseFname:     "FieldResponse/dune35t_response_v1.0.root"
  FieldResponseHistoName: "FieldResponse"

  IndUFieldShape: "[0]*(1.0+[3]*tanh(x-[4]))*([4]-x)*exp(-0.5*((x-[4])/[2])^2.0)"
  IndUFieldParams:  [.00843,.1534,1.77,0.,0.5]    #last parameter needs to be half of FFT vector, correct for in code
  IndVFieldShape: "[0]*(1.0+[3]*tanh(x-[4]))*([4]-x)*exp(-0.5*((x-[4])/[2])^2.0)"
  IndVFieldParams:  [.00843,.1534,1.77,0.,0.5]    #last parameter needs to be half of FFT vector, correct for in code
  ColFieldShape: "x^[2]/(1.0+(x/[0])^[1])"
  ColFieldParams: [ 8.0,16.0,.75 ]

  DebugFieldShape: false
}

# 35t is the same for now

dune35t_signalshapingservice:   @local::dunefd_signalshapingservice
### Previous default settings
#dune35t_signalshapingservice.ADCPerPCAtLowestASICGain: 11700 #ADC/pC   (For correct Digitization)
#dune35t_signalshapingservice.ASICGainInMVPerFC: [7.8, 7.8, 7.8] #mV/fC for Ind & col planes
#dune35t_signalshapingservice.ShapeTimeConst:  [ 2.0, 2.0, 2.0 ] #Gain and Peaking time (microseconds)
### Bringing in line with data settings, 8th Sept 2016
dune35t_signalshapingservice.ASICGainInMVPerFC: [ 14.0, 14.0, 14.0] #mV/fC for Ind & col planes
dune35t_signalshapingservice.ShapeTimeConst:    [ 3.0 , 3.0 , 3.0 ] #Gain and Peaking time (microseconds)
#
# 3x1x1, protoDUNE and DUNE dual-phase signal service
#

# ProtoDUNE single phase
protodunesp_signalshapingservice: @local::dunefd_signalshapingservice
protodunesp_signalshapingservice.ColFilter: "(x>0.0)*gaus"
protodunesp_signalshapingservice.ColFilterParams: [ 1.0, 0.0, 0.1 ]
protodunesp_signalshapingservice.IndUFilter: "(x>0.0)*gaus"
protodunesp_signalshapingservice.IndUFilterParams: [ 1.0, 0.0, 0.1 ]
protodunesp_signalshapingservice.IndVFilter: "(x>0.0)*gaus"
protodunesp_signalshapingservice.IndVFilterParams: [ 1.0, 0.0, 0.1 ]


dunefddphase_signalshapingservice:
{
  AreaNorm:  35.64   # in units (ADC x us) / fC	
  ADCpermV:  1.0     # ADC conversion factor (not used at the moment)
  AmpENC:    1000.0  # noise in electrons from TDR
  DeconNorm: 70.0
  ShapeFunc: "1/([0]-[1]) * ( exp(-(x)/[0]) - exp(-(x)/[1]) )"
  ShapeFuncParams: [0.5, 4.0]
  RespSamplingPeriod: 400. # in nano second
 
  AddFieldFunction: false
  ColFieldFunction: "x*[0]"
  ColFieldFunctionParams: [1.0]
  ColFieldRespAmp: 1.0

  ColFilter:       "[0]*exp(-1.2*(((x-[1])/[2])^2)^[3])"
  ColFilterParams: [ 1.0, 0.0, 0.136, 2.5 ]
  #FieldFunctionParameters: [1.0, 1.0, 1.0, 1.0] #0 step width #1 step height #2 slow/fast (could be taken from E field) #Tau (could be taken from field and temperature). 0 and Tau in us
}

# ProtoDUNE dual phase
protodunedphase_signalshapingservice: @local::dunefddphase_signalshapingservice
protodunedphase_signalshapingservice.ColFilter: "(x>0.0)*gaus"
protodunedphase_signalshapingservice.ColFilterParams: [ 1.0, 0.0, 0.1 ]

# 3x1x1 dual phase TPC
dunedphase3x1x1_signalshapingservice: @local::dunefddphase_signalshapingservice
dunedphase3x1x1_signalshapingservice.AreaNorm:   16.84 
dunedphase3x1x1_signalshapingservice.AreaNorm1m: 23.58
dunedphase3x1x1_signalshapingservice.ShapeFunc: "[0]*exp((x-[1])/[2]) / ( 1 + exp((x-[1])/[3]))"        #obtained from pulsed waveform fit
dunedphase3x1x1_signalshapingservice.ShapeFuncParams: [1.21581, 0.864873, 0.288648, 0.27413]		#obtained from pulsed waveform fit
dunedphase3x1x1_signalshapingservice.ShapeFunc1m: "[0]*exp((x-[1])/[2]) / ( 1 + exp((x-[1])/[3]))"      #obtained from pulsed waveform fit
dunedphase3x1x1_signalshapingservice.ShapeFuncParams1m: [1.46135, 1.0228, 0.336029, 0.29685]		#obtained from pulsed waveform fit

END_PROLOG
BEGIN_PROLOG

no_mag:
{
FieldDescriptions: [ { UseField:         0  # 0--off 1--Constant field
                                            # 2--Field map (not implemented)
                       ConstantField:    [ 0.0, 0.0, 0.0 ]
                       MagnetizedVolume: "volWorld" } ]
}

no_mag_larsoft: @local::no_mag

END_PROLOG
BEGIN_PROLOG

standard_database:
{
  DBHostName:		"fnalpgsdev.fnal.gov"
  DBName:		"uboonedaq_dev"
  DBUser:		"uboonedaq_reader"
  Port:			5436
  PassFileName:		".pswd"
  ToughErrorTreatment:  false                #if true, throw cet::exception at DB connection error
  ShouldConnect:        false
  TableName:    	"main_run"
}

END_PROLOG

BEGIN_PROLOG


dunefd_database:               @local::standard_database
dunefd_database.DBName:	       "dune_dev"
dunefd_database.DBUser:	       "dune_reader"
dunefd_database.Port:	       5438
dunefd_database.PassFileName:  ".lpswd"
dunefd_database.ShouldConnect: false # enable it when DB is available
dunefd_database.ToughErrorTreatment: false # enable it when DB is available too

dune35t_database:               @local::standard_database
dune35t_database.DBName:        "dune_dev"
dune35t_database.DBUser:        "dune_reader"
dune35t_database.Port:          5438
dune35t_database.PassFileName:  ".lpswd"
dune35t_database.ShouldConnect: false # enable it when DB is available
dune35t_database.ToughErrorTreatment: false # enable it when DB is available too


END_PROLOG
BEGIN_PROLOG

PIProv: {
  G4ModuleLabel: "largeant"
  EveIdCalculator: "EmEveIdCalculator"
}
standard_particleinventoryservice: {
  ParticleInventory: @local::PIProv
}

jp250L_particleinventoryservice:     @local::standard_particleinventoryservice
bo_particleinventoryservice:         @local::standard_particleinventoryservice
argoneut_particleinventoryservice:   @local::standard_particleinventoryservice
microboone_particleinventoryservice: @local::standard_particleinventoryservice
#dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
#dunefd_particleinventoryservice:     @local::standard_particleinventoryservice

END_PROLOG



BEGIN_PROLOG

providerBKConf:{
 G4ModuleLabel:            "largeant" # module that produced the sim::Particle objects
 SimChannelModuleLabel:    "largeant" # module that produced the sim::SimChannel objects, if not provided defaults to using the G4ModuleLabel
 MinimumHitEnergyFraction: 0.1        # minimum fraction of energy a G4 trackID contributes to a hit to be 
                                      # counted in hit based efficiency and purity calculations
}

standard_backtrackerservice:

{
 BackTracker: @local::providerBKConf
}

jp250L_backtrackerservice:     @local::standard_backtrackerservice

bo_backtrackerservice:         @local::standard_backtrackerservice

argoneut_backtrackerservice:   @local::standard_backtrackerservice

microboone_backtrackerservice: @local::standard_backtrackerservice

#dune35t_backtrackerservice:    @local::standard_backtrackerservice

#dunefd_backtrackerservice:     @local::standard_backtrackerservice

END_PROLOG


BEGIN_PROLOG

dune35t_backtrackerservice:    @local::standard_backtrackerservice
dunefd_backtrackerservice:     @local::standard_backtrackerservice

END_PROLOG
BEGIN_PROLOG

PIProv: {
  G4ModuleLabel: "largeant"
  EveIdCalculator: "EmEveIdCalculator"
}
standard_particleinventoryservice: {
  ParticleInventory: @local::PIProv
}

jp250L_particleinventoryservice:     @local::standard_particleinventoryservice
bo_particleinventoryservice:         @local::standard_particleinventoryservice
argoneut_particleinventoryservice:   @local::standard_particleinventoryservice
microboone_particleinventoryservice: @local::standard_particleinventoryservice
#dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
#dunefd_particleinventoryservice:     @local::standard_particleinventoryservice

END_PROLOG



BEGIN_PROLOG

dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
dunefd_particleinventoryservice:     @local::standard_particleinventoryservice
#dune35t_particleinventoryservice.ParticleInventory.EveIdCalculator: "EveIdCalculator"
#dunefd_particleinventoryservice.ParticleInventory.EveIdCalculator: "EveIdCalculator"

END_PROLOG
BEGIN_PROLOG

PIProv: {
  G4ModuleLabel: "largeant"
  EveIdCalculator: "EmEveIdCalculator"
}
standard_particleinventoryservice: {
  ParticleInventory: @local::PIProv
}

jp250L_particleinventoryservice:     @local::standard_particleinventoryservice
bo_particleinventoryservice:         @local::standard_particleinventoryservice
argoneut_particleinventoryservice:   @local::standard_particleinventoryservice
microboone_particleinventoryservice: @local::standard_particleinventoryservice
#dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
#dunefd_particleinventoryservice:     @local::standard_particleinventoryservice

END_PROLOG


BEGIN_PROLOG

providerPBKConf:{
 G4ModuleLabel:            "largeant" # module that produced the sim::Particle and sim::SimChannel objects
 MinimumHitEnergyFraction: 0.1        # minimum fraction of energy a G4 trackID contributes to a hit to be 
                                      # counted in hit based efficiency and purity calculations
 Delay:                    0          #This number is the difference between when light arrives at the detector, and the time recorded in OpHits. This number is experiment specific and should be set by each experiment. 
}

standard_photonbacktrackerservice:
{
 PhotonBackTracker: @local::providerPBKConf
}

END_PROLOG


#
# File:    seedservice_dune.fcl
# Desc:    custom configurations of NuRandomService for DUNE
# Author:  Gianluca Petrillo (petrillo@fnal.gov)
# Date:    February 13th, 2015
# Version: 1.0
# 
# The default configuration is the "random" policy, that defies the goal of the
# seed service altogether.
# 
# Changes:
# 13022015 (petrillo@fnal.gov) [v1.0]
#   first version; not many choices here
# 
#

#
# File:    NuRandomService.fcl
# Brief:   Default configuration for random seed service
# Author:  Gianluca Petrillo (petrillo@fnal.gov)
# Date:    February 5th, 2015
# Version: 1.0
# 
# The default configuration for the seed service uses the autoIncrement policy.
# 
# Use this as:
# 
# services.NuRandomService: @local::standard_NuRandomService
# 
# 
# Changes:
# 20150205 (petrillo@fnal.gov) [v1.0]
#   first version
#

BEGIN_PROLOG


autoincrement_NuRandomService: {
  # policy: autoIncrement
  # each time a seed is requested, a counter is increased and its value returned
  # as seed; the first seed returned is baseSeed
  policy            :    "autoIncrement"
  
  # this is the first seed that is returned;
  # override it with:
  # 
  # services.NuRandomService.baseSeed: MySeed
  # 
  baseSeed          : 2829
  
  # since this is a generic configuration and we don't know how many seeds there
  # are going to be around, we just skip the range check
  checkRange        : false
  
  # print into the log all seeds at the end of the job
  endOfJobSummary   :  true
} # autoincrement_NuRandomService


linearmapping_NuRandomService: {
  # policy: linearIncrement
  # each time a seed is requested, a counter is increased and its value returned
  # as seed; the first seed returned is nJob x maxUniqueEngines
  policy            :    "linearMapping"
  
  # this is the number of this job in an absolute batch count; override it with:
  # 
  # services.NuRandomService.nJob: NJOB
  #
  nJob            :  1
  maxUniqueEngines: 20
  
  # make sure that we don't try to use more engines than we are allowed;
  # that would mean overlapping random seeds with the next job
  checkRange      :  true
  
  # print into the log all seeds at the end of the job
  endOfJobSummary   :  true
} # linearmapping_NuRandomService


random_NuRandomService: {
  # policy: random
  # each time a seed is requested, a random number is returned.
  # 
  policy            :    "random"
  
  # if you really want this sequence of seeds to be reproducible,
  # insert here a seed for the random seed generator
  # baseSeed          : 64429
  
  # print into the log all seeds at the end of the job
  endOfJobSummary   :  true
} # random_NuRandomService


per_event_NuRandomService: {
  # policy: perEvent
  # on each event, the seed is computed from event information
  # 
  policy            :    "perEvent"
  
  # print into the log all seeds at the end of the job
  endOfJobSummary   :  false
} # per_event_NuRandomService


# choose our autoIncrement configuration as "standard"
standard_NuRandomService: @local::autoincrement_NuRandomService


END_PROLOG


BEGIN_PROLOG

# 
# the random policy extracts unpredictable, random seeds in a way similar to the
# behaviour that existed before NuRandomService.
# You don't want this for production.
# 
dune_seedservice: @local::random_NuRandomService # from seedservice.fcl


END_PROLOG
BEGIN_PROLOG

# the "standard" values are supposed to be good for ArgoNeuT
standard_detectorclocks:
{
  service_provider: "DetectorClocksServiceStandard"
  
  TrigModuleName:    ""
  InheritClockConfig: true
  G4RefTime:         0     # G4 time [us] where electronics clock counting start
  TriggerOffsetTPC:  0     # Time offset for TPC readout start time w.r.t. trigger [us]
  FramePeriod:       405.504 # Frame period [us]; 2048 * 198 ns
  ClockSpeedTPC:     5.0505  # TPC clock speed in MHz; 1 / 198.0 ns
  ClockSpeedOptical: 64    # Optical clock speed in MHz
  ClockSpeedTrigger: 16    # Trigger clock speed in MHz
  ClockSpeedExternal:31.25 # External clock speed in MHz
  DefaultTrigTime:   0     # Default trigger time in electronics clock [us]
  DefaultBeamTime:   0     # Default beam gate time in electronics clock [us]
}

END_PROLOG

BEGIN_PROLOG

dunefd_detectorclocks: @local::standard_detectorclocks

# dunefd_detectorclocks.TrigModuleName:      ""
dunefd_detectorclocks.InheritClockConfig:   false
dunefd_detectorclocks.G4RefTime:            0.  # G4 time [us] where electronics clock counting start
dunefd_detectorclocks.TriggerOffsetTPC:     0.  # Time [us] for TPC readout start w.r.t. trigger time
dunefd_detectorclocks.FramePeriod:       1600.  # Frame period [us]
dunefd_detectorclocks.ClockSpeedTPC:        2.  # TPC clock speed in MHz
dunefd_detectorclocks.ClockSpeedOptical:   62.5 # Optical clock speed in MHz
dunefd_detectorclocks.ClockSpeedTrigger:   16.  # Trigger clock speed in MHz
dunefd_detectorclocks.DefaultTrigTime:      0.  # Default trigger time [us].
dunefd_detectorclocks.DefaultBeamTime:      0.  # Default beam time [us].


dunefddphase_detectorclocks: @local::standard_detectorclocks
# dunefddphase_detectorclocks.TrigModuleName:      ""
dunefddphase_detectorclocks.InheritClockConfig:   false
dunefddphase_detectorclocks.G4RefTime:            0.    # G4 time [us] where electronics clock counting start
dunefddphase_detectorclocks.TriggerOffsetTPC:     0.    # Time [us] for TPC readout start w.r.t. trigger time
dunefddphase_detectorclocks.FramePeriod:          8000. # Frame period [us]
dunefddphase_detectorclocks.ClockSpeedTPC:        2.5   # TPC clock speed in MHz
dunefddphase_detectorclocks.ClockSpeedOptical:    250.  # Optical clock speed in MHz
dunefddphase_detectorclocks.ClockSpeedTrigger:    16.   # Trigger clock speed in MHz
dunefddphase_detectorclocks.DefaultTrigTime:      0.    # Default trigger time [us].
dunefddphase_detectorclocks.DefaultBeamTime:      0.    # Default beam time [us].

protodunedphase_detectorclocks: @local::dunefddphase_detectorclocks
protodunedphase_detectorclocks.FramePeriod:         4000. # Frame period [us]
protodunedphase_detectorclocks.ClockSpeedOptical:   62.5  # Optical clock speed in MHz

dune35t_detectorclocks: @local::standard_detectorclocks

# dune35t_detectorclocks.TrigModuleName:      ""
dune35t_detectorclocks.InheritClockConfig:   false
dune35t_detectorclocks.G4RefTime:            0. # G4 time [us] where electronics clock counting start
dune35t_detectorclocks.TriggerOffsetTPC:     0. # Time [us] for TPC readout start w.r.t. trigger time
dune35t_detectorclocks.FramePeriod:       2600. # Frame period [us]
dune35t_detectorclocks.ClockSpeedTPC:        2. # TPC clock speed in MHz
dune35t_detectorclocks.ClockSpeedOptical:  128. # Optical clock speed in MHz
dune35t_detectorclocks.ClockSpeedTrigger:   16. # Trigger clock speed in MHz
dune35t_detectorclocks.DefaultTrigTime:      0. # Default trigger time [us].
dune35t_detectorclocks.DefaultBeamTime:      0. # Default beam time [us].

# Implement new 6000 tick readout window (500 before trigger, or 250 us)
protodune_detectorclocks: @local::standard_detectorclocks

protodune_detectorclocks.InheritClockConfig:   false
protodune_detectorclocks.G4RefTime:            -250. # G4 time [us] where electronics clock counting start
protodune_detectorclocks.TriggerOffsetTPC:  -250. # Time [us] for TPC readout start w.r.t. trigger time (500 ticks)
protodune_detectorclocks.FramePeriod:       1600. # Frame period [us]
protodune_detectorclocks.ClockSpeedTPC:        2. # TPC clock speed in MHz
protodune_detectorclocks.ClockSpeedOptical:  150. # Optical clock speed in MHz
protodune_detectorclocks.ClockSpeedTrigger:   16. # Trigger clock speed in MHz
protodune_detectorclocks.DefaultTrigTime:     250. # Default trigger time [us].
protodune_detectorclocks.DefaultBeamTime:     250. # Default beam time [us].

dunedphase3x1x1_detectorclocks: @local::dunefddphase_detectorclocks
dunedphase3x1x1_detectorclocks.ClockSpeedOptical:  250. # Optical clock speed in MHz

END_PROLOG
# Contains information required for:
# Timing parameterisation for VUV photons (propagation time)

BEGIN_PROLOG

# VUV/DIRECT LIGHT: TIMING PARAMETERISATION
# Parameters of the Landau + Exponential (<= 350 cm) and Landau (> 350 cm) models
# Landau parameters
Distances_landau_generic: [0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 525, 550]
Norm_over_entries_generic: [ [4.64837, 4.64837, 2.86581, 1.4143, 0.974871, 0.71311, 0.55772, 0.461078, 0.411807, 0.364951, 0.325477, 0.297132, 0.297132, 0.297132, 0.297132, 0.297132,0.297132, 0.297132,
		0.297132, 0.297132, 0.297132, 0.297132, 0.297132],
		[3.43562, 3.43562, 1.61042, 0.981127, 0.64465, 0.476552, 0.369063, 0.310461, 0.264819, 0.231387, 0.215373, 0.199128, 0.189638, 0.170387, 0.159308, 0.151498,0.140134, 0.135217, 0.131114, 0.129511, 0.126329, 0.12452, 0.124595] ]
Mpv_generic: [	[2.73373, 2.73373, 3.599, 5.80141, 7.57883, 9.56959, 11.6047, 13.6676, 15.6126, 17.5389, 19.492, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254, 21.3254,
		21.3254, 21.3254],
		[2.19076, 2.19076, 4.0163, 5.86531, 8.09466, 10.4547, 12.9261, 15.2731, 17.7939, 20.6664, 22.99, 25.7017, 27.9139, 30.9469, 33.6378, 36.1413, 39.8435, 42.1625, 44.6396, 46.5133, 48.6331, 50.6754, 53.3949] ]
Width_generic: [ [0.198303, 0.198303, 0.347397, 0.562874, 0.750881, 0.998318, 1.2622, 1.55553, 1.79799, 2.05579, 2.3295, 2.57611, 2.57611, 2.57611, 2.57611, 2.57611,2.57611, 2.57611, 2.57611, 2.57611,
		2.57611, 2.57611, 2.57611],
		[0.305766, 0.305766, 0.508544, 0.747765, 1.12059, 1.57047, 2.07501, 2.54661, 3.09789, 3.79078, 4.19731, 4.74438, 5.09894, 5.83702, 6.36225, 6.80253, 8.278, 8.717, 9.2568, 9.7239, 10.5865, 11.3262, 11.8423] ]
# Exponential parameters
Distances_exp_generic: [0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375]
Slope_generic: [ [-0.181318, -0.181318, -0.148935, -0.126243, -0.10837, -0.0860558, -0.0759728, -0.0706126, -0.0672814, -0.0622897, -0.0577351, -0.0546709, -0.0546709, -0.0546709, -0.0546709, -0.0546709],
			[-0.169274, -0.169274, -0.119906, -0.0983691, -0.0781793, -0.0659805, -0.0587059, -0.0545288, -0.0514041, -0.0489773, -0.047259, -0.0454668, -0.0439597, -0.0415122, -0.0396851, -0.0378005] ]
Expo_over_Landau_norm_generic: [ [0.0149644, 0.0149644, 0.0337403, 0.0967895, 0.152669, 0.181732, 0.23025, 0.290033, 0.338948, 0.372986, 0.404828, 0.441243, 0.441243, 0.441243, 0.441243, 0.441243],
							[0.0252807, 0.0252807, 0.0638727, 0.113343, 0.165669, 0.216794, 0.274868, 0.325299, 0.38959, 0.466117, 0.515046, 0.578897, 0.621872, 0.689713, 0.742833, 0.773619] ]


# *************************************************************************************************
#  VUV time model, generic for all experiments (at first order)
# *************************************************************************************************

common_vuv_timing_parameterization:
{
  # Timing parameterisaion:
  #
  # Parameters of the Landau + Exponential (<= 350 cm) and Landau (> 350 cm) models
  # Landau parameters
  Distances_landau: @local::Distances_landau_generic
  Norm_over_entries: @local::Norm_over_entries_generic
  Mpv: @local::Mpv_generic
  Width: @local::Width_generic

  # Exponential parameters
  Distances_exp: @local::Distances_exp_generic
  Slope: @local::Slope_generic

  # Normalisations
  Expo_over_Landau_norm:  @local::Expo_over_Landau_norm_generic

  # Discretisation step size in cm
  step_size: 1.
  # Min and maximum distance in cm parameterisations are generated for (only generated when required to prevent long initial loading time)
  max_d: 2500.
  min_d: 25.
  # VUV group velocity in cm/ns
  vuv_vgroup_mean: 13.5
  vuv_vgroup_max: 18.
  # Distance in cm from "Landau + Expo" -> "Single Landau" model
  inflexion_point_distance: 350.

  # angular bin size in deg, must correspond to parameterisation set
  angle_bin_timing_vuv: 45
}


END_PROLOG










BEGIN_PROLOG

standard_photonvisibilityservice:
{

  NX: 75
  NY: 75
  NZ: 400
  UseCryoBoundary: true
  Interpolate: false

  DoNotLoadLibrary: false

  LibraryBuildJob: false

  #LibraryFile: "PhotonPropagation/LibraryData/lib8984855.root"
  LibraryFile: "PhotonPropagation/LibraryData/uboone_photon_library_v4.root"

 #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}

microboone_photonvisibilityservice: @local::standard_photonvisibilityservice

protodunedp_photonvisibilityservice_buildlib:
{

  NX: 29
  NY: 24
  NZ: 24
  UseCryoBoundary: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"

 #These are not used when usecryoboundary=true
  XMin: -420.5
  XMax: 304.5
  YMin: -300
  YMax: 300
  ZMin: 0
  ZMax: 600
}
#Bea

standard_photonvisibilityservice_buildlib:
{

  NX: 75
  NY: 75
  NZ: 400
  UseCryoBoundary: true
  Interpolate: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"


 #These are not used  when usecryoboundary=true
  XMin: 100
  XMax: 110
  YMin: -100
  YMax: 100
  ZMin: 500
  ZMax: 600

}


standard_photonvisibilityservice_par:
{
  NX: 125
  NY: 1
  NZ: 1
  UseCryoBoundary: false
  Interpolate: false
  DUNE10ktParameterization: true
  DoNotLoadLibrary: true

  LibraryBuildJob: false

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"
  XMin: -627
  XMax: -389
  YMin: -1.
  YMax: 1.
  ZMin: -1.00
  ZMax: 1.00

}

standard_library_vuv_prop_timing_photonvisibilityservice:
{
   # Start from the standard visibility service
   @table::standard_photonvisibilityservice

   # Flag to enable time parameterizations
   IncludePropTime: true

   # Generic VUV timing parameterization
   @table::common_vuv_timing_parameterization

}



END_PROLOG


# Contains information required for:
# Timing parameterisation Visible photons
# Corrections for semi-analytic number of hits models for VUV and visible light

# *************************************************************************************************
#          PARAMETERS SETS FOR SEMI-ANALYTIC SIMULATION ARE DEFINED HERE                        
# *************************************************************************************************     
BEGIN_PROLOG

# VUV/DIRECT LIGHT: TIMING PARAMETERISATION
# DUNE-SP
# Parameters of the Landau + Exponential (<= 400 cm) and Landau (> 400 cm) models
# Landau parameters
Distances_landau_dune: [0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 425, 450, 475, 500, 525, 550, 575, 600, 625, 650, 675, 700, 725]
Norm_over_entries_dune: [ [27.41, 27.41, 2.57134, 1.47775, 0.96034, 0.668723, 0.487808, 0.362789, 0.277659, 0.224883, 0.185199, 0.159048, 0.143393, 0.134121, 0.125978, 0.115751,
						   0.0921523, 0.0907023, 0.0856498, 0.0814134, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844, 0.0750844],
						  [3.79032, 3.79032, 1.25862, 0.928939, 0.566822, 0.319336, 0.331336, 0.219171, 0.178579, 0.135635, 0.119011, 0.109138, 0.0991792, 0.091753, 0.0787281, 0.0743768,
						   0.0663083, 0.0648284, 0.0608437, 0.0572599, 0.0561134, 0.0543579, 0.0529609, 0.0519021, 0.0510434, 0.0504866, 0.0503902, 0.0507405, 0.0503883, 0.0497511] ]	
Mpv_dune: [ [1.77134, 1.77134, 3.85131, 5.593, 7.46645, 9.44108, 11.5899, 13.8189, 16.2753, 18.8619, 21.6428, 24.4828, 27.189, 29.6607, 32.3706, 35.2212, 41.4392, 43.2475, 45.939, 48.5748,
			 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841, 51.4841],
			[1.91282, 1.91282, 4.31774, 5.90297, 8.90329, 11.8104, 12.9629, 17.0555, 19.5031, 24.7774, 27.175, 29.8128, 33.5619, 36.6553, 43.0021, 46.059, 52.6953, 55.1056, 59.9728, 65.2979,
			 67.9593, 71.0675, 74.7855, 79.689, 85.3232, 90.818, 97.0409, 103.2, 111.306, 117.6] ]
Width_dune: [ [0.10303, 0.10303, 0.313506, 0.525492, 0.716541, 0.969894, 1.29961, 1.73657, 2.30482, 2.94669, 3.71951, 4.53258, 5.24435, 5.79945, 6.53951, 7.34736, 12.0305, 12.4263, 13.4917,
			   14.7245, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202, 16.6202],
			[0, 0.281535, 0.633816, 0.80694, 1.46701, 2.32209, 2.20895, 3.56751, 4.23966, 6.11748, 6.97923, 7.82035, 9.05225, 10.1422, 12.6053, 13.6305, 17.7093, 18.3244, 19.9961, 22.1072,
			 23.4653, 25.3052, 27.5297, 30.5683, 34.8304, 39.7456, 45.1447, 51.3363, 58.4681, 63.0122] ]
# Exponential parameters
Distances_exp_dune: [0, 25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375]
Slope_dune: [ [-0.205783, -0.205783, -0.157344, -0.124546, -0.0949427, -0.0640574, -0.0509928, -0.0421876, -0.0360771, -0.0327956, -0.02997, -0.0280924, -0.0269181, -0.0259104, -0.0248679, -0.0233511],
			  [-0.157151, -0.157151, -0.10447, -0.0875509, -0.0605052, -0.0435416, -0.040128, -0.0325951, -0.0292046, -0.0255942, -0.0241776, -0.0226607, -0.0213594, -0.02037, -0.0181767, -0.0172752]	]
Expo_over_Landau_norm_dune:[ [0.00276789, 0.00276789, 0.0362807, 0.081067, 0.111523, 0.106485, 0.123852, 0.144239, 0.168534, 0.201111, 0.234443, 0.269284, 0.300041, 0.320541, 0.342403, 0.356125],
							 [0.0242526, 0.0242526, 0.086063, 0.101552, 0.134787, 0.171863, 0.152519, 0.203461, 0.224872, 0.279135, 0.304123, 0.317034, 0.341433, 0.360053, 0.382877, 0.391287]	]

dune_vuv_timing_parameterization:
{
  # Timing parameterisaion:
  #
  # Parameters of the Landau + Exponential (<= 400 cm) and Landau (> 400 cm) models
  # Landau parameters
  Distances_landau: @local::Distances_landau_dune
  Norm_over_entries: @local::Norm_over_entries_dune
  Mpv: @local::Mpv_dune
  Width: @local::Width_dune

  # Exponential parameters
  Distances_exp: @local::Distances_exp_dune
  Slope: @local::Slope_dune

  # Normalisations
  Expo_over_Landau_norm:  @local::Expo_over_Landau_norm_dune
  
  # Discretisation step size in cm
  step_size: 1.
  # Min and maximum distance in cm parameterisations are generated for (only generated when required to prevent long initial loading time)
  max_d: 2500.
  min_d: 25.
  # VUV group velocity in cm/ns
  vuv_vgroup_mean: 13.5
  vuv_vgroup_max: 18.
  # Distance in cm from "Landau + Expo" -> "Single Landau" model
  inflexion_point_distance: 400.

  # angular bin size in deg, must correspond to parameterisation set 
  angle_bin_timing_vuv: 45
}

# VISIBLE/REFLECTED LIGHT: TIMING PARAMETERISATION
# DUNE-SP
Distances_refl_dune: [38, 63, 88, 113, 138, 163, 188, 213, 238, 263, 288, 313, 338, 353, 358]
Distances_radial_refl_dune: [9.9, 155.0, 253.8, 360.4, 493.2, 594.6, 695.0, 793.2, 830.7]
Cut_off_dune: [
	[	[238.142, 262.539, 282.467, 304.103, 313.013, 337.946, 351.788, 370.942, 376.018, 399.713, 402.083, 408.105, 417.89, 412.451, 411.424],
		[234.078, 262.073, 276.731, 296.061, 311.584, 335.31, 343.996, 359.014, 388.386, 382.394, 405.658, 389.855, 391.849, 417.002, 391.142],
		[233.826, 252.701, 276.161, 295.549, 310.688, 335.343, 333.014, 337.877, 356.375, 365.452, 402.048, 391.411, 387.041, 413.637, 398.582],
		[225.568, 247.426, 269.423, 286.49, 303.236, 312.539, 326.313, 352.405, 354.358, 365.515, 378.07, 386.568, 398.617, 402.382, 395.867],
		[206.919, 228.745, 245.808, 264.952, 278.443, 288.442, 310.195, 322.811, 338.748, 343.625, 353.131, 355.457, 366.05, 369.961, 378.918],
		[195.67, 212.402, 231.2, 246.909, 260.37, 281.104, 290.402, 307.977, 319.123, 326.379, 335.987, 353.426, 346.63, 361.703, 363.194],
		[179.417, 194.449, 215.019, 226.811, 243.818, 255.429, 269.983, 283.393, 295.032, 322.433, 315.948, 318.471, 334.817, 334.004, 326.318],
		[154.088, 172.471, 186.44, 202.967, 218.924, 230.281, 238.207, 258.663, 271.877, 286.323, 291.957, 311.479, 303.508, 312.419, 309.705],
		[149.199, 155.503, 178.764, 184.767, 202.839, 224.528, 215.482, 254.813, 263.972, 284.013, 267.734, 296.432, 262.43, 290.437, 297.707]
	],
	[	[246.114, 267.915, 289.986, 310.104, 324.638, 338.566, 350.776, 359.952, 376.386, 397.82, 394.869, 401.497, 405.346, 414.755, 415.781],
		[241.62, 263.039, 289.868, 305.077, 313.714, 340.302, 356.721, 357.657, 371.048, 380.499, 398.234, 418.922, 405.413, 409.476, 417.102],
		[235.542, 261.916, 282.016, 291.492, 310.319, 327.492, 344.385, 347.677, 365.039, 377.724, 381.374, 386.969, 401.347, 400.177, 392.453],
		[231.138, 253.043, 267.715, 288.464, 302.387, 319.26, 336.987, 348.065, 356.25, 367.535, 380.868, 392.95, 401.268, 393.072, 398.283],
		[209.369, 229.45, 250.276, 264.609, 278.103, 297.421, 307.095, 318.774, 334.469, 347.171, 355.64, 367.906, 371.06, 370.87, 362.123],
		[196.244, 215.249, 230.764, 250.963, 266.498, 279.546, 291.107, 303.001, 318.605, 328.869, 342.382, 359.313, 366.458, 369.223, 358.119],
		[184.429, 199.611, 215.199, 233.223, 248.347, 259.588, 273.831, 280.22, 301.123, 309.877, 324.337, 322.588, 336.158, 348.089, 342.262],
		[163.799, 173.141, 186.3, 209.323, 218.793, 239.084, 248.589, 263.359, 280.873, 296.201, 302.956, 300.096, 338.428, 320.21, 347.723],
		[159.08, 168.789, 187.417, 191.038, 210.331, 228.405, 242.7, 236.532, 269.892, 260.173, 294.648, 297.787, 275.243, 302.138, 290.968]
	],
	[	[250.152, 271.721, 292.124, 311.523, 329.303, 343.734, 362.045, 366.858, 382.884, 400.433, 406.645, 409.91, 417.259, 428.088, 407.686],
		[252.276, 275.258, 288.838, 310.399, 327.316, 339.202, 351.951, 368.195, 375.032, 393.038, 393.904, 404.939, 417.412, 420.595, 422.597],
		[251.722, 266.857, 286.031, 308.488, 323.711, 346.602, 343.121, 357.83, 374.251, 381.872, 372.149, 387.304, 409.728, 411.447, 410.004],
		[240.087, 259.048, 275.438, 295.691, 305.374, 326.708, 336.045, 348.531, 358.766, 373.367, 382.088, 387.178, 391.358, 405.445, 395.087],
		[224.314, 240.819, 254.926, 275.897, 288.594, 299.172, 314.15, 330.417, 336.821, 344.778, 365.24, 371.447, 385.373, 375.14, 374.112],
		[205.355, 224.417, 239.403, 258.428, 271.66, 287.509, 297.811, 313.956, 320.703, 334.091, 344.374, 361.311, 366.204, 365.306, 367.546],
		[190.018, 208.128, 221.75, 239.984, 252.689, 266.927, 274.063, 294.34, 301.445, 320.925, 322.24, 323.328, 341.146, 346.377, 349.755],
		[170.674, 189.917, 202.617, 213.842, 236.233, 248.568, 258.162, 262.287, 276.896, 294.559, 316.76, 324.476, 311.464, 327.771, 331.841],
		[169.668, 183.312, 187.508, 200.981, 212.417, 236.757, 269.173, 245.208, 258.3, 271.882, 295.175, 301.368, 339.273, 303.657, 369.413]
	],
	[	[268.411, 287.711, 310.138, 327.283, 341.435, 357.335, 362.876, 376.574, 393.192, 405.168, 411.973, 415.355, 441.712, 432.722, 418.311],
		[266.584, 286.971, 305.596, 320.476, 337.923, 351.821, 366.981, 374.848, 385.234, 393.006, 404.982, 413.931, 425.926, 421.121, 425.801],
		[261.993, 280.575, 299.544, 318.33, 325.544, 344.972, 356.23, 373.51, 387.219, 396.378, 398.942, 411.78, 411.588, 415.474, 421.921],
		[252.691, 272.887, 290.423, 307.003, 321.859, 335.324, 348.868, 359.32, 369.915, 382.051, 390.864, 399.574, 406.162, 413.715, 408.825],
		[231.161, 250.362, 267.743, 282.66, 299.151, 311.695, 325.55, 339.417, 342.855, 360.101, 366.804, 376.354, 385.595, 383.735, 387.496],
		[223.802, 242.346, 258.778, 274.166, 289.391, 302.706, 314.21, 326.552, 339.073, 346.064, 358.127, 368.062, 370.487, 380.508, 379.736],
		[209.682, 226.531, 241.313, 256.21, 264.927, 281.465, 295.416, 309.286, 321.698, 328.597, 337.654, 353.108, 351.508, 359.492, 361.487],
		[187.512, 201.319, 218.477, 233.414, 244.586, 256.582, 279.252, 279.741, 295.446, 293.343, 320.52, 336.582, 339.989, 343.045, 340.432],
		[180.437, 197.944, 213.83, 224.059, 234.645, 247.69, 267.21, 282.661, 286.906, 313.713, 293.626, 312.821, 325.558, 328.303, 321.306]
	],
	[	[289.914, 310.613, 329.894, 346.834, 362.554, 372.419, 384.793, 393.546, 402.812, 411.007, 419.004, 430.365, 441.083, 441.259, 437.297],
		[286.756, 307.854, 324.357, 340.695, 354.491, 364.467, 379.269, 391.891, 402.363, 408.025, 419.366, 428.493, 434.019, 440.659, 436.065],
		[279.033, 296.285, 313.944, 331.667, 345.103, 354.968, 369.805, 382.226, 386.45, 396.353, 400.613, 407.224, 424.528, 432.519, 432.064],
		[273.681, 292.67, 310.219, 324.72, 342.19, 353.709, 365.811, 377.256, 386.862, 394.211, 401.592, 409.289, 416.512, 419.69, 423.459],
		[252.821, 275.881, 290.547, 305.052, 318.76, 335.804, 344.923, 356.796, 366.782, 381.396, 387.095, 399.874, 405.188, 395.59, 396.829],
		[241.638, 258.4, 275.728, 290.884, 304.633, 317.739, 328.808, 340.59, 348.825, 362.143, 368.125, 377.143, 385.422, 385.222, 386.957],
		[226.83, 244.956, 259.492, 274.426, 289.393, 302.835, 314.495, 322.783, 335.687, 355.561, 357.564, 357.478, 371.557, 378.319, 370.383],
		[212.082, 228.509, 236.565, 253.59, 267.431, 283.445, 284.471, 304.654, 296.006, 315.46, 308.214, 337.028, 363.737, 356.049, 373.881],
		[196.033, 212.916, 223.279, 251.964, 242.766, 263.733, 291.691, 279.277, 297.816, 324.128, 314.101, 307.537, 333.769, 315.3, 342.75]
	],
	[	[317.145, 339.108, 351.234, 370.602, 384.28, 396.29, 409.31, 413.407, 421.532, 434.873, 439.394, 443.384, 451.087, 456.285, 457.325],
		[315.413, 335.463, 348.423, 362.104, 377.276, 389.744, 403.802, 411.179, 422.892, 432.348, 438.45, 441.921, 448.542, 452.471, 451.429],
		[305.073, 328.132, 342.54, 362.058, 375.405, 385.718, 393.883, 408.134, 414.017, 418.398, 429.967, 435.605, 443.127, 440.059, 443.341],
		[300.377, 320.323, 338.408, 353.011, 366.344, 379.359, 389.862, 399.703, 411.283, 420.3, 424.452, 432.673, 434.343, 444.682, 440.862],
		[287.98, 307.368, 323.144, 334.702, 354.845, 362.485, 376.778, 389.867, 390.533, 407.059, 409.517, 425.574, 422.651, 423.41, 429.774],
		[276.238, 294.784, 309.133, 324.364, 337.144, 350.274, 361.762, 373.534, 382.108, 391.929, 401.297, 405.202, 413.818, 419.689, 416.02],
		[262.281, 279.619, 295.647, 310.085, 319.474, 334.1, 341.682, 356.275, 365.639, 373.632, 379.667, 386.258, 401.139, 396.662, 401.901],
		[245.975, 256.794, 270.759, 286.402, 294.829, 310.752, 311.267, 339.42, 343.369, 350.604, 366.277, 361.594, 368.364, 355.674, 369.305],
		[235.344, 257.089, 258.486, 281.143, 284.383, 303.073, 306.858, 326.585, 338.617, 321.156, 322.864, 329.046, 359.368, 355.674, 369.305]
	],
	[	[334.426, 352.052, 370.23, 385.701, 403.089, 408.619, 422.697, 433.641, 439.893, 445.838, 454.844, 458.215, 476.382, 464.554, 470.144],
		[340.243, 356.894, 377.823, 394.276, 405.493, 419.526, 434.314, 440.167, 443.042, 458.305, 468.73, 465.418, 472.132, 470.263, 462.614],
		[339.215, 362.833, 378.653, 395.823, 407.574, 422.286, 436.592, 441.063, 452.994, 456.981, 467.009, 470.162, 469.083, 459.116, 467.666],
		[344.218, 361.56, 381.444, 395.986, 411.238, 423.926, 432.097, 440.824, 447.115, 453.197, 458.719, 456.588, 457.549, 456.965, 458.706],
		[329.449, 354.474, 368.595, 384.864, 398.536, 404.866, 418.107, 418.085, 423.491, 437.099, 437.718, 438.779, 426.195, 417.562, 433.152],
		[318.299, 340.232, 356.692, 372.494, 381.415, 389.127, 399.887, 407.163, 416.273, 425.423, 425.546, 424.873, 427.99, 421.374, 426.463],
		[304.056, 324.602, 339.293, 354.503, 368.104, 371.605, 380.829, 394.825, 400.773, 399.075, 404.887, 395.319, 435.121, 421.374, 426.463],
		[289.905, 307.94, 320.584, 333.673, 342.04, 355.414, 350.113, 355.944, 374.679, 361.003, 344.637, 344.637, 344.637, 344.637, 344.637],
		[275.799, 301.852, 298.569, 322.502, 323.555, 313.801, 355.564, 356.182, 352.22, 361.003, 344.637, 344.637, 344.637, 344.637, 344.637]
	],
	[	[334.426, 352.052, 370.23, 385.701, 403.089, 408.619, 422.697, 433.641, 439.893, 445.838, 454.844, 458.215, 476.382, 464.554, 470.144],
		[340.243, 356.894, 377.823, 394.276, 405.493, 419.526, 434.314, 440.167, 443.042, 458.305, 468.73, 465.418, 472.132, 470.263, 462.614],
		[365.256, 359.335, 415.055, 443.803, 424.261, 416.686, 440.291, 418.294, 444.172, 459.347, 468.73, 465.418, 472.132, 470.263, 462.614],
		[360.086, 378.063, 406.997, 424.072, 432.338, 440.556, 433.113, 452.443, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[353.058, 373.677, 388.688, 397.716, 412.013, 421.769, 428.094, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[345.571, 367.631, 372.833, 394.278, 397.663, 403.512, 434.616, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[334.075, 347.187, 361.561, 384.265, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[317.175, 328.915, 321.654, 347.725, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[297.486, 328.915, 321.654, 347.725, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614]
	],
	[	[334.426, 352.052, 370.23, 385.701, 403.089, 408.619, 422.697, 433.641, 439.893, 445.838, 454.844, 458.215, 476.382, 464.554, 470.144],
		[340.243, 356.894, 377.823, 394.276, 405.493, 419.526, 434.314, 440.167, 443.042, 458.305, 468.73, 465.418, 472.132, 470.263, 462.614],
		[365.256, 359.335, 415.055, 443.803, 424.261, 416.686, 440.291, 418.294, 444.172, 459.347, 468.73, 465.418, 472.132, 470.263, 462.614],
		[360.086, 378.063, 406.997, 424.072, 432.338, 440.556, 433.113, 452.443, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[353.058, 373.677, 388.688, 397.716, 412.013, 421.769, 428.094, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[345.571, 367.631, 372.833, 394.278, 397.663, 403.512, 434.616, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[334.075, 347.187, 361.561, 384.265, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[317.175, 328.915, 321.654, 347.725, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614],
		[297.486, 328.915, 321.654, 347.725, 355.218, 380.568, 357.21, 437.208, 453.272, 454.871, 468.73, 465.418, 472.132, 470.263, 462.614]
	] 
	]
Tau_dune: [
		[	[5.96457, 5.07719, 4.99409, 4.04206, 3.53897, 3.0151, 2.77687, 2.46537, 2.36831, 2.28361, 2.26549, 2.17181, 2.12092, 3.06882, 3.0436],
			[5.80839, 5.17184, 4.87524, 4.17199, 3.46809, 2.91644, 2.75975, 2.56292, 2.26832, 2.21301, 2.24002, 2.28156, 2.1818, 3.1583, 3.04179],
			[5.87934, 5.23502, 5.15792, 4.09652, 3.54772, 3.10177, 2.73277, 2.47171, 2.39474, 2.16523, 2.18489, 1.99915, 2.25365, 2.97022, 3.02243],
			[6.00006, 5.26829, 5.13125, 4.17978, 3.37219, 3.04936, 2.75519, 2.43612, 2.22506, 2.13109, 2.00007, 1.99631, 1.98842, 2.94804, 2.90546],
			[5.95748, 5.05141, 4.91095, 3.8922, 3.22227, 2.68021, 2.41203, 2.0989, 1.85643, 1.73013, 1.61917, 1.64845, 1.63141, 2.7203, 2.67036],
			[5.30483, 4.56571, 4.44116, 3.55242, 2.78611, 2.18762, 2.04502, 1.84214, 1.57797, 1.44502, 1.38835, 1.4049, 1.44472, 2.30442, 2.31722],
			[5.20936, 4.57521, 4.40278, 3.40163, 2.56094, 1.99053, 1.81989, 1.66047, 1.35575, 1.09994, 1.1028, 1.09432, 1.03686, 2.00878, 2.03789],
			[4.71532, 3.72214, 3.64817, 2.99707, 2.30805, 1.50375, 1.09049, 1.15702, 0.905575, 0.803875, 0.682886, 0.569838, 0.564455, 1.61338, 1.34808],
			[4.61481, 3.5, 3.48475, 2.63262, 2.20024, 1.3916, 0.912768, 0.831398, 0.6641, 0.683397, 0.342592, 0.459747, 0.543871, 1.19306, 1.00357]
		],
		[	[6.0354, 5.31897, 5.19515, 4.25833, 3.61615, 3.18563, 2.88475, 2.60235, 2.53525, 2.21919, 2.25335, 2.34856, 2.25909, 3.19966, 3.22475],
			[6.0464, 5.32945, 5.1932, 4.28896, 3.52898, 3.23512, 2.86296, 2.59209, 2.36866, 2.25528, 2.25007, 2.21974, 2.35047, 3.23254, 3.13224],
			[6.11222, 5.35441, 5.16441, 4.24574, 3.68976, 3.23508, 2.83299, 2.63325, 2.27689, 2.15337, 2.09911, 2.17209, 2.2334, 3.15524, 3.07361],
			[6.09937, 5.46468, 5.22791, 4.19851, 3.5083, 3.15777, 2.81754, 2.4285, 2.26929, 2.06762, 1.98974, 2.01879, 2.06496, 3.01153, 2.88765],
			[5.88905, 5.07605, 4.83864, 3.75214, 3.07813, 2.67385, 2.35779, 2.13925, 1.89796, 1.81738, 1.65085, 1.67909, 1.63433, 2.64777, 2.43649],
			[5.2949, 4.677, 4.43335, 3.52238, 2.78443, 2.21877, 2.04896, 1.84461, 1.60476, 1.51221, 1.36126, 1.4131, 1.40436, 2.37343, 2.33066],
			[5.21743, 4.7055, 4.31696, 3.47348, 2.52611, 2.12585, 1.83055, 1.58977, 1.37549, 1.3169, 1.16925, 1.16713, 1.20449, 2.10184, 1.99436],
			[4.82782, 4.04738, 3.91726, 3.02788, 2.32794, 1.45675, 1.27683, 1.16405, 0.9229, 0.780128, 0.703169, 0.60968, 0.714072, 1.50203, 1.37557],
			[4.55414, 3.75576, 3.41954, 2.76907, 2.30544, 0.894174, 0.750302, 0.700783, 0.903002, 0.878854, 0.378455, 0.36607, 0.431089, 1.22243, 1.09718]
		],
		[	[6.30532, 5.60024, 5.34123, 4.38091, 3.72383, 3.2309, 3.00245, 2.67961, 2.53174, 2.42812, 2.27821, 2.26919, 2.26511, 3.41929, 3.25572],
			[6.33204, 5.59122, 5.3709, 4.34319, 3.70327, 3.34205, 2.99071, 2.75068, 2.47161, 2.38718, 2.28385, 2.34122, 2.3472, 3.27431, 3.25456],
			[6.51237, 5.63528, 5.41695, 4.48751, 3.77619, 3.29131, 2.98481, 2.68307, 2.47005, 2.40157, 2.26803, 2.13715, 2.37985, 3.19582, 3.14273],
			[6.38164, 5.69179, 5.39082, 4.39664, 3.63624, 3.27547, 2.88184, 2.48285, 2.31915, 2.18514, 2.10008, 2.10826, 2.11103, 3.05862, 3.01733],
			[6.17303, 5.31955, 5.07852, 4.05035, 3.24062, 2.89892, 2.56912, 2.27691, 2.00998, 1.80968, 1.79265, 1.74122, 1.82872, 2.69963, 2.78144],
			[5.5858, 4.92838, 4.57836, 3.5107, 2.81288, 2.41324, 2.20307, 1.89004, 1.71106, 1.56746, 1.45846, 1.44826, 1.50469, 2.49477, 2.42593],
			[5.51546, 4.93658, 4.58396, 3.4126, 2.60389, 2.19155, 2.02662, 1.68914, 1.42189, 1.36414, 1.17042, 1.10321, 1.24776, 2.0897, 2.03952],
			[5.06723, 4.40759, 4.10753, 3.16073, 2.18927, 1.7288, 1.63416, 1.29918, 0.997631, 0.820509, 0.789512, 0.850946, 0.736224, 1.74511, 1.60892],
			[4.65552, 3.9, 3.64344, 2.54465, 1.80187, 1.31079, 1.33674, 0.891947, 0.593747, 0.4, 0.502183, 0.682269, 0.390691, 1.49123, 1.02849]
		],
		[	[6.75642, 6.06817, 5.87681, 4.80277, 4.23382, 3.75152, 3.30471, 2.95263, 2.71149, 2.57796, 2.44351, 2.54557, 2.41178, 3.53858, 3.48403],
			[6.83135, 6.05778, 5.81198, 4.84431, 4.14284, 3.70326, 3.32696, 2.99773, 2.72409, 2.56572, 2.47494, 2.49247, 2.50532, 3.46651, 3.36307],
			[6.84789, 6.08566, 5.83316, 4.81693, 4.1458, 3.69117, 3.23996, 2.93105, 2.68579, 2.47281, 2.37393, 2.45876, 2.39122, 3.35189, 3.29926],
			[6.84636, 6.08253, 5.69911, 4.6721, 4.08545, 3.58488, 3.12926, 2.74636, 2.54662, 2.31262, 2.2613, 2.26762, 2.25569, 3.19658, 3.18455],
			[6.49128, 5.78555, 5.32809, 4.24672, 3.70856, 3.17328, 2.73308, 2.36785, 2.15334, 1.97175, 1.90532, 1.87916, 1.91024, 2.78953, 2.71248],
			[6.24264, 5.45843, 5.03932, 3.88499, 3.34187, 2.90307, 2.51025, 2.18007, 1.94563, 1.7878, 1.70413, 1.70052, 1.71355, 2.63874, 2.6075],
			[6.01898, 5.22599, 4.75741, 3.61371, 3.08217, 2.68607, 2.2824, 1.87414, 1.66293, 1.4659, 1.3717, 1.42102, 1.38114, 2.37376, 2.21817],
			[5.44261, 4.75737, 4.25017, 3.09949, 2.43497, 2.21826, 1.97049, 1.50531, 1.3505, 1.08725, 1.04406, 1.07537, 0.983351, 2.02946, 1.82382],
			[5.08645, 4.34396, 4.06995, 3.01142, 2.27373, 2.05021, 1.67649, 1.35703, 1.07818, 0.942589, 0.686917, 0.733439, 0.771787, 1.50469, 1.44095]
		],
		[	[7.84001, 7.02445, 6.74358, 5.5386, 4.90811, 4.34112, 3.82917, 3.5689, 3.23996, 2.94809, 2.88278, 2.84453, 2.80638, 4.0044, 4.18463],
			[7.96009, 6.95661, 6.78903, 5.51254, 4.86418, 4.30601, 3.81578, 3.40455, 3.13029, 2.86049, 2.81298, 2.84908, 2.74574, 4.16914, 4.05354],
			[7.64827, 6.54719, 6.17865, 5.2985, 4.59742, 4.02522, 3.50602, 3.14964, 2.90949, 2.70429, 2.57336, 2.5472, 2.47571, 3.54201, 3.61743],
			[7.92974, 6.8201, 6.53271, 5.3015, 4.6803, 4.02622, 3.5493, 3.17292, 2.88242, 2.66675, 2.57216, 2.5529, 2.54433, 3.68363, 3.55278],
			[7.50926, 6.24039, 5.87378, 4.83272, 4.22972, 3.60808, 3.16498, 2.76932, 2.41256, 2.28326, 2.1555, 2.19621, 2.18935, 3.09921, 3.0988],
			[6.90993, 5.82666, 5.38618, 4.41604, 3.76803, 3.19472, 2.75083, 2.46497, 2.16963, 2.00052, 1.92475, 1.89236, 1.95252, 2.86288, 2.78449],
			[6.79507, 5.57163, 5.20405, 4.12369, 3.58091, 2.99103, 2.54424, 2.17971, 2.01767, 1.74572, 1.69754, 1.65578, 1.60057, 2.5256, 2.40649],
			[6.31946, 5.20894, 4.51979, 3.56933, 3.16501, 2.43612, 2.08959, 1.78385, 1.62104, 1.407, 1.39481, 1.20874, 1.09917, 2.25184, 2.24809],
			[5.33467, 4.6119, 4.10264, 3.11051, 2.61035, 2.16347, 1.86028, 1.27061, 1.10083, 0.850165, 0.939195, 0.866033, 0.690194, 1.64104, 1.80895]
		],
		[	[11.9489, 11.6668, 11.4536, 8.75265, 7.29591, 5.8583, 5.18062, 4.55981, 4.05805, 3.69915, 3.63494, 3.67833, 3.57395, 6.25726, 6.16591],
			[11.5272, 10.9288, 10.6557, 7.95326, 6.82772, 5.48559, 4.81446, 4.22457, 3.79079, 3.65687, 3.44221, 3.40137, 3.45342, 5.81608, 5.80147],
			[11.6217, 11.1327, 10.4278, 7.58228, 6.26671, 5.39903, 4.82228, 4.33599, 3.68319, 3.50228, 3.29511, 3.25208, 3.46974, 5.38972, 5.08396],
			[11.3782, 10.8611, 10.2243, 7.33279, 6.34183, 5.13152, 4.48945, 3.99859, 3.55543, 3.29182, 3.15649, 3.1397, 3.21847, 5.20982, 5.26709],
			[10.1716, 9.64567, 8.83558, 6.31549, 5.35836, 4.57666, 4.08414, 3.56821, 3.23444, 2.91008, 2.83799, 2.81835, 2.76454, 4.37497, 4.30567],
			[9.48217, 8.56376, 7.79515, 5.63876, 4.8723, 4.1671, 3.60072, 3.20289, 2.8427, 2.63474, 2.45615, 2.48961, 2.44924, 3.85715, 3.66625],
			[8.46821, 7.57236, 7.05438, 5.13544, 4.3476, 3.70969, 3.22497, 2.79637, 2.51378, 2.30093, 2.18766, 2.15998, 2.01708, 3.32403, 3.09411],
			[7.18484, 5.91973, 5.55348, 4.29947, 3.67089, 3.0072, 2.66158, 2.24491, 2.00604, 1.75675, 1.8134, 1.70376, 1.64657, 2.56667, 2.67337],
			[6.23207, 5.36007, 4.89431, 3.75472, 3.11033, 2.67796, 2.23625, 1.90829, 1.82338, 1.53467, 1.44333, 1.40512, 1.27021, 2.201, 1.92327]
		],
		[	[12.8483, 12.6112, 12.1786, 10.7614, 9.50222, 8.44859, 7.11133, 6.25161, 5.71591, 5.32326, 5.00089, 5.03042, 4.35032, 8.00854, 8.23766],
			[12.7549, 12.3904, 12.0204, 10.9497, 10.2474, 8.7457, 7.96587, 7.32252, 6.306, 5.67946, 5.73712, 5.93768, 5.79708, 8.65708, 8.56371],
			[12.8645, 12.3741, 12.2352, 11.1243, 10.5757, 9.44869, 8.23989, 7.92367, 7.0601, 6.47817, 6.18098, 6.55385, 6.19273, 8.82035, 8.99372],
			[12.6959, 12.2643, 11.8785, 11.114, 10.4208, 9.2111, 8.36877, 7.85155, 7.32856, 6.84506, 6.66631, 7.00608, 6.78541, 8.93225, 8.70316],
			[12.5452, 12.1665, 11.7269, 10.5075, 9.56439, 8.71867, 7.79231, 7.45348, 6.66866, 6.28284, 6.24135, 6.26647, 6.39461, 8.55639, 8.20468],
			[12.0541, 11.3451, 11.0524, 9.65751, 8.7969, 7.42591, 6.70033, 6.20258, 5.65834, 5.27534, 5.27716, 5.42423, 5.26033, 7.49567, 7.41311],
			[11.8893, 11.1326, 10.7512, 8.99326, 7.97202, 6.8874, 5.82871, 5.46771, 4.88342, 4.59128, 4.5547, 4.84998, 4.43973, 6.89836, 6.49232],
			[11.1333, 9.90586, 8.9442, 7.35071, 6.71618, 5.3712, 4.813, 4.33659, 3.7798, 4.04402, 4.32291, 4.15208, 4.78329, 6.53315, 6.18305],
			[9.94244, 8.48604, 8.53327, 6.53562, 5.64959, 4.67588, 4.18134, 3.98564, 3.30388, 2.98186, 2.92041, 3.63641, 4.14041, 6.11911, 5.40965]
		],
		[	[12.8483, 12.6112, 12.1786, 10.7614, 9.50222, 8.44859, 7.11133, 6.25161, 5.71591, 5.32326, 5.00089, 5.03042, 4.35032, 8.00854, 8.23766],
			[12.7549, 12.3904, 12.0204, 10.9497, 10.2474, 8.7457, 7.96587, 7.32252, 6.306, 5.67946, 5.73712, 5.93768, 5.79708, 8.65708, 8.56371],
			[13.4325, 12.4414, 12.0743, 11.6842, 12.2388, 11.4144, 9.28914, 9.97593, 12.2348, 9.23503, 8.62783, 6.85223, 9.81417, 8.79908, 11.2756],
			[12.6473, 12.3558, 12.0081, 11.4888, 11.3523, 10.3128, 10.0266, 10.0789, 9.05136, 9.28551, 8.64309, 8.74761, 8.55587, 9.7955, 9.75475],
			[12.4278, 12.2977, 12.0395, 11.353, 11.5152, 10.5393, 10.037, 9.54046, 9.11765, 8.77425, 8.45984, 8.54731, 7.86723, 9.67888, 9.54721],
			[12.5007, 12.0753, 11.7489, 11.1458, 10.678, 10.0927, 9.50329, 8.96, 8.76761, 8.53607, 7.89683, 7.93522, 7.75269, 9.07914, 8.74846],
			[12.3884, 11.8697, 11.624, 10.8656, 10.6545, 9.59602, 9.52584, 8.67707, 7.70351, 7.24507, 7.2763, 7.02563, 7.10897, 7.90916, 8.13517],
			[12.1068, 11.6689, 11.471, 10.1856, 9.82679, 8.55115, 8.34593, 7.57929, 6.29319, 6.88384, 6.11757, 5.89828, 5.9847, 7.454, 7.15065],
			[12.0139, 11.3105, 10.4283, 9.12612, 9.78714, 7.83548, 7.75834, 6.48438, 6.1277, 5.22, 5.56125, 4.61427, 5.17356, 6.55659, 6.21537]
		],
		[	[12.8483, 12.6112, 12.1786, 10.7614, 9.50222, 8.44859, 7.11133, 6.25161, 5.71591, 5.32326, 5.00089, 5.03042, 4.35032, 8.00854, 8.23766],
			[12.7549, 12.3904, 12.0204, 10.9497, 10.2474, 8.7457, 7.96587, 7.32252, 6.306, 5.67946, 5.73712, 5.93768, 5.79708, 8.65708, 8.56371],
			[13.4325, 12.4414, 12.0743, 11.6842, 12.2388, 11.4144, 9.28914, 9.97593, 12.2348, 9.23503, 8.62783, 6.85223, 9.81417, 8.79908, 11.2756],
			[12.6473, 12.3558, 12.0081, 11.4888, 11.3523, 10.3128, 10.0266, 10.0789, 9.05136, 9.28551, 8.64309, 8.74761, 8.55587, 9.7955, 9.75475],
			[12.4278, 12.2977, 12.0395, 11.353, 11.5152, 10.5393, 10.037, 9.54046, 9.11765, 8.77425, 8.45984, 8.54731, 7.86723, 9.67888, 9.54721],
			[12.5007, 12.0753, 11.7489, 11.1458, 10.678, 10.0927, 9.50329, 8.96, 8.76761, 8.53607, 7.89683, 7.93522, 7.75269, 9.07914, 8.74846],
			[12.3884, 11.8697, 11.624, 10.8656, 10.6545, 9.59602, 9.52584, 8.67707, 7.70351, 7.24507, 7.2763, 7.02563, 7.10897, 7.90916, 8.13517],
			[12.1068, 11.6689, 11.471, 10.1856, 9.82679, 8.55115, 8.34593, 7.57929, 6.29319, 6.88384, 6.11757, 5.89828, 5.9847, 7.454, 7.15065],
			[12.0139, 11.3105, 10.4283, 9.12612, 9.78714, 7.83548, 7.75834, 6.48438, 6.1277, 5.22, 5.56125, 4.61427, 5.17356, 6.55659, 6.21537]
		]
	]

dune_vis_timing_parameterization:
{
  # Timing parameterisation:
  #
  # Smearing parameters
  Distances_refl: @local::Distances_refl_dune
  Distances_radial_refl: @local::Distances_radial_refl_dune
  Cut_off: @local::Cut_off_dune
  Tau: @local::Tau_dune

  # vis velocity in cm/ns
  vis_vmean: 23.99
  
  # angular bin size in deg, must correspond to parameterisation set 
  angle_bin_timing_vis: 10
}


# VUV/DIRECT LIGHT: NUMBER OF HITS CORRECTIONS UPDATED MODEL
# DUNE-SP Gaisser-Hillas 
# Note: corrections include effects of fully simulated wire planes  

# Argon - default
GH_PARS_RS100cm_flat_dune: [ [1.23286, 1.20491, 1.1597, 1.08148, 0.986607, 0.868075, 0.725637, 0.633551, 0.469717],
    						 [150.325, 150.109, 156.294, 169.271, 179.642, 212.9, 232.173, 226.557, 215.166],
			     			 [19.0558, 18.8478, 18.8757, 18.7149, 50.8662, 49.2247, 57.6717, 157.92, 172.494],
			    			 [-3000, -3000, -3000, -3000, -1000, -1000, -1000, -100, -100] ]
GH_border_RS100cm_angulo_flat_dune: [5, 15, 25, 35, 45, 55, 65, 75, 85]
GH_border_RS100cm_flat_dune: [ [-9.63855e-05, -6.82604e-05, -9.63478e-05, -0.000121181, -0.000126611, -0.000115481, -8.61492e-05, -0.000112594, -7.80935e-05],
							   [-0.0662469, -0.0504497, -0.0596321, -0.0418021, -0.0342462, -0.0531668, -0.0522639, -0.0578887, -0.0591081],
							   [-0.00593207, -0.00672713, -0.0020843, -0.00216374, 0.00901291, 0.00385402, 0.0066081, 0.0341547, 0.0446519] ]

dune_vuv_RS100cm_hits_parameterization:
{
 FlatPDCorr: true
 GH_PARS_flat: @local::GH_PARS_RS100cm_flat_dune
 GH_border_angulo_flat: @local::GH_border_RS100cm_angulo_flat_dune
 GH_border_flat: @local::GH_border_RS100cm_flat_dune
 
 DomePDCorr: false

 delta_angulo_vuv: 10

 PMT_radius: 10.16
}

# Xenon
GH_PARS_Xenon_flat_dune: [ [0.959653, 0.92975, 0.874812, 0.790038, 0.685581, 0.566253, 0.433698, 0.31073, 0.197959],
  						   [94.2397, 94.5496, 104.245, 139.412, 189.763, 192.723, 340.598, 501.523, 503.954],
  						   [385.308, 413.922, 405.968, 371.839, 330.268, 484.33, 513.097, 512.926, 253.092],
  						   [-400, -400, -400, -400, -400, -400, -400, -400, -400] ]

GH_border_Xenon_angulo_flat_dune: [5, 15, 25, 35, 45, 55, 65, 75, 85]
GH_border_Xenon_flat_dune: [ [0.000212425, 0.000200659, 0.000179874, 0.000165088, 0.00015168, 0.000122913, 8.94813e-05, 3.98645e-05, 1.24325e-13],
							 [0.151348, 0.168286, 0.153929, 0.12419, 0.0834517, 0.0955464, -0.0175567, -0.112032, -1.98752e-10],
							 [-0.114771, -0.19272, -0.182644, -0.130611, -0.115369, -0.279817, -0.276752, -0.294378, 0.0783223] ]

dune_vuv_Xenon_hits_parameterization:
{
 FlatPDCorr: true
 GH_PARS_flat: @local::GH_PARS_Xenon_flat_dune
 GH_border_angulo_flat: @local::GH_border_Xenon_angulo_flat_dune
 GH_border_flat: @local::GH_border_Xenon_flat_dune
 
 DomePDCorr: false

 delta_angulo_vuv: 10

 PMT_radius: 10.16
}


# VIS/REFLECTED LIGHT: NUMBER OF HITS CORRECTIONS & PARAMETERS
# DUNE-SP Parameters
# Note: corrections include effects of fully simulated wire planes  

# Argon - default  
VIS_distances_x_flat_dune_argon: [3, 13, 38, 63, 88, 113, 138, 163, 188, 213, 238, 263, 288, 313, 338, 353]
VIS_distances_r_flat_dune_argon: [54.1115, 154.253, 269.706, 367.262, 496.739, 605.581, 693.216, 782.765, 862.208]

VIS_correction_flat_dune_argon: [ 
	[ [1.67995, 1.5023, 1.20657, 1.02106, 0.882746, 0.776639, 0.695785, 0.629938, 0.582714, 0.545081, 0.515464, 0.493708, 0.472181, 0.45963, 0.439441, 0.419622],
	  [1.68963, 1.51982, 1.23126, 1.03816, 0.900409, 0.796292, 0.713189, 0.649865, 0.602912, 0.564819, 0.539057, 0.517199, 0.505427, 0.492089, 0.481653, 0.449229],
	  [1.73304, 1.55607, 1.26007, 1.07054, 0.934781, 0.832277, 0.759501, 0.704314, 0.658422, 0.627825, 0.606923, 0.591168, 0.584167, 0.580226, 0.563891, 0.529764],
	  [1.78193, 1.60802, 1.31866, 1.1289, 0.9946, 0.893599, 0.81836, 0.762132, 0.722593, 0.690561, 0.67056, 0.655973, 0.654003, 0.647708, 0.640756, 0.605073],
	  [1.96176, 1.77259, 1.47397, 1.2754, 1.13531, 1.02732, 0.942267, 0.880779, 0.828975, 0.794916, 0.771843, 0.751323, 0.74329, 0.744061, 0.733977, 0.70005],
	  [2.21549, 2.04521, 1.72647, 1.48965, 1.31053, 1.17082, 1.06559, 0.98202, 0.921138, 0.873365, 0.841385, 0.81795, 0.807915, 0.803652, 0.795182, 0.753378],
	  [2.3808, 2.20671, 1.89092, 1.64262, 1.4475, 1.29706, 1.17708, 1.08489, 1.01635, 0.962341, 0.926461, 0.904984, 0.894703, 0.894324, 0.890895, 0.844522],
	  [2.7039, 2.5078, 2.18003, 1.93111, 1.71334, 1.54146, 1.39972, 1.29637, 1.19956, 1.13696, 1.08587, 1.04728, 1.03061, 1.03128, 1.04224, 1.06682],
	  [3.28429, 3.14942, 2.81891, 2.46231, 2.13464, 1.86717, 1.63899, 1.46508, 1.32431, 1.22158, 1.13801, 1.07975, 1.04774, 1.0268, 1.00872, 0.934299]	  
	],
	[ [1.61717, 1.45536, 1.18141, 1.00703, 0.877535, 0.778688, 0.700656, 0.640282, 0.593421, 0.554809, 0.526049, 0.504949, 0.486008, 0.471742, 0.454623, 0.438439],
	  [1.63238, 1.47453, 1.21037, 1.02925, 0.896804, 0.79514, 0.717278, 0.658347, 0.611546, 0.575992, 0.548571, 0.52959, 0.516161, 0.505923, 0.495831, 0.470395],
	  [1.67016, 1.50472, 1.23162, 1.05456, 0.927059, 0.833322, 0.761788, 0.709941, 0.667458, 0.638414, 0.61695, 0.600871, 0.595867, 0.589934, 0.576962, 0.547778],
	  [1.72845, 1.56667, 1.29773, 1.1202, 0.992758, 0.898139, 0.826881, 0.772625, 0.73407, 0.70565, 0.685211, 0.673677, 0.669364, 0.665694, 0.661327, 0.62945],
	  [1.93974, 1.75853, 1.4716, 1.28379, 1.14714, 1.04343, 0.963162, 0.902172, 0.851864, 0.820813, 0.796031, 0.78107, 0.77271, 0.768238, 0.767237, 0.738134],
	  [2.11276, 1.94999, 1.65909, 1.44723, 1.28647, 1.16348, 1.0694, 0.995028, 0.937634, 0.896204, 0.86791, 0.850113, 0.843451, 0.841015, 0.839559, 0.805772],
	  [2.27089, 2.10995, 1.82097, 1.60253, 1.42969, 1.2978, 1.18599, 1.10159, 1.03826, 0.991185, 0.957985, 0.940432, 0.930111, 0.936145, 0.929783, 0.895972],
	  [2.675, 2.49434, 2.18241, 1.9411, 1.7415, 1.57744, 1.43963, 1.33051, 1.24657, 1.17447, 1.13066, 1.09834, 1.08741, 1.0859, 1.10706, 1.12759],
	  [2.96947, 2.85863, 2.57822, 2.2702, 1.98558, 1.75909, 1.56001, 1.40263, 1.27867, 1.18196, 1.11067, 1.05927, 1.03217, 1.0172, 0.9976, 0.934535]	  
	],
	[ [1.50825, 1.36889, 1.13392, 0.98191, 0.866922, 0.77688, 0.707548, 0.651111, 0.606337, 0.572121, 0.544768, 0.525048, 0.509095, 0.494043, 0.47836, 0.45858],
	  [1.52415, 1.38959, 1.16104, 1.00319, 0.886744, 0.794913, 0.724086, 0.670173, 0.625644, 0.593862, 0.570216, 0.551808, 0.53998, 0.532302, 0.522777, 0.495825],
	  [1.56948, 1.42471, 1.18729, 1.03115, 0.919158, 0.834466, 0.770977, 0.72419, 0.686219, 0.660066, 0.641763, 0.630002, 0.623834, 0.621193, 0.608531, 0.576298],
	  [1.64288, 1.50027, 1.26387, 1.10682, 0.992256, 0.906822, 0.84274, 0.793871, 0.758439, 0.733316, 0.71634, 0.706797, 0.70469, 0.703601, 0.697613, 0.662949],
	  [1.86287, 1.70058, 1.44341, 1.27538, 1.15264, 1.05872, 0.986552, 0.931587, 0.88889, 0.860201, 0.839109, 0.827028, 0.82099, 0.820279, 0.818245, 0.783072],
	  [1.96894, 1.83178, 1.5845, 1.40403, 1.26573, 1.15779, 1.07672, 1.01293, 0.961107, 0.927483, 0.903816, 0.891158, 0.88809, 0.89041, 0.887703, 0.850857],
	  [2.11486, 1.98106, 1.74011, 1.55249, 1.40211, 1.28869, 1.18925, 1.11334, 1.0575, 1.01646, 0.989677, 0.978543, 0.972021, 0.97899, 0.974276, 0.938631],
	  [2.4422, 2.2967, 2.05021, 1.85131, 1.67819, 1.53385, 1.41887, 1.3196, 1.24542, 1.18909, 1.14934, 1.12965, 1.12177, 1.13114, 1.14473, 1.17223],
	  [2.5988, 2.52471, 2.32597, 2.09048, 1.86465, 1.67534, 1.50487, 1.3751, 1.26983, 1.18503, 1.1275, 1.08634, 1.06218, 1.05617, 1.042, 0.977655]	  
	],
	[ [1.36203, 1.25143, 1.06416, 0.940405, 0.846393, 0.770026, 0.710644, 0.663008, 0.625575, 0.597437, 0.572537, 0.555241, 0.5426, 0.528512, 0.515126, 0.496204],
	  [1.37792, 1.27147, 1.08773, 0.961108, 0.864395, 0.789027, 0.729774, 0.681964, 0.647106, 0.619295, 0.599427, 0.585466, 0.575829, 0.57062, 0.562177, 0.533077],
	  [1.43685, 1.32193, 1.12809, 1.00146, 0.908067, 0.837362, 0.783724, 0.745501, 0.715154, 0.694964, 0.681247, 0.673038, 0.671752, 0.672051, 0.6613, 0.626777],
	  [1.56602, 1.4446, 1.24389, 1.10849, 1.00957, 0.935897, 0.880299, 0.839168, 0.809274, 0.788491, 0.775715, 0.770102, 0.771824, 0.774011, 0.770752, 0.734038],
	  [1.65725, 1.52999, 1.32736, 1.19666, 1.10039, 1.0278, 0.972371, 0.929854, 0.898858, 0.878205, 0.86608, 0.860904, 0.861646, 0.866037, 0.86557, 0.831242],
	  [1.78054, 1.67683, 1.48465, 1.34081, 1.22965, 1.14298, 1.07772, 1.0273, 0.983856, 0.959071, 0.943603, 0.93805, 0.9416, 0.947582, 0.949896, 0.911353],
	  [1.86241, 1.76882, 1.59574, 1.45292, 1.33642, 1.24684, 1.16578, 1.10885, 1.06611, 1.03589, 1.01871, 1.01663, 1.01979, 1.03478, 1.04109, 0.997536],
	  [2.02194, 1.92338, 1.76362, 1.63216, 1.522, 1.41935, 1.33986, 1.27154, 1.22612, 1.18624, 1.16734, 1.16245, 1.16453, 1.18303, 1.20928, 1.24244],
	  [2.1917, 2.15394, 2.03866, 1.88331, 1.71926, 1.57749, 1.44916, 1.34803, 1.26762, 1.20227, 1.16045, 1.13188, 1.12252, 1.12368, 1.11628, 1.04992]	  
	],
	[ [1.21192, 1.12501, 0.981162, 0.886385, 0.81395, 0.755101, 0.708174, 0.671753, 0.641806, 0.61953, 0.602772, 0.590021, 0.580067, 0.570257, 0.558218, 0.538113],
	  [1.23759, 1.15185, 1.01135, 0.912632, 0.836856, 0.778859, 0.73174, 0.695823, 0.668569, 0.649014, 0.634208, 0.625161, 0.621106, 0.617743, 0.612021, 0.582028],
	  [1.3372, 1.24048, 1.08385, 0.981411, 0.906339, 0.850626, 0.809228, 0.780127, 0.757369, 0.744707, 0.737064, 0.735092, 0.739165, 0.743367, 0.733825, 0.697567],
	  [1.39625, 1.3, 1.14429, 1.04039, 0.966035, 0.911477, 0.870675, 0.841821, 0.823572, 0.812433, 0.809316, 0.811214, 0.81902, 0.827248, 0.827171, 0.788705],
	  [1.44179, 1.34299, 1.19297, 1.09814, 1.0303, 0.980126, 0.943691, 0.917849, 0.901886, 0.893587, 0.891415, 0.897052, 0.906638, 0.916486, 0.92216, 0.88791],
	  [1.49443, 1.42303, 1.29061, 1.1906, 1.11335, 1.054, 1.01118, 0.977035, 0.952696, 0.941875, 0.937759, 0.942588, 0.955226, 0.97001, 0.976097, 0.937184],
	  [1.59488, 1.52823, 1.40851, 1.31078, 1.22903, 1.1642, 1.1103, 1.07635, 1.05194, 1.03894, 1.03624, 1.0454, 1.0604, 1.08511, 1.09897, 1.0563],
	  [1.6671, 1.60158, 1.50068, 1.41958, 1.35017, 1.28541, 1.23678, 1.2002, 1.1771, 1.16522, 1.15902, 1.17343, 1.19414, 1.22399, 1.26039, 1.28191],
	  [1.80691, 1.78974, 1.73667, 1.63844, 1.53272, 1.43474, 1.34692, 1.27759, 1.22442, 1.1885, 1.16391, 1.15584, 1.16103, 1.1786, 1.18017, 1.11401]	  
	],
	[ [1.15524, 1.07988, 0.958385, 0.879462, 0.818869, 0.77138, 0.734666, 0.705303, 0.6833, 0.667096, 0.655951, 0.649252, 0.643192, 0.63591, 0.623073, 0.601985],
	  [1.1885, 1.11803, 0.996096, 0.912411, 0.849796, 0.800743, 0.762943, 0.734867, 0.71462, 0.699669, 0.692586, 0.688702, 0.689522, 0.690546, 0.68734, 0.654688],
	  [1.21943, 1.14146, 1.01304, 0.930509, 0.872149, 0.830513, 0.800824, 0.780524, 0.769998, 0.764595, 0.76575, 0.771854, 0.779683, 0.788188, 0.783455, 0.74605],
	  [1.20788, 1.1374, 1.016, 0.939093, 0.884635, 0.847011, 0.820966, 0.805591, 0.798819, 0.798217, 0.804501, 0.816042, 0.829053, 0.845455, 0.849412, 0.807885],
	  [1.22609, 1.15651, 1.04232, 0.974567, 0.928931, 0.897108, 0.877528, 0.866212, 0.863744, 0.866935, 0.876967, 0.892472, 0.910572, 0.927446, 0.932572, 0.902381],
	  [1.2411, 1.19224, 1.09978, 1.03027, 0.978537, 0.939776, 0.916201, 0.895056, 0.892352, 0.893211, 0.902722, 0.91799, 0.938479, 0.962924, 0.974229, 0.933753],
	  [1.26582, 1.22115, 1.14423, 1.08429, 1.0345, 0.996373, 0.971323, 0.956652, 0.952058, 0.956109, 0.968782, 0.993272, 1.02211, 1.05529, 1.07656, 1.03333],
	  [1.30958, 1.26597, 1.20323, 1.15558, 1.11544, 1.08319, 1.06375, 1.04858, 1.04532, 1.05349, 1.06848, 1.0941, 1.12702, 1.17656, 1.21581, 1.2369],
	  [1.4037, 1.39983, 1.37779, 1.32183, 1.25879, 1.19901, 1.1496, 1.11269, 1.0877, 1.07653, 1.07314, 1.08548, 1.10827, 1.1378, 1.15578, 1.08895]	  
	],
	[ [1.27426, 1.19175, 1.05934, 0.973038, 0.909823, 0.861483, 0.821608, 0.792506, 0.771765, 0.757368, 0.747217, 0.742414, 0.737547, 0.731485, 0.71678, 0.692145],
	  [1.20255, 1.13089, 1.00916, 0.927784, 0.866592, 0.821308, 0.786168, 0.762307, 0.744728, 0.735681, 0.730353, 0.731412, 0.734882, 0.737942, 0.735619, 0.700012],
	  [1.11775, 1.04616, 0.93068, 0.857827, 0.808068, 0.773642, 0.75082, 0.738697, 0.73243, 0.732565, 0.738754, 0.748695, 0.762565, 0.776194, 0.769628, 0.732771],
	  [1.07179, 1.00731, 0.90292, 0.837423, 0.793408, 0.763976, 0.745886, 0.737359, 0.736678, 0.742324, 0.753317, 0.769762, 0.790495, 0.807173, 0.813678, 0.775096],
	  [1.03601, 0.974732, 0.88131, 0.827123, 0.790807, 0.768682, 0.757436, 0.752386, 0.755774, 0.765491, 0.780436, 0.799704, 0.82227, 0.842884, 0.853788, 0.823337],
	  [1.03307, 0.991846, 0.91548, 0.859529, 0.820516, 0.793129, 0.777652, 0.768362, 0.770054, 0.779399, 0.79407, 0.814441, 0.839751, 0.866729, 0.880961, 0.845997],
	  [1.03008, 0.992874, 0.929713, 0.880949, 0.843799, 0.817422, 0.802006, 0.796185, 0.79869, 0.808495, 0.827176, 0.856709, 0.884164, 0.920383, 0.943264, 0.906534],
	  [1.02415, 0.989935, 0.938482, 0.901237, 0.870795, 0.848773, 0.834976, 0.830254, 0.834168, 0.845807, 0.865375, 0.892356, 0.929334, 0.969198, 1.00822, 1.02599],
	  [1.03957, 1.03493, 1.01538, 0.973857, 0.928619, 0.889948, 0.858456, 0.837881, 0.827436, 0.826027, 0.834931, 0.852386, 0.879559, 0.910994, 0.936875, 0.913504]	  
	],
	[ [1.27426, 1.19175, 1.05934, 0.973038, 0.909823, 0.861483, 0.821608, 0.792506, 0.771765, 0.757368, 0.747217, 0.742414, 0.737547, 0.731485, 0.71678, 0.692145],
	  [1.20255, 1.13089, 1.00916, 0.927784, 0.866592, 0.821308, 0.786168, 0.762307, 0.744728, 0.735681, 0.730353, 0.731412, 0.734882, 0.737942, 0.735619, 0.700012],
	  [1.27204, 1.18739, 1.05069, 0.967695, 0.90854, 0.865532, 0.834186, 0.818909, 0.812163, 0.810419, 0.819609, 0.833564, 0.843202, 0.852653, 0.848203, 0.808108],
	  [1.16399, 1.0912, 0.971812, 0.897956, 0.847812, 0.814007, 0.793112, 0.782349, 0.77974, 0.785083, 0.797298, 0.813708, 0.836949, 0.850748, 0.858756, 0.823327],
	  [1.0813, 1.01036, 0.908115, 0.84808, 0.807807, 0.782758, 0.769239, 0.763294, 0.761293, 0.773114, 0.787471, 0.805788, 0.826063, 0.847037, 0.862569, 0.827133],
	  [1.02045, 0.976022, 0.894052, 0.833797, 0.791417, 0.761919, 0.742856, 0.734295, 0.73183, 0.737728, 0.749916, 0.76965, 0.79265, 0.817232, 0.830053, 0.807644],
	  [0.975507, 0.937157, 0.869956, 0.817599, 0.777362, 0.749731, 0.72941, 0.719385, 0.718641, 0.725071, 0.738938, 0.762324, 0.788287, 0.822578, 0.847537, 0.840179],
	  [0.966222, 0.927697, 0.869503, 0.827392, 0.792519, 0.765055, 0.749054, 0.737671, 0.736818, 0.741364, 0.756918, 0.782049, 0.816928, 0.862733, 0.911826, 0.947701],
	  [0.941417, 0.931757, 0.901292, 0.852774, 0.802177, 0.759511, 0.726692, 0.705822, 0.699634, 0.699843, 0.718528, 0.749023, 0.787584, 0.845292, 0.91141, 0.966078]	  
	],
	[ [1.27426, 1.19175, 1.05934, 0.973038, 0.909823, 0.861483, 0.821608, 0.792506, 0.771765, 0.757368, 0.747217, 0.742414, 0.737547, 0.731485, 0.71678, 0.692145],
	  [1.20255, 1.13089, 1.00916, 0.927784, 0.866592, 0.821308, 0.786168, 0.762307, 0.744728, 0.735681, 0.730353, 0.731412, 0.734882, 0.737942, 0.735619, 0.700012],
	  [1.27204, 1.18739, 1.05069, 0.967695, 0.90854, 0.865532, 0.834186, 0.818909, 0.812163, 0.810419, 0.819609, 0.833564, 0.843202, 0.852653, 0.848203, 0.808108],
	  [1.16399, 1.0912, 0.971812, 0.897956, 0.847812, 0.814007, 0.793112, 0.782349, 0.77974, 0.785083, 0.797298, 0.813708, 0.836949, 0.850748, 0.858756, 0.823327],
	  [1.0813, 1.01036, 0.908115, 0.84808, 0.807807, 0.782758, 0.769239, 0.763294, 0.761293, 0.773114, 0.787471, 0.805788, 0.826063, 0.847037, 0.862569, 0.827133],
	  [1.02045, 0.976022, 0.894052, 0.833797, 0.791417, 0.761919, 0.742856, 0.734295, 0.73183, 0.737728, 0.749916, 0.76965, 0.79265, 0.817232, 0.830053, 0.807644],
	  [0.975507, 0.937157, 0.869956, 0.817599, 0.777362, 0.749731, 0.72941, 0.719385, 0.718641, 0.725071, 0.738938, 0.762324, 0.788287, 0.822578, 0.847537, 0.840179],
	  [0.966222, 0.927697, 0.869503, 0.827392, 0.792519, 0.765055, 0.749054, 0.737671, 0.736818, 0.741364, 0.756918, 0.782049, 0.816928, 0.862733, 0.911826, 0.947701],
	  [0.941417, 0.931757, 0.901292, 0.852774, 0.802177, 0.759511, 0.726692, 0.705822, 0.699634, 0.699843, 0.718528, 0.749023, 0.787584, 0.845292, 0.91141, 0.966078]	  
	]
]

dune_vis_RS100cm_hits_parameterization:
{
 FlatPDCorr: true
 VIS_distances_x_flat: @local::VIS_distances_x_flat_dune_argon
 VIS_distances_r_flat: @local::VIS_distances_r_flat_dune_argon
 VIS_correction_flat:  @local::VIS_correction_flat_dune_argon

 DomePDCorr: false
 
 delta_angulo_vis: 10

 PMT_radius: 10.16
}

# Xenon
VIS_distances_x_flat_dune_xenon: [3, 13, 38, 63, 88, 113, 138, 163, 188, 213, 238, 263, 288, 313, 338, 353]
VIS_distances_r_flat_dune_xenon: [54.1115, 154.253, 269.706, 367.262, 496.739, 605.581, 693.216, 782.765, 862.208]

VIS_correction_flat_dune_xenon: [ 
	[ [1.42292, 1.31942, 1.14314, 1.03354, 0.954893, 0.895668, 0.850742, 0.813135, 0.784575, 0.769604, 0.758446, 0.747137, 0.748827, 0.763408, 0.776546, 0.769917],
	  [1.41836, 1.32156, 1.15245, 1.03549, 0.955398, 0.893329, 0.844977, 0.803317, 0.780003, 0.762924, 0.754932, 0.749316, 0.753423, 0.764773, 0.775107, 0.73847],
	  [1.43064, 1.32918, 1.15538, 1.04562, 0.957868, 0.902, 0.858058, 0.82298, 0.798712, 0.783286, 0.772047, 0.764398, 0.775728, 0.790624, 0.797297, 0.75866],
	  [1.46201, 1.36552, 1.20406, 1.09302, 1.01223, 0.951456, 0.905415, 0.868787, 0.844916, 0.826713, 0.817526, 0.824628, 0.829448, 0.83788, 0.832992, 0.824314],
	  [1.61987, 1.52623, 1.38658, 1.22113, 1.1464, 1.07976, 1.02709, 0.986773, 0.953123, 0.935845, 0.913943, 0.91304, 0.915525, 0.925434, 0.93213, 0.955269],
	  [1.89154, 1.78597, 1.64064, 1.48965, 1.38724, 1.29546, 1.21908, 1.16388, 1.11387, 1.08341, 1.06077, 1.04836, 1.05, 1.05101, 1.04239, 0.983244],
	  [2.05023, 1.96241, 1.79936, 1.66012, 1.5446, 1.45309, 1.36128, 1.30031, 1.24959, 1.21221, 1.18766, 1.16757, 1.16475, 1.17336, 1.15028, 1.11875],
	  [2.40085, 2.26858, 2.10522, 1.95488, 1.82863, 1.72549, 1.63033, 1.55232, 1.49184, 1.43598, 1.41357, 1.38856, 1.39596, 1.37445, 1.40755, 1.47731],
	  [3.00131, 2.96722, 2.87576, 2.69863, 2.50406, 2.32312, 2.15486, 2.01486, 1.8907, 1.79851, 1.72108, 1.65956, 1.61751, 1.59252, 1.5179, 1.49579]
	],
	[ [1.37407, 1.2769, 1.11892, 1.02321, 0.954931, 0.900042, 0.86009, 0.828382, 0.803265, 0.789315, 0.775509, 0.768375, 0.775618, 0.786733, 0.805713, 0.810876],
	  [1.36715, 1.28218, 1.12903, 1.02615, 0.954457, 0.896786, 0.854357, 0.817711, 0.797061, 0.784298, 0.773302, 0.773805, 0.780595, 0.796419, 0.810985, 0.788883],
	  [1.37248, 1.28618, 1.12822, 1.03165, 0.953403, 0.905577, 0.865954, 0.833164, 0.812087, 0.797174, 0.790532, 0.78481, 0.794702, 0.811046, 0.826019, 0.800091],
	  [1.41499, 1.33017, 1.18144, 1.08634, 1.01416, 0.959179, 0.918611, 0.886187, 0.862766, 0.847704, 0.843878, 0.850882, 0.85918, 0.868345, 0.872051, 0.872198],
	  [1.60827, 1.5209, 1.40127, 1.23055, 1.16318, 1.09904, 1.05255, 1.01438, 0.986219, 0.967248, 0.94471, 0.946333, 0.954531, 0.96617, 0.985107, 1.00816],
	  [1.79109, 1.69186, 1.56698, 1.43749, 1.34995, 1.27419, 1.20955, 1.16172, 1.12054, 1.09672, 1.08068, 1.07198, 1.07992, 1.07807, 1.0831, 1.04207],
	  [1.94105, 1.86262, 1.72586, 1.61135, 1.51152, 1.43401, 1.35988, 1.30749, 1.26334, 1.23276, 1.2112, 1.19643, 1.19967, 1.20709, 1.18601, 1.1724],
	  [2.38598, 2.2534, 2.10385, 1.96647, 1.85609, 1.75645, 1.67094, 1.59531, 1.53349, 1.4914, 1.46947, 1.45301, 1.4647, 1.44839, 1.4737, 1.55239],
	  [2.72183, 2.68984, 2.63433, 2.50323, 2.34891, 2.2024, 2.06186, 1.93903, 1.8393, 1.75606, 1.69391, 1.6483, 1.60708, 1.58162, 1.50839, 1.48248]
	],
	[ [1.2794, 1.20006, 1.07694, 1.00277, 0.950365, 0.908544, 0.87576, 0.851775, 0.83527, 0.825862, 0.818268, 0.815444, 0.823338, 0.835547, 0.858962, 0.859531],
	  [1.27703, 1.20877, 1.08646, 1.00402, 0.948941, 0.906946, 0.870997, 0.842256, 0.829672, 0.820007, 0.815418, 0.818627, 0.828569, 0.844322, 0.862867, 0.833061],
	  [1.2874, 1.21515, 1.09059, 1.01232, 0.950562, 0.915758, 0.885219, 0.862458, 0.845484, 0.836697, 0.833105, 0.831037, 0.846697, 0.862853, 0.884124, 0.848749],
	  [1.34102, 1.27211, 1.15161, 1.07866, 1.02081, 0.97755, 0.94591, 0.920072, 0.903687, 0.893782, 0.892264, 0.905507, 0.916919, 0.927907, 0.932861, 0.928055],
	  [1.53413, 1.45896, 1.35954, 1.22871, 1.16754, 1.12509, 1.08659, 1.05639, 1.03529, 1.02295, 1.00668, 1.0114, 1.02304, 1.03636, 1.05397, 1.08081],
	  [1.65867, 1.59076, 1.49496, 1.39836, 1.3354, 1.27703, 1.22807, 1.19247, 1.16281, 1.14552, 1.13656, 1.13351, 1.14515, 1.15131, 1.15634, 1.11231],
	  [1.80453, 1.74518, 1.65345, 1.57666, 1.5019, 1.44094, 1.38424, 1.34313, 1.30982, 1.28811, 1.27395, 1.2624, 1.2718, 1.28459, 1.26347, 1.24585],
	  [2.10153, 2.05328, 1.97521, 1.90129, 1.82371, 1.75283, 1.68732, 1.63021, 1.58068, 1.54824, 1.52926, 1.5136, 1.50177, 1.52156, 1.55705, 1.62856],
	  [2.36231, 2.37399, 2.39017, 2.3408, 2.23382, 2.14055, 2.03151, 1.94209, 1.86046, 1.79827, 1.74587, 1.70999, 1.67968, 1.66205, 1.59837, 1.57015]
	],
	[ [1.1587, 1.10258, 1.01763, 0.972936, 0.942476, 0.918824, 0.90139, 0.890344, 0.883709, 0.88271, 0.886015, 0.890102, 0.902704, 0.920961, 0.950356, 0.959914],
	  [1.15581, 1.11106, 1.0278, 0.974191, 0.941421, 0.916465, 0.897497, 0.88092, 0.878494, 0.878512, 0.88354, 0.891103, 0.908239, 0.932995, 0.959165, 0.932838],
	  [1.18233, 1.13225, 1.04602, 0.996879, 0.954006, 0.937118, 0.921234, 0.909001, 0.903469, 0.905103, 0.90932, 0.91506, 0.936128, 0.962579, 0.989865, 0.955045],
	  [1.27987, 1.22599, 1.13806, 1.09147, 1.05338, 1.02533, 1.00669, 0.991285, 0.984225, 0.983176, 0.989949, 1.01319, 1.02911, 1.0466, 1.05565, 1.05465],
	  [1.37098, 1.31428, 1.25887, 1.16969, 1.13438, 1.11293, 1.09334, 1.082, 1.07498, 1.07414, 1.06876, 1.08114, 1.10154, 1.12102, 1.14582, 1.17267],
	  [1.50236, 1.46554, 1.41301, 1.36147, 1.32546, 1.29033, 1.26487, 1.24705, 1.23106, 1.2259, 1.22713, 1.23504, 1.25331, 1.26746, 1.28144, 1.23209],
	  [1.60315, 1.5783, 1.53919, 1.50024, 1.47074, 1.44497, 1.40436, 1.389, 1.372, 1.3651, 1.36882, 1.37046, 1.38737, 1.41173, 1.41223, 1.37083],
	  [1.75648, 1.73054, 1.71033, 1.69857, 1.67488, 1.65189, 1.62651, 1.60748, 1.59238, 1.58493, 1.57967, 1.59267, 1.61092, 1.62596, 1.65529, 1.74053],
	  [2.00571, 2.04056, 2.13422, 2.15003, 2.11537, 2.07883, 2.01903, 1.96674, 1.92093, 1.88048, 1.85433, 1.83814, 1.83025, 1.81992, 1.76921, 1.72067]
	],
	[ [1.04658, 1.00778, 0.95966, 0.942102, 0.936297, 0.934151, 0.935516, 0.940309, 0.949998, 0.962494, 0.977172, 0.990667, 1.01269, 1.03264, 1.07541, 1.09656],
	  [1.05348, 1.02322, 0.974812, 0.949217, 0.941289, 0.936595, 0.935076, 0.933571, 0.948089, 0.959977, 0.977878, 0.996721, 1.02375, 1.05695, 1.09578, 1.07113],
	  [1.11199, 1.07678, 1.02098, 0.99726, 0.977216, 0.981083, 0.982685, 0.987138, 0.995204, 1.00864, 1.02642, 1.0376, 1.07245, 1.10808, 1.1523, 1.11488],
	  [1.1551, 1.11778, 1.07282, 1.04944, 1.03799, 1.02988, 1.02786, 1.03494, 1.04407, 1.05898, 1.07942, 1.09781, 1.13716, 1.16616, 1.19515, 1.18285],
	  [1.20648, 1.16921, 1.15214, 1.10204, 1.08995, 1.09863, 1.10272, 1.11084, 1.12357, 1.14067, 1.15096, 1.17381, 1.20943, 1.23644, 1.2713, 1.30183],
	  [1.28456, 1.26706, 1.26798, 1.25408, 1.25225, 1.25116, 1.25023, 1.25701, 1.26068, 1.27704, 1.2955, 1.31538, 1.34945, 1.37064, 1.39389, 1.34066],
	  [1.38944, 1.38761, 1.39433, 1.40126, 1.40151, 1.40766, 1.40087, 1.40847, 1.41943, 1.43345, 1.45508, 1.48215, 1.51808, 1.55559, 1.57311, 1.5031],
	  [1.46756, 1.46635, 1.4887, 1.5255, 1.54733, 1.56291, 1.5749, 1.59327, 1.60871, 1.62682, 1.65092, 1.68253, 1.72136, 1.75329, 1.78396, 1.8622],
	  [1.66989, 1.72621, 1.86738, 1.94471, 1.96866, 1.98785, 1.97897, 1.97116, 1.96262, 1.96178, 1.96451, 1.97127, 1.98368, 2.00068, 1.9676, 1.88032]
	],
	[ [1.03118, 1.00281, 0.976428, 0.980169, 0.991869, 1.00883, 1.02906, 1.05058, 1.0795, 1.11169, 1.14202, 1.17375, 1.20765, 1.23382, 1.28736, 1.3177],
	  [1.04496, 1.02017, 0.997629, 0.995814, 1.00113, 1.01321, 1.03076, 1.05255, 1.0761, 1.1072, 1.13805, 1.17251, 1.21393, 1.25785, 1.31348, 1.29418],
	  [1.04761, 1.02269, 0.996304, 0.995023, 1.0007, 1.01443, 1.03109, 1.05143, 1.07711, 1.10826, 1.1405, 1.17231, 1.21302, 1.25633, 1.3085, 1.27693],
	  [1.03766, 1.01826, 0.994187, 0.991873, 0.998316, 1.0141, 1.03499, 1.05694, 1.0847, 1.11766, 1.15486, 1.20303, 1.24369, 1.28379, 1.31056, 1.30615],
	  [1.05731, 1.03858, 1.01847, 1.02548, 1.05105, 1.06778, 1.09361, 1.12376, 1.15584, 1.19305, 1.22445, 1.2704, 1.30898, 1.34238, 1.38562, 1.409],
	  [1.10877, 1.10754, 1.14076, 1.15307, 1.18504, 1.20609, 1.22933, 1.25754, 1.28835, 1.32514, 1.36309, 1.39769, 1.45247, 1.49321, 1.52081, 1.46434],
	  [1.1436, 1.15103, 1.18693, 1.22099, 1.25743, 1.29632, 1.31765, 1.35473, 1.39353, 1.4329, 1.48052, 1.53162, 1.58169, 1.64218, 1.67934, 1.59459],
	  [1.19421, 1.20256, 1.25152, 1.317, 1.36939, 1.41774, 1.46407, 1.51032, 1.55923, 1.60923, 1.66674, 1.71655, 1.77754, 1.83076, 1.8659, 1.93086],
	  [1.34172, 1.40313, 1.56572, 1.68537, 1.75519, 1.81807, 1.85753, 1.89438, 1.93073, 1.96484, 2.00243, 2.04032, 2.08798, 2.12176, 2.12229, 2.00869]
	],
	[ [1.16989, 1.14166, 1.11952, 1.12862, 1.15072, 1.1794, 1.21092, 1.24722, 1.28841, 1.33695, 1.38336, 1.42854, 1.47133, 1.49804, 1.54741, 1.60228],
	  [1.10141, 1.07998, 1.06145, 1.06426, 1.08325, 1.10846, 1.13749, 1.16747, 1.20553, 1.25047, 1.29551, 1.34354, 1.40275, 1.45218, 1.51533, 1.50297],
	  [1.01096, 0.991787, 0.971516, 0.976379, 0.991447, 1.0196, 1.05113, 1.08405, 1.12178, 1.1661, 1.21459, 1.25266, 1.3159, 1.36625, 1.42783, 1.38305],
	  [0.969217, 0.952436, 0.942125, 0.952499, 0.972033, 0.996329, 1.02925, 1.06522, 1.10686, 1.1524, 1.20293, 1.26395, 1.32181, 1.3664, 1.3952, 1.38077],
	  [0.947213, 0.934058, 0.939794, 0.941679, 0.973627, 1.00591, 1.04379, 1.08653, 1.13184, 1.1822, 1.22609, 1.28252, 1.33969, 1.38291, 1.42353, 1.43162],
	  [0.974022, 0.978218, 1.02104, 1.04427, 1.08599, 1.11956, 1.15665, 1.20023, 1.24537, 1.2971, 1.34998, 1.39711, 1.46284, 1.52256, 1.55725, 1.50591],
	  [0.983942, 0.997837, 1.03974, 1.0837, 1.12872, 1.17995, 1.21721, 1.26786, 1.3201, 1.37515, 1.43636, 1.50599, 1.57261, 1.639, 1.69817, 1.60824],
	  [0.986637, 1.00021, 1.05809, 1.12605, 1.18612, 1.24586, 1.30626, 1.36646, 1.42805, 1.49162, 1.55908, 1.62912, 1.70098, 1.77127, 1.82632, 1.83638],
	  [1.05328, 1.11283, 1.26775, 1.3846, 1.46585, 1.54778, 1.6025, 1.66216, 1.7191, 1.77506, 1.83249, 1.89588, 1.95564, 2.01094, 2.03729, 1.92352]
	],
	[ [1.16989, 1.14166, 1.11952, 1.12862, 1.15072, 1.1794, 1.21092, 1.24722, 1.28841, 1.33695, 1.38336, 1.42854, 1.47133, 1.49804, 1.54741, 1.60228],
	  [1.10141, 1.07998, 1.06145, 1.06426, 1.08325, 1.10846, 1.13749, 1.16747, 1.20553, 1.25047, 1.29551, 1.34354, 1.40275, 1.45218, 1.51533, 1.50297],
	  [1.18138, 1.14739, 1.12995, 1.13489, 1.15539, 1.18368, 1.21695, 1.25575, 1.29879, 1.35524, 1.41206, 1.46715, 1.5353, 1.58196, 1.64623, 1.61357],
	  [1.07715, 1.05718, 1.04135, 1.0538, 1.07493, 1.10168, 1.13983, 1.17895, 1.22699, 1.2772, 1.33161, 1.41493, 1.47309, 1.51852, 1.54152, 1.53889],
	  [1.02121, 1.00515, 1.03757, 1.0002, 1.03372, 1.07104, 1.11477, 1.15716, 1.20884, 1.26404, 1.30206, 1.36415, 1.43529, 1.4845, 1.53161, 1.54125],
	  [0.991434, 0.993547, 1.04104, 1.06174, 1.09845, 1.13584, 1.17396, 1.22239, 1.26504, 1.32346, 1.38022, 1.4284, 1.49953, 1.55411, 1.60144, 1.5439],
	  [0.958746, 0.973306, 1.01366, 1.05779, 1.09917, 1.14531, 1.18026, 1.23175, 1.28569, 1.33957, 1.40024, 1.45703, 1.52317, 1.60065, 1.64575, 1.56922],
	  [0.958867, 0.972587, 1.02301, 1.08662, 1.14244, 1.19739, 1.25631, 1.31383, 1.37222, 1.43563, 1.50117, 1.56715, 1.63567, 1.70922, 1.76777, 1.7753],
	  [0.986332, 1.04235, 1.18522, 1.29253, 1.36492, 1.43449, 1.4859, 1.53936, 1.59273, 1.64912, 1.70134, 1.7577, 1.81235, 1.86855, 1.89174, 1.80892]
	],
	[ [1.16989, 1.14166, 1.11952, 1.12862, 1.15072, 1.1794, 1.21092, 1.24722, 1.28841, 1.33695, 1.38336, 1.42854, 1.47133, 1.49804, 1.54741, 1.60228],
	  [1.10141, 1.07998, 1.06145, 1.06426, 1.08325, 1.10846, 1.13749, 1.16747, 1.20553, 1.25047, 1.29551, 1.34354, 1.40275, 1.45218, 1.51533, 1.50297],
	  [1.18138, 1.14739, 1.12995, 1.13489, 1.15539, 1.18368, 1.21695, 1.25575, 1.29879, 1.35524, 1.41206, 1.46715, 1.5353, 1.58196, 1.64623, 1.61357],
	  [1.07715, 1.05718, 1.04135, 1.0538, 1.07493, 1.10168, 1.13983, 1.17895, 1.22699, 1.2772, 1.33161, 1.41493, 1.47309, 1.51852, 1.54152, 1.53889],
	  [1.02121, 1.00515, 1.03757, 1.0002, 1.03372, 1.07104, 1.11477, 1.15716, 1.20884, 1.26404, 1.30206, 1.36415, 1.43529, 1.4845, 1.53161, 1.54125],
	  [0.991434, 0.993547, 1.04104, 1.06174, 1.09845, 1.13584, 1.17396, 1.22239, 1.26504, 1.32346, 1.38022, 1.4284, 1.49953, 1.55411, 1.60144, 1.5439],
	  [0.958746, 0.973306, 1.01366, 1.05779, 1.09917, 1.14531, 1.18026, 1.23175, 1.28569, 1.33957, 1.40024, 1.45703, 1.52317, 1.60065, 1.64575, 1.56922],
	  [0.958867, 0.972587, 1.02301, 1.08662, 1.14244, 1.19739, 1.25631, 1.31383, 1.37222, 1.43563, 1.50117, 1.56715, 1.63567, 1.70922, 1.76777, 1.7753],
	  [0.986332, 1.04235, 1.18522, 1.29253, 1.36492, 1.43449, 1.4859, 1.53936, 1.59273, 1.64912, 1.70134, 1.7577, 1.81235, 1.86855, 1.89174, 1.80892]
	]
]

dune_vis_xenon_hits_parameterization:
{
 FlatPDCorr: true
 VIS_distances_x_flat: @local::VIS_distances_x_flat_dune_xenon
 VIS_distances_r_flat: @local::VIS_distances_r_flat_dune_xenon
 VIS_correction_flat:  @local::VIS_correction_flat_dune_xenon

 DomePDCorr: false
 
 delta_angulo_vis: 10

 PMT_radius: 10.16
}

END_PROLOG

BEGIN_PROLOG

##########
# 35 ton #
##########

dune35t_photonvisibilityservice:
{

  NX: 100
  NY: 100
  NZ: 100
  UseCryoBoundary: true

  DoNotLoadLibrary: false

  LibraryBuildJob: false

  LibraryFile: "PhotonPropagation/LibraryData/lib_35ton_v5_20150721.root"

 #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}

dune35t_photonvisibilityservice_buildlib: @local::dune35t_photonvisibilityservice
dune35t_photonvisibilityservice_buildlib.DoNotLoadLibrary: true
dune35t_photonvisibilityservice_buildlib.LibraryBuildJob: true
dune35t_photonvisibilityservice_buildlib.LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"	 







######################
# 1x2x6 SP Workspace #
######################

dune10kt_v1_1x2x6_photonvisibilityservice:
{

  NX: 100
  NY: 100
  NZ: 300
  UseCryoBoundary: true

  DoNotLoadLibrary: false

  LibraryBuildJob: false

  LibraryFile: "PhotonPropagation/LibraryData/lib_dune10kt_v1_1x2x6_20170412.root"
  

 #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}


dune10kt_v2_1x2x6_photonvisibilityservice:                           @local::dune10kt_v1_1x2x6_photonvisibilityservice
dune10kt_v2_1x2x6_photonvisibilityservice.LibraryFile:               "PhotonPropagation/LibraryData/lib_dune10kt_v2_1x2x6_20171113.root"


dune10kt_1x2x6_xe_photonvisibilityservice: {
   
  NX: 100
  NY: 100
  NZ: 300

  # The boundaries of the cryostat are:
  # X = [-379.662, 379.662] cm
  # Y = [-658.099, 699.599] cm
  # Z = [-302.946, 1443.53] cm
  UseCryoBoundary: false
  XMin: 0
  XMax: 379.662
  YMin: -658.09
  YMax: 699.59
  ZMin: -302.946
  ZMax: 1443.5
  ReflectOverZeroX: true

  StoreReflected: false
  StoreReflT0: false
  IncludePropTime: false

  DoNotLoadLibrary: false
  LibraryBuildJob: false

  LibraryFile: "PhotonPropagation/LibraryData/lib_dune10kt_v3_1x2x6_Xe_photonvisibilityservice.root"
}



### Visibility services with ARAPUCAs and reflector foils
dune10kt_1x2x6_refl_v1_photonvisibilityservice: {

   NX: 75
   NY: 125
   NZ: 300

   # The boundaries of the cryostat are:
   # X = [-379.662, 379.662] cm
   # Y = [-658.099, 699.599] cm
   # Z = [-302.946, 1443.53] cm
   UseCryoBoundary: false
   XMin: 0
   XMax: 379.662
   YMin: -658.09
   YMax: 699.59
   ZMin: -302.946
   ZMax: 1443.5
   ReflectOverZeroX: true

   StoreReflected: true
   StoreReflT0: true
   IncludePropTime: false

   DoNotLoadLibrary: false
   LibraryBuildJob: false

   LibraryFile: "PhotonPropagation/LibraryData/lib_dune10kt_v4_1x2x6_withfoils_lib.root"
}


##############
#
# Enable direct and reflected timing parameterization on top of a photon library.
# Works only for DUNE SP.
#
dunesp_library_vuv_vis_prop_timing_photonvisibilityservice:
{
   # This will need to be repalced in dunetpc with
   # dunesp-specific library settings
   @table::dune10kt_1x2x6_refl_v1_photonvisibilityservice

   # Flag to enable time parameterizations
   IncludePropTime: true

   # DUNE-specific VUV timing parameterization
   @table::dune_vuv_timing_parameterization

   # Flag to enable visible light simulation
   StoreReflected: true
   
   # DUNE-specific VIS parameterization
   @table::dune_vis_timing_parameterization

}

#
# Enable direct timing parameterization and Nhits model estimation.
# Works only for DUNE SP.
#
# xenon doped argon case
dunesp_Nhits_vuv_Xe_photonvisibilityservice:
{
   # Flags to enable parameterizations, disable library
   IncludePropTime: false	# timing parameterisation does not exist for Xe doped case
   UseNhitsModel: true
   DoNotLoadLibrary: true

   # Semi-analytic VUV Nhits parameters
   @table::dune_vuv_Xenon_hits_parameterization
}

#
# Enable direct and reflected timing parameterization and Nhits model estimation.
# Works only for DUNE SP.
#
# default case is 100cm Rayleigh scattering length for the VUV light
dunesp_Nhits_vuv_vis_prop_timing_RS100cm_photonvisibilityservice:
{
   # Flags to enable parameterizations, disable library
   IncludePropTime: true
   UseNhitsModel: true
   DoNotLoadLibrary: true

   # DUNE-specific VUV time parameterization
   @table::dune_vuv_timing_parameterization

   # DUNE-specific VUV semi-analytic Nhits parameters
   @table::dune_vuv_RS100cm_hits_parameterization

   # Flag to enable visible light simulation
   StoreReflected: true
 
   # DUNE-specific VIS time parameterization
   @table::dune_vis_timing_parameterization

   # DUNE-specific VIS semi-analytic Nhits parameters
   @table::dune_vis_RS100cm_hits_parameterization

}
# xenon doped argon case
dunesp_Nhits_vuv_vis_Xe_photonvisibilityservice:
{
   # DUNE-SP VUV timing and Nhits settings - note: timing is disabled, parameterisation does not exist for Xe doped case
   @table::dunesp_Nhits_vuv_Xe_photonvisibilityservice

   # Flag to enable visible light simulation
   StoreReflected: true
 
   # DUNE-specific VIS semi-analytic Nhits parameters
   @table::dune_vis_xenon_hits_parameterization
}

##############


# Make a choice here among the above for *the* FD 1x2x6 PVS
# Use the pre-defined DUNE SP configuration for paramterized simulation
# Default case is with 90cm Rayleigh scattering length @ 128nm
dune10kt_1x2x6_photonvisibilityservice: @local::dunesp_Nhits_vuv_vis_prop_timing_RS100cm_photonvisibilityservice

# Make choice here for Xenon doped FD 1x2x6 PVS
# Use pre-defined DUNE SP configuration for paramterized simulation
dune10kt_1x2x6_xenon_photonvisibilityservice: @local::dunesp_Nhits_vuv_vis_Xe_photonvisibilityservice



# Jobs for building libraries:
dune10kt_1x2x6_photonvisibilityservice_buildlib:                  @local::dune10kt_v1_1x2x6_photonvisibilityservice
dune10kt_1x2x6_photonvisibilityservice_buildlib.DoNotLoadLibrary: true
dune10kt_1x2x6_photonvisibilityservice_buildlib.LibraryBuildJob:  true
dune10kt_1x2x6_photonvisibilityservice_buildlib.LibraryFile:      "PhotonPropagation/LibraryData/Not_A_Library.root"

dune10kt_1x2x6_refl_photonvisibilityservice_buildlib:                  @local::dune10kt_1x2x6_refl_v1_photonvisibilityservice
dune10kt_1x2x6_refl_photonvisibilityservice_buildlib.DoNotLoadLibrary: true
dune10kt_1x2x6_refl_photonvisibilityservice_buildlib.LibraryBuildJob:  true
dune10kt_1x2x6_refl_photonvisibilityservice_buildlib.LibraryFile:      "PhotonPropagation/LibraryData/Not_A_Library.root"




##########################
# ProtoDUNE Single Phase #
##########################


protodunev4_photonvisibilityservice:
{

  NX: 100
  NY: 100
  NZ: 100
   
  UseCryoBoundary: true
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "PhotonPropagation/LibraryData/lib_protodune_v4_20171214.root"

  #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}




########################################
# ProtoDUNE Single Phase  with arapucas#
########################################

protodunev7_photonvisibilityservice:
{

  NX: 140
  NY: 120
  NZ: 140
   
  UseCryoBoundary: true
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "PhotonPropagation/LibraryData/lib_Protodunev7_merged_avg.root"

  #These are not used when usecryoboundary=true
  XMin: -120
  XMax: 120
  YMin: -120
  YMax: 120
  ZMin: 0
  ZMax: 1200
}

# Uses a library with fewer voxels for less memory
protodunev7small_photonvisibilityservice: @local::protodunev7_photonvisibilityservice
protodunev7small_photonvisibilityservice.NX: 100
protodunev7small_photonvisibilityservice.NY: 100
protodunev7small_photonvisibilityservice.NZ: 100 
protodunev7small_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_Protodunev7_small.root"


# Uses library with 90cm Rayleigh scattering
protodunev7l90cm_photonvisibilityservice: @local::protodunev7_photonvisibilityservice
protodunev7l90cm_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_Protodunev7_90cm.root"

# Make the v7 visibility service the default

protodune_photonvisibilityservice: @local::protodunev7_photonvisibilityservice





########################
# ProtoDUNE Dual Phase #
########################

protodunedp_photonvisibilityservice_buildlib:
{

  NX: 29
  NY: 24
  NZ: 24
  UseCryoBoundary: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"

 #These are not used when usecryoboundary=true
  XMin: -420.5
  XMax: 304.5
  YMin: -300
  YMax: 300
  ZMin: 0
  ZMax: 600

  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 3
  ParametrisedTimePropagationFittedFormula: "TMath::Landau(x,[0],[1])"
}


protodunedp_photonvisibilityservice: @local::protodunedp_photonvisibilityservice_buildlib
protodunedp_photonvisibilityservice.DoNotLoadLibrary: false
protodunedp_photonvisibilityservice.LibraryBuildJob: false
protodunedp_photonvisibilityservice.Interpolate: true
#protodunedp_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_protodunedp_lightsim_nonuni_20171213.root"
#protodunedp_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_protodunedp_lightsim_20171204.root"
protodunedp_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedp_lightsim_20180420.root"


protodunedp_driftY_photonvisibilityservice:
{
  NX: 25
  NY: 25
  NZ: 25
  UseCryoBoundary: true
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_CRYO_RL91CM_v08_41_01_1e8_25x25x25_20200416.root"
  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 3
  ParametrisedTimePropagationMaxRange: 2000
}

protodunedp_driftY_RL99CM_VUVREF_photonvisibilityservice: @local::protodunedp_driftY_photonvisibilityservice
protodunedp_driftY_RL99CM_VUVREF_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_CRYO_RL99CM_VUVREF_v08_41_01_1e8_25x25x25_20200624.root"

protodunedp_driftY_RL61CM_photonvisibilityservice: @local::protodunedp_driftY_photonvisibilityservice
protodunedp_driftY_RL61CM_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_CRYO_RL61CM_v08_41_01_1e8_25x25x25_20200416.root"


protodunedp_driftY_AV_photonvisibilityservice:
{
  NX: 30
  NY: 30
  NZ: 30
  UseCryoBoundary: true
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  XMin:300    XMax: 300    YMin: -407    YMax: 300    ZMin: 0    ZMax: 600
  LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_AV_RL91CM_v08_41_01_1e8_30x30x30_20200416.root"
  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 3
  ParametrisedTimePropagationMaxRange: 2000
}
protodunedp_driftY_AV_RL61CM_photonvisibilityservice: @local::protodunedp_driftY_AV_photonvisibilityservice
protodunedp_driftY_AV_RL61CM_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_protodunedphase_driftY_AV_RL61CM_v08_41_01_1e8_30x30x30_20200416.root"



####################
# Dual Phase 3x1x1 #
####################

dunedphase3x1x1_photonvisibilityservice_buildlib:
{

  NX: 4
  NY: 4
  NZ: 12
  UseCryoBoundary: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"

 #These are not used when usecryoboundary=true
  XMin: -50
  XMax: 50
  YMin: -50
  YMax: 50
  ZMin: 0
  ZMax: 300

  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 4
  ParametrisedTimePropagationFittedFormula: "TMath::Exp([0]*x) + [2]*TMath::Exp([1]*x)"

}

dunedphase3x1x1_photonvisibilityservice: @local::dunedphase3x1x1_photonvisibilityservice_buildlib
dunedphase3x1x1_photonvisibilityservice.DoNotLoadLibrary: false
dunedphase3x1x1_photonvisibilityservice.Interpolate: true
dunedphase3x1x1_photonvisibilityservice.LibraryBuildJob: false
#dunedphase3x1x1_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_dunedphase3x1x1_lightsim_20171213.root"
dunedphase3x1x1_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_dunedphase3x1x1_lightsim_20171213.root"





#################
# Dual Phase FD #
#################

dunefddphase_photonvisibilityservice_buildlib:
{

  NX: 16
  NY: 16
  NZ: 81
  UseCryoBoundary: false

  DoNotLoadLibrary: true

  LibraryBuildJob: true

  LibraryFile: "PhotonPropagation/LibraryData/Not_A_Library.root"

 #These are not used when usecryoboundary=true
  XMin: -600
  XMax: 600
  YMin: -600
  YMax: 600
  ZMin: 0
  ZMax: 6000

  ParametrisedTimePropagation: false
}


dunefddphase_photonvisibilityservice: @local::dunefddphase_photonvisibilityservice_buildlib
dunefddphase_photonvisibilityservice.DoNotLoadLibrary: false
dunefddphase_photonvisibilityservice.Interpolate: true
dunefddphase_photonvisibilityservice.LibraryBuildJob: false
#dunefddphase_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/lib_FD_300_000_16_16_81.root"
dunefddphase_photonvisibilityservice.UseCryoBoundary: true
dunefddphase_photonvisibilityservice.NX: 15
dunefddphase_photonvisibilityservice.NY: 15
dunefddphase_photonvisibilityservice.NZ: 62
dunefddphase_photonvisibilityservice.ParametrisedTimePropagationMaxRange: 1000
dunefddphase_photonvisibilityservice.ParametrisedTimePropagationNParameters: 3
dunefddphase_photonvisibilityservice.ParametrisedTimePropagation: true
#dunefddphase_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_dunedp_1M_15x15x62_20180913.root"#not use this old library
dunefddphase_photonvisibilityservice.LibraryFile: "PhotonPropagation/LibraryData/libext_dunedp_1M_15x15x62_20181122.root"




####################################
# S2 visibility service parameters #
####################################

dunedphase3x1x1_photonvisibilityserviceS2:
{
  NX: 1
  NY: 4
  NZ: 12
  UseCryoBoundary: false
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "libext_dunedphase3x1x1_lightsim_S2_20171213.root"
 #These are not used when usecryoboundary=true
  XMin: 50
  XMax: 52
  YMin: -50
  YMax: 50
  ZMin: 0
  ZMax: 300
  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 4
}

protodunedp_photonvisibilityserviceS2:
{

  NX: 1
  NY: 24
  NZ: 24
  UseCryoBoundary: false
  DoNotLoadLibrary: false
  LibraryBuildJob: false
  LibraryFile: "libext_protodunedp_lightsim_S2_20171220.root"
 #These are not used when usecryoboundary=true
  XMin: 296
  XMax: 302
  YMin: -300
  YMax: 300
  ZMin: 0
  ZMax: 300
  ParametrisedTimePropagation: true
  ParametrisedTimePropagationNParameters: 3
}

END_PROLOG
BEGIN_PROLOG

# Standard configurations for art's built-in FileCatalogMetadata service.
# Metadata fields are standard, but values are still dune-specific.

art_file_catalog:
{
  # Note sam application name is taken from "process_name" fcl parameter in main job file.
  applicationFamily:   "art"
  applicationVersion:  "development"
  group:               "dune"
  runType:             "physics"
  fileType:            "unknown"
}

art_file_catalog_mc:           @local::art_file_catalog
art_file_catalog_mc.fileType:  "mc"

art_file_catalog_data:           @local::art_file_catalog
art_file_catalog_data.fileType:  "data"

# standard configurations for the TFileMetadataDUNE service

dune_tfile_metadata:
{
  JSONFileName:          "ana_hist.root.json"
  GenerateTFileMetadata: true
  dataTier:              "root-tuple"
  fileFormat:            "root"
}

END_PROLOG
BEGIN_PROLOG

###################################################################
# Added July-2013: These are the parameters/modules associated with
# the MicroBooNE PMT ADCs.
###################################################################

standard_opdigiproperties:
{
  SampleFreq:    64       # ADC sampling frequency in MHz
  TimeBegin:     0        # Where readout frame starts, relative to simulation t0 in micro-seconds
  TimeEnd:       1600     # Where readout frame ends, relative to simulation t0 in micro-seconds

  # Parameter of PMT & shaper
  UseEmpiricalGain:        false # boolean control to load empirical gain or not
  QE:                      0.01  # Quantum efficiency
  DarkRate:                1.e4  # Dark noise rate in Hz
  GainSpread:              0.05  # Intrinsic spread in each PMT's gain in fraction (percentile/100)
  GainSpread_PMT2PMT:      0.05  # PMT-to-PMT spread in the gain mean values in fraction (percentile/100)
  HighGainMean:            20    # ADC count per p.e.
  LowGainMean:             2     # ADC count per p.e.
  
  # Option to provide empirical data files
  HighGainFile:            "OpticalDetector/toyHighGain.txt"   # PMT high gain given in a file
  LowGainFile:             "OpticalDetector/toyLowGain.txt"    # PMT low gain given in a file
  GainSpreadFile:          "OpticalDetector/toyGainSpread.txt" # PMT intrinsic gain spread in a file

  # Parameter of digitizer
  SaturationScale:         4097  # waveform saturation point
  PedFlucRate:             1.e7  # Rate of ADC count fluctuation in Hz
  PedFlucAmp:              1     # Amplitude of ADC count fluctuation
  ADCBaseline:             2048  # ADC Basline
  ADCBaseSpread:           3.4   # ADC Basline mean spread in double
  
  # Parameters for waveform generation
  UseEmpiricalShape: false # true = use text file SPE shape, false = use an analytical model
  WFLength:          2     # Maximum Duration of sahpe sampling period [us]
  PERescale:         0.2   # Rescaling factor to be applied on file input 
  WaveformFile:  "OpticalDetector/toyWaveform.txt" # a toy text file for SPE shape
  
  # Parameters for analytical waveform
  WFPowerFactor:           10    # "(n-1)" factor in shape
  WFTimeConstant:          0.006 # 60 ns
  VoltageAmpForSPE:        0.04  # 40mV/p.e.  
}


standard_opdigiproperties_3windows: @local::standard_opdigiproperties
standard_opdigiproperties_3windows.TimeBegin: -1600
standard_opdigiproperties_3windows.TimeEnd:    4800


standard_opdetresponse:
{
   service_provider:        DefaultOpDetResponse
}


END_PROLOG
BEGIN_PROLOG

PIProv: {
  G4ModuleLabel: "largeant"
  EveIdCalculator: "EmEveIdCalculator"
}
standard_particleinventoryservice: {
  ParticleInventory: @local::PIProv
}

jp250L_particleinventoryservice:     @local::standard_particleinventoryservice
bo_particleinventoryservice:         @local::standard_particleinventoryservice
argoneut_particleinventoryservice:   @local::standard_particleinventoryservice
microboone_particleinventoryservice: @local::standard_particleinventoryservice
#dune35t_particleinventoryservice:    @local::standard_particleinventoryservice
#dunefd_particleinventoryservice:     @local::standard_particleinventoryservice

END_PROLOG


BEGIN_PROLOG

providerPBKConf:{
 G4ModuleLabel:            "largeant" # module that produced the sim::Particle and sim::SimChannel objects
 MinimumHitEnergyFraction: 0.1        # minimum fraction of energy a G4 trackID contributes to a hit to be 
                                      # counted in hit based efficiency and purity calculations
 Delay:                    0          #This number is the difference between when light arrives at the detector, and the time recorded in OpHits. This number is experiment specific and should be set by each experiment. 
}

standard_photonbacktrackerservice:
{
 PhotonBackTracker: @local::providerPBKConf
}

END_PROLOG



BEGIN_PROLOG


#
## dune photon backtracker
#

dune_providerPBKConf:{
   G4ModuleLabel:            "largeant" # module that produced the sim::Particle and sim::SimChannel objects
   MinimumHitEnergyFraction: 0.1        # minimum fraction of energy a G4 trackID contributes to a hit to be
   Delay:                    260          #This number is the difference between when light arrives at the detector, and the time recorded in OpHits. This number is experiment specific and should be set by each experiment.
}

dunefd_photonbacktrackerservice:
{
  PhotonBackTracker: @local::dune_providerPBKConf
}

dune35t_photonbacktrackerservice:
{
  PhotonBackTracker: @local::dune_providerPBKConf
}

##
# FD op det response services, nominal and reference
##

dunefd_opdetresponse_iuradiator:
{
   
   service_provider:        DUNEOpDetResponse
   
   WavelengthCutLow:        0 
   WavelengthCutHigh:       10000
   
   LightGuideAttenuation:   true

   # New IU Radiator Parameters from arXiv:1710.11233
   # Pending a new library to go along with them
   QuantumEfficiency:       0.00287 # 0.0041 * 70% for mesh transmission
   LambdaShort:                4.3 # cm
   LambdaLong:               225.0 # cm
   FracShort:                 0.29
   FracLong:                  0.71
   
   LongAxis:                z
   
   # Convert geometry to readout channels
   # when reading in fast simulation
   ChannelConversion:       fast

   # QE here includes:
   #   Measured response at SiPM end, corrected for 12-SiPM coverage: 0.005
   #   Mesh transmission: 70%
   #   Attenuation in bars already in library response

}

dunefd_opdetresponse_arapuca:
{
   
   service_provider:        DUNEOpDetResponse
   
   QuantumEfficiency:       0.035 # 3.5% efficiency, no corrections
   
   WavelengthCutLow:        0 
   WavelengthCutHigh:       10000
   
   # No light guide attenuation
   LightGuideAttenuation:   false
   LambdaShort:             0
   LambdaLong:              0
   FracShort:               0
   FracLong:                0
   LongAxis:                z
   
   # No need to convert ARAPUCA channels
   ChannelConversion:       none
}

# Use the IU radiator design by default
dunefd_opdetresponse: @local::dunefd_opdetresponse_arapuca
protodune_opdetresponse: @local::dunefd_opdetresponse_iuradiator



##
# 35ton op det response service
##

dune35t_opdetresponse:
{
   service_provider:        DUNE35tonOpDetResponse
   QuantumEfficiency:       0.0023 #0.0016/0.6961, the normalization factor for the bars in DUNE35tOpDetResponse_service
   WavelengthCutLow:        0 
   WavelengthCutHigh:       10000
   LightGuideAttenuation:   true

   LongAxis:                y
   
   # Convert geometry to readout channels
   # when reading in fast simulation
   ChannelConversion:       fast

   # QE here includes:
   #   SiPMQE: 35%
   #   SiPM Coverage: 71%
   #   Surface Conversion: 2% (conservative estimate for new bars)
   #   Mesh transmission: 83%
   #   Attenuation in bars already in library response

}

dunedphase3x1x1_opdigiproperties:
{
  SampleFreq:    250       # ADC sampling frequency in MHz
  TimeBegin:     -200        # Where readout frame starts, relative to simulation t0 in micro-seconds
  TimeEnd:       800     # Where readout frame ends, relative to simulation t0 in micro-seconds
  # Parameter of PMT & shaper
  UseEmpiricalGain:        false # boolean control to load empirical gain or not
  QE:                      0.2  # Quantum efficiency
  DarkRate:                1.7e3  # Dark noise rate in Hz - as stablished in arXiv:1806.04571
  GainSpread:              0.05  # Intrinsic spread in each PMT's gain in fraction (percentile/100)
  GainSpread_PMT2PMT:      0.05  # PMT-to-PMT spread in the gain mean values in fraction (percentile/100)
  HighGainMean:            20    # ADC count per p.e.
  LowGainMean:             2     # ADC count per p.e

  # Option to provide empirical data files
  HighGainFile:            ""   # PMT high gain given in a file
  LowGainFile:             ""    # PMT low gain given in a file
  GainSpreadFile:          "" # PMT intrinsic gain spread in a file
  # Parameter of digitizer
  SaturationScale:         4096  # waveform saturation point
  PedFlucRate:             1.e7  # Rate of ADC count fluctuation in Hz
  PedFlucAmp:              1     # Amplitude of ADC count fluctuation
  ADCBaseline:             100  # ADC Basline
  ADCBaseSpread:           3.4   # ADC Basline mean spread in double

  # Parameters for waveform generation
  UseEmpiricalShape: true # true = use text file SPE shape, false = use an analytical model
  WFLength:          2     # Maximum Duration of sahpe sampling period [us]
  PERescale:         4.1   # Rescaling factor to be applied on file input 4.1 for a gain of 1.e6
  WaveformFile:  "PhotonPropagation/PMTResponse/protoDUNEDP_waveform_20180927.txt" # a toy text file for SPE shape

  # Parameters for analytical waveform
  WFPowerFactor:           10    # "(n-1)" factor in shape
  WFTimeConstant:          0.006 # 60 ns
  VoltageAmpForSPE:        0.04  # 40mV/p.e.
  WaveformChargeNormalized: true
}

protodunedphase_opdigiproperties:           @local::dunedphase3x1x1_opdigiproperties
protodunedphase_opdigiproperties.QE: 0.036  #
protodunedphase_opdigiproperties.SampleFreq: 62.5  #  https://www.caen.it/products/v1740/
protodunedphase_opdigiproperties.TimeBegin: -4000  #
protodunedphase_opdigiproperties.TimeEnd: 4000  #

dunefddphase_opdigiproperties:           @local::dunedphase3x1x1_opdigiproperties
dunefddphase_opdigiproperties.QE: 0.12  # as stablished in arxiv:1807.07123
END_PROLOG
# channelmapping_dune.fcl
#
# David Adams
# May 2016
#
# Configurations for the ChannelMappingService.

BEGIN_PROLOG

# For 35t data, we use the service provided in lbne_raw_data.
dune35t_channelmapping: {
  service_provider:  Dune35tChannelMappingService
}

END_PROLOG
#
# Channel filter service configuration for DUNE
#
#
BEGIN_PROLOG

dune35t_channel_status_may2016: {
# implements IChannelStatusService
service_provider: SimpleChannelStatusService

#THIS IS A LIST OF OFFLINE CHANNEL NUMBERS WHICH SUFFER FROM BAD STUCK CODES, THEY CAN BE ADDED TO THE BAD CHANNEL LIST IF REQUIRED.
#858, 861, 943, 952, 980, 1413, 1442, 1992
#OFFLINE CHANNEL NUMBERS HIGHLIGHTED AS BAD BY DAN WAHL AND AARON. ALSO HAND SELECTED FROM THE EVENT DISPLAY. COLLECTION PLANE CORRECT
#AS OF 05/03.
  BadChannels: [
    4,
   39,
   51,
   84,
   92,
  110,
  120,
  145,
  146,
  204,
  213,
  240,
  357,
  432,
  433,
  446,
  496,
  451,
  500,
  520,
  524,
  530,
  547,
  574,
  575,
  576,
  577,
  578,
  579,
  580,
  581,
  582,
  583,
  611,
  632,
  656,
  657,
  658,
  659,
  660,
  661,
  662,
  663,
  664,
  665,
  666,
  693,
  694,
  730,
  732,
  744,
  809,
  828,
  829,
  830,
  831,
  832,
  833,
  834,
  835,
  836,
  837,
  838,
  839,
  840,
  841,
  842,
  843,
  844,
  845,
  846,
  847,
  848,
  849,
  850,
  851,
  852,
  853,
  854,
  855,
  884,
  886,
  887,
  888,
  889,
  890,
  891,
  892,
  893,
  894,
  895,
  896,
  897,
  898,
  899,
  900,
  901,
  902,
  903,
  904,
  905,
  906,
  907,
  908,
  909,
  910,
  911,
  965,
  992,
  993,
  1021,
  1062,
  1105,
  1134,
  1145,
  1149,
  1206,
  1209,
  1240,
  1259,
  1272,
  1440,
  1461,
  1486,
  1494,
  1495,
  1496,
  1497,
  1498,
  1499,
  1500,
  1501,
  1502,
  1503,
  1504,
  1505,
  1506,
  1507,
  1510,
  1546,
  1555,
  1556,
  1557,
  1558,
  1559,
  1560,
  1561,
  1562,
  1563,
  1564,
  1565,
  1566,
  1567,
  1568,
  1569,
  1570,
  1571,
  1599,
  1607,
  1617,
  1625,
  1646,
  1660,
  1671,
  1679,
  1694,
  1716,
  1717,
  1718,
  1719,
  1720,
  1721,
  1722,
  1723,
  1724,
  1725,
  1726,
  1727,
  1728,
  1729,
  1730,
  1731,
  1732,
  1733,
  1740,
  1741,
  1742,
  1824,
  1825,
  1826,
  1827,
  1828,
  1829,
  1830,
  1831,
  1832,
  1833,
  1834,
  1835,
  1836,
  1837,
  1880,
  1881,
  1882,
  1883,
  1884,
  1885,
  1886,
  1887,
  1888,
  1889,
  1890,
  1891,
  1892,
  1893,
  1894,
  1895,
  1896,
  1897,
  1898,
  1899,
  1900,
  1901,
  1902,
  1903,
  1904,
  1905,
  1906,
  1907,
  1936,
  1950,
  1951,
  1952,
  1953,
  1954,
  1955,
  1956,
  1957,
  1958,
  1959,
  1960,
  1961,
  1962,
  1963,
  2029,
  2034,
  2035,
  2036,
  2037,
  2038,
  2039,
  2040,
  2041,
  2042,
  2043,
  2044,
  2045,
  2046,
  2047
]

#ONLINE CHANNEL NUMBERS HIGHLIGHTED AS BAD BY DAN AND AARON.
#BadChannels: [
#25,   
#27,   
#29,   
#31,	  
#38,   
#63,   
#78,   
#83,   
#85,   
#244,  
#253,  
#262,  
#281,  
#283,  
#285,  
#337,  
#339,  
#341,  
#383,	 
#406,  
#413,  
#415,  
#427,  
#448,  
#449,  
#450,  
#451,  
#464,  
#543,  
#555,  
#589,  
#595,  
#597,	 
#598,  
#631,  
#678,  
#721,  
#723,	 
#751,  
#817,  
#829,  
#851,  
#853,	 
#923,  
#925,  
#927,  
#1083, 
#1091, 
#1094, 
#1107, 
#1109, 
#1155, 
#1193, 
#1194, 
#1206, 
#1209, 
#1222, 
#1307, 
#1356, 
#1363, 
#1365, 
#1435, 
#1469, 
#1475, 
#1492, 
#1495, 
#1520, 
#1559, 
#1563, 
#1565, 
#1567, 
#1584,	
#1606, 
#1619, 
#1621,	
#1659, 
#1665, 
#1675, 
#1678, 
#1680, 
#1682, 
#1686, 
#1693, 
#1695,	
#1696, 
#1707, 
#1708, 
#1711, 
#1726, 
#1727, 
#1742, 
#1743, 
#1744,	
#1758, 
#1775, 
#1786, 
#1787,
#1790,
#1791, 
#1815, 
#1817, 
#1819, 
#1821, 
#1823,	
#1837, 
#1846, 
#1849, 
#1859, 
#1861, 
#1873, 
#1875, 
#1877, 
#1919,	
#1947, 
#1968,	
#1981, 
#1990, 
#2001,	
#2003,	
#2032, 
#2038, 
#2047  
#]		

  NoisyChannels: []
} 

# Bad channel list from David Adams
# January 2017
# Many runs over the course of my dataset list were studied.
# Channels are typically declared bad if any fail.
# Notes made when runs look good before or after power failure.
# Bad channels from the wahl list (above) are retained and have less indentation.
# Annotation:
#   SB - Four-consecutive sticky code fraction is greater than 30%
#   NSB - Four-consectuve non-sticky code repeat fraction is greater than 5%
#   RMS>X - RMS with 3*RMS truncation is greater than X

dune35t_channel_status_dla: {
# implements IChannelStatusService
service_provider: SimpleChannelStatusService

  BadChannels: [
# APA 0u 0-143
       2,   # SB
    4,      # NSB
       9,   # NSB
      31,   # SB
      36,   # RMS>=45
   39,      # RMS=2
   51,      # RMS=1
      65,   # SB
      80,   # RMS>=40
   84,      # RMS=2
      88,   # SB (OK for 2nd half)
      92,   # SB (OK for 2nd half)
   92,      # RMS=2
     100,   # SB
     101,   # SB
     102,   # SB
     103,   # SB
     104,   # SB
     105,   # SB
     106,   # SB
     111,   # RMS>=40
  110,      # RMS=5
     117,   # NSB
  120,
# APA 0v 144-287
  145,      # RMS=3
  146,      # RMS=1
     147,   # RMS>=50
     148,   # NSB
     183,   # SB
  204,      # SB, RMS=2
  213,      # RMS=3
     215,   # SB, RMS=40
     216,   # RMS=6
     217,   # RMS=6
     218,   # RMS=6
     219,   # RMS=40
     238,   # SB (2nd half OK)
     236,   # SB (2nd half OK)
  240,      # RMS=3
     249,   # SB
     252,   # NSB
     253,   # SB
     254,   # SB
     255,   # SB
     256,   # NSB
     257,   # SB
     258,   # SB
     259,   # SB
     260,   # SB
     280,   # SB
     287,   # RMS>=45
# APA 0z1  288-399
     319,   # SB
     346,   # SB (intermittent)
     347,   # SB (intermittent)
     348,   # SB (intermittent)
  357,      # NSB
# APA 0z2  400-511
     400,   # RMS>35
     401,   # RMS>35, sticks on 0x1
     402,   # RMS>35
     403,   # RMS>35
     404,   # RMS>35
     405,   # RMS>35
     406,   # RMS>35
     407,   # RMS>35
     408,   # RMS>35
     409,   # RMS>35
     410,   # RMS>35
     411,   # RMS>35
  432,      # RMS=5
  433,      # RMS=3
     434,   # SB (intermittent)
     441,   # SB (intermittent)
     444,   # SB
  446,      # RMS=5
  451,      # RMS=2
     458,   # SB (intermittent)
     460,   # SB (intermittent)
     469,   # SB (intermittent)
     493,   # SB (intermittent)
  496,      # SB (intermittent), RMS OK
  500,      # RMS=2
# APA 1u  512-655
     513,   # SB
     517,   # SB
  520,      # SB, RMS=0
  524,      # NSB, RMS = 1
  530,      # RMS=2
     533,   # SB
     538,   # SB, RMS=2
     539,   # SB, RMS=1
  547,      # RMS=2
     548,   # SB
     560,   # SB
     561,   # SB
     564,   # SB, RMS>30
     565,   # RMS>30
     566,   # NSB, RMS>50,RMS=1
     567,   # NSB
     568,   # NSB
     569,   # NSB
     560,   # NSB
     571,   # NSB
     572,   # NSB
     573,   # NSB
  574,      # RMS>50
  575,      # RMS>50
  576,      # RMS>50
  577,      # RMS>50
  578,      # RMS>50
  579,      # RMS>50
  580,      # RMS>50
  581,      # RMS>50
  582,      # RMS>50
  583,      # RMS>50
  611,      # RMS=3
     619,   # SB
     620,   # RMS=6
     621,   # RMS=6dd
     622,   # RMS=6
     623,   # SB
     626,   # SB
  632,      # RMS=0
     649,   # SB
     650,   # SB
     651,   # SB
     652,   # SB
     653,   # SB
     654,   # SB
# APA 1v  656-799
  656,      # NSB, RMS>50
  657,      # RMS>50
  658,      # RMS>50
  659,      # RMS>50
  660,      # RMS>50
  661,      # RMS>50
  662,      # RMS>50
  663,      # RMS>50
  664,      # RMS>50
  665,      # RMS>50
  666,      # SB OK, RMS OK
     669,   # SB
     675,   # SB
     692,   # RMS>40
  693,      # SB OK, RMS OK
  694,
     728,   # NSB
     729,   # SB, RMS=3
  730,      # SB, RMS=3
     731,   # SB, RMS=3
  732,      # NSB
     736,   # SB
     738,   # RMS>50 (intermittent)
  744,      # SB OK, RMS OK
     760,   # SB
     771,   # SB (OK for 1st half)
     776,   # SB (OK for 1st half)
     788,   # SB
     792,   # SB
# APA 1z1 800-911
     804,   # SB (OK for 1st half)
  809,      # RMS=1
     819,   # SB
     821,   # SB
     822,   # SB (OK for 1st half)
     826,   # SB
  828,      # RMS=2
  829,      # RMS=2
  830,      # RMS=2
  831,      # RMS=2
  832,      # RMS=2
  833,      # RMS=2
  834,      # RMS=2
  835,      # RMS=2
  836,      # RMS=2
  837,      # RMS=2
  838,      # RMS=2
  839,      # RMS=2
  840,      # RMS=2
  841,      # RMS=2
  842,      # RMS=2
  843,      # RMS=2
  844,      # RMS=2
  845,      # RMS=2
  846,      # RMS=2
  847,      # RMS=2
  848,      # RMS=2
  849,      # RMS=2
  850,      # RMS=2
  851,      # RMS=2
  852,      # RMS=2
  853,      # RMS=2
  854,      # RMS=2
  855,      # RMS=2
     856,   # SB
     857,   # SB
     858,   # SB
     859,   # SB
     860,   # SB
     861,   # SB
     862,   # SB
     863,   # SB
     864,   # SB
     865,   # SB
     866,   # SB
     867,   # SB
     868,   # SB
     869,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
     826,   # SB
  884,      # RMS>50
     885,   # RMS>50
  886,      # RMS>50
  887,      # RMS>50
  888,      # RMS>50
  889,      # RMS>50
  890,      # RMS>50
  891,      # RMS>50
  892,      # RMS>50
  893,      # RMS>50
  894,      # RMS>50
  895,      # RMS>50
  896,      # RMS>50
  897,      # RMS>50
  898,      # RMS>50
  899,      # RMS>50
  900,      # RMS>50
  901,      # RMS>50
  902,      # RMS>50
  903,      # RMS>50
  904,      # RMS>50
  905,      # RMS>50
  906,      # RMS>50
  907,      # RMS>50
  908,      # RMS>50
  909,      # RMS>50
  910,      # RMS>50
  911,      # RMS>50
# APA 1z2 912-1023
     940,   # SB (OK for 1st half)
     943,   # SB
     948,   # SB
     952,   # SB
  965,      # RMS=3
     978,   # SB
     980,   # SB
  992,      # RMS=0
  993,      # RMS=1
    1016,   # SB
  1021,     # RMS=1
    1023,   # SB (OK for 1st half)
# APA 2u 1024-1167
    1025,   # SB
    1026,   # SB
    1047,   # SB (OK for 2nd half of run)
    1051,   # SB (OK for 1st half of run)
    1055,   # SB
    1058,   # NSB
  1062,     # SB OK
    1063,   # SB (OK for 2nd half of run)
    1077,   # SB
    1087,   # SB
    1088,   # SB
    1089,   # SB
    1090,   # SB
    1091,   # SB
    1092,   # SB
    1093,   # SB
    1094,   # SB
    1095,   # NSB
    1097,   # SB OK, RMS=8, missing intermediate freq noise
    1102,   # SB (OK for 2nd half of run)
  1105,     # SB OK
    1122,   # SB (OK for 2nd half of run)
    1126,   # SB (OK for 1st half of run)
  1134,     # NSB
    1141,   # SB
  1145,     # SB OK
  1149,     # SB
    1160,   # SB
    1161,   # SB
    1162,   # SB
    1163,   # SB
    1164,   # SB
    1165,   # SB
    1166,   # SB
# APA 2v 1168-1311
    1169,   # SB
    1170,   # SB
    1171,   # SB
    1172,   # SB
    1173,   # SB
    1174,   # SB
    1175,   # SB
    1176,   # SB
    1189,   # SB, OK for 1st half of run
    1194,   # SB
    1204,   # NSB
    1205,   # SB
  1206,     # wahl, NSB, RMS=2
    1207,   # SB, OK for 1st half of run
    1208,   # NSB
  1209,     # wahl, SB, RMS=8 for run 13843
    1210,   # SB, OK for 2nd half of run
    1211,   # NSB
    1216,   # SB, OK for 2nd half of run
    1217,   # SB, OK for 2nd half of run
    1226,   # SB
  1240,     # wahl, SB OK, RMS=0
    1241,   # SB
    1242,   # SB
    1243,   # SB
    1244,   # SB
    1245,   # SB
    1246,   # SB
    1247,   # SB
    1254,   # SB, OK for 1st half of run
    1255,   # SB, OK for 2nd half of run
  1259,     # wahl, SB OK, RMS=3
  1272,     # wahl, SB OK, RMS=9
    1273,   # SB
    1279,   # SB
    1295,   # SB
    1298,   # SB, OK for 1st half of run
    1299,   # NSB
    1310,   # SB
# APA 2z1 1312-1423
    1312,   # NSB
    1313,   # NSB
    1314,   # NSB
    1315,   # NSB
    1316,   # NSB
    1317,   # NSB
    1318,   # NSB
    1319,   # NSB
    1320,   # NSB
    1321,   # NSB
    1322,   # NSB
    1323,   # NSB
    1324,   # NSB
    1325,   # NSB
    1340,   # SB
    1358,   # SB, OK for 2nd half of run
    1378,   # SB
    1382,   # SB
    1388,   # SB
    1397,   # SB, OK for 1st half of run
    1407,   # SB, OK for 1st half of run
    1413,   # SB, OK for 2nd half of run
    1421,   # SB
# APA 2z2 1424-1535
    1430,   # SB, OK for 1st half of run
    1439,   # SB
    1439,   # SB
  1440,     # wahl, SB
    1442,   # SB
    1447,   # SB, OK for 1st half
    1450,   # SB
    1458,   # SB
  1461,
    1468,   # SB, OK for 1st half of run
    1472,   # SB, OK for 1st half of run
    1472,   # SB
    1478,   # SB
  1486,     # wahl, SB
  1494,     # wahl, RMS low and jumpy
  1495,     # wahl, RMS low and jumpy
  1496,     # wahl, RMS low and jumpy
  1497,     # wahl, RMS low and jumpy
  1498,     # wahl, RMS low and jumpy
  1499,     # wahl, RMS low and jumpy
  1500,     # wahl, RMS low and jumpy
  1501,     # wahl, RMS low and jumpy
  1502,     # wahl, RMS low and jumpy
  1503,     # wahl, RMS low and jumpy
  1504,     # wahl
  1505,     # wahl, RMS low and jumpy
  1506,     # wahl, RMS low and jumpy
  1507,     # wahl, RMS low and jumpy
  1510,     # wahl, NSB
    1511,   # SB, OK for 2nd half
    1520,   # SB, OK for 2nd half
    1528,   # SB
# APA 3u 1536-1679
  1546,     # NSB, RMS=1
    1547,   # NSB, RMS=5
    1554,   # RMS=0
  1555,     # RMS=0
  1556,     # RMS=0
  1557,     # RMS=0
  1558,     # RMS=0
  1559,     # RMS=0
  1560,     # RMS=0
  1561,     # RMS=0
  1562,     # RMS=0
  1563,     # RMS=0
  1564,     # RMS=0
  1565,     # RMS=0
  1566,     # RMS=0
  1567,     # RMS=0
  1568,     # RMS=0
  1569,     # RMS=0
  1570,     # RMS=0
  1571,     # RMS=0
    1574,   # RMS=7
    1575,   # RMS>45
    1588,   # SB
    1589,   # RMS>40
  1599,     # RMS=2
    1606,   # SB
  1607,     # RMS=1
  1617,     # RMS=2
    1621,   # SB
  1625,     # RMS=2
    1637,   # SB (OK for 1st half)
    1638,   # SB (OK for 1st half)
    1639,   # SB (OK for 1st half)
    1640,   # SB (OK for 1st half)
    1641,   # SB (OK for 1st half)
    1642,   # SB (OK for 1st half)
    1643,   # SB (OK for 1st half)
  1646,     # RMS=5
    1647,   # RMS>45
  1660,     # RMS=2
    1661,   # RMS>45
  1671,     # NSB, RMS=2
    1672,   # SB (OK for 2nd half)
    1673,   # SB (OK for 2nd half)
    1674,   # SB (OK for 2nd half)
    1675,   # SB (OK for 2nd half)
    1676,   # SB (OK for 2nd half)
    1677,   # SB (OK for 2nd half)
    1678,   # SB (OK for 2nd half)
  1679,     # RMS=2
# APA 3v 1680-1823
  1694,     # RMS=3
  1716,     # RMS=0
  1717,     # RMS=0
  1718,     # RMS=0
  1719,     # RMS=0
  1720,     # RMS=0
  1721,     # RMS=0
  1722,     # RMS=0
  1723,     # RMS=0
  1724,     # RMS=0
  1725,     # RMS=0
  1726,     # RMS=0
  1727,     # RMS=0
  1728,     # RMS=0
  1729,     # RMS=0
  1730,     # RMS=0
  1731,     # RMS=0
  1732,     # RMS=0
  1733,     # RMS=0
  1740,     # RMS=2
  1741,     # RMS=2
  1742,     # RMS=2
    1752,   # NSB
    1753,   # SB, RMS=3
    1754,   # SB
    1755,   # SB
    1756,   # NSB
    1757,   # SB
    1758,   # SB
    1759,   # SB
    1788,   # NSB (intermittent)
    1792,   # NSB (intermittent)
# APA 3z1 1824-1935
  1824,     # RMS=2
  1825,     # RMS=2
  1826,     # RMS=2
  1827,     # RMS=2
  1828,     # RMS=2
  1829,     # RMS=2
  1830,     # RMS=2
  1831,     # RMS=2
  1832,     # RMS=2
  1833,     # RMS=2
  1834,     # RMS=2
  1835,     # RMS=2
  1836,     # RMS=2
  1837,     # RMS=2
    1843,   # SB (OK for 1st half)
    1866,   # SB
    1870,   # SB
  1880,     # RMS=0
  1881,     # RMS=0
  1882,     # RMS=0
  1883,     # RMS=0
  1884,     # RMS=0
  1885,     # RMS=0
  1886,     # RMS=0
  1887,     # RMS=0
  1888,     # RMS=0
  1889,     # RMS=0
  1890,     # RMS=0
  1891,     # RMS=0
  1892,     # RMS=0
  1893,     # RMS=0
  1894,     # RMS=0
  1895,     # RMS=0
  1896,     # RMS=0
  1897,     # RMS=0
  1898,     # RMS=0
  1899,     # RMS=0
  1900,     # RMS=0
  1901,     # RMS=0
  1902,     # RMS=0
  1903,     # RMS=0
  1904,     # RMS=0
  1905,     # RMS=0
  1906,     # RMS=0
  1907,     # RMS=0
    1909,   # SB (1st half OK)
# APA 3z2 1936-2047
  1936,     # RMS=2
    1946,   # SB
    1948,   # SB (OK for 2nd half)
  1950,     # RMS=2
  1951,     # RMS=2
  1952,     # RMS=2
  1953,     # RMS=2
  1954,     # RMS=2
  1955,     # RMS=2
  1956,     # RMS=2
  1957,     # RMS=2
  1958,     # RMS=2
  1959,     # RMS=2
  1960,     # RMS=2
  1961,     # RMS=2
  1962,     # RMS=2
  1963,     # RMS=2
    1974,   # SB (OK for 1st half)
    1992,   # SB
    1995,   # SB (OK for 2nd half)
    2004,   # SB
  2029,     # RMS=3
  2034,     # RMS=2
  2035,     # RMS=2
  2036,     # RMS=2
  2037,     # RMS=2
  2038,     # RMS=2
  2039,     # RMS=2
  2040,     # RMS=2
  2041,     # RMS=2
  2042,     # RMS=2
  2043,     # RMS=2
  2044,     # RMS=2
  2045,     # RMS=2
  2046,     # RMS=2
  2047      # RMS=2
]

  NoisyChannels: []
} 

dunedphase3x1x1_channel_status: {
# implements IChannelStatusService
service_provider: SimpleChannelStatusService

# list of bad channels:
                    BadChannels:   [
#view 0
0,    #blind
#49,
#77, 
#122,
159,  #blind
160,  #blind
#172,
#178,
#183,
#184,
#216,
#218,
#288,
319,  #blind
#view 1
320,  #blind
#477,
479,  #blind
480,  #blind
#550,
#569,
639,  #blind
640,  #blind
#674,
799,  #blind
800,  #blind
#828,
959,  #blind
960,  #blind
#1144,
1119, #blind
1120, #blind
#1275,
1279  #blind
]

# list of bad noisy channels:
                    NoisyChannels: [
#plane 0:
41    #constantly high noise
#plane 1:
]

                       } 

dunefd_channel_status: {
# implements IChannelStatusService
service_provider: SimpleChannelStatusService

# list of bad channels:
                    BadChannels:   [
]

# list of bad noisy channels:
                    NoisyChannels: [
]

                       } 

END_PROLOG
# channelstatus_pdsp.fcl
#
# David Adams
# October 2018
#
# Bad and noisy channels for protDUNE single phase.

# Include bad channel maps.
# channelstatus_pdsp_2081.fcl
#
# David Adams
# October 2018
#
# Bad and noisy channels for protDUNE single phase.

BEGIN_PROLOG

pdsp_channel_status_2018: {
 
  # implements IChannelStatusService
  service_provider: SimpleChannelStatusService

  # list of bad channels:
  BadChannels:   [
    # CE group: Inactive FE
     4411,  # femb515x12
     4412,  # femb515x13
     9990,  # femb605x10
    11842,  # femb120x03
    # CE group: Broken connection
        1,  # femb311u39
      400,  # femb301u40
      401,  # femb301u39
      800,  # femb320v01
      801,  # femb320v02
      876,  # femb319v37
     1200,  # femb310v01
     2961,  # femb501u39
     5321,  # femb216u39
     5363,  # femb217u37
     6132,  # femb215v13
     7058,  # femb213x03
     7295,  # femb202x01
     7681,  # femb611u39
     8080,  # femb601u40
     8328,  # femb607u32
     8480,  # femb620v01
     9282,  # femb620x03
     9283,  # femb620x04
     9736,  # femb611x25
     9854,  # femb602x02
    10800,  # femb105u40
    11024,  # femb110u16
    11457,  # femb110v18
    11459,  # femb110v20
    11463,  # femb110v24
    11469,  # femb110v30: bad in 4875-185-1500, ok in 5803-76-3200
    11517,  # femb109v38
    11669,  # femb105v30
    11679,  # femb105v40
    12756,  # femb110x44
    12801,  # femb411u39
    13001,  # femb416u39
    13081,  # femb418u39
    # CE group: ENC > 2000e
     4410,  # femb515x11: High noise, no signal 5008-76
    #-----
    # CE group excessive sticky
    #femb318x
     1719,  # femb318x24
     5125,  # femb211u35
     7551,  # femb208x33
     7190,  # femb211x39
     7194,  # femb211x43
     7918,  # femb616u02, sticky pedestal (three peaks)
    #-----
    # CE group: good.
    # femb311
        2,  # femb311u38, no signal
        4,  # femb311u36, very sticky pedestal 5308-76
     1632,  # femb320x33, very sticky pedestal 5308-76
     2169,  # femb302x07, Mostly stuck on one bad code, 5308-76
     2450,  # femb308x14, Very noisy (1000 ADC) in run 5759 (20nov2019)
     3541,  # femb516v22, very sticky--signal near zero half the time (5308-81)
     3543,  # femb516v24, very sticky--signal near zero half the time (5308-81)
     3661,  # femb513v22, most signal near zero (5308-81)
     3663,  # femb513v24, most signal near zero (5308-81)
     4061,  # femb503v22, most signal near zero (5308-81)
     4063,  # femb503v24, most signal near zero (5308-81)
     4141,  # femb501v22, signal near zero half the time (5308-81)
     4143,  # femb501v24, signal sometimes near zero (5308-81)
     4377,  # femb516x26, very sticky pedestal
     4379,  # femb516x28, very sticky pedestal
     4381,  # femb516x30, very sticky pedestal
     4383,  # femb516x32, very sticky pedestal
     4385,  # femb516x34, very sticky pedestal
     4387,  # femb516x36, very sticky pedestal
     4521,  # femb513x26, very sticky pedestal
     4523,  # femb513x28, very sticky pedestal
     4525,  # femb513x30, very sticky pedestal
     4527,  # femb513x32, very sticky pedestal
     4529,  # femb513x34, very sticky pedestal
     4531,  # femb513x36, very sticky pedestal
     4652,  # femb501x36, very sticky pedestal
     4654,  # femb501x34, very sticky pedestal
     4656,  # femb501x32, very sticky pedestal
     4658,  # femb501x30, very sticky pedestal
     4660,  # femb501x28, very sticky pedestal
     4748,  # femb503x36, very sticky pedestal
     4750,  # femb503x34, very sticky pedestal
     4752,  # femb503x32, very sticky pedestal
     4754,  # femb503x30, very sticky pedestal
     4756,  # femb503x28, very sticky pedestal
     4758,  # femb503x26, very sticky pedestal
     5361,  # femb217u39, no signal
     7680,  # femb611u40: No signal in 5308-76, end wire
     8501,  # femb620v22, very sticky pedestal
     8503,  # femb620v24, very sticky pedestal
     8821,  # femb612v22, very sticky pedestal
     8823,  # femb612v24, very sticky pedestal
     9261,  # femb601v22, very sticky pedestal
     9263,  # femb601v24, very sticky pedestal
     9305,  # femb620x26, very sticky pedestal
     9307,  # femb620x28, very sticky pedestal
     9309,  # femb620x30, very sticky pedestal
     9311,  # femb620x32, very sticky pedestal
     9313,  # femb620x34, very sticky pedestal
     9315,  # femb620x36, very sticky pedestal
     9689,  # femb612x26, very sticky pedestal
     9691,  # femb612x28, very sticky pedestal
     9693,  # femb612x30, very sticky pedestal
     9695,  # femb612x32, very sticky pedestal
     9697,  # femb612x34, very sticky pedestal
     9699,  # femb612x36, very sticky pedestal
     9772,  # femb601x26, very sticky pedestal
     9774,  # femb601x28, very sticky pedestal
     9776,  # femb601x30, very sticky pedestal
     9778,  # femb601x32, very sticky pedestal
     9780,  # femb601x34, very sticky pedestal
     9782,  # femb601x36, very sticky pedestal
    10102,  # femb608x42, mostly stuck on one code
    10189,  # femb609x03, mostly stuck on one code
    10697,  # femb102u23, mostly stuck on a few classic codes
    10907,  # femb107u13, mostly stuck on one code
    11203,  # femb116v04, stuck on many classic codes
    11270,  # femb115v31, stuck on many classic codes
    11902,  # femb119x15, stuck on two classic codes
    12324,  # femb101x44, stuck on many classic codes
    12333,  # femb101x35, stuck on many classic codes
    12744,  # femb109x08, stuck on many classic codes
    13363,  # femb405u37, very noisy, nosignal 5308-76-4800

    #-----
    # These 16 channels are an intermitently bad ASIC.
    # Matt W. 19oct2018.
    # femb316u
      200,   # femb316u40
      202,   # femb316u38
      204,   # femb316u36
      206,   # femb316u34
      208,   # femb316u32
    # femb316v
      991,   # femb316v32
      993,   # femb316v34
      995,   # femb316v36
      997,   # femb316v38
      999,   # femb316v40
    # femb316x
     1829,   # femb316x38
     1831,   # femb316x40
     1833,   # femb316x42
     1835,   # femb316x44
     1837,   # femb316x46
     1839    # femb316x48
    #-----
  ]

  # list of bad noisy channels:
  NoisyChannels: [
    # CE group: ENC > 2000e
     9569,
    # CE group: sticky.
     2318,
    # DLA sticky
    # femb311u
        4,
    # femb313u
       94,
    # femb319u
      325,  # femb319u35, 2020-02-27: Mostly stuck on one bad code 5141, 5795, 8764, ...
    # femb302u
      442,
      447,
      453,
      455,
      456,
      472,
      477,
    # femb304u
      571,
      573,
    # femb302v
     1534,
     1539,
     1546,
    # femb315x
     1864,
     #1864,  # acceptable??
    # femb302x
     2135,
     2146,
     2158,
     2161,
    # femb513u
     2674,  # 2-value pedestal
   # femb518u
     2833,  # Noisy adc pedestal
   # femb516x
     4377,  # Pedestal very sticky
   # femb503x
     4654,  # sticky pedestal
     4658,  # sticky pedestal
     4662,  # sticky pedestal
   # femb503x
     4752,  # sticky pedestal
   # femb214u
     5271,  # sticky pedestal
   # femb217u
     5377,  # sticky pedestal
   # femb218u
     5400,  # sticky pedestal
     5423,  # sticky pedestal
   # femb201x
     7220, # Pedestal stuck on 980
   # femb203x
     7334, # Pedestal stuck on 980,981
   # femb204x
     7347, # Pedestal stuck on 979
   # femb207x
     7396, # Sticky pedestal
   # femb607x
     8341 # Sticky pedestal
  ]

}

END_PROLOG
# channelstatus_pdsp.fcl
#
# David Adams
# October 2018
#
# Bad and noisy channels for protDUNE single phase.

# Include old bad channel maps.
# channelstatus_pdsp_2081.fcl
#
# David Adams
# October 2018
#
# Bad and noisy channels for protDUNE single phase.

BEGIN_PROLOG

pdsp_channel_status_2018: {
 
  # implements IChannelStatusService
  service_provider: SimpleChannelStatusService

  # list of bad channels:
  BadChannels:   [
    # CE group: Inactive FE
     4411,  # femb515x12
     4412,  # femb515x13
     9990,  # femb605x10
    11842,  # femb120x03
    # CE group: Broken connection
        1,  # femb311u39
      400,  # femb301u40
      401,  # femb301u39
      800,  # femb320v01
      801,  # femb320v02
      876,  # femb319v37
     1200,  # femb310v01
     2961,  # femb501u39
     5321,  # femb216u39
     5363,  # femb217u37
     6132,  # femb215v13
     7058,  # femb213x03
     7295,  # femb202x01
     7681,  # femb611u39
     8080,  # femb601u40
     8328,  # femb607u32
     8480,  # femb620v01
     9282,  # femb620x03
     9283,  # femb620x04
     9736,  # femb611x25
     9854,  # femb602x02
    10800,  # femb105u40
    11024,  # femb110u16
    11457,  # femb110v18
    11459,  # femb110v20
    11463,  # femb110v24
    11469,  # femb110v30: bad in 4875-185-1500, ok in 5803-76-3200
    11517,  # femb109v38
    11669,  # femb105v30
    11679,  # femb105v40
    12756,  # femb110x44
    12801,  # femb411u39
    13001,  # femb416u39
    13081,  # femb418u39
    # CE group: ENC > 2000e
     4410,  # femb515x11: High noise, no signal 5008-76
    #-----
    # CE group excessive sticky
    #femb318x
     1719,  # femb318x24
     5125,  # femb211u35
     7551,  # femb208x33
     7190,  # femb211x39
     7194,  # femb211x43
     7918,  # femb616u02, sticky pedestal (three peaks)
    #-----
    # CE group: good.
    # femb311
        2,  # femb311u38, no signal
        4,  # femb311u36, very sticky pedestal 5308-76
     1632,  # femb320x33, very sticky pedestal 5308-76
     2169,  # femb302x07, Mostly stuck on one bad code, 5308-76
     2450,  # femb308x14, Very noisy (1000 ADC) in run 5759 (20nov2019)
     3541,  # femb516v22, very sticky--signal near zero half the time (5308-81)
     3543,  # femb516v24, very sticky--signal near zero half the time (5308-81)
     3661,  # femb513v22, most signal near zero (5308-81)
     3663,  # femb513v24, most signal near zero (5308-81)
     4061,  # femb503v22, most signal near zero (5308-81)
     4063,  # femb503v24, most signal near zero (5308-81)
     4141,  # femb501v22, signal near zero half the time (5308-81)
     4143,  # femb501v24, signal sometimes near zero (5308-81)
     4377,  # femb516x26, very sticky pedestal
     4379,  # femb516x28, very sticky pedestal
     4381,  # femb516x30, very sticky pedestal
     4383,  # femb516x32, very sticky pedestal
     4385,  # femb516x34, very sticky pedestal
     4387,  # femb516x36, very sticky pedestal
     4521,  # femb513x26, very sticky pedestal
     4523,  # femb513x28, very sticky pedestal
     4525,  # femb513x30, very sticky pedestal
     4527,  # femb513x32, very sticky pedestal
     4529,  # femb513x34, very sticky pedestal
     4531,  # femb513x36, very sticky pedestal
     4652,  # femb501x36, very sticky pedestal
     4654,  # femb501x34, very sticky pedestal
     4656,  # femb501x32, very sticky pedestal
     4658,  # femb501x30, very sticky pedestal
     4660,  # femb501x28, very sticky pedestal
     4748,  # femb503x36, very sticky pedestal
     4750,  # femb503x34, very sticky pedestal
     4752,  # femb503x32, very sticky pedestal
     4754,  # femb503x30, very sticky pedestal
     4756,  # femb503x28, very sticky pedestal
     4758,  # femb503x26, very sticky pedestal
     5361,  # femb217u39, no signal
     7680,  # femb611u40: No signal in 5308-76, end wire
     8501,  # femb620v22, very sticky pedestal
     8503,  # femb620v24, very sticky pedestal
     8821,  # femb612v22, very sticky pedestal
     8823,  # femb612v24, very sticky pedestal
     9261,  # femb601v22, very sticky pedestal
     9263,  # femb601v24, very sticky pedestal
     9305,  # femb620x26, very sticky pedestal
     9307,  # femb620x28, very sticky pedestal
     9309,  # femb620x30, very sticky pedestal
     9311,  # femb620x32, very sticky pedestal
     9313,  # femb620x34, very sticky pedestal
     9315,  # femb620x36, very sticky pedestal
     9689,  # femb612x26, very sticky pedestal
     9691,  # femb612x28, very sticky pedestal
     9693,  # femb612x30, very sticky pedestal
     9695,  # femb612x32, very sticky pedestal
     9697,  # femb612x34, very sticky pedestal
     9699,  # femb612x36, very sticky pedestal
     9772,  # femb601x26, very sticky pedestal
     9774,  # femb601x28, very sticky pedestal
     9776,  # femb601x30, very sticky pedestal
     9778,  # femb601x32, very sticky pedestal
     9780,  # femb601x34, very sticky pedestal
     9782,  # femb601x36, very sticky pedestal
    10102,  # femb608x42, mostly stuck on one code
    10189,  # femb609x03, mostly stuck on one code
    10697,  # femb102u23, mostly stuck on a few classic codes
    10907,  # femb107u13, mostly stuck on one code
    11203,  # femb116v04, stuck on many classic codes
    11270,  # femb115v31, stuck on many classic codes
    11902,  # femb119x15, stuck on two classic codes
    12324,  # femb101x44, stuck on many classic codes
    12333,  # femb101x35, stuck on many classic codes
    12744,  # femb109x08, stuck on many classic codes
    13363,  # femb405u37, very noisy, nosignal 5308-76-4800

    #-----
    # These 16 channels are an intermitently bad ASIC.
    # Matt W. 19oct2018.
    # femb316u
      200,   # femb316u40
      202,   # femb316u38
      204,   # femb316u36
      206,   # femb316u34
      208,   # femb316u32
    # femb316v
      991,   # femb316v32
      993,   # femb316v34
      995,   # femb316v36
      997,   # femb316v38
      999,   # femb316v40
    # femb316x
     1829,   # femb316x38
     1831,   # femb316x40
     1833,   # femb316x42
     1835,   # femb316x44
     1837,   # femb316x46
     1839    # femb316x48
    #-----
  ]

  # list of bad noisy channels:
  NoisyChannels: [
    # CE group: ENC > 2000e
     9569,
    # CE group: sticky.
     2318,
    # DLA sticky
    # femb311u
        4,
    # femb313u
       94,
    # femb319u
      325,  # femb319u35, 2020-02-27: Mostly stuck on one bad code 5141, 5795, 8764, ...
    # femb302u
      442,
      447,
      453,
      455,
      456,
      472,
      477,
    # femb304u
      571,
      573,
    # femb302v
     1534,
     1539,
     1546,
    # femb315x
     1864,
     #1864,  # acceptable??
    # femb302x
     2135,
     2146,
     2158,
     2161,
    # femb513u
     2674,  # 2-value pedestal
   # femb518u
     2833,  # Noisy adc pedestal
   # femb516x
     4377,  # Pedestal very sticky
   # femb503x
     4654,  # sticky pedestal
     4658,  # sticky pedestal
     4662,  # sticky pedestal
   # femb503x
     4752,  # sticky pedestal
   # femb214u
     5271,  # sticky pedestal
   # femb217u
     5377,  # sticky pedestal
   # femb218u
     5400,  # sticky pedestal
     5423,  # sticky pedestal
   # femb201x
     7220, # Pedestal stuck on 980
   # femb203x
     7334, # Pedestal stuck on 980,981
   # femb204x
     7347, # Pedestal stuck on 979
   # femb207x
     7396, # Sticky pedestal
   # femb607x
     8341 # Sticky pedestal
  ]

}

END_PROLOG

BEGIN_PROLOG

pdsp_channel_status_nov2019: {
 
  # implements IChannelStatusService
  service_provider: SimpleChannelStatusService

  # list of bad channels:
  BadChannels:   [
    # CE group: Inactive FE
     4411,  # femb515x12
     4412,  # femb515x13
     9990,  # femb605x10
    11842,  # femb120x03
    # CE group: Broken connection
        1,  # femb311u39
      400,  # femb301u40
      401,  # femb301u39
      800,  # femb320v01
      801,  # femb320v02
      876,  # femb319v37
     1200,  # femb310v01
     2961,  # femb501u39
     5321,  # femb216u39
     5363,  # femb217u37
     6132,  # femb215v13
     7058,  # femb213x03
     7295,  # femb202x01
     7681,  # femb611u39
     7715,  # femb611u05 Very, very noisy in run 10527 (nov 2019)
     8080,  # femb601u40
     8328,  # femb607u32
     8480,  # femb620v01
     9282,  # femb620x03
     9283,  # femb620x04
     9736,  # femb611x25
     9854,  # femb602x02
    10033,  # femb106x15  low RMS, no response to pulser in 10493 (nov 2019)
    10800,  # femb105u40
    11001,  # femb110u39  v. low RMS in run 10419, 10527; no sig in 10527; responds to pulser (nov 2019)
    11011,  # femb110x39  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11014,  # femb110u26  v. low RMS in run 10419, 10527; no sig in 10527; responds to pulser (nov 2019)
    11013,  # femb110x37  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11015,  # femb110x35  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11017,  # femb110x33  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11018,  # femb110u32  v. low RMS in run 10404, 10527; no sig in 10527; responds to pulser (nov 2019)
    11019,  # femb110x31  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11024,  # femb110u16
    11457,  # femb110v18
    11459,  # femb110v20
    11460,  # femb110v21  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11462,  # femb110v23  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11463,  # femb110v24  (looks good in 10527 event 1 tick 1000)
    11464,  # femb110v25  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11466,  # femb110v27  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11467,  # femb110v28  v. low RMS in 10417; no signal in 10527 (nov 2019)
    11468,  # femb110v29  severe sticky code or stuck bit in run 10417, 10527 (nov 2019)
    11469,  # femb110v30: bad in 4875-185-1500, ok in 5803-76-3200; bad in 10527
    11501,  # femb109v22  v. low RMS in 10417; no signal in 10527 (nov 2019)
    11517,  # femb109v38
    12765,  # femb110x35  bad in run 10417 (nov 2019)
    11669,  # femb105v30
    12756,  # femb110x44
    12756,  # femb110x44
    12767,  # femb110x33  bad in run 10417 (nov 2019)
    12769,  # femb110x31  bad in run 10417 (nov 2019)
    12771,  # femb110x29  bad in run 10417 (nov 2019)
    12773,  # femb110x27  bad in run 10417 (nov 2019)
    12775,  # femb110x25  bad in run 10417 (nov 2019)
    12801,  # femb411u39
    13001,  # femb416u39
    13081,  # femb418u39
    # CE group: ENC > 2000e
     4410,  # femb515x11: High noise, no signal 5008-76
    #-----
    # CE group excessive sticky
    #femb318x
     1719,  # femb318x24
     5125,  # femb211u35
     7551,  # femb208x33
     7190,  # femb211x39
     7194,  # femb211x43
     7918,  # femb616u02, sticky pedestal (three peaks)
    #-----
    # CE group: good.
    # femb311
        2,  # femb311u38, no signal
        4,  # femb311u36, very sticky pedestal 5308-76
     1632,  # femb320x33, very sticky pedestal 5308-76
     2169,  # femb302x07, Mostly stuck on one bad code, 5308-76
     2450,  # femb308x14, Very noisy (1000 ADC) in run 5759 (nov 2019)
     3541,  # femb516v22, very sticky--signal near zero half the time (5308-81)
     3543,  # femb516v24, very sticky--signal near zero half the time (5308-81)
     3661,  # femb513v22, most signal near zero (5308-81)
     3663,  # femb513v24, most signal near zero (5308-81)
     4061,  # femb503v22, most signal near zero (5308-81)
     4063,  # femb503v24, most signal near zero (5308-81)
     4141,  # femb501v22, signal near zero half the time (5308-81)
     4143,  # femb501v24, signal sometimes near zero (5308-81)
     4377,  # femb516x26, very sticky pedestal
     4379,  # femb516x28, very sticky pedestal
     4381,  # femb516x30, very sticky pedestal
     4383,  # femb516x32, very sticky pedestal
     4385,  # femb516x34, very sticky pedestal
     4387,  # femb516x36, very sticky pedestal
     4521,  # femb513x26, very sticky pedestal
     4523,  # femb513x28, very sticky pedestal
     4525,  # femb513x30, very sticky pedestal
     4527,  # femb513x32, very sticky pedestal
     4529,  # femb513x34, very sticky pedestal
     4531,  # femb513x36, very sticky pedestal
     4652,  # femb501x36, very sticky pedestal
     4654,  # femb501x34, very sticky pedestal
     4656,  # femb501x32, very sticky pedestal
     4658,  # femb501x30, very sticky pedestal
     4660,  # femb501x28, very sticky pedestal
     4658,  # femb501x26, very sticky pedestal
     4748,  # femb503x36, very sticky pedestal
     4750,  # femb503x34, very sticky pedestal
     4752,  # femb503x32, very sticky pedestal
     4754,  # femb503x30, very sticky pedestal
     4756,  # femb503x28, very sticky pedestal
     4758,  # femb503x26, very sticky pedestal
     5361,  # femb217u39, no signal
     7680,  # femb611u40: No signal in 5308-76, end wire
     8501,  # femb620v22, very sticky pedestal
     8503,  # femb620v24, very sticky pedestal
     8821,  # femb612v22, very sticky pedestal
     8823,  # femb612v24, very sticky pedestal
     9261,  # femb601v22, very sticky pedestal
     9263,  # femb601v24, very sticky pedestal
     9305,  # femb620x26, very sticky pedestal
     9307,  # femb620x28, very sticky pedestal
     9309,  # femb620x30, very sticky pedestal
     9311,  # femb620x32, very sticky pedestal
     9313,  # femb620x34, very sticky pedestal
     9315,  # femb620x36, very sticky pedestal
     9689,  # femb612x26, very sticky pedestal
     9691,  # femb612x28, very sticky pedestal
     9693,  # femb612x30, very sticky pedestal
     9695,  # femb612x32, very sticky pedestal
     9697,  # femb612x34, very sticky pedestal
     9699,  # femb612x36, very sticky pedestal
     9772,  # femb601x26, very sticky pedestal
     9774,  # femb601x28, very sticky pedestal
     9776,  # femb601x30, very sticky pedestal
     9778,  # femb601x32, very sticky pedestal
     9780,  # femb601x34, very sticky pedestal
     9782,  # femb601x36, very sticky pedestal
    10102,  # femb608x42, mostly stuck on one code
    10189,  # femb609x03, mostly stuck on one code
    10697,  # femb102u23, mostly stuck on a few classic codes
    10907,  # femb107u13, mostly stuck on one code
    11203,  # femb116v04, stuck on many classic codes
    11270,  # femb115v31, stuck on many classic codes
    11902,  # femb119x15, stuck on two classic codes
    12324,  # femb101x44, stuck on many classic codes
    12333,  # femb101x35, stuck on many classic codes
    12744,  # femb109x08, stuck on many classic codes
    13363,  # femb405u37, very noisy, nosignal 5308-76-4800

    #-----
    # These 16 channels are an intermitently bad ASIC.
    # Matt W. 19oct2018.
    # femb316u
      200,   # femb316u40
      202,   # femb316u38
      204,   # femb316u36
      206,   # femb316u34
      208,   # femb316u32
    # femb316v
      991,   # femb316v32
      993,   # femb316v34
      995,   # femb316v36
      997,   # femb316v38
      999,   # femb316v40
    # femb316x
     1829,   # femb316x38
     1831,   # femb316x40
     1833,   # femb316x42
     1835,   # femb316x44
     1837,   # femb316x46
     1839    # femb316x48
    #-----
  ]

  # list of bad noisy channels:
  NoisyChannels: [
    # CE group: ENC > 2000e
     9569,
    # CE group: sticky.
     2318,
    # DLA sticky
    # femb311u
        4,
    # femb313u
       94,
    # femb319u
      325,  # femb319u35, 2020-02-27: Mostly stuck on one bad code 5141, 5795, 8764, ...
    # femb302u
      442,
      447,
      453,
      455,
      456,
      472,
      477,
    # femb304u
      571,
      573,
    # femb302v
     1534,
     1539,
     1546,
    # femb315x
     1864,
     #1864,  # acceptable??
    # femb302x
     2135,
     2146,
     2158,
     2161,
    # femb513u
     2674,  # 2-value pedestal
   # femb518u
     2833,  # Noisy adc pedestal
   # femb516x
     4377,  # Pedestal very sticky
   # femb503x
     4654,  # sticky pedestal
     4658,  # sticky pedestal
     4662,  # sticky pedestal
   # femb503x
     4752,  # sticky pedestal
   # femb214u
     5271,  # sticky pedestal
   # femb217u
     5377,  # sticky pedestal
   # femb218u
     5400,  # sticky pedestal
     5423,  # sticky pedestal
   # femb201x
     7220, # Pedestal stuck on 980
   # femb203x
     7334, # Pedestal stuck on 980,981
   # femb204x
     7347, # Pedestal stuck on 979
   # femb207x
     7396, # Sticky pedestal
   # femb607x
     8341, # Sticky pedestal
   # femb112x
   #  12252,  # nov 2019 pulser area is very noisy
   # femb102x
   #  12382   # nov 2019 pulser area is very noisy
     4473,  # femb514x26  Nonlinear response in nov 2019 calibration
     9641   # femb613x26  Nonlinear response in nov 2019 calibration
  ]

}

# Add channels with bad calibration pulser.
# Channel 4413 had bad fit in feb2019 calib but looks ok in nov.
pdsp_channel_status_nov2019_goodpulser: @local::pdsp_channel_status_nov2019
pdsp_channel_status_nov2019_goodpulser.BadChannels: [
  @sequence::pdsp_channel_status_nov2019_goodpulser.BadChannels,
  4232, 4234, 4236, 4238, 4240, 4242,   # femb519x (apa5z, feb2018 values in fix01)
  4472, 4474, 4476, 4478, 4480, 4482,   # femb514x (apa5z, feb2018 values in fix01)
  9545, 9547, 9549, 9551, 9553, 9555,   # femb615x (apa5z, feb2018 values in fxi01)
  4473,                                 # femb514x
  9260,                                 # femb601v (feb2018 values in fix01)
  9641                                  # femb613x
]

END_PROLOG

BEGIN_PROLOG

pdsp_channel_status: @local::pdsp_channel_status_2018
#pdsp_channel_status: @local::pdsp_channel_status_nov2019

END_PROLOG
# pedestals_dune.fcl
#
# David Adams
# March 2016
#
# File now holds the full service configuration instead of only the provider.

BEGIN_PROLOG

dune_dbpeds: {
}

dune_fixedpeds: {
  service_provider: FixedDetPedestalService
  FixedDetPedestal: {
    PedMeanU: 1800.0
    PedMeanV: 1800.0
    PedMeanZ:  500.0
    PedRmsU:     2.5
    PedRmsV:     2.5
    PedRmsZ:     2.5
    PedMeanErrU: 0.1
    PedMeanErrV: 0.1
    PedMeanErrZ: 0.1
    PedRmsErrU:  0.1
    PedRmsErrV:  0.1
    PedRmsErrZ:  0.1
  }
}

dunedp_fixedpeds: {
  service_provider: DPhaseFixedDetPedestalService
  FixedDetPedestal: {
    PedMeanX: 10.0
    PedMeanY: 10.0
    PedMeanZ: 10.0
    PedRmsX:     1.0
    PedRmsY:     1.0
    PedRmsZ:     1.0
    PedMeanErrX: 0.1
    PedMeanErrY: 0.1
    PedMeanErrZ: 0.1
    PedRmsErrX:  0.1
    PedRmsErrY:  0.1
    PedRmsErrZ:  0.1
  }
}

END_PROLOG
# dunetpc/dune/Daq/daq_dune.fcl
#
# David Adams
# February 2016

BEGIN_PROLOG

#***********************************************************************

# 35-ton online/offline channel mapping.

chmap35t: {
  service_provider: FileChannelMappingService
  FileName:         "rce_channel_map_dune35t.txt"
  FilePathEnv:      FW_SEARCH_PATH
  LogLevel:         1
}

#***********************************************************************

END_PROLOG
# detsimmodules_dune.fcl
#
#
# David Adams
# April 2016
#
# This FCL prolog file holds a minimal default configuration for the
# DetSim module and configuration options for the services used by that
# module.
#
# See dunetpc/fcl/dune35t/detsim/standard_detsim_dune35t for top-level
# FCL that uses this configuration.

BEGIN_PROLOG

standard_simwire:
{
  module_type:        "SimWire"
  DriftEModuleLabel:  "largeant"
  NoiseFact:           0.0132      # Noise Scale
  NoiseWidth:         62.4         # Exponential Noise width (kHz)
  LowCutoff:           7.5         # Low frequency filter cutoff (kHz)
  FieldBins:          75
  Col3DCorrection:    2.5
  Ind3DCorrection:    1.5
  ColFieldRespAmp:    0.0354
  IndFieldRespAmp:    0.018
  ShapeTimeConst:     [ 3000., 900. ]
  CompressionType:    "none"
}


standard_simwireana:
{ 
 module_type:       "SimWireAna"
 DetSimModuleLabel: "daq"
}
# extra comment to test check-in

microboone_simwire:  
{ 
 module_type:        "SimWireMicroBooNE"
 DriftEModuleLabel:  "largeant"
 NoiseFact:          0.0132       #Noise Scale
 #NoiseFact:          0.15       #Noise Scale to use with histogram
 NoiseWidth:         62.4         #Exponential Noise width (kHz)
 LowCutoff:          7.5          #Low frequency filter cutoff (kHz)
 CompressionType:    "none"       #could also be none
 GetNoiseFromHisto:   false  
 NoiseFileFname:      "uboone_noise_v0.1.root"
 NoiseHistoName:      "NoiseFreq"    

}
microboone_simwireana: @local::standard_simwireana

standard_wienerfilterana: 
{
 module_type:        "WienerFilterAna"
 DetSimModuleLabel:  "daq"
}

bo_wienerfilterana:         @local::standard_wienerfilterana
argoneut_wienerfilterana:   @local::standard_wienerfilterana
microboone_wienerfilterana: @local::standard_wienerfilterana



END_PROLOG

BEGIN_PROLOG

#***********************************************************************

# DetSim module

dune_detsim: {
  module_type:       "SimWireDUNE"
  SimChannelLabel:   "largeant"
  NoiseOn:           false
  PedestalOn:        false
  DistortOn:         false
  SuppressOn:        false
  KeepEmptyChannels: false
  AdcSimulator:      "adcsim_ideal"
}

#***********************************************************************

# SimChannelExtractService converts GEANT output to TPC signals.

# Simple single-phase extractor.
scxgeneric: {
  service_provider: GenericSimChannelExtractService
}

# Signal extractor service for dune dual-phase detector
scxdp: {
  service_provider: DPhaseSimChannelExtractService
}

# Single-phase extractor with special handling of signal near and beyond
# TPC active boundaries.
scx35t: {
  service_provider: Dune35tSimChannelExtractService
  FractHorizGapUCollect: [ 0.1, 0.0 ]
  FractHorizGapUMiss: [ 0.8, 0.0 ]
  FractHorizGapVCollect: [ 0.1, 0.0 ]
  FractHorizGapVMiss: [ 0.8, 0.0 ]
  FractHorizGapZMiss: [ 0.8, 0.0 ]
  FractUUCollect: [ 0.5, 0.0 ]
  FractUUMiss: [ 0.2, 0.0 ]
  FractUVCollect: [ 0.1, 0.0 ]
  FractUVMiss: [ 0.2, 0.0 ]
  FractVUCollect: [ 0.5, 0.0 ]
  FractVUMiss: [ 0.2, 0.0 ]
  FractVVCollect: [ 0.1, 0.0 ]
  FractVVMiss: [ 0.2, 0.0 ]
  FractVertGapUCollect: [ 0.1, 0.0 ]
  FractVertGapUMiss: [ 0.8, 0.0 ]
  FractVertGapVCollect: [ 0.1, 0.0 ]
  FractVertGapVMiss: [ 0.8, 0.0 ]
  FractVertGapZMiss: [ 0.8, 0.0 ]
  FractZUMiss: [ 0.2, 0.0 ]
  FractZVMiss: [ 0.2, 0.0 ]
}

#***********************************************************************

# ChannelNoiseService adds noise to channel-tick bins.

# Option 1 from the old DetSim module.
chnoiseold: {
  service_provider: ExponentialChannelNoiseService
  NoiseNormU: 3.16
  NoiseNormV: 3.16
  NoiseNormZ: 3.16
  NoiseWidthU: 2000
  NoiseWidthV: 2000
  NoiseWidthZ: 2000
  LowCutoffU: 7.5
  LowCutoffV: 7.5
  LowCutoffZ: 7.5
  WhiteNoiseU: 0.0
  WhiteNoiseV: 0.0
  WhiteNoiseZ: 0.0
  NoiseArrayPoints: 1000
  OldNoiseIndex: true
}

# Option 2 from the old DetSim module.
chnoisewhite: {
  service_provider: WhiteChannelNoiseService
}

# Tune from October 2016.
# See D. Adams talk at the 26oct 35t sim/reco meeting.
# Option 1 from the old DetSim module.
chnoise35t: {
  service_provider: ExponentialChannelNoiseService
  NoiseNormU:   30.0
  NoiseNormV:   30.0
  NoiseNormZ:   15.0
  NoiseWidthU: 150.0
  NoiseWidthV: 150.0
  NoiseWidthZ: 150.0
  LowCutoffU:    0.0
  LowCutoffV:    0.0
  LowCutoffZ:    0.0
  WhiteNoiseU:   1.6
  WhiteNoiseV:   1.6
  WhiteNoiseZ:   1.6
  NoiseArrayPoints: 1000
  OldNoiseIndex: false
}

# Tune from August 2018. Based on protoDUNE run 3775.
# Requires dunetpc v07_05_00 or later.
# See https://cdcvs.fnal.gov/redmine/issues/20621.
pdsp_chnoiseAug2018: {
  service_provider: ExponentialChannelNoiseService
  NoiseNormU:   25
  NoiseNormV:   25
  NoiseNormZ:   20
  LowCutoffU: -180
  LowCutoffV: -180
  LowCutoffZ: -180
  WhiteNoiseU:  0.8
  WhiteNoiseV:  0.8
  WhiteNoiseZ:  0.8
  NoiseWidthU: 150.0
  NoiseWidthV: 150.0
  NoiseWidthZ: 150.0
  NoiseArrayPoints: 1000
  OldNoiseIndex: false
}

#Configure realistic noise service for DP detectors based on the 311 data
#A.Scarpelli andrea.scarpelli@cern.ch November 2017
#NB: Hardcoded unrotated geometry:

dprealisticnoise:{
  service_provider: DPhaseRealisticNoiseService
  NoiseModel:       "$MRB_SOURCE/dunetpc/dune/DetSim/NoiseModels/729-0_fft_mirror.root"
  RandomizeX:       15.0     #amplitude randomization sigma
  RandomizeY:       15.0     #amplitude randomization sigma
  Smooth:           1000      #smoothing factor when mirroring
  SetFirst0:        false    #set first bin of the fft model to 0
  SetBaseline:      false    #if true, baseline added to real noise model
  NoiseArrayPoints: 1000     #number of pre-generated waveforms
  OldNoiseIndex:    false    #From ExponentialChannelNoiseService. Keep false
}

dpcoherentnoise:{
  service_provider: DPhaseCoherentNoiseService
  NoiseModel:       "$MRB_SOURCE/dunetpc/dune/DetSim/NoiseModels/729-0-model-fft.root"
  AmplitudeCut:     50                       #select frequencies above this threshold
  Normalization:    1                        #amplitude normalizations
  Randomize:        [ 1, 1 ]                 #rms amplitude ( different for every channel and frequency )
  PhaseShift:       [ -1, 1 ]                #phase shift per group of channels in radiants
  ChannelGroup:     [ 0, 320, 1280 ]         #list here the first channel of every significant correlation pattern
  InchoerentNoise:  [ 0.7, 1.1, 0.7, 1.1 ]   #rms and sigma of a small incohrent noise ( or very high frequency )
  NumberOfPhases:   1000                     #number of random phases array to produce
  LogLevel:         0                        #Verbosity level
}

chnoiseprotodune: {
  service_provider: ProtoDUNEChannelNoiseService
  LowCutoffU:    0.0
  LowCutoffV:    0.0
  LowCutoffZ:    0.0
  WhiteNoiseU:   0.0
  WhiteNoiseV:   0.0
  WhiteNoiseZ:   0.0
  NoiseArrayPoints: 1000
  OldNoiseIndex: false
  WireLengthZ:    598.39
  WireLengthU:    740.06
  WireLengthV:    737.36
  EffectiveNBits: 10.6
}

#***********************************************************************


# PedestalAdditionService adds pedestals to signals.

# Takes pedestal mean and RMS and from the DetPedestalService provider.
# Incoherent noise is added with Gaussian sigma = NoiseScale*RMS.
padprovided: {
  service_provider: ProvidedPedestalAdditionService
  NoiseScale: 0.0
}

#***********************************************************************

# AdcDistortService adds distortions to the digitized signals.

# Add 35-ton stuck bits.
stuckbits: {
  service_provider: StuckBitAdcDistortionService
  StuckBitsOverflowProbHistoName: "pCorrFracOverflowVsInputLsbCell"
  StuckBitsProbabilitiesFname: "ADCStuckCodeProbabilities35t/output_produceDcScanSummaryPlots_20150827_coldTest_0p1to1p4_step0p0010.root"
  StuckBitsUnderflowProbHistoName: "pCorrFracUnderflowVsInputLsbCell"
}

#***********************************************************************

# AdcSuppressService indicates which channel-tick bins should be
# ignored (i.e. zero-suppressed).

# No suppression.
zsnone: {
  service_provider: FixedZeroSuppressService
}

# Simple window supression. Same as the old module.
zslegacy: {
  service_provider: Legacy35tZeroSuppressService
  AdcThreshold: 10.0
  TickRange: 10
  MinTickGap: 2
  SuppressStickyBits: false
}

# Algorithm developed for use with the 35-ton detector with original
# (low) thresholds.
zsonline: {
  service_provider: Dune35tZeroSuppressService
  NS:  5
  NL: 15
  ND:  5
  NT:  3
  TS:  3
  TL:  7
  TD:  5
}

# Algorithm developed for use with the 35-ton detector with high
# thresholds.
zsonline_nhi: {
  service_provider: Dune35tZeroSuppressService
  NS:  5
  NL: 15
  ND:  5
  NT:  3
  TS:  6
  TL: 10
  TD: 10
}

#***********************************************************************

# AdcCompressService applies supression and converts digititzed signals
# to the final raw data format.

# Replaces suppressed bins with value Zero.
# Use this to effectively skip compression.
cmpreplace: {
  service_provider: ReplaceCompressService
  Zero: 0
}

# Larsoft block formatting. This removes the suppressed bins.
cmpblock: {
  service_provider: "LarsoftHuffmanCompressService"
  UseBlock:         "true"
  UseHuffman:       "false"
}

# Larsoft block formatting with Larsoft Huffman compression.
cmphuffman: {
  service_provider: "LarsoftHuffmanCompressService"
  UseBlock:         "true"
  UseHuffman:       "true"
}

#***********************************************************************
# Below are configurations for the old (and soon to be obsolete) DetSim
# modules. These can be removed when the old modules
# SimWireDUNE35t_module.cc and SimWireDUNE10kt_module.cc are dropped.
#***********************************************************************

dunefd_simwire:
{
 module_type:        "SimWireDUNE10kt"
 DriftEModuleLabel:  "largeant"
 NoiseFactU:          0.0349     # Noise Scale for U plane. Reset by DLA 26apr16.
 NoiseWidthU:         2000         #Exponential Noise width (kHz) for U plane
 LowCutoffU:          7.5          #Low frequency filter cutoff (kHz) for U plane
 NoiseFactV:          0.0349     #Noise Scale for V plane, should produce RMS of 2.5 ADC counts. Reset by DLA 26apr16.
 NoiseWidthV:         2000         #Exponential Noise width (kHz) for V plane, should produce RMS of 2.5 ADC counts
 LowCutoffV:          7.5          #Low frequency filter cutoff (kHz) for V plane
 NoiseFactZ:          0.0349     #Noise Scale for Z plane, should produce RMS of 2.5 ADC counts. Reset by DLA 26apr16.
 NoiseWidthZ:         2000         #Exponential Noise width (kHz) for Z plane
 LowCutoffZ:          7.5          #Low frequency filter cutoff (kHz) for Z plane
 CompressionType:    "ZeroSuppression"       #could also be none
 #CompressionType:    ""       #could also be none
 ZeroThreshold:       10        #Threshold for zero suppression
 NearestNeighbor:     10        #Maximum distance between hits above threshold before they are separated into different blocks
 NeighboringChannels: 0        #Number of neighboring channels on either side allowed to influence zero suppression
 NoiseArrayPoints:    1000     #number of points in noise array
 NoiseOn:             1        #1 for noise on, 0 for noise off
 NoiseModel:          1        #1 for original model, 2 for a model similar to uBooNE

 CollectionPed:       400         #ADC baseline for coll plane
 CollectionPedRMS:    0        #ADC baseline RMS for coll plane
 InductionPed:        2048        #ADC baseline for ind plane
 InductionPedRMS:     0        #ADC baseline RMS for ind plane

 CollectionCalibPed:     400      #Assumed measured value for coll plane pedestal
 CollectionCalibPedRMS:  0        #Assumed measured value for coll plane pedestal RMS
 InductionCalibPed:      2048     #Assumed measured value for ind plane pedestal
 InductionCalibPedRMS:   0        #Assumed measured value for ind plane pedestal RMS

 PedestalOn:          true     #add pedestal value to ADC vector

 SimCombs:           false
 SaveEmptyChannel:   false      #if channel's ADC vector is entirely full of zeros, save it in RawDigit collection (true) or discard (false)
 SimStuckBits:       false        #simulate stuck bits

 StuckBitsProbabilitiesFname:     "ADCStuckCodeProbabilities35t/output_produceDcScanSummaryPlots_20150827_coldTest_0p1to1p4_step0p0010.root"
 StuckBitsOverflowProbHistoName:     "pCorrFracOverflowVsInputLsbCell"
 StuckBitsUnderflowProbHistoName:     "pCorrFracUnderflowVsInputLsbCell"

# random initial guesses for charge inefficiency and wrong-type collection on the induction-plane wires
# the second number is for the gap with the deflector

 FractUUCollect:        [ 0.5, 0 ]        # fraction of charge that collects on U (non-transparency) when charge drifts over the comb holding U wires
 FractUVCollect:        [ 0.1, 0 ]        # fraction of charge that collects on U (non-transparency) when charge drifts over the comb holding V wires
 FractVUCollect:        [ 0.5, 0 ]        # fraction of charge that collects on V (non-transparency) when charge drifts over the comb holding U wires
 FractVVCollect:        [ 0.1, 0 ]        # fraction of charge that collects on V (non-transparency) when charge drifts over the comb holding V wires
 FractUUMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on U when charge drifts over the comb holding U
 FractUVMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on U when charge drifts over the comb holding V
 FractVUMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on V when charge drifts over the comb holding U
 FractVVMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on V when charge drifts over the comb holding V
 FractZUMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on Z (collection) when charge drifts over the comb holding U
 FractZVMiss:           [ 0.2, 0 ]        # fraction of charge that gets missed on Z (collection) when charge drifts over the comb holding V
 FractHorizGapUMiss:    [ 0.8, 0 ]        # fraction of charge in the horizontal gap that is missing on U
 FractVertGapUMiss:     [ 0.8, 0 ]        # fraction of charge in the horizontal gaps that is missing on U
 FractHorizGapVMiss:    [ 0.8, 0 ]        # fraction of charge in the horizontal gap that is missing on V
 FractVertGapVMiss:     [ 0.8, 0 ]        # fraction of charge in the horizontal gaps that is missing on V
 FractHorizGapZMiss:    [ 0.8, 0 ]        # fraction of charge in the horizontal gap that is missing on Z
 FractVertGapZMiss:     [ 0.8, 0 ]        # fraction of charge in the horizontal gaps that is missing on Z
 FractHorizGapUCollect: [ 0.1, 0 ]        # fraction of charge in the horizontal gap that collects on U
 FractHorizGapVCollect: [ 0.1, 0 ]        # fraction of charge in the horizontal gap that collects on V
 FractVertGapUCollect:  [ 0.1, 0 ]        # fraction of charge in the vertical gap that collects on U
 FractVertGapVCollect:  [ 0.1, 0 ]        # fraction of charge in the vertical gap that collects on V
}

dunefd_simwireana:            @local::standard_simwireana
dunefd_wienerfilterana:       @local::standard_wienerfilterana


# For now treat the other dune geometries like FD

dune35t_simwire:		@local::dunefd_simwire
dune35t_simwire.PedestalOn:     true        #add pedestal value to ADC vector
dune35t_simwire.CollectionPed:  500         #ADC baseline for coll plane
dune35t_simwire.CollectionPedRMS:    0.0    #ADC baseline RMS for coll plane
dune35t_simwire.InductionPed:   1800        #ADC baseline for ind plane
dune35t_simwire.InductionPedRMS:    0.0    #ADC baseline RMS for ind plane
dune35t_simwire.CollectionCalibPed:  500         #Assumed measured value for coll plane pedestal
dune35t_simwire.CollectionCalibPedRMS:  0.0     #Assumed measured value for coll plane pedestal RMS
dune35t_simwire.InductionCalibPed:   1800        #Assumed measured value for ind plane pedestal
dune35t_simwire.InductionCalibPedRMS:   0.0        #Assumed measured value for ind plane pedestal RMS
#dune35t_simwire.CompressionType:    "none"      #no data compression for noise test

dune35t_simwire.ZeroThreshold:  5
dune35t_simwire.NoiseModel:     1
dune35t_simwire.NoiseWidthU:  2000  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.NoiseWidthV:  2000  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.NoiseWidthZ:  2000  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.NoiseFactU:   0.05  # Should produce RMS of 2.5 ADC counts
dune35t_simwire.NoiseFactV:   0.05  # Should produce RMS of 2.5 ADC counts
dune35t_simwire.NoiseFactZ:   0.05  # Should produce RMS of 2.5 ADC counts
#dune35t_simwire.NoiseFactU:   0.1  # Should produce RMS of 5 ADC counts
#dune35t_simwire.NoiseFactV:   0.1  # Should produce RMS of 5 ADC counts
#dune35t_simwire.NoiseFactZ:   0.1  # Should produce RMS of 5 ADC counts
dune35t_simwire.LowCutoffU:    7.5  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.LowCutoffV:    7.5  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.LowCutoffZ:    7.5  # If turn NoiseModel to 1 use these numbers..
dune35t_simwire.SimStuckBits:    false   # Simulate stuck bits
dune35t_simwireana:             @local::dunefd_simwireana
dune35t_wienerfilterana:        @local::dunefd_wienerfilterana
dune35t_simwire.module_type:    "SimWireDUNE35t"

dune35t_simcounter:
{
    module_type:           "SimCounter35t"
    LArGeantModuleLabel:   "largeant"
    MakeTree:              false
    BSUTriggerThreshold:   0.5 # MeV
    TSUTriggerThreshold:   0.25 # MeV
    TriggerEfficiency:     1.0
# below changed on Feb. 1 2016 to match data . .
#    ClockSpeedCounter:     31.25 # MHz
    ClockSpeedCounter:     64.0 # MHz
    CombinedTimeDelay:     160 # ns. cable length delay + various electronics delays
}

END_PROLOG
BEGIN_PROLOG

standard_spacecharge:
{
  EnableSimSpatialSCE:       false
  EnableSimEfieldSCE:        false
  EnableCalSpatialSCE:       false
  EnableCalEfieldSCE:        false
  EnableCorrSCE:			 false
  RepresentationType:       "Parametric"
  InputFilename:            "SCEoffsets.root"
  CalibrationInputFilename: "SCEoffsets.root"
  service_provider:          SpaceChargeServiceStandard
}

bo_spacecharge:         @local::standard_spacecharge
jp250L_spacecharge:     @local::standard_spacecharge
argoneut_spacecharge:   @local::standard_spacecharge
microboone_spacecharge: @local::standard_spacecharge
dune35t_spacecharge:    @local::standard_spacecharge
dunefd_spacecharge:     @local::standard_spacecharge

END_PROLOG

BEGIN_PROLOG

dunefd_spacecharge:   @local::standard_spacecharge

dunefddphase_spacecharge:   @local::standard_spacecharge

protodune_spacecharge:   				@local::standard_spacecharge
protodune_spacecharge.InputFilename:  			"SpaceChargeProtoDUNE/SCE_DataDriven_180kV_v4.root"
protodune_spacecharge.CalibrationInputFilename:	        "SpaceChargeProtoDUNE/SCE_DataDriven_180kV_v4.root"
protodune_spacecharge.RepresentationType:               "Splines_TH3"
protodune_spacecharge.service_provider:  		SpaceChargeServiceProtoDUNE

protodunedp_spacecharge:                                                  @local::standard_spacecharge
protodunedp_spacecharge.InputFilename:                    "666_short_50kV.root"
protodunedp_spacecharge.RepresentationType:       "Voxelized_TH3"
protodunedp_spacecharge.service_provider:                 SpaceChargeServiceProtoDUNEdp


dune35t_spacecharge:   @local::standard_spacecharge
dune35t_spacecharge.InputFilename:  "SpaceCharge35t/SCEoffsets_DUNE35t_E500.root"
dune35t_spacecharge.service_provider:  SpaceChargeServiceDUNE35t

dphase3x1x1_spacecharge:   @local::standard_spacecharge
dphase3x1x1_spacecharge.InputFilename:  "SpaceCharge35t/SCEOffsets_311_Fieldcage_E500.root"
dphase3x1x1_spacecharge.service_provider:  SpaceChargeService3x1x1dphase

END_PROLOG
# dataprep_dune.fcl
#
# David Adams
# August 2016
#
# This holds all the prolog for dataprep.

BEGIN_PROLOG

#***********************************************************************

# AdcChannelDataCopyService copies AdcChannelData.

adccopy: {
  service_provider: ConfigurableAdcChannelDataCopyService
  LogLevel:           1
  CopyChannel:     true
  CopyPedestal:    true
  CopyRaw:        false
  CopySamples:     true
  CopyFlags:      false
  CopyRois:       false
  CopyDigit:       true
  CopyWire:       false
  CopyDigitIndex:  true
  CopyWireIndex:  false
}

#***********************************************************************

# RawDigitExtractService pulls ADC signals (raw:RawDigit) out of the lar
# container, converts to float, flags bad channels and subtracts pedestals.

rdx_std: {
  service_provider: StandardRawDigitExtractService
  LogLevel: 1
  DigitReadTool: digitReader
  PedestalOption: 1
  FlagStuckOff: false
  FlagStuckOn: false
}

rdx_35tdata: {
  service_provider: StandardRawDigitExtractService
  LogLevel: 1
  DigitReadTool: digitReader
  PedestalOption: 1
  FlagStuckOff: true
  FlagStuckOn: true
}

#***********************************************************************

# AdcMitigationService is used to mitigate ADC signals, e.g.
# interpolate between good values to deal with stuck bits.

adcmit_dune35t: {
  service_provider: InterpolatingAdcMitigationService
  LogLevel: 1
  SkipUnderflows:      true
  SkipOverflows:       true
  MaxConsecutiveSamples:  5
  MaxConsecutiveFlag:     0
}

#***********************************************************************

# AdcSuppressService is used by AdcSuppressSignalFindingService (below).

adcsuppress_legacy35t: {
  service_provider: Legacy35tZeroSuppressService
  AdcThreshold: 30.0
  TickRange: 4
  MinTickGap: 2
  SuppressStickyBits: false
}

#***********************************************************************

# AdcSuppressSignalFindingService is used to remove noise from ADC signals.

# This implementation uses AdcSuppressService.
adcsigfind_suppress: {
  service_provider: AdcSuppressSignalFindingService
}

#***********************************************************************

# AdcNoiseRemovalService is used to remove noise from ADC signals.

adcnr_dune35tlegacy: {
}

adcnr_dunedphase3x1x1: {
  service_provider: DuneDPhase3x1x1NoiseRemovalService
  CorrMode:                         "median" # mean or median
  DoTwoPassFilter:                      false
  BinsToSkip: 				2
  Coherent32:                           true
  Coherent32Groups:                       [] # do all groups if empty list
  Coherent16:                           true
  Coherent16Groups:   [6, 7, 16, 17, 18, 19] # do all groups if empty list
  UseBasicROIForCNR:			 true
  RoiStartThreshold:                       7
  RoiEndThreshold:                         6
  RoiPadLow:                               8
  RoiPadHigh:                             40
  Flatten:                              true
  FlattenExtrapolate:			false
  LowPassFlt:                           false
  LowPassFltSecondPass:                 false
  LowPassFltFCut:                       0.5
  LowPassFltExpo:                       8
}

#***********************************************************************

# PedestalEvaluationService is used to evaluate pedestals from the
# ADC signals.

adcped_median: {
  service_provider: MedianPedestalService
  LogLevel:              1
  UseMean:            false
  SkipFlaggedSamples: true
  SkipSignals:        true
}

adcped_mean: {
  service_provider: MedianPedestalService
  LogLevel:              1
  UseMean:            true
  SkipFlaggedSamples: true
  SkipSignals:        true
}

#***********************************************************************

# AdcDeconvolutionService is used to deconvolute the ADC signals.

adcdco_dune35t: {
  service_provider: DuneDeconvolutionService
  LogLevel:              1
}

adcdco_dunefd: @local::adcdco_dune35t

adcdco_dunefddphase: {
  service_provider: DuneDPhaseDeconvolutionService
  LogLevel:              1
}

#***********************************************************************

# AdcRoiBuildingService is used to define ROIs for the ADC signals.

adcroi_dune35t: {
  service_provider: DuneRoiBuildingService
  NSigmaStart:        3.0
  NSigmaEnd:          1.0
  PadLow:              50
  PadHigh:             50
  LogLevel:             1
}

adcroi_dunefd: @local::adcroi_dune35t

adcroi_dunefddphase: {
  service_provider: DuneDPhaseRoiBuildingService
  UseFilter:                 false
  FltCoeffs:     [0.1, 0.75, 0.95]
  NSigmaStart:                 3.0
  NSigmaEnd:                   1.0
  PadLow:                       50
  PadHigh:                      50
  LogLevel:                      1
}

adcroi_keepall: {
  service_provider: KeepAllRoiBuildingService
  LogLevel:              1
}

#***********************************************************************

# AdcWireBuildingService constructs lar outputs (recob::Wire) from ADC
# signals.

adcwire_std: {
  service_provider: StandardAdcWireBuildingService
  LogLevel:              1
}

#***********************************************************************

# RawDigitPrepService is the high level service that uses the above
# services to prepare ADC signals including the conversion of
# raw::RawDigit to recob::Wire.

# Read raw data and subtract pedestals without any other preparation.
adcprep_readraw: {
  service_provider: StandardRawDigitPrepService
  LogLevel: 1
  SkipBad:               false
  SkipNoisy:             false
  DoMitigation:          false
  DoEarlySignalFinding:  false
  DoNoiseRemoval:        false
  DoPedestalAdjustment:  false
  DoDeconvolution:       false
  DoROI:                 false
  DoWires:               false
  DoIntermediateStates:  false
  DisplayTools:             []
}

# Process simulation using service-based dataprep.
adcprep_with_services_sim: {
  service_provider: StandardRawDigitPrepService
  LogLevel: 1
  SkipBad:                true
  SkipNoisy:             false
  DoMitigation:          false
  DoEarlySignalFinding:  false
  DoNoiseRemoval:        false
  DoPedestalAdjustment:  false
  DoDeconvolution:        true
  DoROI:                  true
  DoWires:                true
  DoIntermediateStates:  false
  DisplayTools:             []
}

# Process simulation using tool-based dataprep.
adcprep_with_tools_sim: {
  service_provider: ToolBasedRawDigitPrepService
  LogLevel: 3
  DoWires: true
  AdcChannelToolNames: [
    "digitReader",
    "adcSampleFiller",
    "adcVintageDeconvoluter",
    "adcThresholdSignalFinder"
  ]
  CallgrindToolNames: []
}

# Process data using tool-based dataprep.
adcprep_with_tools_data: {
  service_provider: ToolBasedRawDigitPrepService
  LogLevel: 3
  DoWires: true
  AdcChannelToolNames: [
    "digitReader",
    "adcSampleFiller",
    "adcVintageDeconvoluter",
    "adcThresholdSignalFinder"
  ]
  CallgrindToolNames: []
}

# Process DP 3x1x1 data.
adcprep_dunedphase3x1x1: {
  service_provider: StandardRawDigitPrepService
  LogLevel: 1
  SkipBad:               false
  SkipNoisy:              true
  DoMitigation:          false
  DoEarlySignalFinding:  false
  DoNoiseRemoval:         true
  DoPedestalAdjustment:  false
  DoDeconvolution:        true
  DoROI:                  true
  DoWires:                true
  DoIntermediateStates:  false
  DisplayTools:             []
}

# Process 35-ton data
adcprep_dune35tdata: {
  service_provider: StandardRawDigitPrepService
  LogLevel: 1
  SkipBad:                true
  SkipNoisy:             false
  DoMitigation:           true
  DoEarlySignalFinding:   true
  DoNoiseRemoval:         true
  DoPedestalAdjustment:  false
  DoDeconvolution:        true
  DoROI:                  true
  DoWires:                true
  DoIntermediateStates:  false
  DisplayTools:             []
}

#***********************************************************************

# Channel groups.

# Process by APA keeping all ROPs.
changroup_apa_keepall: {
  service_provider: GeoApaChannelGroupService
  LogLevel: 1
  ApaRops: []
}

# Process by APA dropping the protoDUNE cryostat-side collection plane.
changroup_apa_pd_drop_outer: {
  service_provider: GeoApaChannelGroupService
  LogLevel: 1
  ApaRops: [11, 7]
}

# Process by APA keeping only the protoDUNE TPC-side collection plane.
changroup_apa_pd_tpccoll: {
  service_provider: GeoApaChannelGroupService
  LogLevel: 1
  ApaRops: [ 8, 4]
}

changroup_rop: {
  service_provider: GeoRopChannelGroupService
}

#***********************************************************************

# DataPrepModule is the producer that calls RawDigitPrepService

# This configuration does not make use of the decoding tool.
# Input is raw::RawDigit vector DigitLabel in the event data store.
# Use with MC. Can be used with data if the decoder module is called first.
producer_adcprep_notool: {
  module_type:   "DataPrepModule"
  LogLevel:                     1
  DecoderTool:                 ""       # Non-blank reads digits with named tool.
  DigitLabel:               "daq"       # Label for input digits if decoder tool is not used
  TimeStampName:               ""       # Non-blank writes RDTimeStamps if decoder tool is used
  OutputDigitName:             ""       # Non-blank writes digits if decoder tool is used
  WireName:                    ""
  DoAssns:                   true
  DoGroups:                  true
  ChannelRanges:               []
  BeamEventLabel:              ""
  IntermediateStates:          []
  OnlineChannelMapTool:  pd_onlineChannelMapByFemb
}

# This configuration uses the decoding tool and the old module.
# All APAs are decoded in one call to the tool.
# Obsolete. Use the byAPA module instead.
producer_adcprep_tool_old: {
  module_type: "DataPrepModule"
  LogLevel:                   1
  DecoderTool:   "pdsp_decoder"      # Non-blank reads digits with named tool.
  DigitLabel:                ""       # Label for input digits if decoder tool is not used
  TimeStampName:     "dataprep"       # Non-blank writes RDTimeStamps if decoder tool is used
  OutputDigitName:           ""       # Non-blank writes digits if decoder tool is used
  WireName:                  ""
  DoAssns:                 true
  DoGroups:                true
  ChannelRanges:             []
  BeamEventLabel:            ""
  IntermediateStates:        []
  OnlineChannelMapTool:  pd_onlineChannelMapByFemb
}

# This configuration uses the decoding tool and the new byAPA module.
# All APAs are decoded in one call to the tool if ChannelGroups = ["all"]
# Use ChannelGroups = ["apas"] to process one APA at a time.
producer_adcprep_byapa: {
  module_type: "DataPrepByApaModule"
  LogLevel:                     1
  DecoderTool:     "pdsp_decoder"       # Tool that reads digits.
  OutputTimeStampName: "dataprep"       # Non-blank writes digit RDTimeStamps
  OutputDigitName:             ""       # Non-blank writes digits
  OutputWireName:      "dataprep"       # Non-blank writes wires (processed digits)
  ChannelGroups:         ["apas"]
  BeamEventLabel:              ""
  KeepChannels:                []       # Channels to keep (all if empty).
  SkipChannels:                []       # Channels to skip.
  SkipEmptyChannels:         true       # If true, empty channels are not processed and do not produce wires
  DeltaTickCount:           0.005       # If true, empty channels are not processed and do not produce wires
  ApaChannelCounts:        [2560]       # # of channels in each APA. Last value used for later values.
  OnlineChannelMapTool: pd_onlineChannelMapByFemb
}

producer_adcprep: @local::producer_adcprep_notool

#***********************************************************************

END_PROLOG
# protodune_dataprep_services.fcl
#
# David Adams
# February 2010
#
# Dataprep service configurations.
#
# Dataprep is now mostly tool-based but one important service remains:
# ToolBasedRawDigitPrepService with interface RawDigitPrepService.
# It is called by each of the dataprep modules to run an ADC channel tool
# sequence to process the TPC data.
#
# Some standard sequences are defined here.
#
###################################################################################
# Dataprep tool sequences for protoDUNE SP data.
###################################################################################

BEGIN_PROLOG

# No calibration, no noise removal.
protodune_dataprep_tools_nocal_tail: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleFiller",            # Subtract pedestal, trivial calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate",        # Mitigate FEMB302 timing
  "adcCorrectUndershootAdc"     # correct undershoot
]

# Charge calibration; no mitigation or tail or noise removal.
protodune_dataprep_tools_calib_only: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection"         # Correct gain calibration
]

# Charge calibration and mitigation, no tail or noise removal.
protodune_dataprep_tools_calib_mit: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection",        # Correct gain calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate"         # Mitigate FEMB302 timing
]

# Charge calibration, mitigation, obsolete tail removal, no noise removal.
protodune_dataprep_tools_calib_oldtail: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection",        # Correct gain calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate",        # Mitigate FEMB302 timing
  "adcCorrectUndershootKe"      # correct undershoot
]

# Charge calibration, mitigation, tail removal, no noise removal.
protodune_dataprep_tools_calib_tail: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection",        # Correct gain calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate",        # Mitigate FEMB302 timing
  "pdspTailPedRemovalZKe"       # Tail removal
]

# Charge calibration, noise removal.
protodune_dataprep_tools_calib_noiserem: [
  "digitReader",                # Read RawDigit
  "pdsp_sticky_codes_ped",      # Flag sticky codes
  "pd_adcPedestalFit",          # Find pedestal
  "adcSampleCalibration",       # Subtract pedestal and apply charge calibration
  "pdsp_gainCorrection",        # Correct gain calibration
  "pdsp_adcMitigate",           # Mitigate sticky codes
  "pdsp_timingMitigate",        # Mitigate FEMB302 timing
  "pdspTailPedRemovalZKe",      # Tail removal
  "pdsp_noiseRemovalKe"         # Remove high frequency noise and coherent noise
]

# Drop ROIs, scale back to ADC and zero bad/noisy channels for wirecell processing.
protodune_dataprep_tools_wirecell: [
  @sequence::protodune_dataprep_tools_calib_noiserem,
  "adcKeepAllSignalFinder",     # Keep all signal (no ROIs)
  "adcScaleKeToAdc",            # Scale samples to nominal ADC counts
  "pdsp_RemoveBadChannels"      # Set bad channels to 0 ADC
]

###################################################################################
# Dataprep tool sequences for protoDUNE SP simulation.
###################################################################################

pdsim_dataprep_tools_vintage: [
    "digitReader",              # Read RawDigit
    "adcSampleFiller",          # Subtract pedestal, trivial calibration
    "adcVintageDeconvoluter",   # Deconvolution
    "adcThresholdSignalFinder", # ROI
    "pdsp_RemoveBadChannels"    # Set bad channels to 0 ADC
]

# ProtoDUNE sim dataprep leaving samples at ADC scale. Passthru for wirecell.
pdsim_dataprep_tools_adc: [
  "digitReader"                 # Read RawDigit
]

# ProtoDUNE sim dataprep converted to ke scale.
pdsim_dataprep_tools_calib: [
  "digitReader",                # Read RawDigit
  "adcSampleFiller",            # Subtract pedestal, trivial calibration
  "adcScaleAdcToKe"             # Scale samples to nominal ADC counts
]

# ProtoDUNE sim dataprep at ke scale with tail removal.
pdsim_dataprep_tools_oldtail: [
  @sequence::pdsim_dataprep_tools_calib,
  "adcCorrectUndershootKe"      # correct undershoot with old tool
]

# ProtoDUNE sim dataprep at ke scale with tail removal.
pdsim_dataprep_tools_tail: [
  @sequence::pdsim_dataprep_tools_calib,
  "pdspTailPedRemovalZKe"       # correct tails
]

# Drop ROIs, scale back to ADC and zero bad/noisy channels for wirecell processing.
pdsim_dataprep_tools_wirecell: [
  @sequence::pdsim_dataprep_tools_tail,
  "adcKeepAllSignalFinder",     # Keep all signal (no ROIs)
  "adcScaleKeToAdc",            # Scale samples to nominal ADC counts
  "pdsp_RemoveBadChannels"      # Set bad channels to 0 ADC
]

# Specify here the default sequence used in reconstruction of MC data.
#protodune_dataprep_tools_sim: @local::pdsim_dataprep_tools_vintage
#protodune_dataprep_tools_sim: @local::pdsim_dataprep_tools_calib
protodune_dataprep_tools_sim: @local::pdsim_dataprep_tools_tail

###################################################################################
#
END_PROLOG

# PdspChannelMapService.fcl
#
# Temporary copy until dune_raw_data is released with this prolog.

BEGIN_PROLOG

# ProtoDUNE-SP online/offline channel mapping.

pdspchannelmap: {
  FileName:         "protoDUNETPCChannelMap_RCE_v4.txt"
  FELIXFileName:    "protoDUNETPCChannelMap_FELIX_v4.txt"
  SSPFileName:      "protoDUNESSPChannelMap_v1.txt"
  LogLevel:         1
}

END_PROLOG

BEGIN_PROLOG

# Iceberg online/offline channel mapping.
# SSP map left over from PDSP for now
# include a FELIX map in case someone uses FELIX for Iceberg

icebergchannelmap: {
  FileName:         "IcebergChannelMap_RCE_v1.txt"
  FELIXFileName:    "IcebergChannelMap_FELIX_v1.txt"
  SSPFileName:      "protoDUNESSPChannelMap_v1.txt"
  LogLevel:         1
}

END_PROLOG
BEGIN_PROLOG

protodune_xyzcalib :
{
  service_provider: "XYZCalibServiceProtoDUNE"

  UseCondbXYZCorr: true
  Interpolate: false

  XCorrFileName: ""
  YZCorrFileName: ""
  NormCorrFileName: ""

  XCorrDBTag: ""
  YZCorrDBTag: ""
  NormCorrDBTag: ""

}

END_PROLOG
BEGIN_PROLOG

protodune_lifetimecalib :
{
  service_provider: "LifetimeCalibServiceProtoDUNE"

  IsMC: false
  UseCondbLifetime: false
  Interpolate: true
  LifetimeFileName: ""
  LifetimeDBTag: ""

}

END_PROLOG
BEGIN_PROLOG

#
# Applies channel-by-channel PE calibrations
#
protodunesp_photoncalibrator:
{
   service_provider: PhotonCalibratorServiceProtoDUNESP
   BadChannels:      [25, 36, 49, 51, 58, 62, 65, 72, 73, 75, 82, 101, 110, 119, 156, 160  ]
}


END_PROLOG
BEGIN_PROLOG

dune_time_tracker: { 
  printSummary : true
  dbOutput     : {
    filename   :  "time.db"
    overwrite  :  true
  }
}

dune_memory_tracker: {
  includeMallocInfo : true
  dbOutput     : {
    filename   :  "mem.db"
    overwrite  :  true
  }
}

END_PROLOG
BEGIN_PROLOG

dunefddphase_crpgain: {
   service_provider: CrpGainService
   LogLevel:       1
   CrpDefaultGain: 6
   CrpNumLem:      36
   LemViewChans:   160
   LemEffTool:     ""
}

# protodune dp LEM efficiency map for CFR-35 design
protodunedphase_crpgain:            @local::dunefddphase_crpgain
protodunedphase_crpgain.LemEffTool: "lemEfficiency"

# simple CRP gain service configuration always returns one number
single_crpgain: @local::dunefddphase_crpgain
single_crpgain.CrpNumLem: 1
single_crpgain.LemEffTool: ""


END_PROLOG

BEGIN_PROLOG

# The above *_dune.fcl include contain the parameter blocks
# for all dune geometries. All PROLOG files for dune should
# contain all of the parameters for each dune geometry so
# that they are in one place and there is only one type of
# file to include. This file is an example of that



############################
### Dune FD Single Phase ###
############################

dunefd_services: {
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 Geometry:                       @local::dune10kt_geo
 GeometryConfigurationWriter: {}
 DetectorClocksService:          @local::dunefd_detectorclocks
 DetectorPropertiesService:      @local::dunefd_detproperties
 LArPropertiesService:           @local::dunefd_properties
 LArFFT:                         @local::dunefd_larfft
 DatabaseUtil:                   @local::dunefd_database
 BackTrackerService:                    @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 PhotonBackTrackerService:              @local::dunefd_photonbacktrackerservice
 SpaceCharge:                    @local::dunefd_spacecharge
 NuRandomService:                @local::dune_seedservice
 SignalShapingServiceDUNE:       @local::dunefd_signalshapingservice
 ChannelStatusService:           @local::dunefd_channel_status
 ChannelGroupService:            @local::changroup_apa_keepall
}

dunefd_simulation_services: {
 LArFFT:                       @local::dunefd_larfft
 LArG4Parameters:              @local::dunefd_largeantparameters
 ExptGeoHelperInterface:       @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 Geometry:                     @local::dune10kt_geo
 DetectorClocksService:        @local::dunefd_detectorclocks
 DetectorPropertiesService:    @local::dunefd_detproperties
 LArPropertiesService:         @local::dunefd_properties
 DatabaseUtil:                 @local::dunefd_database
 LArVoxelCalculator:           @local::dunefd_larvoxelcalculator
 MagneticField:                @local::no_mag_larsoft
 BackTrackerService:                  @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 PhotonBackTrackerService:            @local::dunefd_photonbacktrackerservice
 SpaceCharge:                  @local::dunefd_spacecharge
 NuRandomService:              @local::dune_seedservice
 SignalShapingServiceDUNE:     @local::dunefd_signalshapingservice
 OpDetResponseInterface:       @local::dunefd_opdetresponse
 ChannelStatusService:         @local::dunefd_channel_status
}

# Reco services for 35-ton simulation.
dunefd_reco_services:                            @local::dunefd_services
dunefd_reco_services.RawDigitExtractService:     @local::rdx_std
dunefd_reco_services.RawDigitPrepService:        @local::adcprep_with_services_sim
dunefd_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefd
dunefd_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefd
dunefd_reco_services.AdcWireBuildingService:     @local::adcwire_std

# Settings for optical simulation in the FD. Optical simulation not on by default
# for FD, turned on by custom physics list and defining a photon visibility
# services is workspace g4 fhicl file.

dunefd_simulation_services.LArPropertiesService.ScintYield: 24000
dunefd_simulation_services.LArPropertiesService.ScintPreScale: 0.05
dunefd_simulation_services.LArPropertiesService.EnableCerenkovLight: false





####################################
### DUNE far detector dual phase ###
####################################

dunefddphase_services: {
 DatabaseUtil:                   @local::dunefd_database
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 ChannelStatusService:           @local::dunefd_channel_status
 LArFFT:                         @local::dunefd_larfft
 NuRandomService:                @local::dune_seedservice
 Geometry:                       @local::dunedphase10kt_geo
 DetectorClocksService:          @local::dunefddphase_detectorclocks
 DetectorPropertiesService:      @local::dunefddphase_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::dunefddphase_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::dunefddphase_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
}

dunefddphase_simulation_services: {
 BackTrackerService:                    @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 LArFFT:                         @local::dunefd_larfft
 LArG4Parameters:                @local::dunefd_largeantparameters
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 LArVoxelCalculator:             @local::dunefd_larvoxelcalculator
 MagneticField:                  @local::no_mag_larsoft
 NuRandomService:                @local::dune_seedservice
 DatabaseUtil:                   @local::dunefd_database
 OpDetResponseInterface:         @local::standard_opdetresponse
 PhotonBackTrackerService:       @local::standard_photonbacktrackerservice
 ChannelStatusService:           @local::dunefd_channel_status
 Geometry:                       @local::dunedphase10kt_geo
 DetectorClocksService:          @local::dunefddphase_detectorclocks
 DetectorPropertiesService:      @local::dunefddphase_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::dunefddphase_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::dunefddphase_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
 DetPedestalService:		 @local::dunedp_fixedpeds
}

dunefddphase_reco_services:                            @local::dunefddphase_services
dunefddphase_reco_services.BackTrackerService:                @local::dunefd_backtrackerservice
dunefddphase_reco_services.ParticleInventoryService:      @local::standard_particleinventoryservice
dunefddphase_reco_services.RawDigitExtractService:     @local::rdx_std
dunefddphase_reco_services.RawDigitPrepService:        @local::adcprep_with_services_sim
dunefddphase_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefddphase
dunefddphase_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefddphase
dunefddphase_reco_services.AdcWireBuildingService:     @local::adcwire_std
dunefddphase_reco_services.PedestalEvaluationService:  @local::adcped_median
dunefddphase_reco_services.AdcNoiseRemovalService:     @local::adcnr_dunedphase3x1x1

# Settings for optical simulation in the FD. Optical simulation not on by default
# for FD, turned on by custom physics list and defining a photon visibility
# services is workspace g4 fhicl file.

dunefddphase_simulation_services.LArPropertiesService.ScintYield: 24000
dunefddphase_simulation_services.LArPropertiesService.ScintPreScale: 1
dunefddphase_simulation_services.LArPropertiesService.EnableCerenkovLight: false
dunefddphase_simulation_services.OpDetResponseInterface.QuantumEfficiency: 0.12 # including TPB from arxiv 1807.07123



########################
### 3x1x1 dual phase ###
########################
dunedphase3x1x1_services: {
 DatabaseUtil:                   @local::dunefd_database
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 ChannelStatusService:           @local::dunedphase3x1x1_channel_status
 LArFFT:                         @local::dunefd_larfft
 NuRandomService:                @local::dune_seedservice
 Geometry:                       @local::dphase3x1x1_geo
 DetectorClocksService:          @local::dunedphase3x1x1_detectorclocks
 DetectorPropertiesService:      @local::dphase3x1x1_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::dunedphase3x1x1_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::single_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
}

dunedphase3x1x1_simulation_services: {
 BackTrackerService:                    @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 LArFFT:                         @local::dunefd_larfft
 LArG4Parameters:                @local::protodune_largeantparameters
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 LArVoxelCalculator:             @local::dunefd_larvoxelcalculator
 MagneticField:                  @local::no_mag_larsoft
 NuRandomService:                @local::dune_seedservice
 DatabaseUtil:                   @local::dunefd_database
 OpDetResponseInterface:         @local::standard_opdetresponse
 PhotonBackTrackerService:       @local::standard_photonbacktrackerservice
 ChannelStatusService:           @local::dunedphase3x1x1_channel_status
 Geometry:                       @local::dphase3x1x1_geo
 DetectorClocksService:          @local::dunedphase3x1x1_detectorclocks
 DetectorPropertiesService:      @local::dphase3x1x1_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::dunedphase3x1x1_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::single_crpgain
 SpaceCharge:                    @local::dphase3x1x1_spacecharge
 PhotonVisibilityService: 	 @local::dunedphase3x1x1_photonvisibilityservice
 PhotonVisibilityServiceS2: 	 @local::dunedphase3x1x1_photonvisibilityserviceS2
 DetPedestalService:		 @local::dunedp_fixedpeds
 OpDigiProperties: 		 @local::dunedphase3x1x1_opdigiproperties
}

dunedphase3x1x1_reco_services:                            @local::dunedphase3x1x1_services
dunedphase3x1x1_reco_services.BackTrackerService:                @local::dunefd_backtrackerservice
dunedphase3x1x1_reco_services.ParticleInventoryService:      @local::standard_particleinventoryservice
dunedphase3x1x1_reco_services.RawDigitExtractService:     @local::rdx_std
dunedphase3x1x1_reco_services.RawDigitPrepService:        @local::adcprep_dunedphase3x1x1
dunedphase3x1x1_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefddphase
dunedphase3x1x1_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefddphase
dunedphase3x1x1_reco_services.AdcWireBuildingService:     @local::adcwire_std
dunedphase3x1x1_reco_services.PedestalEvaluationService:  @local::adcped_median
dunedphase3x1x1_reco_services.AdcNoiseRemovalService:     @local::adcnr_dunedphase3x1x1

# Settings for optical simulation in the FD. Optical simulation not on by default
# for FD, turned on by custom physics list and defining a photon visibility
# services is workspace g4 fhicl file.

dunedphase3x1x1_simulation_services.LArG4Parameters.UseCustomPhysics: true
dunedphase3x1x1_simulation_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                           "FastOptical",
                                           "SynchrotronAndGN",
                                           "Ion",
                                           "Hadron",
                                           "Decay",
                                           "HadronElastic",
                                           "Stopping",
                                           "NeutronTrackingCut" ]
dunedphase3x1x1_simulation_services.LArPropertiesService.ScintYield: 		24000
dunedphase3x1x1_simulation_services.LArPropertiesService.EnableCerenkovLight: 	false
dunedphase3x1x1_simulation_services.LArPropertiesService.ScintPreScale: 	1
dunedphase3x1x1_simulation_services.OpDetResponseInterface.QuantumEfficiency: 	1.0

############################
### protoDUNE dual phase ###
############################

protodunedphase_services: {
 DatabaseUtil:                   @local::dunefd_database
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 ChannelStatusService:           @local::dunefd_channel_status
 LArFFT:                         @local::dunefd_larfft
 NuRandomService:                @local::dune_seedservice
 Geometry: 			 @local::protodunedphase_geo
 DetectorClocksService:          @local::protodunedphase_detectorclocks
 DetectorPropertiesService: 	 @local::protodunedphase_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::protodunedphase_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::dunefddphase_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
 CrpGainService:                 @local::dunefddphase_crpgain
}


protodunedphase_simulation_services: {
 BackTrackerService:                    @local::dunefd_backtrackerservice
 ParticleInventoryService:      @local::standard_particleinventoryservice
 LArFFT:                         @local::dunefd_larfft
 LArG4Parameters:                @local::protodune_largeantparameters
 ExptGeoHelperInterface:         @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 LArVoxelCalculator:             @local::dunefd_larvoxelcalculator
 MagneticField:                  @local::no_mag_larsoft
 NuRandomService:                @local::dune_seedservice
 DatabaseUtil:                   @local::dunefd_database
 OpDetResponseInterface:         @local::standard_opdetresponse
 PhotonBackTrackerService:       @local::standard_photonbacktrackerservice
 ChannelStatusService:           @local::dunefd_channel_status
 Geometry: 			 @local::protodunedphase_geo
 DetectorClocksService:          @local::protodunedphase_detectorclocks
 DetectorPropertiesService: 	 @local::protodunedphase_detproperties
 LArPropertiesService:           @local::dunefddphase_properties
 SignalShapingServiceDUNEDPhase: @local::protodunedphase_signalshapingservice
 SimChannelExtractService:       @local::scxdp
 CrpGainService:                 @local::dunefddphase_crpgain
 SpaceCharge:                    @local::dunefddphase_spacecharge
 PhotonVisibilityService: 	 @local::protodunedp_photonvisibilityservice
 PhotonVisibilityServiceS2: 	 @local::protodunedp_photonvisibilityserviceS2
 DetPedestalService:		 @local::dunedp_fixedpeds
 CrpGainService:                 @local::dunefddphase_crpgain
 OpDigiProperties:               @local::protodunedphase_opdigiproperties
}

protodunedphase_reco_services:                         	  @local::protodunedphase_services
protodunedphase_reco_services.BackTrackerService:         @local::dunefd_backtrackerservice
protodunedphase_reco_services.ParticleInventoryService:   @local::standard_particleinventoryservice
protodunedphase_reco_services.RawDigitExtractService:     @local::rdx_std
protodunedphase_reco_services.RawDigitPrepService:        @local::adcprep_with_services_sim
protodunedphase_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefddphase
protodunedphase_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefddphase
protodunedphase_reco_services.AdcWireBuildingService:     @local::adcwire_std
protodunedphase_reco_services.PedestalEvaluationService:  @local::adcped_median
#protodunedphase_reco_services.AdcNoiseRemovalService:    @local::adcnr_dunedphase3x1x1

# Settings for optical simulation in the protodunedp. Optical simulation IS by default ON,
# turned on by custom physics list and defining a photon visibility
# services is workspace g4 fhicl file.

protodunedphase_simulation_services.LArG4Parameters.UseCustomPhysics: true
protodunedphase_simulation_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                           "FastOptical",
                                           "SynchrotronAndGN",
                                           "Ion",
                                           "Hadron",
                                           "Decay",
                                           "HadronElastic",
                                           "Stopping",
                                           "NeutronTrackingCut" ]

protodunedphase_simulation_services.OpDetResponseInterface.QuantumEfficiency: 1
protodunedphase_simulation_services.LArPropertiesService.ScintPreScale: 1
protodunedphase_simulation_services.LArPropertiesService.ScintYield: 24000
protodunedphase_simulation_services.LArPropertiesService.EnableCerenkovLight: false

protodunedphase_driftY_simulation_services: @local::protodunedphase_simulation_services
protodunedphase_driftY_simulation_services.PhotonVisibilityService: 	 @local::protodunedp_driftY_RL99CM_VUVREF_photonvisibilityservice
protodunedphase_driftY_simulation_services.Geometry: 			 @local::protodunedphase_driftY_geo


# dune10kt and dune34kt consolidated into dunefd,
# but catch any leftover cases of 10kt...
#dune10kt_services: @local::dunefd_services
#dune10kt_services.Geometry.GDML: "dune10kt.gdml"
#dune10kt_services.Geometry.ROOT: "dune10kt.gdml"
#dune10kt_simulation_services: @local::dunefd_services
#dune10kt_simulation_services.Geometry.GDML: "dune10kt.gdml"
#dune10kt_simulation_services.Geometry.ROOT: "dune10kt.gdml"





##############################
### ProtoDUNE Single Phase ###
##############################

protodune_services: {
 ExptGeoHelperInterface:       @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 Geometry:                     @local::protodune_geo
 DetectorClocksService:        @local::protodune_detectorclocks
 DetectorPropertiesService:    @local::protodune_detproperties
 LArPropertiesService:         @local::dunefd_properties
 LArFFT:                       @local::dunefd_larfft
 DatabaseUtil:                 @local::dunefd_database
 BackTrackerService:           @local::dunefd_backtrackerservice
 ParticleInventoryService:     @local::dunefd_particleinventoryservice
 PhotonBackTrackerService:     @local::dunefd_photonbacktrackerservice
 SpaceCharge:                  @local::protodune_spacecharge
 NuRandomService:              @local::dune_seedservice
 SignalShapingServiceDUNE:     @local::protodunesp_signalshapingservice
 ChannelStatusService:         @local::dunefd_channel_status
 ChannelGroupService:          @local::changroup_apa_keepall
}


protodune_rawdecoding_services: {
  ExptGeoHelperInterface:       @local::dune_geometry_helper
  GeometryConfigurationWriter: {}
  Geometry:                     @local::protodune_geo
  DetectorClocksService:        @local::protodune_detectorclocks
  DetectorPropertiesService:    @local::protodune_detproperties
  LArPropertiesService:         @local::dunefd_properties
  LArFFT:                       @local::dunefd_larfft  
  DatabaseUtil:                 @local::dunefd_database
  ChannelStatusService:         @local::dunefd_channel_status
#  ChannelGroupService:          @local::changroup_apa
  PdspChannelMapService:        @local::pdspchannelmap
}

iceberg_rawdecoding_services: {
  ExptGeoHelperInterface:       @local::dune_geometry_helper
  GeometryConfigurationWriter: {}
  Geometry:                     @local::iceberg_geo
  DetectorClocksService:        @local::protodune_detectorclocks
  DetectorPropertiesService:    @local::protodune_detproperties
  LArPropertiesService:         @local::dunefd_properties
  LArFFT:                       @local::dunefd_larfft  
  DatabaseUtil:                 @local::dunefd_database
  ChannelStatusService:         @local::dunefd_channel_status
  IcebergChannelMapService:     @local::icebergchannelmap
}

protodune_data_services: {
 ExptGeoHelperInterface:       @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 Geometry:                     @local::protodune_geo
 DetectorClocksService:        @local::protodune_detectorclocks
 DetectorPropertiesService:    @local::protodune_detproperties
 LArPropertiesService:         @local::dunefd_properties
 LArFFT:                       @local::dunefd_larfft
 DatabaseUtil:                 @local::dunefd_database
 SpaceCharge:                  @local::protodune_spacecharge
 NuRandomService:              @local::dune_seedservice
 SignalShapingServiceDUNE:     @local::protodunesp_signalshapingservice
 ChannelStatusService:         @local::pdsp_channel_status
 ChannelGroupService:          @local::changroup_apa_keepall
# Reco services for ProtoDUNE real data.
 RawDigitExtractService:       @local::rdx_std
 RawDigitPrepService:          @local::adcprep_with_services_sim
 AdcDeconvolutionService:      @local::adcdco_dunefd
 AdcRoiBuildingService:        @local::adcroi_dunefd
 AdcWireBuildingService:       @local::adcwire_std
}


protodune_simulation_services: {
 LArFFT:                       @local::dunefd_larfft
 LArG4Parameters:              @local::protodune_largeantparameters
 ExptGeoHelperInterface:       @local::dune_geometry_helper
 GeometryConfigurationWriter: {}
 Geometry:                     @local::protodune_geo
 DetectorClocksService:        @local::protodune_detectorclocks
 DetectorPropertiesService:    @local::protodune_detproperties
 LArPropertiesService:         @local::dunefd_properties
 DatabaseUtil:                 @local::dunefd_database
 LArVoxelCalculator:           @local::dunefd_larvoxelcalculator
 MagneticField:                @local::no_mag_larsoft
 SpaceCharge:                  @local::protodune_spacecharge
 NuRandomService:              @local::dune_seedservice
 SignalShapingServiceDUNE:     @local::protodunesp_signalshapingservice
 PhotonVisibilityService:      @local::protodune_photonvisibilityservice
 OpDetResponseInterface:       @local::protodune_opdetresponse
 ChannelStatusService:         @local::dunefd_channel_status
}

# Enable photon simulation for protoDUNE by default

protodune_simulation_services.LArPropertiesService.ScintYield: 24000
protodune_simulation_services.LArPropertiesService.ScintPreScale: 0.0287
protodune_simulation_services.LArPropertiesService.EnableCerenkovLight: false
protodune_simulation_services.LArG4Parameters.UseCustomPhysics: true
protodune_simulation_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                                                "FastOptical",
                                                                "SynchrotronAndGN",
                                                                "Ion",
                                                                "Hadron",
                                                                "Decay",
                                                                "HadronElastic",
                                                                "Stopping" ]


# Reco services for ProtoDUNE simulation.
protodune_reco_services:                            @local::protodune_services
protodune_reco_services.RawDigitExtractService:     @local::rdx_std
protodune_reco_services.RawDigitPrepService:        @local::adcprep_with_services_sim
protodune_reco_services.AdcDeconvolutionService:    @local::adcdco_dunefd
protodune_reco_services.AdcRoiBuildingService:      @local::adcroi_dunefd
protodune_reco_services.AdcWireBuildingService:     @local::adcwire_std
# Switch to tool-based dataprep for ProtoDUNE simulation.
protodune_reco_services.RawDigitPrepService:        @local::adcprep_with_tools_sim
protodune_reco_services.RawDigitPrepService.AdcChannelToolNames: @local::protodune_dataprep_tools_sim
# xyz calibration service
protodune_reco_services.XYZCalibService:            @local::protodune_xyzcalib
# lifetime calibration service
protodune_reco_services.LifetimeCalibService:       @local::protodune_lifetimecalib
# channel map service
protodune_reco_services.PdspChannelMapService:      @local::pdspchannelmap
# channel status service
protodune_reco_services.ChannelStatusService:       @local::pdsp_channel_status

# Reco services for ProtoDUNE data
protodune_data_reco_services:                       @local::protodune_reco_services
# Get rid of low frequency noise
protodune_data_reco_services.SignalShapingServiceDUNE.IndUFilter: "(x>0.01)*gaus"
protodune_data_reco_services.SignalShapingServiceDUNE.IndVFilter: "(x>0.01)*gaus"
# Use channel service for data
protodune_data_reco_services.ChannelStatusService: @local::pdsp_channel_status
# Add the photon detector calibrator service
protodune_data_reco_services.IPhotonCalibrator:    @local::protodunesp_photoncalibrator
# ProtoDUNE detector properties service
protodune_data_reco_services.DetectorPropertiesService: @local::protodunesp_detproperties
# Dataprep service.
protodune_data_reco_services.RawDigitPrepService.AdcChannelToolNames: @local::protodune_dataprep_tools_wirecell

##################################################
### Make Parallel Services for the v7 geometry ###
##################################################

protodunev7_services:  @local::protodune_services
protodunev7_services.Geometry: @local::protodunev7_geo

protodunev7_rawdecoding_services:  @local::protodune_rawdecoding_services
protodunev7_rawdecoding_services.Geometry: @local::protodunev7_geo

protodunev7_data_services:  @local::protodune_data_services
protodunev7_data_services.Geometry: @local::protodunev7_geo

protodunev7_reco_services:  @local::protodune_reco_services
protodunev7_reco_services.Geometry: @local::protodunev7_geo

protodunev7_data_reco_services:  @local::protodune_data_reco_services
protodunev7_data_reco_services.Geometry: @local::protodunev7_geo

protodunev7_simulation_services:  @local::protodune_simulation_services
protodunev7_simulation_services.Geometry: @local::protodunev7_geo
protodunev7_simulation_services.PhotonVisibilityService: @local::protodunev7_photonvisibilityservice





#######################
### 35ton Prototype ###
#######################

dune35t_basic_services: {
  ExptGeoHelperInterface:     @local::dune_geometry_helper
  GeometryConfigurationWriter: {}
  Geometry:                   @local::dune35t_geo
  DetectorClocksService:      @local::dune35t_detectorclocks
  DetectorPropertiesService:  @local::dune35t_detproperties
  LArPropertiesService:       @local::dune35t_properties
  DatabaseUtil:               @local::dune35t_database
  SpaceCharge:                @local::dune35t_spacecharge
  NuRandomService:             @local::dune_seedservice
  ChannelStatusService:       @local::dune35t_channel_status_dla
  ChannelGroupService:        @local::changroup_apa_keepall
}

# DLA Aug2016: Drop this in favor of dune35t_reco_services?
# For now, keep for use with the old reco.
dune35t_services:                            @local::dune35t_basic_services
dune35t_services.LArFFT:                     @local::dune35t_larfft
dune35t_services.BackTrackerService:                @local::dune35t_backtrackerservice
dune35t_services.ParticleInventoryService:      @local::dune35t_particleinventoryservice
dune35t_services.PhotonBackTrackerService:          @local::dune35t_photonbacktrackerservice
dune35t_services.SignalShapingServiceDUNE:   @local::dune35t_signalshapingservice

dune35t_gen_services:                        @local::dune35t_basic_services
dune35t_gen_services.MagneticField:          @local::no_mag_larsoft

dune35t_g4_services:                         @local::dune35t_gen_services
dune35t_g4_services.LArG4Parameters:         @local::dune35t_largeantparameters
dune35t_g4_services.LArVoxelCalculator:      @local::dune35t_larvoxelcalculator
dune35t_g4_services.PhotonVisibilityService: @local::dune35t_photonvisibilityservice
dune35t_g4_services.OpDetResponseInterface:  @local::dune35t_opdetresponse

##
# Settings to turn on and configure photon simulation
##

# Pre-scale the scintillation yield to save memory (correct when applying QE)
# MUST match between g4 and detsim steps
dune35t_g4_services.LArPropertiesService.ScintYield:    24000
dune35t_g4_services.LArPropertiesService.ScintPreScale: 0.0023

# disable cerenkov
dune35t_g4_services.LArPropertiesService.EnableCerenkovLight: false

# enable "FastOptical" in geant4
dune35t_g4_services.LArG4Parameters.UseCustomPhysics: true
dune35t_g4_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                                      "FastOptical",
                                                      "SynchrotronAndGN",
                                                      "Ion",
                                                      "Hadron",
                                                      "Decay",
                                                      "HadronElastic",
                                                      "Stopping",
                                                      "NeutronTrackingCut" ]

dune35t_detsim_services:                              @local::dune35t_basic_services
dune35t_detsim_services.LArFFT:                       @local::dune35t_larfft
dune35t_detsim_services.SignalShapingServiceDUNE:     @local::dune35t_signalshapingservice
dune35t_detsim_services.OpDetResponseInterface:       @local::dune35t_opdetresponse
dune35t_detsim_services.LArG4Parameters:              @local::dune35t_largeantparameters

# enable "FastOptical" in geant4
dune35t_detsim_services.LArG4Parameters.UseCustomPhysics: true
dune35t_detsim_services.LArG4Parameters.EnabledPhysics: [ "Em",
                                                          "FastOptical",
                                                          "SynchrotronAndGN",
                                                          "Ion",
                                                          "Hadron",
                                                          "Decay",
                                                          "HadronElastic",
                                                          "Stopping",
                                                          "NeutronTrackingCut" ]

# Pre-scale the scintillation yield to save memory (correct when applying QE)
# MUST match between g4 and detsim steps
dune35t_detsim_services.LArPropertiesService.ScintPreScale:      0.0023

dune35t_simulation_services:                                      @local::dune35t_g4_services
dune35t_simulation_services.LArFFT:                               @local::dune35t_larfft
dune35t_simulation_services.SignalShapingServiceDUNE:             @local::dune35t_signalshapingservice
dune35t_simulation_services.PhotonVisibilityService:              @local::dune35t_photonvisibilityservice
dune35t_simulation_services.BackTrackerService:                          @local::dune35t_backtrackerservice
dune35t_simulation_services.ParticleInventoryService:      @local::dune35t_particleinventoryservice
dune35t_simulation_services.PhotonBackTrackerService:                    @local::dune35t_photonbacktrackerservice

# Reco services for 35-ton data.
dune35tdata_reco_services:                            @local::dune35t_basic_services
dune35tdata_reco_services.LArFFT:                     @local::dune35t_larfft
dune35tdata_reco_services.BackTrackerService:         @local::dune35t_backtrackerservice
dune35tdata_reco_services.ParticleInventoryService:   @local::dune35t_particleinventoryservice
dune35tdata_reco_services.SignalShapingServiceDUNE:   @local::dune35t_signalshapingservice
dune35tdata_reco_services.AdcChannelDataCopyService:  @local::adccopy
dune35tdata_reco_services.RawDigitExtractService:     @local::rdx_35tdata
dune35tdata_reco_services.AdcSuppressonService:       @local::adcmit_dune35t
dune35tdata_reco_services.AdcSuppressService:         @local::adcsuppress_legacy35t
dune35tdata_reco_services.AdcNSignalFindingService:   @local::adcsigfind_suppress
dune35tdata_reco_services.PedestalEvaluationService:  @local::adcped_median
dune35tdata_reco_services.AdcDeconvolutionService:    @local::adcdco_dune35t
dune35tdata_reco_services.AdcRoiBuildingService:      @local::adcroi_dune35t
dune35tdata_reco_services.AdcWireBuildingService:     @local::adcwire_std
dune35tdata_reco_services.RawDigitPrepService:        @local::adcprep_dune35tdata

# Reco services for 35-ton simulation.
dune35tsim_reco_services:                             @local::dune35tdata_reco_services
dune35tsim_reco_services.RawDigitExtractService:      @local::rdx_std
dune35tsim_reco_services.RawDigitPrepService:         @local::adcprep_with_services_sim

dune35t_milliblock_reco_services:                                 @local::dune35tsim_reco_services
dune35t_milliblock_reco_services.DetectorPropertiesService:       @local::dune35t_milliblock_detproperties

dune35t_milliblock_detsim_services:                               @local::dune35t_detsim_services
dune35t_milliblock_detsim_services.DetectorPropertiesService:     @local::dune35t_milliblock_detproperties

dune35t_milliblock_simulation_services:                           @local::dune35t_simulation_services
dune35t_milliblock_simulation_services.DetectorPropertiesService: @local::dune35t_milliblock_detproperties





########################
### Message Services ###
########################

dune_message_services: {
  debugModules: ["*"]
  destinations: {
    LogDebugFile: {
      type:       "file"
      filename:   "debug.log"
      append:     false
      threshold:  "DEBUG"
      categories:{
        default:{ limit: 0 }
      }
    }
    LogStandardOut: {
      type:       "cout"
      threshold:  "WARNING"
      categories:{
        default:{ }
        RecoBaseDefaultCtor: { limit: 0 }
        AnaBaseDefaultCtor:  { limit: 0 }
        GeometryBadInputPoint: { limit: 5 timespan: 1000}
      }
    }
    LogStandardError: {
      type:       "cerr"
      threshold:  "ERROR"
      categories:{
        default:{ }
      }
    }
  }
}

dune_message_services_prod_debug: {
  debugModules: ["*"]
  destinations: {
    LogDebugFile:      @local::dune_message_services.destinations.LogDebugFile
    LogStandardOut:    @local::dune_message_services.destinations.LogStandardOut
    LogStandardError:  @local::dune_message_services.destinations.LogStandardError
  }
}

dune_message_services_prod_debug.destinations.LogDebugFile.categories:{
  default: { }
  RecoBaseDefaultCtor: { limit: 0 }
  AnaBaseDefaultCtor:  { limit: 0 }
  Track3DKalmanSPS_GenFit: { limit: 0 }
  GeometryBadInputPoint: { limit: 5 timespan: 1000}
  SpacePointAlg: { limit: 0 }
  KalmanFilterAlg: { limit: 0 }
  Track3DKalmanHit: { limit: 0 }
  fuzzyCluster: { limit: 0}
  ChannelFilter: { limit: 0}
  HoughBaseAlg: { limit: 0}
  DBscan: {limit: 0}
  CosmicTracker: {limit: 0}
  HitCheater: {limit: 0}
  DisambigAlg35t: {limit: 0}
  ClusterCheater: {limit: 0}
  ClusterCrawlerAlg: {limit: 0}
  CaloPrtTrk: {limit: 0}
  CaloPrtHit: {limit: 0}
  BackTrackerService: {limit: 0}
  DisambigCheat: {limit: 0}
  Summary: {limit: 0}
  CosmicTracker: {limit: 0}
  ClusterMergeTQ: {limit: 0}
  LArPandora: {limit: 0}
}


dune_message_services_prod: {
  debugModules: ["*"]
  destinations: {
    LogDebugFile: {
      type:       "file"
      filename:   "debugprod.log"
      append:     false
      threshold:  "DEBUG"
      categories:{
        default:{ limit: 0 }
      }
    }
    LogStandardOut: {
      type:       "cout"
      threshold:  "INFO"
      categories:{
        ArtReport: {limit: -1}
        default:{limit: 0}
      }
    }
    LogStandardError: {
      type:       "cerr"
      threshold:  "ERROR"
      categories:{
        default:{}
      }
    }
  }
}

dune_message_services_interactive: {
  debugModules: ["*"]
  destinations: {
    LogDebugFile:      @local::dune_message_services.destinations.LogDebugFile
    LogStandardOut:    @local::dune_message_services.destinations.LogStandardOut
    LogStandardError:  @local::dune_message_services.destinations.LogStandardError
  }
}
dune_message_services_interactive.destinations.LogStandardOut.threshold:  "INFO"
dune_message_services_interactive.destinations.LogStandardOut.categories:{
  default: { limit: 0 }
}
dune_message_services_interactive.destinations.LogStandardError.threshold:  "WARNING"
dune_message_services_interactive.destinations.LogStandardError.categories: {
  default: { }
  RecoBaseDefaultCtor: { limit: 1 }
  AnaBaseDefaultCtor:  { limit: 1 }
  GeometryBadInputPoint: { limit: 5 timespan: 1000}
}

END_PROLOG
BEGIN_PROLOG

crt_raw_decoder:
{
  module_type: "CRTRawDecoder"
  RawDataTag: "daq:ContainerCRT"
  LookForContainer: true
}

timing_raw_decoder:
{
  module_type: "TimingRawDecoder"
  RawDataLabel: "daq"
  OutputDataLabel: "daq"
  UseChannelMap: "true"
  Debug: "false"
  MakeTree: "false"
}

rce_raw_decoder:
{
  module_type: "RceRawDecoder"
  RawDataLabel: "daq"
  OutputDataLabel: "daq"
  ExpectContainerFragments: true
}

felix_raw_decoder:
{
  module_type: "FelixRawDecoder"
  RawDataLabel: "daq"
  OutputDataLabel: "daq"
  ExpectContainerFragments: true
}

# configuration for combined TPC Raw Decoder module. Supersedes the RCE and FELIX
# raw decoder modules listed above.

pdsp_tpc_raw_decoder:
{
  module_type: "PDSPTPCRawDecoder"
  OutputDataLabel: "daq"

  APAsToDecode: []    # a list of APA (=crate) numbers to decode if you want a subset of them
                      # an emtpy list decodes the entire input data

  DefaultCrateIfUnexpected:  3     #  Use for coldbox data -- unexpected means not in the range 1-6.

  MinOfflineChannel:        -1     #  Use to limit range of channels.  <0: no limit
  MaxOfflineChannel:        -1     #  Use to limit range of channels.  <0: no limit.  < MinOfflineChannel: no limit
 
# if this list is empty or missing, then read all artdaq fragements with TPC in their labels
  RCERawDataLabels: [ "daq:ContainerTPC", "daq:TPC", 
    "daq:ContainerTPC001", 
    "daq:ContainerTPC002", 
    "daq:ContainerTPC003", 
    "daq:ContainerTPC004",
    "daq:ContainerTPC005", 
    "daq:ContainerTPC006", 
    "daq:TPC001", 
    "daq:TPC002", 
    "daq:TPC003", 
    "daq:TPC004",
    "daq:TPC005", 
    "daq:TPC006" ] 

  RCEEnforceFragmentTypeMatch: false   # DAQ group reserves the right to change fragment type numbers
  RCEFragmentType: 2
  RCEDropEventsWithSmallFrags: false
  RCEDropSmallFrags: true
  RCESmallFragSize: 500000
  RCEDropFragsWithBadSF: true    # skip fragments with invalid slot and fiber numbers
  RCEDropFragsWithBadC: true     # skip fragments with invalid crate numbers
  RCEHexDump: false
  RCESaveFragsToFiles: false
  RCECheckBufferSize: true
  RCEBufferSizeCheckLimit: 10000000

  RCEFIX110:                         true   # shift waveforms for ASIC 3 on FEMB 110
  RCEFIX110NTICKS:                   18     # number of ticks to shift waveforms on FEMB 110 ASIC 3

# if this list is empty or missing, then read all artdaq fragements with FELIX in their labels
  FELIXRawDataLabels: [ "daq:ContainerFELIX", "daq:FELIX",
    "daq:ContainerFELIX001", 
    "daq:ContainerFELIX002", 
    "daq:ContainerFELIX003", 
    "daq:ContainerFELIX004",
    "daq:ContainerFELIX005", 
    "daq:ContainerFELIX006", 
    "daq:FELIX001", 
    "daq:FELIX002", 
    "daq:FELIX003", 
    "daq:FELIX004",
    "daq:FELIX005", 
    "daq:FELIX006" ] 

  FELIXEnforceFragmentTypeMatch: false   # DAQ group reserves the right to change fragment type numbers
  FELIXFragmentType: 8  
  FELIXDropFragsWithBadSF: true   # drop fragments with bad slot or fiber numbers
  FELIXDropFragsWithBadC: true    # drop fragments with ununderstood crate numbers
  FELIXHexDump: false
  FELIXDropEventsWithSmallFrags: false
  FELIXDropSmallFrags: true
  FELIXSmallFragSize: 10000
  FELIXCheckBufferSize: true
  FELIXBufferSizeCheckLimit: 10000000

  CompressHuffman: false
  PrintColdataConvertCount: false

  MakeHistograms: false #for making error monitoring histograms

# enforcement flags.  If these are set to true and the data completeness 
# conditions are not met, then an emtpy collection of raw::RawDigits is 
# put in the event

# if set to true, the number of channels present in the fragments must be
# the FullChannelCount below.

  EnforceFullChannelCount: false
  FullChannelCount: 15360

# requires that we don't see the same channel twice in in an event

  EnforceNoDuplicateChannels: true

# requires that all channels have the same number of ticks (on each event separately). Drops all data if they differ

  EnforceSameTickCount: false

# requires that all channels except FEMB 302 have the same number of ticks

  EnforceMedianTickCount: false

# requires that all channels have the specified number of ticks

  EnforceFullTickCount: false
  FullTickCount: 6000

# requires that no errors are reported by the unpacker (checksum or capture errors)

  EnforceErrorFree: false

}

ssp_raw_decoder:
{

  module_type: "SSPRawDecoder"
  RawDataLabel: "daq"
   
  SplitTriggers: false           # If true, split into external and internal trigger data products
  OutputDataLabel: "daq"         # Used if SplitTriggers = false
  ExtTrigOutputLabel: "external" # Used if SplitTriggers = true
  IntTrigOutputLabel: "internal" # Used if SPlitTriggers = true
   
#  UseChannelMap: "true"
  UseChannelMap: "false"
  Debug: "false"
  MakeTree: "false"
  verbose_metadata: "false"
  verbose_adcs: 0

  number_of_packets: 12  # number of channels per SSP

  SSP_m1: 10   # samples used to calculate peak height
  SSP_m2: 10   # samples used to calculate integral
  SSP_i1: 40  # samples used to calculate pedestal
  SSP_i2: 1200  # samples used to calculate peak height

  NOvAClockFrequency: 150.0 # MHz
  SPESize: 25
 
}

ssp_raw_decoder_split: @local::ssp_raw_decoder
ssp_raw_decoder_split.SplitTriggers: true


ctb_raw_decoder:
{
  module_type: "PDSPCTBRawDecoder"
  InputLabel: "daq"
  InputContainerInstance: "ContainerCTB"
  InputNonContainerInstance: "CTB"
  OutputLabel: "daq"
}

online_monitor:
{
  module_type:     "OnlineMonitor"
  TPCInputModule:  "rcerawdecoder"
  TPCInstanceName: "daq"
  FELIXInputModule:  "felixrawdecoder"
  FELIXInstanceName: "daq"
}

tpc_fft:
{
  module_type:     "TpcFFT"
  TPCInputModule:  "rcerawdecoder"
  TPCInstanceName: "daq"  
}

ssp_evt_analyzer:
{
  module_type:     "PDRawEVD"
  SSPInputModule:  "ssprawdecoder"
  SSPInstanceName: "daq"  
}

END_PROLOG
BEGIN_PROLOG

proto_beamevent:
{
  module_type:          "BeamEvent"
  URLStr:                 "https://ifb-data.fnal.gov:8104/ifbeam"
#  URLStr:                 "http://ifb-data.fnal.gov:8190/ifbeam"
  BFEpsilon:           6.
  XCETEpsilon:         6.
  XCETFetchShift:      -5.
  FillCacheUp:         5.
  FillCacheDown:       10.
  IFBeamDebug:         0
  OutputLabel:         "BeamEvent"

  PrintDebug:          "false"

  NRetries:             5
  TimeWindow: 120  # width of time window in seconds
  BundleName: "DUNE_CERN_SEP2018"
  XCETBundleName: "DUNE_CERN_SEP2018_TIMBER"

  ##########################
  #Warning: Only for testing
  #
  # Any items in Multiple or
  # nonzero Fixed time
  # Tells the code to override 
  # the event time and grab 
  # from the database with 
  # these specific times
  ##########################
  MultipleTimes: [] 
  FixedTime:     0.

  Coordinates:   [] 
  Dimension:         [["XBPF022697",1],
                      ["XBPF022698",1],
                      ["XBPF022701",1],
                      ["XBPF022702",1],
                      ["XBPF022707",1],
                      ["XBPF022708",1],
                      ["XBPF022716",1],
                      ["XBPF022717",1]]

  XBPFPrefix:         "dip/acc/NORTH/NP04/BI/XBPF/"
  XTOFPrefix:         "dip/acc/NORTH/NP04/BI/XTOF/"
  XCETPrefix:         "dip/acc/NORTH/NP04/BI/XCET/"


  TOF1:               "XBTF022687"
  TOF2:               "XBTF022716"


  ####Calibrations for TOFs#####
  TOFCalAA: 60.1630598   #155.479 - 95.3159402
  TOFCalAB: 59.7480598   #155.064 - 95.3159402
  TOFCalBA: 60.0430598   #155.359 - 95.3159402
  TOFCalBB: 59.6540598   #154.970 - 95.3159402
  #############################
                                   
  CKov1:              "XCET022713"
  CKov2:              "XCET022716"
  XCET1:              "timber/XBH4/XTDC/022/713"
  XCET2:              "timber/XBH4/XTDC/022/716"

  XCETDebug:          "false"

  DeviceTypes:  [["XBPF022697","horiz"],
                 ["XBPF022698","vert"],
                 ["XBPF022701","horiz"],
                 ["XBPF022702","horiz"],
                 ["XBPF022707","horiz"],
                 ["XBPF022708","vert"], 
                 ["XBPF022716","horiz"],
                 ["XBPF022717","vert"]]

         
  Devices:        ["XBPF022697",
                   "XBPF022698",
                   "XBPF022701",
                   "XBPF022702",
                   "XBPF022707",
                   "XBPF022708",
                   "XBPF022716",
                   "XBPF022717"]


  #For tracking###################
  FirstUpstream:    "XBPF022707"
  SecondUpstream:   "XBPF022708"
  FirstDownstream:  "XBPF022716"
  SecondDownstream: "XBPF022717"
  ################################

  #For Momentum Spectrometry######
  FirstBPROF1:  "XBPF022697"
  SecondBPROF1: "XBPF022698"
  BPROF2:       "XBPF022701"
  BPROF3:       "XBPF022702"
  #Nominal beam bend (mrad)
  BeamBend:     .12003

  L1: 1.980
  L2: 1.69472      
  L3: 2.11666

      ##Calibrated Positions##
  BProf1Shift:  0.
  BProf2Shift:  0.
  BProf3Shift:  1.45
  ################################


  #Angles originally used - taken from Leigh's MC module
  #RotateMonitorXZ:   -10.3
  #RotateMonitorYZ:    11.7
   
  ###Angles taken from Paola (actual direction of beamline)
  #RotateMonitorXZ:     15.676709377408265
  RotateMonitorYX:     227.18669653445150
  
  ###New rotations - same final z axis as those 
  ###from Paola, but the X axis is kept horizontal 
  RotateMonitorYZ: 11.4328
  RotateMonitorXZ: -10.7985

# Position of beam monitor in z in [mm] 
  #FirstTrackingProfZ: 707479
  #SecondTrackingProfZ: 716048
  #NP04FrontZ: 717243
  ####From beatch file:
  FirstTrackingProfZ: 707555
  SecondTrackingProfZ: 716124
  NP04FrontZ: 717243
  ########################

# Position of Beam in [cm]
  #BeamX: 8.0757
  #BeamY: 461.06
  #BeamZ: -196.11
  ##New from Martin:
  BeamX: -4.994
  BeamY: 448.449
  BeamZ: -129.804

# Current TAI Offset in [sec]  
  OffsetTAI: 37

# CTB/Timing Timestamp offset  
# Searching Offset + Tolerance <= diff >= Offset - Tolerance
  OffsetCTBtoRDTS: 23  
  ToleranceCTBtoRDTS: 2

# Timing Offset [sec] 
# HLT - GenTrig - (PDTS_spill - BI_spill)
#  TimingCalibration:   -0.09515150
  TimingCalibration:    -0.095151040
  CalibrationTolerance: 1.e-6 

  S11DiffUpper: -.55e-6
  S11DiffLower: -.75e-6

  RDTSToS11Upper: 500000.e-9
  RDTSToS11Lower: -500000.e-9

#Should we grab from the folders each time?
  ForceNewFetch:        "false"

#Should we force matching with S11? (just for testing)
  ForceMatchS11:        "false"

#Do we want to match in time between
#beamline and tpc?
  MatchTime:            "true"

#Option to get info from database
#even if we don't have a good
#trigger from the BI to CTB 
#or if we are getting invalid Spill Times
  ForceRead:            "false"

  SaveOutTree:   "false"
  DebugTOFs:     "false"
  DebugMomentum: "false"

#Tolerance for matching between Downstream scintillator modules 
#and coincidence signal (GeneralTrigger)
#units of ns
  DownstreamToGenTrig:  50.

#Tolerance for matching between Upstream and Downstream scintillator modules 
#units of ns
  UpstreamToDownstream:  500.

}

END_PROLOG
BEGIN_PROLOG


t962_calwire:
{
 module_type:        "CalWireT962"
 DigitModuleLabel:   "daq"
 ResponseFile:       "ArgoResponse1.5.root"
 ExponentialEndBins: 300
 PostsampleBins:     300
}

argoneut_calwire: @local::t962_calwire


microboone_calwire:
{
 module_type:        "CalWireMicroBooNE"
 DigitModuleLabel:   "daq"
 PostsampleBins:     400
}

microboone_calwirePrespill:  @local::microboone_calwire
microboone_calwirePostspill: @local::microboone_calwire
microboone_calwirePrespill.DigitModuleLabel: "daq:preSpill"
microboone_calwirePostspill.DigitModuleLabel: "daq:postSpill"

jp250L_calwire: @local::microboone_calwire



standard_calwireana: 
{
 module_type:        "CalWireAna"
 CalWireModuleLabel: "caldata"
 DetSimModuleLabel:  "daq"
}

jp250L_calwireana:     @local::standard_calwireana
argoneut_calwireana:   @local::standard_calwireana
microboone_calwireana: @local::standard_calwireana


END_PROLOG
// from larreco/RecoAlg:
#
# Standard configuration for hit finding algorithms
#
# It currently (temporary?) include experiment-specific configuration.
#
BEGIN_PROLOG

standard_cchitfinderalg:
{
  CalDataModuleLabel: "caldata"
  MinPeak:    [8, 5, 5] # min peak signal in each plane
  MinRMS:    [2, 2, 2] # min signal RMS in each plane
  MaxBumps:    5    # make a crude hit if > MaxBumps are found in the RAT
  MaxXtraHits: 1    # max number of hidden hits in Region Above Threshold
  ChiSplit:  20.   # Max chi/DOF for splitting hits for signal rms error = 1
  ChiNorms: [ 1.0, 1.0, 1.0 ]  # chi/DOF normalization for each plane
  StudyHits:  false       # study hit fits on a selected (W,T) range on one event
  UWireRange:   [ 300, 350]  # Study mode: wire range in the U plane
  UTickRange: [ 5200, 5500]  # Study mode: tick range in the U plane
  VWireRange:  [1050, 1080]  # Study mode: wire range in the V plane
  VTickRange: [ 1500, 1750]  # Study mode: tick range in the V plane
  WWireRange:   [ 200, 250]  # Study mode: wire range in the W plane
  WTickRange: [ 5200, 5400]  # Study mode: tick range in the W plane
}


bo_cchitfinderalg:              @local::standard_cchitfinderalg
bo_cchitfinderalg.MinPeak:      [4.,  4.,  5.]
bo_cchitfinderalg.MinRMS:       [8.,  8.,  7.]
bo_cchitfinderalg.ChiNorms:     [1.8, 3.3, 4.3]


microboone_cchitfinderalg:                    @local::standard_cchitfinderalg
microboone_cchitfinderalg.MinPeak:            [10., 5., 5.]
microboone_cchitfinderalg.MinRMS:             [2.2, 2.2, 2.2]
microboone_cchitfinderalg.ChiNorms:           [0.1, 0.4, 0.1]

argoneut_cchitfinderalg:             @local::standard_cchitfinderalg
argoneut_cchitfinderalg.MinPeak:   [1.8, 2.5]
argoneut_cchitfinderalg.MinRMS:    [5., 10.]
argoneut_cchitfinderalg.ChiNorms:  [ 0.5, 2.7]
argoneut_cchitfinderalg.ChgNorms:  [ 1.0, 1.0]

END_PROLOG

BEGIN_PROLOG

hitfinderwaveformalgs:
{
    tool_type: WaveformTools
}

# Define the differential tool for finding candidate hits
candhitfinder_derivative:
{
    tool_type:           CandHitDerivative
    Plane:               0
    MinDeltaTicks:       1
    MaxDeltaTicks:       40
    MinDeltaPeaks:       0.25
    MinHitHeight:        2
    NumInterveningTicks: 6
    OutputHistograms:    false
    WaveformAlgs:        @local::hitfinderwaveformalgs
}

# Define the morphological filter tool for finding candidate hits
candhitfinder_morphological:
{
    tool_type:           CandHitMorphological
    Plane:               0
    DilationThreshold:   4.
    DilationFraction:    0.75
    ErosionFraction:     0.2
    MinDeltaTicks:       1
    MinDeltaPeaks:       0.01
    MinHitHeight:        1
    NumInterveningTicks: 6
    StructuringElement:  20
    OutputHistograms:    false
    OutputWaveforms:     false
    WaveformAlgs:        @local::hitfinderwaveformalgs
}

# Define the standard "threshold over baseline" method for finding candidate hits
candhitfinder_standard:
{
    tool_type:                   CandHitStandard
    Plane:                       0                # The plane this tool is operating on
    RoiThreshold:                5.               # The threshold to apply to find hits
}

peakfitter_gaussian:
{
    tool_type:     "PeakFitterGaussian"
    MinWidth:      0.5
    MaxWidthMult:  3.
    PeakRangeFact: 2.
    PeakAmpRange:  2.
    FloatBaseline: false
}

peakfitter_mrqdt:
{
    tool_type:     "PeakFitterMrqdt"
    MinWidth:      0.5
    MaxWidthMult:  3.
    PeakRangeFact: 2.
    PeakAmpRange:  2.
}


END_PROLOG

BEGIN_PROLOG

standard_hitcheater:
{
 module_type:       "HitCheater"
 G4ModuleLabel:     "largeant"
 WireModuleLabel:   "caldata"
 MinimumCharge:     5.
}

standard_hitcheater_preSpill:  @local::standard_hitcheater
standard_hitcheater_postSpill: @local::standard_hitcheater
standard_hitcheater_preSpill.WireModuleLabel:  "caldataPreSpill:preSpill"
standard_hitcheater_postSpill.WireModuleLabel: "caldataPostSpill:postSpill"

standard_hitfinder:
{
 module_type:         "FFTHitFinder"
 CalDataModuleLabel:  "caldata"      
 MinSigInd:            6.0              # Induction signal height threshold  
 MinSigCol:            11.0             # Collection signal height threshold
 IndWidth:             6.0              # Initial width for induction fit
 ColWidth:             7.8              # Initial width for collection fit
 IndMinWidth:          4.0              # Induction Hit width threshold
 ColMinWidth:          6.0              # Collection hit width threshold
 MaxMultiHit:          3                # maximum hits for multi fit   
 AreaMethod:           0                # 0 = area by integral, 1 = area by gaussian area formula
 AreaNorms:            [ 13.25, 26.31 ] # normalizations that put signal area in 
                                        # same scale as peak height. 
}

gaus_hitfinder:
{
    module_type:          "GausHitFinder"
    CalDataModuleLabel:   "caldata"
    MaxMultiHit:          10                 # maximum hits for multi gaussia fit attempt
    AreaMethod:           0                  # 0 = area by integral, 1 = area by gaussian area formula
    AreaNorms:            [ 13.25, 26.31 ]   # normalizations that put signal area in
                                             # same scale as peak height.
    LongMaxHits:          [  1,  1,  1]      # max number hits in long pulse trains
    LongPulseWidth:       [ 16, 16, 16]      # max widths for hits in long pulse trains
    Chi2NDF:              2000               # maximum Chisquared / NDF allowed to store fit, if fail
                                             # will use "long" pulse method to return hit
    AllHitsInstanceName:  ""                 # If non-null then this will be the instance name of all hits output to event
                                             # in this case there will be two hit collections, one filtered and one containing all hits

    # Candididate peak finding done by tool, one tool instantiated per plane (but could be other divisions too)
    HitFinderToolVec:
    {
        CandidateHitsPlane0:  @local::candhitfinder_standard  # plane 0
        CandidateHitsPlane1:  @local::candhitfinder_standard  # plane 1
        CandidateHitsPlane2:  @local::candhitfinder_standard  # plane 2
    }

    # Declare the peak fitting tool
    PeakFitter:           @local::peakfitter_gaussian
    #PeakFitter:           @local::peakfitter_mrqdt

    # The below are for the hit filtering section of the gaushit finder
    FilterHits:           false              # true = do not keep undesired hits according to settings of HitFilterAlg object
    HitFilterAlg:
    {
        AlgName: "HitFilterAlg"
        MinPulseHeight: [5.0, 5.0, 5.0]      #minimum hit peak amplitude per plane
        MinPulseSigma:  [1.0, 1.0, 1.0]      #minimum hit rms per plane
    }
                                             # In addition to the filter alg we can also filter hits on the same pulse train
    PulseHeightCuts:      [3.0,  3.0,  3.0 ] # Minimum pulse height
    PulseWidthCuts:       [2.0,  1.5,  1.0 ] # Minimum pulse width
    PulseRatioCuts:       [0.35, 0.40, 0.20] # Ratio of pulse height to width
}

# Currently have to tell each tool which plane it is operating on... this is really
# for the histogramming option which enables hist naming without conflict
gaus_hitfinder.HitFinderToolVec.CandidateHitsPlane0.Plane: 0
gaus_hitfinder.HitFinderToolVec.CandidateHitsPlane1.Plane: 1
gaus_hitfinder.HitFinderToolVec.CandidateHitsPlane2.Plane: 2

dpraw_hitfinder:
{
 module_type:          		"DPRawHitFinder"
 LogLevel:	   		0

 CalDataModuleLabel:   		"caldata"
 MinSig:               		10    		# peak threshold for peak finding (in ADC). Peaks with lower amplitudes are neither fitted nor stored.
 TicksToStopPeakFinder: 	4		# when walking along waveform to find start and end points of a peak, stop when current tick is followed by minimum "TicksToStopPeakFinder" ticks 							# with equal or higher ADC counts (=inflection point). Stop anyway if ADC count of a tick is <= 0.

 GroupMaxDistance:		10		# maximum distance (in ticks) between two peaks to be grouped.
 GroupMinADC:			0		# minimum ADC count between two peaks to be grouped.
 SameShape:			true		# if true: fits within same group are forced to have identical shape

 DoMergePeaks:			false		# true: enables peak merging for peaks in the same group.
 MergeADCSumThreshold:		0.2		# merge two peaks only if (ADC sum of the smaller peak) < MergeADCSumThreshold*(ADC sum of the bigger peak).
 MergeMaxADCThreshold:		0.2		# merge two peaks only if (height of the smaller peak) < MergeADCSumThreshold*(height of the bigger peak).
 MinRelativePeakHeightLeft:	0.1		# if smaller peak is on the left: merge two peaks if (relative peak height of the smaller peak) < MinRelativePeakHeightLeft*(peak height of the smaller peak)
 MinRelativePeakHeightRight:	0.1		# if smaller peak is on the right: merge two peaks if (relative peak height of the smaller peak) < MinRelativePeakHeightRight*(peak height of the smaller peak)
 MergeMaxADCLimit:		25		# merge two peaks only if smaller peak <= MergeMaxADCLimit

 MinWidth:             		5              	# threshold for width (in ticks). Groups of peaks with smaller values are neither fitted nor stored.
 MinADCSum:    			10             	# threshold for ADC sum (in ADC*ticks). Groups of peaks with smaller values are neither fitted nor stored.
 MinADCSumOverWidth:    	0             	# threshold for ADC sum over width (in ADC*ticks/ticks). Groups of peaks with smaller values are neither fitted nor stored.

 MaxMultiHit:          		6               # maximum number of peaks in a group for the group to be fitted. If more, split the group in equally spaced hits without fitting.
						# When refitting, maximum number of peaks in group is: 1) not greater than 3x number of peaks before re-fitting.
 MaxGroupLength:          	20000            # Maximum length of group of peaks for the group to be fitted, in ticks. If more, split the group in equally spaced hits without fitting.
 MaxFluctuations:		20000		# If the sum of fluctuations in all peaks is > MaxFluctuations, split the group in equally spaced hits without fitting.

 TryNplus1Fits:        		false		# true: will try to re-fit poorly modeled groups of peaks (chi2PerNDF>Chi2NDFRetry) while adding (an) additional peak(s).
 Chi2NDFRetry:         		25              # for single peaks: if the first fit returns a Chi2/NDF greater than this, try to re-fit.
 Chi2NDFRetryFactorMultiHits: 	2       	# for groups of peaks (2 or more): if the first fit returns a Chi2/NDF greater than Chi2NDFRetryFactorMultiHits*Chi2NDFRetry, try to re-fit.

 Chi2NDFMax:          		2000            # for single peaks: maximum chi square / NDF allowed for a fit to be stored as recob::Hits. Otherwise, handle peak as long pulse train.
 Chi2NDFMaxFactorMultiHits: 	2       	# for groups of peaks (2 or more): maximum chi square / NDF allowed for a fit to be stored as recob::Hit. Otherwise, handle group as long pulse train.

 LongPulseWidth:       		40      	# max widths for hits in long pulse trains 
 LongMaxHits:         		20      	# max number hits in long pulse trains


 ChargeNorm:           		1		# Normalization for fit integral. Should be set to 1.
 NumBinsToAverage:     		0		# 0 or 1 = no averaging.
 MinTau:			0.01		# minimum value of the rising and falling time constants of the fit, in microseconds.
 MaxTau:			20		# maximum value of the rising and falling time constants of the fit, in microseconds.
 FitPeakMeanRange:		5		# range in that the fitter can move the mean of the fit function w.r.t. the peak.

 WidthNormalization:    	2.335		# standard width of the fitted hit is the FWHM of the fitted function (full width at half maximum). 
						# This width is divied by 'WidthNormalization' and saved to the recob::Hit.
						# standard value is chosen to be 2.335 = 2*sqrt(2*ln(2)), which is the relation between FWHM and standard deviation for the Gaussian distribution.
}

standard_rffhitfinderalg:
{
    AmplitudeThreshold:   [ 0.0 ]
    MeanMatchThreshold:   [ 2.0 ]
    MinMergeMultiplicity: [ 2 ]
}

rff_hitfinder:
{
 module_type:           "RFFHitFinder"
 WireModuleLabel:       "caldata"
 RFFHitFinderAlgParams: @local::standard_rffhitfinderalg
}

tt_hitfinder:
{
 module_type:         "TTHitFinder"
 CalDataModuleLabel:  "caldata"
 MinSigPeakInd:       6.0
 MinSigPeakCol:       11.0
 MinSigTailInd:       2.0
 MinSigTailCol:       3.67
 IndWidth:            3
 ColWidth:            3
}

#For now, keep the APAHitFinder configured just like the GausHitFinder
apa_hitfinder:               @local::gaus_hitfinder
apa_hitfinder.module_type:   "APAHitFinder"


standard_hitfinderana:
{
 module_type:          "HitFinderAna"
 HitsModuleLabel:      "ffthit"
 LArGeantModuleLabel:  "largeant"
}

gaus_hitfinderana:
{
 module_type:          "GausHitFinderAna"
 HitsModuleLabel:      "gaushit"
 LArGeantModuleLabel:  "largeant"
}

standard_fasthitfinder:
{
 module_type:         "RawHitFinder"
 CalDataModuleLabel:  "caldata"      
 MinSigInd:            5.0              # Induction signal height threshold  
 MinSigCol:            5.0             # Collection signal height threshold
 IndWidth:             6.0              # Initial width for induction fit
 ColWidth:             7.8              # Initial width for collection fit
 IndMinWidth:          4.0              # Induction Hit width threshold
 ColMinWidth:          6.0              # Collection hit width threshold
 MaxMultiHit:          3                # maximum hits for multi fit   
 AreaMethod:           0                # 0 = area by integral, 1 = area by gaussian area formula
 AreaNorms:            [ 13.25, 26.31 ] # normalizations that put signal area in
 ColMinWindow: 100         # minimum integration window for charge, coll plane
 IndCutoff: 1              # max distance between zero crossing and hit start
                             #  in ticks, for induction planes only
 SkipInd: false            # If true, do not make any hits for ind plane wires
 UncompressWithPed: false
}

standard_clustercrawlerhit:
{
 # call this: "cchit"
 module_type:         "HitFinder"
 CalDataModuleLabel:  "caldata"
 CCHitFinderAlg:      @local::standard_cchitfinderalg
} # standard_clustercrawlerhit


jp250L_hitfinder:       @local::standard_hitfinder
jp250L_gaushitfinder:   @local::gaus_hitfinder

bo_hitfinder:       @local::standard_hitfinder
bo_gaushitfinder:   @local::gaus_hitfinder

argoneut_hitfinder:     @local::standard_hitfinder
argoneut_gaushitfinder: @local::gaus_hitfinder
argoneut_mc_hitfinder:  @local::standard_hitfinder
argoneut_mc_hitfinder.AreaNorms: [ 12.89, 14.51 ]

microboone_hitfinder:     @local::standard_hitfinder
microboone_gaushitfinder: @local::gaus_hitfinder
microboone_rffhitfinder: @local::rff_hitfinder
microboone_hitfinder.IndMinWidth: 1.0
microboone_hitfinder.ColMinWidth: 1.0
microboone_gaushitfinder.MinSig: [ 6.0, 6.0, 11.0 ]
microboone_gaushitfinder.InitWidth: [ 6.0, 6.0, 7.8 ]
microboone_gaushitfinder.MinWidth:  [ 4.0, 4.0, 6.0 ]
microboone_gaushitfinder.AreaNorms: [ 13.25, 13.25, 26.31 ]
microboone_clustercrawlerhit: @local::standard_clustercrawlerhit
microboone_clustercrawlerhit.CCHitFinderAlg:      @local::microboone_cchitfinderalg
END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

standard_dataprovideralg:
{
 DriftWindow:          6 # downsampling window (in drift ticks)
 DownscaleFullView: true # downsample full view

 DownscaleFn:     "mean" # "maxpool" takes the max value in the window,
                         # "maxmean" is mean from 3 ADC's around the max,
                         # "mean" is the mean value of all ADC's in the window

 BlurKernel:      []  # apply channel-channel blurring
 NoiseSigma:      0   # apply white noise
 CoherentSigma:   0   # apply coherent noise

 CalorimetryAlg:    @local::standard_calorimetryalgmc  # used to eliminate amplitude variation due to electron lifetime
 CalibrateAmpl:     false # calibrate ADC values with CalAmpConstants (allows different gains in MC and data)
 CalibrateLifetime: true  # calibrate ADC values according to the electron lifetime

 # The following settings allow to scale the interesting ADC range into desired range of values,
 # e.g. convenient for the CNN or for the conversion to decimal type range. Default values
 # provided here will result with the scaling factor of 0.1.
 AdcMax:            150.0 # input saturation max value
 AdcMin:            -50.0 # input saturation min value
 OutMax:             15.0 # output max value
 OutMin:             -5.0 # output min value
}

END_PROLOG

BEGIN_PROLOG

standard_spacepointalg:
{
  MaxDT:      2.0
  MaxS:       0.3
  MinViews:   2
  EnableU:    true
  EnableV:    true
  EnableW:    false
  Filter:     true
  Merge:      false
  PreferColl: false
}

standard_seedfinderalgorithm:
{
  SpacePointAlg:          @local::standard_spacepointalg
  InitSeedLength:         2
  MinPointsInSeed:        4
  Refits:                 5
  HitResolution:          1
  OccupancyCut:           0.8
  MaxViewRMS:             [2,2,2]
  ExtendSeeds:            true
  LengthCut:              0
}
standard_seedfinderalgorithm.SpacePointAlg.Filter: false

standard_projectionmatchingalg:
{
  OptimizationEps:        0.01    # relative change of the obj.fn which stops optimization after adding a node
  FineTuningEps:          0.0001  # relative change of the obj.fn which stops fine-tuning of optimized track
  TrkValidationDist2D:    1.0     # max. distance [cm] used in the track validation in the "third" plane
  HitTestingDist2D:       0.5     # max. distance [cm] used in testing compatibility of hits with the track
  MinTwoViewFraction:     0.4     # min. fraction of track length covered with hits from many 2D views intertwinted with each other
  NodeMargin3D:           3.0     # margin in [cm] around TPC for allowed track node positions
  HitWeightZ:             1.0     # weights used for hits in U, V, Z planes:
  HitWeightV:             1.0     #    - use lower values for planes where hit position is less reliable (e.g. due to S/N)
  HitWeightU:             1.0     #    - relative ratios matter, sum does not need to be 1.0
}

standard_pmalgtracker:
{
  MinSeedSize1stPass:     20      # min. cluster size used to start building a track in the 1st pass
  MinSeedSize2ndPass:     4       # ..and in the 2nd pass: differentiate to speed up finding long tracks
                                  # w/o checking large number of possibilities, then use as small size
                                  # as reasonnable for used clustering algorithm to complete the search
                                  # in the second pass
  TrackLikeThreshold:     0.0     # CNN output threshold for track-like recognition; ClusterModuleLabel
                                  # needs to be associated to CNN outputs in case of threshold > 0; will
                                  # exclude obvious EM from tracking and tag clean electron tracks as PDG=11
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
                                  #
  FlipToBeam:             false   # set the track direction to increasing Z values
  FlipDownward:           false   # set the track direction to decreasing Y values (like cosmic rays)
  FlipToX:             	  false   # set the track direction to decreasing X values (like cosmic rays in dual phase)
  AutoFlip_dQdx:          false   # set the track direction to increasing dQ/dx (overrides FlipToBeam,
                                  # FlipDownward and FlipToX if significant rise of dQ/dx at the track end)
                                  #
  MergeWithinTPC:         false   # merge witnin single TPC; finds tracks best matching by angle, with limits:
  MergeTransverseShift:   2.0     #    - max. transverse displacement [cm] between tracks
  MergeAngle:             2.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  StitchBetweenTPCs:      true    # stitch between TPCs; finds tracks best matching by angle, with limits:
  StitchDistToWall:       3.0     #    - max. track endpoint distance [cm] to TPC boundary
  StitchTransverseShift:  3.0     #    - max. transverse displacement [cm] between tracks
  StitchAngle:           10.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  MatchT0inAPACrossing:   false   # match T0 of APA-crossing tracks using PMAlgStitcher
  MatchT0inCPACrossing:   false   # match T0 of CPA-crossing tracks using PMAlgStitcher

  Validation:             "hits"  # "hits":   uses hits to validate track
                                  # "adc":   uses adc image to validate tracks
                                  # "calib": uses hits to validate tracks and produce histograms to find adc thresholds
                                  #          which should be used in "adc" mode
  AdcValidationThr:       [1.0, 1.0, 1.0]    # threshold for not-empty pixel in the ADC image used for the track validation, per plane
  AdcImageAlg:            @local::standard_dataprovideralg
}

standard_pmalgfitter:
{
  TrackingOnlyPdg:        [0]     # PDG list to select which PFParticles should be reconstructed;
                                  # all PFP's are used if the list is empty or starts with 0
  TrackingSkipPdg:        [0]    # PDG list to select which PFParticles should NOT be reconstructed,
                                  # e.g. skip EM showers; no skipping if the list is empty or starts with 0
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
}

standard_beziertrackeralgorithm:
{	
  OverlapCut:            0.2
  DirectJoinDistance:    10.0
  TrackJoinAngle:        0.5          
  VertexImpactThreshold: 2.0
  VertexExtrapDistance:  5.0
  OccupancyThresh:       0.8
  TrackResolution:       2.0
  SeedFinder:            @local::standard_seedfinderalgorithm

}
standard_beziertrackeralgorithm.SeedFinder.LengthCut: 2

standard_trackstitcheralg:
{
  CosAngTolerance: 0.98
  SpptSepTolerance: 30.0 # cm
  CommonComponentStitch: true
}

standard_kalmanfilteralg:
{
  Trace: false
  MaxPErr: 0.25      # Maximum pointing error for free propagation.
  GoodPErr: 0.1      # Pointing error threshold for switching from linearized to free propataion.
  MaxIncChisq: 10.   # Incremental chisquare cut.
  MaxSeedIncChisq: 1000.  # Incremental chisquare cut in seed phase.
  MaxSmoothIncChisq: 100. # Incremental chisquare cut in smooth phase.
  MaxEndChisq: 10.   # Maximum incremental chisquare for endpoint hit.
  MinLHits: 20       # Minimum number of measurements for linearized propagation.
  MaxLDist: 10.      # Maximum distance to use linearized propagation using starting guess.
  MaxPredDist: 5.    # Maximum prediction distance to accept a hit.
  MaxSeedPredDist: 50. # Maximum prediction distance to accept a hit in seed phase.
  MaxPropDist: 50.   # Maximum propagation distance to candidate surface.
  MinSortDist: 0.    # Low threshold to resort hits.
  MaxSortDist: 2.    # High threshold to resort hits.
  MaxSamePlane: 3    # Maximum consecutive hits in same plane.
  GapDist: 3.        # Minimum gap distance.
  MaxNoiseHits: 3    # Maximum number of hits in noise cluster.
  MinSampleDist: 20. # Minimum sample distance (for momentum measurement).
  FitMomRange: true  # Fit momentum using range.
  FitMomMS: false    # Fit momentum using multiple scattering.

  # Graphical trace options.
  # For any kine of graphical tracing to work, you need to configure
  # the event display service to initialize the graphics system.

  GTrace: false      # Graphical trace flag.
  GTraceWW: 1200     # Window width (pixels).
  GTraceWH: 800      # Window height (pixels).
  GTraceXMin: -256.  # Graphical trace minimum x (same for each view).
  GTraceXMax: 512.   # Graphical trace maximum x (same for each view).
  GTraceZMin: [    0.,    0.,    0.]  # Graphical trace minimum z for each view.
  GTraceZMax: [ 1040., 1040., 1040.]  # Graphical trace maximum z for each view
}

standard_track3Dkalmanhitalg:
{
  MaxTcut:            10.           # Maximum delta ray energy in MeV for restricted dE/dx
  DoDedx:             false         # dE/dx enable flag.
  SelfSeed:           false         # Generate seeds internally.
  LineSurface:        false         # Store hits on line surfaces.
  MinSeedHits:        12            # Minimum number of hits per track seed.
  MinSeedChopHits:    50            # Potentially chop seeds that exceed this length.
  MaxChopHits:        20            # Maximum number of hits to chop from each end of seed.
  MaxSeedChiDF:       20.           # Maximum seed track chisquare/dof.
  MinSeedSlope:       0.0           # Minimum seed slope (dx/dz).
  InitialMomentum:    0.5           # Initial momentum (GeV/c).
  KalmanFilterAlg:    @local::standard_kalmanfilteralg
  SeedFinderAlg:      @local::standard_seedfinderalgorithm
}

standard_cosmictrackeralg:
{
    SPTAlg:   0
    TrajOnly: false
    TMatch:   2.5
    SMatch:   1
}

argoneut_spacepointalg:      @local::standard_spacepointalg
argoneut_kalmanfilteralg:    @local::standard_kalmanfilteralg
argoneut_cosmictrackeralg:   @local::standard_cosmictrackeralg
argoneut_cosmictrackeralg.SPTAlg:   1
argoneut_cosmictrackeralg.TrajOnly: true

bo_spacepointalg: @local::standard_spacepointalg
bo_spacepointalg.MinViews: 2
bo_spacepointalg.EnableW:  true
bo_kalmanfilteralg:          @local::standard_kalmanfilteralg
bo_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
bo_seedfinderalgorithm.SpacePointAlg :           @local::bo_spacepointalg
bo_seedfinderalgorithm.SpacePointAlg.PreferColl: true
bo_seedfinderalgorithm.SpacePointAlg.Filter:     false
bo_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
bo_beziertrackeralgorithm.SeedFinder:            @local::bo_seedfinderalgorithm

microboone_spacepointalg:                                @local::standard_spacepointalg
microboone_spacepointalg.MinViews:                       3
microboone_spacepointalg.EnableW:                        true
microboone_kalmanfilteralg:                              @local::standard_kalmanfilteralg
microboone_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
microboone_seedfinderalgorithm.SpacePointAlg : {
  @table::microboone_spacepointalg
  PreferColl: true
  Filter:     false
}
microboone_track3Dkalmanhitalg: {
  @table::standard_track3Dkalmanhitalg
  KalmanFilterAlg: @local::microboone_kalmanfilteralg
  SeedFinderAlg:   @local::microboone_seedfinderalgorithm
}
microboone_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
microboone_beziertrackeralgorithm.SeedFinder:            @local::microboone_seedfinderalgorithm
microboone_trackstitcheralg:  @local::standard_trackstitcheralg

dune10kt_spacepointalg:          @local::standard_spacepointalg
dune10kt_spacepointalg.MinViews: 3
dune10kt_spacepointalg.EnableW:  true
dune10kt_kalmanfilteralg:        @local::standard_kalmanfilteralg
dune34kt_spacepointalg:          @local::dune10kt_spacepointalg
dune34kt_kalmanfilteralg:        @local::dune10kt_kalmanfilteralg
dune35t_spacepointalg: @local::standard_spacepointalg
dune35t_spacepointalg.MinViews:  3
dune35t_spacepointalg.EnableW:   true
dune35t_kalmanfilteralg:         @local::standard_kalmanfilteralg
dune35t_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
dune35t_seedfinderalgorithm.SpacePointAlg :           @local::dune35t_spacepointalg
dune35t_seedfinderalgorithm.SpacePointAlg.PreferColl: true
dune35t_seedfinderalgorithm.SpacePointAlg.Filter:     false


END_PROLOG
##include "cluster3dpathfindingtools.fcl"

BEGIN_PROLOG

standard_cluster3dkdTree:
{
  EnableMonitoring:  true    # enable monitoring of functions
  PairSigmaPeakTime: 3.      # "sigma" multiplier on peak time
  RefLeafBestDist:   0.5     # Initial distance once reference leaf found
}

standard_standardhit3dbuilder:
{
  tool_type:            StandardHit3DBuilder
  HitFinderTagVec:      ["gaushit"]
  EnableMonitoring:     true  # enable monitoring of functions
  NumSigmaPeakTime:     1.5   # Number "sigma" for peak times when building hits
  HitWidthScaleFactor:  6.    #
  DeltaPeakTimeSig:     1.7   # "Significance" of agreement between 2 hit peak times
  WirePitchScaleFactor: 1.9
  MaxHitChiSquare:      6.0
  OutputHistograms:     false
}

standard_spacepointhit3dbuilder:
{
  tool_type:               SpacePointHit3DBuilder
  SpacePointProducerLabel: "SpacePointSolver"
  HitProducerLabel:        "gaushit"
  EnableMonitoring:        true  # enable monitoring of functions
  MaxHitChiSquare:         6.0
  OutputHistograms:        false
}

standard_cluster3dprincipalcomponentsalg:
{
  ParallelLines:        0.00001 # delta theta to be parallel
}

standard_cluster3dParamsBuilder:
{
  tool_type:                ClusterParamsBuilder
  ClusterMinHits:           3
  ClusterMinUniqueFraction: 0.5
  ClusterMaxLostFraction:   0.5
  PrincipalComponentsAlg:   @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dMergeAlg:
{
  tool_type:              ClusterMergeAlg
  EnableMonitoring:       true    # enable monitoring of functions
  AxisAngleScaleFactor:   5.
  MinTransEigenVal:       0.09
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3ddbscanalg:
{
  tool_type:              DBScanAlg
  EnableMonitoring:       true    # enable monitoring of functions
  MinPairPts:             2       # minimum number of hit pairs for DBScan to consider
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dminSpanTreeAlg:
{
  tool_type:              MinSpanTreeAlg
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dskeletonalg:
{
  MinimumDeltaTicks:      0.05  # minimum delta time (in ticks) when matching hits
  MaximumDeltaTicks:      10.0  # maximum delta time (in ticks) when matching hits
}

standard_cluster3dhoughseedfinderalg:
{
  Minimum3DHits:            5      # Minimum number 3D hits to run transform
  ThetaBins:              360      # Number of bins in theta (pi)
  HalfRhoBins:             75      # Half of the number of bins in rho
  HiThresholdMin:           5      # Minimum value for hi threshold in hough scan
  HiThresholdFrac:       0.05      # Fraction of total hits for hi threshold
  LoThresholdFrac:       0.85      # Fraction of peak bin count for lo threshold
  NumSeed2DHits:           80      # number of 2D hits in the seed
  NumAveDocas:             6.      # number of "docas" from axis to accept hits
  NumSkippedHits:          10      # number hits allowed to be skipped for seed hits
  MaxLoopsPerCluster:       3      # Maximum number of loops to search for tracks
  MaximumGap:              5.      # Maximum gap in arc length for seed hits
  DisplayHoughHist:       false
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dpcaseedfinderalg:
{
  GapDistance:             5.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  MinAllowedCosAng:       0.7      # minimum angle allowed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dparallelhitsseedfinderalg:
{
  MaxNumEdgeHits:        1000      # Maximum number hits each end of PCA axis
  GapDistance:            20.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dPathAlg:
{
  tool_type:              ClusterPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_voronoiPathAlg:
{
  tool_type:              VoronoiPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_convexhullPathAlg:
{
  tool_type:              ConvexHullPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_MSTPathAlg:
{
  tool_type:              MSTPathFinder
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

microboone_standardhit3dbuilder:               @local::standard_standardhit3dbuilder
microboone_spacepointhit3dbuilder:             @local::standard_spacepointhit3dbuilder
microboone_cluster3dMergeAlg:                  @local::standard_cluster3dMergeAlg
microboone_cluster3dPathAlg:                   @local::standard_cluster3dPathAlg
microboone_voronoiPathAlg:                     @local::standard_voronoiPathAlg
microboone_cluster3ddbscanalg:                 @local::standard_cluster3ddbscanalg
microboone_cluster3dminSpanTreeAlg:            @local::standard_cluster3dminSpanTreeAlg
microboone_cluster3dprincipalcomponentsalg:    @local::standard_cluster3dprincipalcomponentsalg
microboone_cluster3dskeletonalg:               @local::standard_cluster3dskeletonalg 
microboone_cluster3dhoughseedfinderalg:        @local::standard_cluster3dhoughseedfinderalg 
microboone_cluster3dpcaseedfinderalg:          @local::standard_cluster3dpcaseedfinderalg
microboone_cluster3dparallelhitsseedfinderalg: @local::standard_cluster3dparallelhitsseedfinderalg
microboone_cluster3dkdtree:                    @local::standard_cluster3dkdTree

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG
BEGIN_PROLOG
mcsfitproducer: {
  module_type:  MCSFitProducer
  inputs: {
        inputLabel: @nil
  }
  fitter: {
  	pIdHypothesis: 13
	minNumSegments: 3
	segmentLength: 14.0
	minHitsPerSegment: 2
	nElossSteps: 10
	eLossMode: 0
	pMin: 0.01
	pMax: 7.50
	pStep: 0.01
	angResol: 3.0
  }
}
END_PROLOG
BEGIN_PROLOG
kalmanfilterfittrackmakertool: {
   tool_type: KalmanFilterFitTrackMaker
   options: {
      defaultMomInGeV: 1.0
      momFromMCSCollection: false
      mcsInputTag: ""
      momFromCombAndPid: false
      contInputTag: ""
      pidFromCollection: false
      pidInputTag: ""
      pidFromLengthCut: -1.
      defaultPdgId: 13
      dirFromVec: false
      dirVec: [0,0,1]
      alwaysInvertDir: false
      keepInputTrajectoryPoints: false
   }
   fitter: {
      useRMSError: true
      sortHitsByPlane: true
      sortHitsByWire: false
      sortOutputHitsMinLength: true
      skipNegProp: true
      cleanZigzag: false
      rejectHighMultHits: false
      rejectHitsNegativeGOF: true
      hitErr2ScaleFact: 1.0
      tryNoSkipWhenFails: true
      tryBothDirs: false
      pickBestHitOnWire: false
      maxResidue: -1.
      maxResidueFirstHit: -1.
      maxChi2: -1.
      maxDist: -1.
      negDistTolerance: 0.
      dumpLevel: 0
   }
   propagator: {
      minStep: 1.0
      maxElossFrac: 0.1
      maxNit: 10
      tcut: 10.
      wrongDirDistTolerance: 0.01
      propPinvErr: false
   }
   mcsfit: @local::mcsfitproducer.fitter
}
END_PROLOG
BEGIN_PROLOG

standard_trajclusteralg:
{
   Mode: 1                  # 1(-1) step from US(DS) to DS(US), 2 = don't use
   NPtsAve: 10              # Number of points to find average charge, Ave chg rms
   MinPtsFit: [3, 3, 3]     # Min number of points in the trajectory fit required on each pass
   MinPts:    [3, 3, 3]     # Min number of points in the trajectory required on each pass
   MaxAngleCode: [0, 1, 2]  # Max angle range code allowed on each pass
   MinMCSMom: [0, 0, 0]   # Minimum MCSMom for each pass
   MaxChi: 20               # Max Chi/DOF for accepting a trajectory fit (long muons)
   HitErrFac: 0.4          # hit time error for fitting = fHitErrFac * (hit RMS)
   MinAmp:  1               # Min amplitude for a wire signal being considered present (must be > 0)
   AngleRanges: [40, 85, 90]  # Max angle (degrees) for small, intermediate and large angle trajectories
   MultHitSep: 2.5          # Hits separated by < MultHitSep * RMS may be combined in a trajectory point
   ChargeCuts: [4, 0.15, 0.25]  # [Max(min) chg pull, Min allowed chg RMS, Max allowed chg RMS]
#   KinkCuts: [0.4, 1.5, 3] # kink angle, MCS kink significance, nPts fit << OLD
   KinkCuts: [ 8, 15, 1, 10 ] # << NEW
   # 0 Number of points to fit at the end of the trajectory
   # 1 Minimum kink significance
   # 2 Use charge in significance calculation? (yes if > 0)
   # 3 3D kink fit length (cm)
   ProjectionErrFactor: 2   # Factor applied to calculated trajectory error
   VLAStepSize: 1.5         # Step size for Very Large Angle trajectories
   JTMaxHitSep: 3           # max hit separation (WSE units) for making Junk Trajectories (<0) turn off
   MaxWireSkipNoSignal:  3  # max allowed number of not-dead wires if no signal is present
   MaxWireSkipWithSignal: 100  # max allowed number of not-dead wires if a signal is present
   QualityCuts: [ 0.8, 3] # Min points/wire, min consecutive pts after a gap
   MuonTag: [40, 500, 40, 3]    # minLength, minMCSMom, maxWireSkip,(min delta-ray length for muon direction tag)
   DeltaRayTag:  [10, 5, 500] # Tag short TJs as delta-rays close to muons [min sep, min MCSMom, max MCSMom]
#               0   1   2   3   4  5    6   7  8  9 10 11 12
   ShowerTag: [ 1, 100, 10, 50, 2.5, 1, 0, 3, 5, 0.7, 1, 10, -13]
# 0 Mode (<= 0 OFF, 1 = tag only, 2 = find showers)
  # 1 Max Tj MCSMom for a shower tag
  # 2 Max separation
  # 3 Min energy (MeV)
  # 4 rms width factor
  # 5 Min shower 1/2 width (WSE units)
  # 6 Min ElectronLikelihood (if > 0)
  # 7 Min Tjs
  # 8 max parent FOM
  # 9 max direction FOM
  # 10 max aspect ratio
  # 11 not used
  # 12 Print 2D showers in plane (0,1,2) or all planes (3) or just 3D matching (4)
   SaveShowerTree: false
   SaveCRTree: false
   TagCosmics: false
   ChkStopCuts: [10, 8, 1.5] # [Min chg slope, nFitPts, Chg fit ChiDOF cut]
   VertexScoreWeights: [1, 2, 10, 2]
    # 0 = Vertex error weight
    # 1 = 3D match weight
    # 2 = Charge fraction of vertex Tjs near the vertex weight
    # 3 = Tj MCSMom, ChgRMS, Angle difference significance between Tjs weight
   Vertex2DCuts:  [6, 8, 45, 3, 3, 50, 0.6, 30, 0.8, 0.8] # << NEW increase min Score
   # 0 User definition of a short Tj => max number of Tj points
   # 1 max separation between a vertex and the start of a trajectory for a user-defined short Tj
   # 2 max separation for a user-defined long Tj
   # 3 max position pull when attaching a Tj to a vertex
   # 4 max position error for creating a Tj or attaching Tjs to an existing vertex
   # 5 Min MCSMom of Tjs that can be used to create a vertex
   # 6 min frac of Points/Wire between a vtx and a Tj. Ideally one if the efficiency is good
   # 7 min Score
   # 8 Min charge fraction near a vertex or merge point
   # 9 max MCSmom asymmetry for a merge
   Vertex3DCuts: [0.8, 2., 3.]
   # 0 dX match cut (cm)
   # 1 dY and dZ match cut (cm)
   # 2 max separation btw PFParticle end and 3D vertex
   Match3DCuts: [ 0.5, 10000, 1, 2, 2.0, 2.5, 1]
   # 0 dx (cm) matching cut
   # 1 max number of 3-plane matches for any Tj
   # 2 Attempt 2-view match?
   # 3 min number of TP3Ds in at least 2 planes to fit in each PFP section
   # 4 max pull for adding/rejecting TP3Ds in sections
   # 5 suggested max ChiDOF for a SectionFit
   # 6 > 0 Don't match muon shower tjs
   PFPStitchCuts: [ 0.02, 3, 2 ]
   # 0 = matching angle resolution (radians)
   # 1 = matching position resolution (cm)
   # 2 = max angle-position figure of merit
   SkipAlgs: [ ]   # List of algs that should not be used
   DebugConfig: []
}
standard_trajclusteralg.CaloAlg: @local::standard_calorimetryalgmc

standard_clustercrawleralg:
{
  NumPass:              3  # number of passes through the hit list. 0 = no cluster reco
  MaxHitsFit: [ 100,  8, 4] # number of hits fitted to a line
  MinHits:    [ 50,  8, 3] # minimum size of a cluster
  NHitsAve:   [ 20,  8, 2] # number of hits to find the average charge and width
                           # at the end of the cluster. NHitsAve should be 1 or 2
  ChgCut:    [ .8, .8, .8] # max fractional hit charge difference for adding hits
  ChiCut:    [ 4, 8, 10] # stop adding hits to clusters if ChiCut is reached
  MaxWirSkip:   [25, 8, 0] # max number of wires to skip without adding a hit
  MinWirAfterSkip: [2, 2, 1] # min reqd number of consecutive wires with a hit after a skip
  KinkChiRat: [1.2, 1.2, 0.] # Max consecutive chisq increase for the last 3 hits on the cluster
                             # 0. = no kink check when following
  KinkAngCut: [0.4, 0.4, 1.5] # kink angle cut (radians) used to follow and merge
  DoMerge:   [false, true, true] # run cluster merging code?
  TimeDelta: [ 8, 8, 20] # max time difference for cluster merging
  MergeChgCut: [0.8, 0.8, 0.8] # max charge ratio for cluster merging
  FindVertices: [true, true, true]  # make 2D vertices after clustering?
  LACrawl:     [true, true, true]  # crawl Large Angle clusters?
  LAClusAngleCut:       60 # Large cluster angle cut (0 < 90 degrees). <0 to turn off
	LAClusMaxHitsFit: 		 4 #
	MinHitFrac: 				 0.6 # Drop clusters having < (#hits/#wires)
	MinAmp: 			 [5, 5, 5] # Min hit signal amplitude for merging
	ChgNearWindow:				40 # #of ticks for summing charge near a cluster
	ChgNearCut: 				 1.5 # Cluster end is shower-like if (nearby chg)/(cls chg)> cut
  HitMergeChiCut:      2.5 # Merge cluster hit-multiplets if the separation chisq
                           # is < cut. Set < 0 for no merging
  MergeAllHits:      false # merge all hits before reconstructing clusters
  MergeOverlapAngCut:  0.1 # Set <= 0 to turn off overlapping cluster merging
  ChkClusterDS:       true # Check reconstruction at DS end of clusters?
  KillGarbageClusters: 0.1 # Kill ghost clusters, set to 0 to turn off
  VtxClusterSplit:    true # Split clusters that cross vertices
  FindStarVertices:   true # Find vertices with a star topology
  HitErrFac:           0.2 # hit time error for fitting = fHitErrFac * (hit width)
  HitMinAmp:             2 # ignore hits with PH < this value
  ClProjErrFac:          3 # cluster projection error factor
  AllowNoHitWire:        1 # Allow skipping N wires w no hits (if poor purity)
	Vertex2DCut:					10 # Max chisq cut for attaching a cluster to a vtx
  Vertex3DCut:           5 # 2D vtx -> 3D vtx matching cut (chisq)
	FindHammerClusters: true # look for hammer type clusters
  RefineVertexClusters: false # (not ready)
  FindVLAClusters: false # find Very Large Angle clusters (not ready)
  DebugPlane:          -1  # print info only in this plane
  DebugWire:            0  # set to the Begin Wire and Hit of a cluster to print
  DebugHit:             0  # out detailed information while crawling
}

standard_blurredclusteralg:
{
  BlurWire:            6
  BlurTick:            12
  SigmaWire:           4
  SigmaTick:           6
  ClusterWireDistance: 2
  ClusterTickDistance: 2
  MaxTickWidthBlur:    10
  NeighboursThreshold: 0
  MinNeighbours:       0
  MinSize:             2
  MinSeed:             0.1
  TimeThreshold:       500
  ChargeThreshold:     0.07
}

standard_mergeclusteralg:
{
  MinMergeClusterSize: 3
  MaxMergeSeparation:  30
  ProjWidthThreshold:  0.2
}

standard_houghbasealg:
{
  MaxLines:                 50   # The maximum number of Hough lines to look for, 20 had been working!
  MinHits:                  5
  SaveAccumulator:          0
  NumAngleCells:            20000 # The number of angle cells to create for the Hough transform,
  RhoResolutionFactor:      5    # Was set to 5
  MaxDistance:              1.0  # 0.1 was working (okay, not really, larger is probably better,
  MaxSlope:                 80.0 # 80 was working fine previously
  RhoZeroOutRange:          0
  ThetaZeroOutRange:        0
  HitsPerCluster:           1
  MissedHits:               1    # Was set to 0
  MissedHitsDistance:       2.0  #
  MissedHitsToLineSize:     0.25    # Was set to 0
}

standard_endpointalg:
{
  TimeBins:            256
  MaxCorners:          20
  Gsigma:              1.
  Window:              5
  Threshold:           0.1
  SaveVertexMap:       -1
}


standard_cornerfinderalg:
{
  RawDataModuleLabel:           "daq"
  CalDataModuleLabel:		"caldata"
  Trimming_threshold:      10
  Trimming_totalThreshold: 5e4
  Conversion_algorithm:         "standard"
  Conversion_function:          "TMath::Gaus(x,0,1)*TMath::Gaus(y,0,1)"
  Conversion_func_neighborhood: 3
  Conversion_threshold:		0
  Conversion_bins_per_input_x:	1
  Conversion_bins_per_input_y:	1
  Derivative_method: 		"Sobel" #Noble
  Derivative_neighborhood:	1
  Derivative_BlurFunc:	"NotImplemented"
  Derivative_BlurNeighborhood:	5
  CornerScore_Noble_epsilon:    1e-5
  CornerScore_Harris_kappa:     0.05
  CornerScore_neighborhood:	1
  CornerScore_algorithm:	"Nobel" #Harris
  MaxSuppress_neighborhood:	3
  MaxSuppress_threshold:	1000
  Integral_bin_threshold:       5
  Integral_fraction_threshold:  0.95


}

standard_dbscanalg:
{
  eps:    1.0
  epstwo: 1.5
  minPts: 2
  Method: 0   # 0 -- naive findNeighbor implemention
              # 1 -- findNeigbors with R*-tree
              # 2 -- DBScan from the paper with R*-tree
  Metric: 3   # Which RegionQuery distance metric to use.
              # **ONLY APPLIES** if Method is 1 or 2.
              #
	      # 0 -- rectangle (no bad channels) **not implemented**
	      # 1 -- Manhattan distance (only uses eps, no bad channels)
              #                                  **not implemented**
	      # 2 -- Eliptical (no bad channels) **not implemented**
	      # 3 -- findNeighbors-alike: Elliptical and bad
              #                           channel aware (not working)
}

standard_dbscan3dalg:
{
    epsilon:          5.0
    minpts:           2
    neighbors:        100
    badchannelweight: 0.
}

standard_tcshoweralg:
{
    CalorimetryAlg: @local::standard_calorimetryalgmc
    ProjectionMatchingAlg:    @local::standard_projectionmatchingalg
}

standard_fuzzyclusteralg:
{
  RunHough:       true    # Turns on and off the Hough line finder, useful for diagnostics
  NumberTimeBoundaries:             3	# Number of boundaries in ticks for the drift window to be divided up to make the Hough line finder easier on memory
  NumberWireBoundaries:             3	# Number of boundaries in wires for the drift window to be divided up to make the Hough line finder easier on memory
  GenerateHoughLinesOnly:       false # Show only the results of the Hough line finder, hits not in a line will not be clustered
  HoughBaseAlg:{
    MaxLines:             100
    MaxDistance:          1
    MinHits:              5
    NumAngleCells:        10800
    SaveAccumulator:          0
    RhoResolutionFactor:      5
    MaxSlope:                 80.0 # 80 was working fine previously
    RhoZeroOutRange:          0
    ThetaZeroOutRange:        0
    HitsPerCluster:           1
    MissedHits:               1    # Was set to 0
    MissedHitsDistance:       1.0  #
    MissedHitsToLineSize:     0.5    # Was set to 0
  }
  DBScanAlg:                @local::standard_dbscanalg
  DoFuzzyRemnantMerge:      true # Tell the algorithm to merge fuzzy cluster remnants into showers or tracks (0-off, 1-on)
  FuzzyRemnantMergeCutoff: 20    # Cut off on distance from hough line to hit in the remnant of the fuzzy cluster

  DoTrackClusterMerge:     true # Turns on merging of track-like Hough lines (0-off, 1-on)
  ChargeAsymAngleCut:        0.1 # Cut on product of charge asymmetry and the square of the sin of angle between slopes of lines, only for track-like
  SigmaChargeAsymAngleCut:   1.0  # Cut on product of charge sigma asymmetry and the sin of angle between slopes of lines, only for track-like
  TrackClusterMergeCutoff: 5.0 # The maximum distance between track-like Hough line endpoints before they can be merged,

  DoShowerClusterMerge:     true # Turns on merging of shower-like Hough line (0-off, 1-on)
  ShowerClusterMergeAngle: 30    # The maximum angle between slopes of shower-like lines to be merged,
  ShowerClusterMergeCutoff:  7.5 # The maximum distance between shower-like line endpoints before they can be merged,

  DoShowerTrackClusterMerge:     true # Turns on merging of shower-like and track-like lines (0-off, 1-on)
  ShowerTrackClusterMergeAngle:  15   # The maximum angle between slopes of shower-like and track-like lines to be merged,
  ShowerTrackClusterMergeCutoff: 7.5  # The maximum distance between shower-like and track-like line endpoints before they can be merged,
  ShowerLikenessCut:       10    # Cut on shower likeness (the larger the more shower like, the smaller the less shower like)
  MaxVertexLines:          100   # Max number of line end points allowed in a Hough line merge region for a merge to happen
  VertexLinesCutoff:       5.0   #  Size of the vertex region to count up lines for MaxVertexLines
}

standard_clusterparamsalg:
 {
  ChargeCutoffThreshold:    [500,500,1000]
  SelectBoxSizePar:               10     #distance along axis
  SelectBoxSizePerp:              3      #distance perpendicular to axis
  ForceRightGoing:        	  false
  MinHitListSize:		  40
  fOutlierRadius:		  5
  #HoughBaseAlg.NumAngleCells:       3000
  #HoughBaseAlg.RhoResolutionFactor:       4
  #HoughBaseAlg.MaxLines:       100
  HitDensityCutoff:             1.9  # Showers is high, tracks low, 0 don't use cut
  MultiHitWireCutoff: 		 2.1  # Showers is high, tracks low, 0 don't use cut
  OffAxisHitsCutoff:            0    # Showers is high, tracks low, 0 don't use cut
  PrincipalComponentCutoff:     0    # Tracks is high ~1, showers low, 0 don't use cut
  ShowerSelisORorAND:           0    # 0 = OR, 1 = AND

  HoughBaseAlg:                   @local::standard_houghbasealg

 }

 standard_clustermatchalg:
 {
  DebugMode: true
  StoreSpacePoint: true
  MatchAlgoList:                [0, 1, 2, 3] # Algorithms enum to be enabled
  CutParam_NumSpacePoint:       100          # Number of minimum space point to claim a cluster by kSpacePoint
  CutParam_OverlayTimeFraction: 0.0          # Minimum fraction of overlayed time period used by kRoughTime
  CutParam_SumChargeRatio:      1000.0       # Maximum difference in fraction of clusters' charge sum used by kSumCharge
  SpacePointAlg:                @local::microboone_spacepointalg
  }
 standard_clustermatchalg.SpacePointAlg.Filter: false

 standard_clustermergealg:
 {
  VerboseMode:    false
  MaxAngleDiff:   0
  MaxSquaredDist: 0
  }

standard_smallclustalg:
 {
  RadiusSizePar:   	3	  #radius of circle in "cm"
  NHitsInClust:		4	  # Max Number of hits in cluster
  Verbose:			false
 }

standard_clustermatchtq:
{
  KSCut: 0.9
  EnableU: true
  EnableV: true
  EnableZ: true
}

standard_dbscanalg_fast:        @local::standard_dbscanalg
standard_dbscanalg_fast.eps:    1.25
standard_dbscanalg_fast.epstwo: 1.75
standard_dbscanalg_fast.Method: 2

jp250L_dbscanalg:                  @local::standard_dbscanalg
jp250L_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
jp250L_houghbasealg:               @local::standard_houghbasealg
jp250L_houghbasealg.MaxLines:      15
jp250L_houghbasealg.MinHits:       3
jp250L_houghbasealg.NumAngleCells: 5000
jp250L_houghbasealg.MaxDistance:   5.0
jp250L_endpointalg:                @local::standard_endpointalg

bo_dbscanalg:                   @local::standard_dbscanalg
bo_fuzzyclusteralg:             @local::standard_fuzzyclusteralg
bo_houghbasealg:                @local::standard_houghbasealg
bo_houghbasealg.MaxLines:       15
bo_houghbasealg.MinHits:        3
bo_houghbasealg.NumAngleCells:  5000
bo_houghbasealg.MaxDistance:    5.0
bo_endpointalg:                 @local::standard_endpointalg
bo_clustercrawleralg:           @local::standard_clustercrawleralg
bo_clustercrawleralg.NumPass: 1
bo_clustercrawleralg.MaxHitsFit: [ 8 ]
bo_clustercrawleralg.MinHits: [ 3 ]
bo_clustercrawleralg.ChgCut: [ 2. ]
bo_clustercrawleralg.WidCut: [ 2. ]
bo_clustercrawleralg.ChiCut: [ 20. ]
bo_clustercrawleralg.MaxWirSkip: [ 25 ]
bo_clustercrawleralg.MinWirAfterSkip: [ 1 ]
bo_clustercrawleralg.KinkChiRat: [ 2. ]
bo_clustercrawleralg.KinkAngCut: [ 0.5 ]
bo_clustercrawleralg.DoMerge:  [ true ]
bo_clustercrawleralg.TimeDelta:  [ 10. ]
bo_clustercrawleralg.FindVertices: [ false ]
bo_clustercrawleralg.HitErrFac: 1.
bo_clustermatchtq:             @local::standard_clustermatchtq

argoneut_dbscanalg:                  @local::standard_dbscanalg
argoneut_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
argoneut_houghbasealg:               @local::standard_houghbasealg
argoneut_houghbasealg.MaxLines:      15
argoneut_houghbasealg.MinHits:       3
argoneut_houghbasealg.NumAngleCells: 5000
argoneut_houghbasealg.MaxDistance:   5.0
argoneut_endpointalg:                @local::standard_endpointalg
argoneut_cornerfinderalg:		      @local::standard_cornerfinderalg
argoneut_clusterparamsalg:       @local::standard_clusterparamsalg
argoneut_clusterparamsalg.HoughBaseAlg: @local::argoneut_houghbasealg
argoneut_clusterparamsalg.HoughBaseAlg.NumAngleCells:       3000
argoneut_clusterparamsalg.HoughBaseAlg.RhoResolutionFactor:       4
argoneut_clusterparamsalg.HoughBaseAlg.MaxLines:       100
argoneut_clusterparamsalg.ChargeCutoffThreshold:  [200,400]
argoneut_clusterparamsalg.ForceRightGoing:   true
argoneut_smallclustalg:	@local::standard_smallclustalg
argoneut_clustermatchtq:             @local::standard_clustermatchtq
argoneut_clustermatchtq.KSCut:              0.5


microboone_dbscanalg:                         @local::standard_dbscanalg_fast
microboone_endpointalg:                       @local::standard_endpointalg
microboone_houghbasealg:                      @local::standard_houghbasealg
microboone_houghbasealg.MaxLines:             20
microboone_houghbasealg.MaxDistance:          1.0
microboone_houghbasealg.MinHits:              5
microboone_houghbasealg.NumAngleCells:        20000
microboone_houghbasealg.DoHoughLineMerge:     1
microboone_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
microboone_fuzzyclusteralg.Threshold          : -20.0
microboone_cornerfinderalg:		      @local::standard_cornerfinderalg
microboone_clusterparamsalg:                  @local::standard_clusterparamsalg
microboone_smallclustalg:	              @local::standard_smallclustalg
microboone_clustercrawleralg:                 @local::standard_clustercrawleralg

microboone_trajclusteralg:                    @local::standard_trajclusteralg
microboone_trajclusteralg.MultHitSep: 3.2
microboone_trajclusteralg.MaxWireSkipNoSignal: 2
microboone_trajclusteralg.MuonTag: [40, 500, 10, 3]
microboone_trajclusteralg.VLAStepSize: 1
microboone_trajclusteralg.Vertex2DCuts: [ 6, 8, 45, 3, 3, 50, 0.6, 50, 0.8, 0.8]

microboone_clustermatchalg:                   @local::standard_clustermatchalg
microboone_clustermergealg:                   @local::standard_clustermergealg
microboone_clustermatchtq:                    @local::standard_clustermatchtq

dune35t_dbscanalg:    @local::standard_dbscanalg_fast
dune35t_dbscanalg.eps:    2.0
dune35t_dbscanalg.epstwo: 2.0
dune35t_houghbasealg: @local::standard_houghbasealg
#dune35t_houghbasealg.DoHoughLineMerge:     1
dune35t_endpointalg:  @local::standard_endpointalg
dune35t_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dune35t_fuzzyclusteralg.HoughBaseAlg:      @local::dune35t_houghbasealg
#dune35t_fuzzyclusteralg.Threshold:         -50.0
dune35t_clustercrawleralg:                 @local::standard_clustercrawleralg
dune35t_clustermatchtq:                    @local::standard_clustermatchtq
dune35t_clustermatchtq.KSCut:              0.7

dunefd_dbscanalg:    @local::standard_dbscanalg_fast
dunefd_houghbasealg: @local::standard_houghbasealg
dunefd_endpointalg:  @local::standard_endpointalg
dunefd_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dunefd_fuzzyclusteralg.HoughBaseAlg:      @local::dunefd_houghbasealg
dunefd_clustercrawleralg:                 @local::standard_clustercrawleralg
dunefd_clustermatchtq:                    @local::standard_clustermatchtq
dunefd_clustermatchtq.KSCut:              0.7


END_PROLOG

BEGIN_PROLOG


apa_geoalg:
{
}


apa_disambigalg:
{
 APAGeometryAlg:     @local::apa_geoalg
 Crawl:              true
 UseEndP:            true
 CompareViews:       true
 NChanJumps:         5
 CloseHitsRadius:    6.
 MaxEndPDegRange:    10.
}



END_PROLOG

BEGIN_PROLOG


standard_disambigcheat:
{
 module_type:         "DisambigCheater"
 ChanHitLabel:        "gaushit"
}

standard_disambigfromsp:
{
    module_type:      "DisambigFromSpacePoints"
    HitModuleLabel:   "gaushit"
    SpModuleLabel:    "reco3d"
    ExcludeTPCs:      []       # if there are TPC volumes with no actual drift towards wires, exclude them here
    UseNeighbors:     true     # use neigboring hits to resolve hits missed by spacepoints
    NumNeighbors:     2        # number of neigboring hits to resolve hits missed by spacepoints
    MaxDistance:      1000        # neighborhood max distance [cm] used to resolve hits missed with spacepoints
    MoveLeftovers:    "first"  # "repeat" - duplicate undisambiguated hits to every allowed wire segment
                               # "first"  - put undisambiguated hits on the first allowed wire segment
                               # "drop"   - drop undisambiguated hits from the output
    MonitoringPlots:  false    # create histograms of no. of unresolved hits at each stage, per plane
}

hit_repeater:
{
    module_type:      "HitRepeater"
    ChanHitLabel:     "gaushit"
}

emlikehits:
{
    module_type:      "EmLikeHits"
    HitModuleLabel:   "hit"   # hits used to reconstruct tagged tracks
    Trk3DModuleLabel: "track" # tagged tracks (hadron/muon- or cascade-like)
}

# This is the showerhitseparator that divides the output from MVA methods
# # identifying the shower hits and track hits.
standard_showerhitseparator:
{
  module_type: "ShowerHitSeparator"
  MVALabel: "emtrkmichelid:emtrkmichel"
  HitLabel: "linecluster"
  MVAOutputCut: 0.6
  SaveTree: false
}

apa_hitfinder:
{
 module_type:         "APAHitFinder"
 DisambigAlg:         @local::apa_disambigalg
 ChanHitLabel:        "gaushit"
 ClusLabel:           "fuzzy"
}

dunefd_disambigfromsp:                @local::standard_disambigfromsp
dunefd_disambigfromsp.ExcludeTPCs:    [] # workspace has no outer TPCs, but full FD has, I think

pdune_disambigfromsp:                 @local::standard_disambigfromsp
pdune_disambigfromsp.ExcludeTPCs:     []
pdune_disambigfromsp.MoveLeftovers:   "repeat"

dunefddphase_gaushitfinder:	@local::gaus_hitfinder
#dunefddphase_gaushitfinder.MinSig:    [6.0, 6.0]
#dunefddphase_gaushitfinder.MinWidth:  [1.0, 1.0]
dunefddphase_gaushitfinder.HitFinderToolVec.CandidateHitsPlane0.RoiThreshold: 6.0
dunefddphase_gaushitfinder.HitFinderToolVec.CandidateHitsPlane1.RoiThreshold: 6.0
dunefddphase_gaushitfinder.InitWidth: [6.0, 6.0]
dunefddphase_gaushitfinder.AreaNorms: [13.25, 13.25]
#dunefddphase_gaushitfinder.Chi2NDFRetry: 1000.

dunefddphase_dprawhitfinder:	@local::dpraw_hitfinder

dune35t_hit_repeater:    @local::hit_repeater
dune35t_disambigcheat:    @local::standard_disambigcheat

dune35t_gaushitfinder:    @local::gaus_hitfinder
dune35t_apahitfinder:     @local::apa_hitfinder
dune35t_emlikehits:    @local::emlikehits
dune35t_hitcheater:	  @local::standard_hitcheater

#dune35t_gaushitfinder.MinSig:    [6.0, 6.0, 6.0]
#dune35t_gaushitfinder.MinWidth:  [1.0, 1.0, 1.0]
dune35t_gaushitfinder.HitFinderToolVec.CandidateHitsPlane0.RoiThreshold: 6.0
dune35t_gaushitfinder.HitFinderToolVec.CandidateHitsPlane1.RoiThreshold: 6.0
dune35t_gaushitfinder.HitFinderToolVec.CandidateHitsPlane2.RoiThreshold: 6.0
dune35t_gaushitfinder.InitWidth: [6.0, 6.0, 6.0]
dune35t_gaushitfinder.AreaNorms: [13.25, 13.25, 13.25]
#dune35t_gaushitfinder.Chi2NDFRetry: 1000.

dune35t_disambigalg:
{
    TimeCut:          3.   #tolerance for 3 view hits matching, in ticks
    DistanceCut:      1.   #tolerance to determine whether wires cross, in cm
    DistanceCutClu:   4.   #tolerance to get disambiguated hits around a given hit, in cm
    TimeWiggle:       5.   #Buffer to extend cluster windows by to exclude small clusters
    		      	   # of mis-identified hits.
    ColChannelWiggle: 5    #Buffer to extend cluster windows by to exclude small clusters
                           # of mis-identified hits.
    DoCleanUpHits:    true #clean up wrong hit triplets
    DBScanAlg:        @local::standard_dbscanalg
}

dune35t_disambigalg.DBScanAlg.eps:       13.
dune35t_disambigalg.DBScanAlg.epstwo:    15.

dune35t_TimeBasedDisambigAlg:
{
    TimeCut:          3.   #tolerance for 3 view hits matching, in ticks
    DistanceCut:      1.   #tolerance to determine whether wires cross, in cm
    DistanceCutClu:   4.   #tolerance to get disambiguated hits around a given hit, in cm
    TimeWiggle:       5.   #Buffer to extend cluster windows by to exclude small clusters
                           # of mis-identified hits.
    ColChannelWiggle: 5    #Buffer to extend cluster windows by to exclude small clusters
                           # of mis-identified hits.
}

dune35t_hitfinder35t:
{
    module_type:      "HitFinder35t"
    DisambigAlg:      @local::dune35t_disambigalg
    TimeBasedDisambigAlg:      @local::dune35t_TimeBasedDisambigAlg
    ChanHitLabel:     "gaushit"
    Algorithm:        "TripletMatch"
}

dune35t_handscan:
{
    module_type:     "HitHandScan"
    HandScanFileName: "/dune/app/users/mthiesse/PersistentFiles/handscan.txt"
    PreviousHitModuleLabel: "hit35t"
}

dune35t_hitlinefitalg:
{
    FitPolN: 2
    MinStartPoints: 3
    MinAlsoPoints: 6
    IterationsMultiplier: 20
    InclusionThreshold: 2
    LogLevel: 2
}

dune35t_hitfindercounters:
{
    module_type:           "HitFinderCounter35t"
    Debug:                 false
    HitsModuleLabel:       "gaushit"
    CounterModuleLabel:    "SplitterInput:TRIGGER"
    CounterDir:            "/dune/app/users/mthiesse/PersistentFiles/"
    CounterFile:           "counterInformation.txt"
    CoincidenceTolerance:  2
    fConvCountTimeToTicks: 32
    ExtendCounters:        10
    AdjacentWireWidth:     10
    AdjacentTimeWidth:     100
    CollectionTimeWidth:   50
    DoHitLineFitAlg:       false
    HitLineFitAlg:         @local::dune35t_hitlinefitalg
}

dune35t_hitfindercounters_sim: @local::dune35t_hitfindercounters
dune35t_hitfindercounters_sim.CounterModuleLabel: "simcounter"
dune35t_hitfindercounters_sim.CounterDir: "/dune/app/users/mthiesse/PersistentFiles/"
dune35t_hitfindercounters_sim.CounterFile: "counterInformation_sim.txt"


dune35t_fasthitfinder:    @local::standard_fasthitfinder
dune35t_fasthitfinder.MinSigInd: 5.0
dune35t_fasthitfinder.MinSigCol: 5.0

dune35t_clustercrawlerhit: @local::standard_clustercrawlerhit
dune35t_clustercrawlerhit.CCHitFinderAlg.ChiNorms:           [ 0.31, 0.62, 0.6 ]
dune35t_clustercrawlerhit.CCHitFinderAlg.MinPeak:            [ 3., 3., 3. ]
dune35t_clustercrawlerhit.CCHitFinderAlg.MinRMS:             [ 2.3, 2.3, 2.1 ]
dune35t_clustercrawlerhit.CCHitFinderAlg.AllowNoHitWire:     2

dunefd_disambigcheat:     @local::standard_disambigcheat
dunefd_gaushitfinder:     @local::dune35t_gaushitfinder
dunefd_apahitfinder:      @local::apa_hitfinder
dunefd_hitcheater:	  @local::standard_hitcheater
dunefd_fasthitfinder:     @local::dune35t_fasthitfinder
dunefd_clustercrawlerhit: @local::dune35t_clustercrawlerhit
dunefd_hitfinderfd:       @local::dune35t_hitfinder35t
dunefd_hitfinderfd.DisambigAlg.DoCleanUpHits:  false
dunefd_hitfinderfd.DisambigAlg.DistanceCutClu: 100

protodunespmc_gaushitfinder: @local::gaus_hitfinder
protodunespmc_gaushitfinder.HitFinderToolVec.CandidateHitsPlane0.RoiThreshold: 0.6
protodunespmc_gaushitfinder.HitFinderToolVec.CandidateHitsPlane1.RoiThreshold: 0.6
protodunespmc_gaushitfinder.HitFinderToolVec.CandidateHitsPlane2.RoiThreshold: 0.6
protodunespmc_gaushitfinder.InitWidth: [6.0, 6.0, 6.0]
protodunespmc_gaushitfinder.AreaNorms: [13.25, 13.25, 13.25]
protodunespmc_gaushitfinder.MaxMultiHit: 4
protodunespmc_gaushitfinder.Chi2NDF: 50
protodunespmc_gaushitfinder.LongMaxHits: [ 25, 25, 25 ]
protodunespmc_gaushitfinder.LongPulseWidth: [ 10, 10, 10 ]
protodunespmc_gaushitfinder.PeakFitter:	@local::peakfitter_mrqdt

dune35t_rmshitfinderalg:
{
    WindowWidth: 50
    FilterWidth: 6
    SigmaRiseThreshold: 2.0
    SigmaFallThreshold: 0.25
}

dune35t_robusthitfinder:
{
    module_type: "RobustHitFinder"
    MakeTree: true
    Efield: [ 0.25, 0.620, 0.777, 1.772 ] #kV/cm --> 60kV cathode voltage
    CounterT0ModuleLabel: "t0counter"
    WireModuleLabel: "caldata"
    DigitModuleLabel: "caldata"
    DoWireAssns: true
    DoRawDigitAssns: false
    HitGeomDistanceCut: 25
    MinPedMean: -10
    MaxPedMean: 4000
    MinPedRms: 0
    MaxPedRms: 500
    MakeupMissedHits: true
    MissedBufferTicksLow: 0
    MissedBufferTicksHigh: 0
    HitLineFitAlg: @local::dune35t_hitlinefitalg
    RMSHitFinderAlg: @local::dune35t_rmshitfinderalg
    UseMeasuredCounterPositions: true
    ConstantHitWidth: true
    PreHitTicks: 50
    PostHitTicks: 100
    Simulation: false
}

dune35t_robusthitfindersim: @local::dune35t_robusthitfinder
dune35t_robusthitfindersim.SearchPreTicks: 100
dune35t_robusthitfindersim.SearchPostTicks: 4400
dune35t_robusthitfindersim.HitGeomDistanceCut: 25
dune35t_robusthitfindersim.UseMeasuredCounterPositions: false
dune35t_robusthitfindersim.Simulation: true

protodunesp_disambig:
{
    module_type: "HitFinderProtoDUNESP"
# so far there's only one algorithm so this value is ignored.
    ChanHitLabel: "gaushit"
    Algorithm: "Placeholder_Value"
    DisambigAlg:
     {
       TimeCut: 3
       DistanceCut: 1
     }
}

dune35t_trackhitbacktracker:
{
    module_type: "TrackHitBacktracker"
    WireModuleLabel: "caldata"
    TrackModuleLabel: "pmtrack"
    PrevHitModuleLabel: "linecluster"
    PreBaselineTicks: 100
    PostBaselineTicks: 100
    PulseStartWidthMult: 1.0
    PulseEndWidthMult: 1.5
    MakeTree: false
}


END_PROLOG

BEGIN_PROLOG



dunefd_calwire:
{
 module_type:        "CalWireDUNE10kt"
 DigitModuleLabel:   "daq"
 #PostsampleBins:     400
 PostsampleBins:     0
 DoBaselineSub:  false # subtract baseline after deconvolution?
 PlaneROIPad: [ 50, 50 ] # number of bins to pad both ends of the ROIs
 SigThrFact:  3.0
 
}
dunefd_calwireana:   @local::standard_calwireana

dunefddphase_calwire:
{
 module_type:        "CalWireDUNEDPhase"
 DigitModuleLabel:   "daq"
 #PostsampleBins:     400
 PostsampleBins:     0
 DoBaselineSub:  false # subtract baseline after deconvolution?
 PlaneROIPad: [ 50, 50 ] # number of bins to pad both ends of the ROIs
 SigThrFact:  3.0
}
dunefddphase_calwireana: @local::standard_calwireana

dune35t_calwire:
{
 module_type:        "CalWireDUNE35t"
 DigitModuleLabel:   "daq"
 # PostsampleBins:     400
 PostsampleBins:     0	
 DoBaselineSub:  false # subtract baseline after deconvolution?
 PlaneROIPad: [ 50, 50 ] # number of bins to pad both ends of the ROIs
 fSigThrFact: 3.0
}
dune35t_calwireana:    @local::standard_calwireana

dune35t_deconvgaushf:
{
 module_type:        "DeconvGausHFDUNE35t"
 DigitModuleLabel:   "daq"
 PostsampleBins:     400
 DeconvKernSize:       5                # Length of truncated deconvolution kernel
 MinSigInd:            6.0              # Induction signal height threshold  
 MinSigCol:            11.0             # Collection signal height threshold
 IndWidth:             6.0              # Initial width for induction fit
 ColWidth:             7.8              # Initial width for collection fit
 IndMinWidth:          4.0              # Induction Hit width threshold
 ColMinWidth:          6.0              # Collection hit width threshold
 MaxMultiHit:          3                # maximum hits for multi fit   
 AreaMethod:           0                # 0 = area by integral, 1 = area by gaussian area formula
 AreaNorms:            [ 13.25, 26.31 ] # normalizations that put signal area in 
                                        # same scale as peak height. 
 Chi2NDF:              15               # maximum Chisquared / NDF allowed for a hit to be saved
}
dune35t_deconvgaushfana:    @local::standard_calwireana

dunefd_deconvgaushf:
{
 module_type:        "DeconvGausHFDUNE10kt"
 DigitModuleLabel:   "daq"
 PostsampleBins:     400
 DeconvKernSize:       30               # Length of truncated deconvolution kernel
 MinSigInd:            6.0              # Induction signal height threshold  
 MinSigCol:            11.0             # Collection signal height threshold
 IndWidth:             6.0              # Initial width for induction fit
 ColWidth:             7.8              # Initial width for collection fit
 IndMinWidth:          4.0              # Induction Hit width threshold
 ColMinWidth:          6.0              # Collection hit width threshold
 MaxMultiHit:          3                # maximum hits for multi fit   
 AreaMethod:           0                # 0 = area by integral, 1 = area by gaussian area formula
 AreaNorms:            [ 13.25, 26.31 ] # normalizations that put signal area in 
                                        # same scale as peak height. 
 Chi2NDF:              15               # maximum Chisquared / NDF allowed for a hit to be saved
}
dunefd_deconvgaushfana:    @local::standard_calwireana



dune35t_calgaushf:
{
 module_type:        "CalGausHFDUNE35t"
 DigitModuleLabel:   "daq"
 PostsampleBins:     400
 DeconvKernSize:       5                # Length of truncated deconvolution kernel
 MinSigInd:            6.0              # Induction signal height threshold  
 MinSigCol:            11.0             # Collection signal height threshold
 IndWidth:             6.0              # Initial width for induction fit
 ColWidth:             7.8              # Initial width for collection fit
 IndMinWidth:          4.0              # Induction Hit width threshold
 ColMinWidth:          6.0              # Collection hit width threshold
 MaxMultiHit:          3                # maximum hits for multi fit   
 AreaMethod:           0                # 0 = area by integral, 1 = area by gaussian area formula
 AreaNorms:            [ 13.25, 26.31 ] # normalizations that put signal area in 
                                        # same scale as peak height. 
 Chi2NDF:              15               # maximum Chisquared / NDF allowed for a hit to be saved
}
dune35t_calgaushfana:    @local::standard_calwireana


dunefd_calgaushf:
{
 module_type:        "CalGausHFDUNE10kt"
 DigitModuleLabel:   "daq"
 PostsampleBins:     400
 DeconvKernSize:       30               # Length of truncated deconvolution kernel
 MinSigInd:            6.0              # Induction signal height threshold  
 MinSigCol:            11.0             # Collection signal height threshold
 IndWidth:             6.0              # Initial width for induction fit
 ColWidth:             7.8              # Initial width for collection fit
 IndMinWidth:          4.0              # Induction Hit width threshold
 ColMinWidth:          6.0              # Collection hit width threshold
 MaxMultiHit:          3                # maximum hits for multi fit   
 AreaMethod:           0                # 0 = area by integral, 1 = area by gaussian area formula
 AreaNorms:            [ 13.25, 26.31 ] # normalizations that put signal area in 
                                        # same scale as peak height. 
 Chi2NDF:              15               # maximum Chisquared / NDF allowed for a hit to be saved
}
dunefd_calgaushfana:    @local::standard_calwireana

dune35t_unstick:
{
 module_type:        "UnstickADCCodes"
 DigitModuleLabel:   "daq" 
 StickyADCCodesLimit:  5                # Number of ADC codes to check for stickiness at 0x00 or 0x3f before stopping, 
                                        # i.e. assuming that ADC values are at true zero or pedestal value that is not sticky
}

END_PROLOG

BEGIN_PROLOG

protodunespdata_nfsp: 
{
    module_type : WireCellToolkit
    wcls_main: {
        tool_type: WCLS
        apps: ["Pgrapher"]
        
        # Libraries in which to look for WCT components
        plugins: ["WireCellGen", "WireCellSigProc", "WireCellSio", "WireCellPgraph", "WireCellLarsoft"]
        
        # The tool marshals the art::Event to these visitors before.
        # See notes below in params.
        inputers: ["wclsRawFrameSource"
                   # To use wclsMultiChannelNoiseDB you must also put epoch:dynamic below
                   # and you must have geo::Geometry service in your environment.
                   # ,"wclsMultiChannelNoiseDB"  
               ]
        
        # or after the WCT app is run.  These names MUST be used identically in the Jsonnet
        # fixme: https:#github.com/WireCell/larwirecell/issues/3
        #outputers: ["wclsFrameSaver:nfsaver", "wclsFrameSaver:spsaver"]
        outputers: ["wclsFrameSaver:spsaver"]

        # This sets the "main" Jsonnet file which provides the 
        # configuration for the Wire-Cell Toolkit components.  It is
        # take as relative to entries in WIRECELL_PATH.
        configs: ["pgrapher/experiment/pdsp/wcls-nf-sp.jsonnet"]

        # Set the "external variables" required by the Jsonnet.
        params : {
            # This locates the input raw::RawDigit collection in the art::Event 
            raw_input_label: "tpcrawdecoder:daq"

            # Set "data" vs. "sim".  The epoch below probably should follow suit.
            reality: "data"
            # reality: "sim"

            # if epoch is "dynamic" you MUST add
            # "wclsMultiChannelNoiseDB" to "inputers" and must NOT
            # add it if not "dynamic"
            # epoch: "dynamic"
            # epoch: "perfect"
            epoch: "after"

            # Save output signal waveforms (recob::Wire) in "sparse" or "dense" form
            signal_output_form: "sparse"
        }
    }
}

protodunespdata_wctsp: 
{
    module_type : WireCellToolkit
    wcls_main: {
        tool_type: WCLS
        apps: ["Pgrapher"]
        
        # Libraries in which to look for WCT components
        plugins: ["WireCellGen", "WireCellSigProc", "WireCellSio", "WireCellPgraph", "WireCellLarsoft"]
        
        # The tool marshals the art::Event to these visitors before.
        # See notes below in params.
        inputers: ["wclsCookedFrameSource"
                   # To use wclsMultiChannelNoiseDB you must also put epoch:dynamic below
                   # and you must have geo::Geometry service in your environment.
                   # ,"wclsMultiChannelNoiseDB"  
               ]
        
        # or after the WCT app is run.  These names MUST be used identically in the Jsonnet
        # fixme: https://github.com/WireCell/larwirecell/issues/3
        #outputers: ["wclsFrameSaver:nfsaver", "wclsFrameSaver:spsaver"]
        outputers: ["wclsFrameSaver:spsaver"]
        
        # This sets the "main" Jsonnet file which provides the 
        # configuration for the Wire-Cell Toolkit components.  It is
        # take as relative to entries in WIRECELL_PATH.
        configs: ["pgrapher/experiment/pdsp/wcls-sp.jsonnet"]
    
        # Set the "external variables" required by the Jsonnet.
        params : {
            # This locates the input raw::RawDigit collection in the art::Event 
            #raw_input_label: "tpcrawdecoder:daq"
            #raw_input_label: "caldata"
            raw_input_label: "caldata:dataprep"
            
            # Set "data" vs. "sim".  The epoch below probably should follow suit.
            reality: "data"
            # reality: "sim"

            # if epoch is "dynamic" you MUST add
            # "wclsMultiChannelNoiseDB" to "inputers" and must NOT
            # add it if not "dynamic"
            # epoch: "dynamic"
            # epoch: "perfect"
            epoch: "after"
            
            # Save output signal waveforms (recob::Wire) in "sparse" or "dense" form
            signal_output_form: "sparse"
        }
    }
}

dune10kt_1x2x6_data_nfsp: 
{
    module_type : WireCellToolkit
    wcls_main: {
        tool_type: WCLS
        apps: ["Pgrapher"]
        
        # Libraries in which to look for WCT components
        plugins: ["WireCellGen", "WireCellSigProc", "WireCellSio", "WireCellPgraph", "WireCellLarsoft"]
        
        # The tool marshals the art::Event to these visitors before.
        # See notes below in params.
        inputers: ["wclsRawFrameSource"
                   # To use wclsMultiChannelNoiseDB you must also put epoch:dynamic below
                   # and you must have geo::Geometry service in your environment.
                   # ,"wclsMultiChannelNoiseDB"  
               ]
        
        # or after the WCT app is run.  These names MUST be used identically in the Jsonnet
        # fixme: https:#github.com/WireCell/larwirecell/issues/3
        #outputers: ["wclsFrameSaver:nfsaver", "wclsFrameSaver:spsaver"]
        outputers: ["wclsFrameSaver:spsaver"]

        # This sets the "main" Jsonnet file which provides the 
        # configuration for the Wire-Cell Toolkit components.  It is
        # take as relative to entries in WIRECELL_PATH.
        configs: ["pgrapher/experiment/dune10kt-1x2x6/wcls-nf-sp.jsonnet"]

        # Set the "external variables" required by the Jsonnet.
        params : {
            # This locates the input raw::RawDigit collection in the art::Event 
            raw_input_label: "tpcrawdecoder:daq"

            # Set "data" vs. "sim".  The epoch below probably should follow suit.
            reality: "data"
            # reality: "sim"

            # if epoch is "dynamic" you MUST add
            # "wclsMultiChannelNoiseDB" to "inputers" and must NOT
            # add it if not "dynamic"
            # epoch: "dynamic"
            # epoch: "perfect"
            epoch: "after"

            # Save output signal waveforms (recob::Wire) in "sparse" or "dense" form
            signal_output_form: "sparse"
        }
    }
}


# This rewrites existing raw::RawDigit and recob::Wire
# collections in order to truncate and scale them.  This is not
# WCT related but happens to run generic art modules currently
# living in larwirecell.  The intention is to satisfy
# assumptions made by legacy code.
protodunespdata_digitwire : {
    module_type : "EventButcher"
    
    inRawTag: "tpcrawdecoder:daq"
    inSigTag: "wclsdatasp:gauss:"

    # apparently downstream code is too brittle to handle giving
    # any instance names.
    
    outRawTag: ""
    outSigTag: ""
    outAssnTag: ""
    
    # don't throw away data
    
    ndrop: 0
    nkeep: -1
    
    # match some arbitrary and inexplicable "ADC" charge scale
    # instead of number of ionized electrons.
    
    sigscale: 0.005
}



END_PROLOG
// from larreco/RecoAlg:
#
# Standard configuration for hit finding algorithms
#
# It currently (temporary?) include experiment-specific configuration.
#
BEGIN_PROLOG

standard_cchitfinderalg:
{
  CalDataModuleLabel: "caldata"
  MinPeak:    [8, 5, 5] # min peak signal in each plane
  MinRMS:    [2, 2, 2] # min signal RMS in each plane
  MaxBumps:    5    # make a crude hit if > MaxBumps are found in the RAT
  MaxXtraHits: 1    # max number of hidden hits in Region Above Threshold
  ChiSplit:  20.   # Max chi/DOF for splitting hits for signal rms error = 1
  ChiNorms: [ 1.0, 1.0, 1.0 ]  # chi/DOF normalization for each plane
  StudyHits:  false       # study hit fits on a selected (W,T) range on one event
  UWireRange:   [ 300, 350]  # Study mode: wire range in the U plane
  UTickRange: [ 5200, 5500]  # Study mode: tick range in the U plane
  VWireRange:  [1050, 1080]  # Study mode: wire range in the V plane
  VTickRange: [ 1500, 1750]  # Study mode: tick range in the V plane
  WWireRange:   [ 200, 250]  # Study mode: wire range in the W plane
  WTickRange: [ 5200, 5400]  # Study mode: tick range in the W plane
}


bo_cchitfinderalg:              @local::standard_cchitfinderalg
bo_cchitfinderalg.MinPeak:      [4.,  4.,  5.]
bo_cchitfinderalg.MinRMS:       [8.,  8.,  7.]
bo_cchitfinderalg.ChiNorms:     [1.8, 3.3, 4.3]


microboone_cchitfinderalg:                    @local::standard_cchitfinderalg
microboone_cchitfinderalg.MinPeak:            [10., 5., 5.]
microboone_cchitfinderalg.MinRMS:             [2.2, 2.2, 2.2]
microboone_cchitfinderalg.ChiNorms:           [0.1, 0.4, 0.1]

argoneut_cchitfinderalg:             @local::standard_cchitfinderalg
argoneut_cchitfinderalg.MinPeak:   [1.8, 2.5]
argoneut_cchitfinderalg.MinRMS:    [5., 10.]
argoneut_cchitfinderalg.ChiNorms:  [ 0.5, 2.7]
argoneut_cchitfinderalg.ChgNorms:  [ 1.0, 1.0]

END_PROLOG

BEGIN_PROLOG

hitfinderwaveformalgs:
{
    tool_type: WaveformTools
}

# Define the differential tool for finding candidate hits
candhitfinder_derivative:
{
    tool_type:           CandHitDerivative
    Plane:               0
    MinDeltaTicks:       1
    MaxDeltaTicks:       40
    MinDeltaPeaks:       0.25
    MinHitHeight:        2
    NumInterveningTicks: 6
    OutputHistograms:    false
    WaveformAlgs:        @local::hitfinderwaveformalgs
}

# Define the morphological filter tool for finding candidate hits
candhitfinder_morphological:
{
    tool_type:           CandHitMorphological
    Plane:               0
    DilationThreshold:   4.
    DilationFraction:    0.75
    ErosionFraction:     0.2
    MinDeltaTicks:       1
    MinDeltaPeaks:       0.01
    MinHitHeight:        1
    NumInterveningTicks: 6
    StructuringElement:  20
    OutputHistograms:    false
    OutputWaveforms:     false
    WaveformAlgs:        @local::hitfinderwaveformalgs
}

# Define the standard "threshold over baseline" method for finding candidate hits
candhitfinder_standard:
{
    tool_type:                   CandHitStandard
    Plane:                       0                # The plane this tool is operating on
    RoiThreshold:                5.               # The threshold to apply to find hits
}

peakfitter_gaussian:
{
    tool_type:     "PeakFitterGaussian"
    MinWidth:      0.5
    MaxWidthMult:  3.
    PeakRangeFact: 2.
    PeakAmpRange:  2.
    FloatBaseline: false
}

peakfitter_mrqdt:
{
    tool_type:     "PeakFitterMrqdt"
    MinWidth:      0.5
    MaxWidthMult:  3.
    PeakRangeFact: 2.
    PeakAmpRange:  2.
}


END_PROLOG

BEGIN_PROLOG

standard_hitcheater:
{
 module_type:       "HitCheater"
 G4ModuleLabel:     "largeant"
 WireModuleLabel:   "caldata"
 MinimumCharge:     5.
}

standard_hitcheater_preSpill:  @local::standard_hitcheater
standard_hitcheater_postSpill: @local::standard_hitcheater
standard_hitcheater_preSpill.WireModuleLabel:  "caldataPreSpill:preSpill"
standard_hitcheater_postSpill.WireModuleLabel: "caldataPostSpill:postSpill"

standard_hitfinder:
{
 module_type:         "FFTHitFinder"
 CalDataModuleLabel:  "caldata"      
 MinSigInd:            6.0              # Induction signal height threshold  
 MinSigCol:            11.0             # Collection signal height threshold
 IndWidth:             6.0              # Initial width for induction fit
 ColWidth:             7.8              # Initial width for collection fit
 IndMinWidth:          4.0              # Induction Hit width threshold
 ColMinWidth:          6.0              # Collection hit width threshold
 MaxMultiHit:          3                # maximum hits for multi fit   
 AreaMethod:           0                # 0 = area by integral, 1 = area by gaussian area formula
 AreaNorms:            [ 13.25, 26.31 ] # normalizations that put signal area in 
                                        # same scale as peak height. 
}

gaus_hitfinder:
{
    module_type:          "GausHitFinder"
    CalDataModuleLabel:   "caldata"
    MaxMultiHit:          10                 # maximum hits for multi gaussia fit attempt
    AreaMethod:           0                  # 0 = area by integral, 1 = area by gaussian area formula
    AreaNorms:            [ 13.25, 26.31 ]   # normalizations that put signal area in
                                             # same scale as peak height.
    LongMaxHits:          [  1,  1,  1]      # max number hits in long pulse trains
    LongPulseWidth:       [ 16, 16, 16]      # max widths for hits in long pulse trains
    Chi2NDF:              2000               # maximum Chisquared / NDF allowed to store fit, if fail
                                             # will use "long" pulse method to return hit
    AllHitsInstanceName:  ""                 # If non-null then this will be the instance name of all hits output to event
                                             # in this case there will be two hit collections, one filtered and one containing all hits

    # Candididate peak finding done by tool, one tool instantiated per plane (but could be other divisions too)
    HitFinderToolVec:
    {
        CandidateHitsPlane0:  @local::candhitfinder_standard  # plane 0
        CandidateHitsPlane1:  @local::candhitfinder_standard  # plane 1
        CandidateHitsPlane2:  @local::candhitfinder_standard  # plane 2
    }

    # Declare the peak fitting tool
    PeakFitter:           @local::peakfitter_gaussian
    #PeakFitter:           @local::peakfitter_mrqdt

    # The below are for the hit filtering section of the gaushit finder
    FilterHits:           false              # true = do not keep undesired hits according to settings of HitFilterAlg object
    HitFilterAlg:
    {
        AlgName: "HitFilterAlg"
        MinPulseHeight: [5.0, 5.0, 5.0]      #minimum hit peak amplitude per plane
        MinPulseSigma:  [1.0, 1.0, 1.0]      #minimum hit rms per plane
    }
                                             # In addition to the filter alg we can also filter hits on the same pulse train
    PulseHeightCuts:      [3.0,  3.0,  3.0 ] # Minimum pulse height
    PulseWidthCuts:       [2.0,  1.5,  1.0 ] # Minimum pulse width
    PulseRatioCuts:       [0.35, 0.40, 0.20] # Ratio of pulse height to width
}

# Currently have to tell each tool which plane it is operating on... this is really
# for the histogramming option which enables hist naming without conflict
gaus_hitfinder.HitFinderToolVec.CandidateHitsPlane0.Plane: 0
gaus_hitfinder.HitFinderToolVec.CandidateHitsPlane1.Plane: 1
gaus_hitfinder.HitFinderToolVec.CandidateHitsPlane2.Plane: 2

dpraw_hitfinder:
{
 module_type:          		"DPRawHitFinder"
 LogLevel:	   		0

 CalDataModuleLabel:   		"caldata"
 MinSig:               		10    		# peak threshold for peak finding (in ADC). Peaks with lower amplitudes are neither fitted nor stored.
 TicksToStopPeakFinder: 	4		# when walking along waveform to find start and end points of a peak, stop when current tick is followed by minimum "TicksToStopPeakFinder" ticks 							# with equal or higher ADC counts (=inflection point). Stop anyway if ADC count of a tick is <= 0.

 GroupMaxDistance:		10		# maximum distance (in ticks) between two peaks to be grouped.
 GroupMinADC:			0		# minimum ADC count between two peaks to be grouped.
 SameShape:			true		# if true: fits within same group are forced to have identical shape

 DoMergePeaks:			false		# true: enables peak merging for peaks in the same group.
 MergeADCSumThreshold:		0.2		# merge two peaks only if (ADC sum of the smaller peak) < MergeADCSumThreshold*(ADC sum of the bigger peak).
 MergeMaxADCThreshold:		0.2		# merge two peaks only if (height of the smaller peak) < MergeADCSumThreshold*(height of the bigger peak).
 MinRelativePeakHeightLeft:	0.1		# if smaller peak is on the left: merge two peaks if (relative peak height of the smaller peak) < MinRelativePeakHeightLeft*(peak height of the smaller peak)
 MinRelativePeakHeightRight:	0.1		# if smaller peak is on the right: merge two peaks if (relative peak height of the smaller peak) < MinRelativePeakHeightRight*(peak height of the smaller peak)
 MergeMaxADCLimit:		25		# merge two peaks only if smaller peak <= MergeMaxADCLimit

 MinWidth:             		5              	# threshold for width (in ticks). Groups of peaks with smaller values are neither fitted nor stored.
 MinADCSum:    			10             	# threshold for ADC sum (in ADC*ticks). Groups of peaks with smaller values are neither fitted nor stored.
 MinADCSumOverWidth:    	0             	# threshold for ADC sum over width (in ADC*ticks/ticks). Groups of peaks with smaller values are neither fitted nor stored.

 MaxMultiHit:          		6               # maximum number of peaks in a group for the group to be fitted. If more, split the group in equally spaced hits without fitting.
						# When refitting, maximum number of peaks in group is: 1) not greater than 3x number of peaks before re-fitting.
 MaxGroupLength:          	20000            # Maximum length of group of peaks for the group to be fitted, in ticks. If more, split the group in equally spaced hits without fitting.
 MaxFluctuations:		20000		# If the sum of fluctuations in all peaks is > MaxFluctuations, split the group in equally spaced hits without fitting.

 TryNplus1Fits:        		false		# true: will try to re-fit poorly modeled groups of peaks (chi2PerNDF>Chi2NDFRetry) while adding (an) additional peak(s).
 Chi2NDFRetry:         		25              # for single peaks: if the first fit returns a Chi2/NDF greater than this, try to re-fit.
 Chi2NDFRetryFactorMultiHits: 	2       	# for groups of peaks (2 or more): if the first fit returns a Chi2/NDF greater than Chi2NDFRetryFactorMultiHits*Chi2NDFRetry, try to re-fit.

 Chi2NDFMax:          		2000            # for single peaks: maximum chi square / NDF allowed for a fit to be stored as recob::Hits. Otherwise, handle peak as long pulse train.
 Chi2NDFMaxFactorMultiHits: 	2       	# for groups of peaks (2 or more): maximum chi square / NDF allowed for a fit to be stored as recob::Hit. Otherwise, handle group as long pulse train.

 LongPulseWidth:       		40      	# max widths for hits in long pulse trains 
 LongMaxHits:         		20      	# max number hits in long pulse trains


 ChargeNorm:           		1		# Normalization for fit integral. Should be set to 1.
 NumBinsToAverage:     		0		# 0 or 1 = no averaging.
 MinTau:			0.01		# minimum value of the rising and falling time constants of the fit, in microseconds.
 MaxTau:			20		# maximum value of the rising and falling time constants of the fit, in microseconds.
 FitPeakMeanRange:		5		# range in that the fitter can move the mean of the fit function w.r.t. the peak.

 WidthNormalization:    	2.335		# standard width of the fitted hit is the FWHM of the fitted function (full width at half maximum). 
						# This width is divied by 'WidthNormalization' and saved to the recob::Hit.
						# standard value is chosen to be 2.335 = 2*sqrt(2*ln(2)), which is the relation between FWHM and standard deviation for the Gaussian distribution.
}

standard_rffhitfinderalg:
{
    AmplitudeThreshold:   [ 0.0 ]
    MeanMatchThreshold:   [ 2.0 ]
    MinMergeMultiplicity: [ 2 ]
}

rff_hitfinder:
{
 module_type:           "RFFHitFinder"
 WireModuleLabel:       "caldata"
 RFFHitFinderAlgParams: @local::standard_rffhitfinderalg
}

tt_hitfinder:
{
 module_type:         "TTHitFinder"
 CalDataModuleLabel:  "caldata"
 MinSigPeakInd:       6.0
 MinSigPeakCol:       11.0
 MinSigTailInd:       2.0
 MinSigTailCol:       3.67
 IndWidth:            3
 ColWidth:            3
}

#For now, keep the APAHitFinder configured just like the GausHitFinder
apa_hitfinder:               @local::gaus_hitfinder
apa_hitfinder.module_type:   "APAHitFinder"


standard_hitfinderana:
{
 module_type:          "HitFinderAna"
 HitsModuleLabel:      "ffthit"
 LArGeantModuleLabel:  "largeant"
}

gaus_hitfinderana:
{
 module_type:          "GausHitFinderAna"
 HitsModuleLabel:      "gaushit"
 LArGeantModuleLabel:  "largeant"
}

standard_fasthitfinder:
{
 module_type:         "RawHitFinder"
 CalDataModuleLabel:  "caldata"      
 MinSigInd:            5.0              # Induction signal height threshold  
 MinSigCol:            5.0             # Collection signal height threshold
 IndWidth:             6.0              # Initial width for induction fit
 ColWidth:             7.8              # Initial width for collection fit
 IndMinWidth:          4.0              # Induction Hit width threshold
 ColMinWidth:          6.0              # Collection hit width threshold
 MaxMultiHit:          3                # maximum hits for multi fit   
 AreaMethod:           0                # 0 = area by integral, 1 = area by gaussian area formula
 AreaNorms:            [ 13.25, 26.31 ] # normalizations that put signal area in
 ColMinWindow: 100         # minimum integration window for charge, coll plane
 IndCutoff: 1              # max distance between zero crossing and hit start
                             #  in ticks, for induction planes only
 SkipInd: false            # If true, do not make any hits for ind plane wires
 UncompressWithPed: false
}

standard_clustercrawlerhit:
{
 # call this: "cchit"
 module_type:         "HitFinder"
 CalDataModuleLabel:  "caldata"
 CCHitFinderAlg:      @local::standard_cchitfinderalg
} # standard_clustercrawlerhit


jp250L_hitfinder:       @local::standard_hitfinder
jp250L_gaushitfinder:   @local::gaus_hitfinder

bo_hitfinder:       @local::standard_hitfinder
bo_gaushitfinder:   @local::gaus_hitfinder

argoneut_hitfinder:     @local::standard_hitfinder
argoneut_gaushitfinder: @local::gaus_hitfinder
argoneut_mc_hitfinder:  @local::standard_hitfinder
argoneut_mc_hitfinder.AreaNorms: [ 12.89, 14.51 ]

microboone_hitfinder:     @local::standard_hitfinder
microboone_gaushitfinder: @local::gaus_hitfinder
microboone_rffhitfinder: @local::rff_hitfinder
microboone_hitfinder.IndMinWidth: 1.0
microboone_hitfinder.ColMinWidth: 1.0
microboone_gaushitfinder.MinSig: [ 6.0, 6.0, 11.0 ]
microboone_gaushitfinder.InitWidth: [ 6.0, 6.0, 7.8 ]
microboone_gaushitfinder.MinWidth:  [ 4.0, 4.0, 6.0 ]
microboone_gaushitfinder.AreaNorms: [ 13.25, 13.25, 26.31 ]
microboone_clustercrawlerhit: @local::standard_clustercrawlerhit
microboone_clustercrawlerhit.CCHitFinderAlg:      @local::microboone_cchitfinderalg
END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

standard_dataprovideralg:
{
 DriftWindow:          6 # downsampling window (in drift ticks)
 DownscaleFullView: true # downsample full view

 DownscaleFn:     "mean" # "maxpool" takes the max value in the window,
                         # "maxmean" is mean from 3 ADC's around the max,
                         # "mean" is the mean value of all ADC's in the window

 BlurKernel:      []  # apply channel-channel blurring
 NoiseSigma:      0   # apply white noise
 CoherentSigma:   0   # apply coherent noise

 CalorimetryAlg:    @local::standard_calorimetryalgmc  # used to eliminate amplitude variation due to electron lifetime
 CalibrateAmpl:     false # calibrate ADC values with CalAmpConstants (allows different gains in MC and data)
 CalibrateLifetime: true  # calibrate ADC values according to the electron lifetime

 # The following settings allow to scale the interesting ADC range into desired range of values,
 # e.g. convenient for the CNN or for the conversion to decimal type range. Default values
 # provided here will result with the scaling factor of 0.1.
 AdcMax:            150.0 # input saturation max value
 AdcMin:            -50.0 # input saturation min value
 OutMax:             15.0 # output max value
 OutMin:             -5.0 # output min value
}

END_PROLOG

BEGIN_PROLOG

standard_spacepointalg:
{
  MaxDT:      2.0
  MaxS:       0.3
  MinViews:   2
  EnableU:    true
  EnableV:    true
  EnableW:    false
  Filter:     true
  Merge:      false
  PreferColl: false
}

standard_seedfinderalgorithm:
{
  SpacePointAlg:          @local::standard_spacepointalg
  InitSeedLength:         2
  MinPointsInSeed:        4
  Refits:                 5
  HitResolution:          1
  OccupancyCut:           0.8
  MaxViewRMS:             [2,2,2]
  ExtendSeeds:            true
  LengthCut:              0
}
standard_seedfinderalgorithm.SpacePointAlg.Filter: false

standard_projectionmatchingalg:
{
  OptimizationEps:        0.01    # relative change of the obj.fn which stops optimization after adding a node
  FineTuningEps:          0.0001  # relative change of the obj.fn which stops fine-tuning of optimized track
  TrkValidationDist2D:    1.0     # max. distance [cm] used in the track validation in the "third" plane
  HitTestingDist2D:       0.5     # max. distance [cm] used in testing compatibility of hits with the track
  MinTwoViewFraction:     0.4     # min. fraction of track length covered with hits from many 2D views intertwinted with each other
  NodeMargin3D:           3.0     # margin in [cm] around TPC for allowed track node positions
  HitWeightZ:             1.0     # weights used for hits in U, V, Z planes:
  HitWeightV:             1.0     #    - use lower values for planes where hit position is less reliable (e.g. due to S/N)
  HitWeightU:             1.0     #    - relative ratios matter, sum does not need to be 1.0
}

standard_pmalgtracker:
{
  MinSeedSize1stPass:     20      # min. cluster size used to start building a track in the 1st pass
  MinSeedSize2ndPass:     4       # ..and in the 2nd pass: differentiate to speed up finding long tracks
                                  # w/o checking large number of possibilities, then use as small size
                                  # as reasonnable for used clustering algorithm to complete the search
                                  # in the second pass
  TrackLikeThreshold:     0.0     # CNN output threshold for track-like recognition; ClusterModuleLabel
                                  # needs to be associated to CNN outputs in case of threshold > 0; will
                                  # exclude obvious EM from tracking and tag clean electron tracks as PDG=11
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
                                  #
  FlipToBeam:             false   # set the track direction to increasing Z values
  FlipDownward:           false   # set the track direction to decreasing Y values (like cosmic rays)
  FlipToX:             	  false   # set the track direction to decreasing X values (like cosmic rays in dual phase)
  AutoFlip_dQdx:          false   # set the track direction to increasing dQ/dx (overrides FlipToBeam,
                                  # FlipDownward and FlipToX if significant rise of dQ/dx at the track end)
                                  #
  MergeWithinTPC:         false   # merge witnin single TPC; finds tracks best matching by angle, with limits:
  MergeTransverseShift:   2.0     #    - max. transverse displacement [cm] between tracks
  MergeAngle:             2.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  StitchBetweenTPCs:      true    # stitch between TPCs; finds tracks best matching by angle, with limits:
  StitchDistToWall:       3.0     #    - max. track endpoint distance [cm] to TPC boundary
  StitchTransverseShift:  3.0     #    - max. transverse displacement [cm] between tracks
  StitchAngle:           10.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  MatchT0inAPACrossing:   false   # match T0 of APA-crossing tracks using PMAlgStitcher
  MatchT0inCPACrossing:   false   # match T0 of CPA-crossing tracks using PMAlgStitcher

  Validation:             "hits"  # "hits":   uses hits to validate track
                                  # "adc":   uses adc image to validate tracks
                                  # "calib": uses hits to validate tracks and produce histograms to find adc thresholds
                                  #          which should be used in "adc" mode
  AdcValidationThr:       [1.0, 1.0, 1.0]    # threshold for not-empty pixel in the ADC image used for the track validation, per plane
  AdcImageAlg:            @local::standard_dataprovideralg
}

standard_pmalgfitter:
{
  TrackingOnlyPdg:        [0]     # PDG list to select which PFParticles should be reconstructed;
                                  # all PFP's are used if the list is empty or starts with 0
  TrackingSkipPdg:        [0]    # PDG list to select which PFParticles should NOT be reconstructed,
                                  # e.g. skip EM showers; no skipping if the list is empty or starts with 0
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
}

standard_beziertrackeralgorithm:
{	
  OverlapCut:            0.2
  DirectJoinDistance:    10.0
  TrackJoinAngle:        0.5          
  VertexImpactThreshold: 2.0
  VertexExtrapDistance:  5.0
  OccupancyThresh:       0.8
  TrackResolution:       2.0
  SeedFinder:            @local::standard_seedfinderalgorithm

}
standard_beziertrackeralgorithm.SeedFinder.LengthCut: 2

standard_trackstitcheralg:
{
  CosAngTolerance: 0.98
  SpptSepTolerance: 30.0 # cm
  CommonComponentStitch: true
}

standard_kalmanfilteralg:
{
  Trace: false
  MaxPErr: 0.25      # Maximum pointing error for free propagation.
  GoodPErr: 0.1      # Pointing error threshold for switching from linearized to free propataion.
  MaxIncChisq: 10.   # Incremental chisquare cut.
  MaxSeedIncChisq: 1000.  # Incremental chisquare cut in seed phase.
  MaxSmoothIncChisq: 100. # Incremental chisquare cut in smooth phase.
  MaxEndChisq: 10.   # Maximum incremental chisquare for endpoint hit.
  MinLHits: 20       # Minimum number of measurements for linearized propagation.
  MaxLDist: 10.      # Maximum distance to use linearized propagation using starting guess.
  MaxPredDist: 5.    # Maximum prediction distance to accept a hit.
  MaxSeedPredDist: 50. # Maximum prediction distance to accept a hit in seed phase.
  MaxPropDist: 50.   # Maximum propagation distance to candidate surface.
  MinSortDist: 0.    # Low threshold to resort hits.
  MaxSortDist: 2.    # High threshold to resort hits.
  MaxSamePlane: 3    # Maximum consecutive hits in same plane.
  GapDist: 3.        # Minimum gap distance.
  MaxNoiseHits: 3    # Maximum number of hits in noise cluster.
  MinSampleDist: 20. # Minimum sample distance (for momentum measurement).
  FitMomRange: true  # Fit momentum using range.
  FitMomMS: false    # Fit momentum using multiple scattering.

  # Graphical trace options.
  # For any kine of graphical tracing to work, you need to configure
  # the event display service to initialize the graphics system.

  GTrace: false      # Graphical trace flag.
  GTraceWW: 1200     # Window width (pixels).
  GTraceWH: 800      # Window height (pixels).
  GTraceXMin: -256.  # Graphical trace minimum x (same for each view).
  GTraceXMax: 512.   # Graphical trace maximum x (same for each view).
  GTraceZMin: [    0.,    0.,    0.]  # Graphical trace minimum z for each view.
  GTraceZMax: [ 1040., 1040., 1040.]  # Graphical trace maximum z for each view
}

standard_track3Dkalmanhitalg:
{
  MaxTcut:            10.           # Maximum delta ray energy in MeV for restricted dE/dx
  DoDedx:             false         # dE/dx enable flag.
  SelfSeed:           false         # Generate seeds internally.
  LineSurface:        false         # Store hits on line surfaces.
  MinSeedHits:        12            # Minimum number of hits per track seed.
  MinSeedChopHits:    50            # Potentially chop seeds that exceed this length.
  MaxChopHits:        20            # Maximum number of hits to chop from each end of seed.
  MaxSeedChiDF:       20.           # Maximum seed track chisquare/dof.
  MinSeedSlope:       0.0           # Minimum seed slope (dx/dz).
  InitialMomentum:    0.5           # Initial momentum (GeV/c).
  KalmanFilterAlg:    @local::standard_kalmanfilteralg
  SeedFinderAlg:      @local::standard_seedfinderalgorithm
}

standard_cosmictrackeralg:
{
    SPTAlg:   0
    TrajOnly: false
    TMatch:   2.5
    SMatch:   1
}

argoneut_spacepointalg:      @local::standard_spacepointalg
argoneut_kalmanfilteralg:    @local::standard_kalmanfilteralg
argoneut_cosmictrackeralg:   @local::standard_cosmictrackeralg
argoneut_cosmictrackeralg.SPTAlg:   1
argoneut_cosmictrackeralg.TrajOnly: true

bo_spacepointalg: @local::standard_spacepointalg
bo_spacepointalg.MinViews: 2
bo_spacepointalg.EnableW:  true
bo_kalmanfilteralg:          @local::standard_kalmanfilteralg
bo_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
bo_seedfinderalgorithm.SpacePointAlg :           @local::bo_spacepointalg
bo_seedfinderalgorithm.SpacePointAlg.PreferColl: true
bo_seedfinderalgorithm.SpacePointAlg.Filter:     false
bo_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
bo_beziertrackeralgorithm.SeedFinder:            @local::bo_seedfinderalgorithm

microboone_spacepointalg:                                @local::standard_spacepointalg
microboone_spacepointalg.MinViews:                       3
microboone_spacepointalg.EnableW:                        true
microboone_kalmanfilteralg:                              @local::standard_kalmanfilteralg
microboone_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
microboone_seedfinderalgorithm.SpacePointAlg : {
  @table::microboone_spacepointalg
  PreferColl: true
  Filter:     false
}
microboone_track3Dkalmanhitalg: {
  @table::standard_track3Dkalmanhitalg
  KalmanFilterAlg: @local::microboone_kalmanfilteralg
  SeedFinderAlg:   @local::microboone_seedfinderalgorithm
}
microboone_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
microboone_beziertrackeralgorithm.SeedFinder:            @local::microboone_seedfinderalgorithm
microboone_trackstitcheralg:  @local::standard_trackstitcheralg

dune10kt_spacepointalg:          @local::standard_spacepointalg
dune10kt_spacepointalg.MinViews: 3
dune10kt_spacepointalg.EnableW:  true
dune10kt_kalmanfilteralg:        @local::standard_kalmanfilteralg
dune34kt_spacepointalg:          @local::dune10kt_spacepointalg
dune34kt_kalmanfilteralg:        @local::dune10kt_kalmanfilteralg
dune35t_spacepointalg: @local::standard_spacepointalg
dune35t_spacepointalg.MinViews:  3
dune35t_spacepointalg.EnableW:   true
dune35t_kalmanfilteralg:         @local::standard_kalmanfilteralg
dune35t_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
dune35t_seedfinderalgorithm.SpacePointAlg :           @local::dune35t_spacepointalg
dune35t_seedfinderalgorithm.SpacePointAlg.PreferColl: true
dune35t_seedfinderalgorithm.SpacePointAlg.Filter:     false


END_PROLOG
##include "cluster3dpathfindingtools.fcl"

BEGIN_PROLOG

standard_cluster3dkdTree:
{
  EnableMonitoring:  true    # enable monitoring of functions
  PairSigmaPeakTime: 3.      # "sigma" multiplier on peak time
  RefLeafBestDist:   0.5     # Initial distance once reference leaf found
}

standard_standardhit3dbuilder:
{
  tool_type:            StandardHit3DBuilder
  HitFinderTagVec:      ["gaushit"]
  EnableMonitoring:     true  # enable monitoring of functions
  NumSigmaPeakTime:     1.5   # Number "sigma" for peak times when building hits
  HitWidthScaleFactor:  6.    #
  DeltaPeakTimeSig:     1.7   # "Significance" of agreement between 2 hit peak times
  WirePitchScaleFactor: 1.9
  MaxHitChiSquare:      6.0
  OutputHistograms:     false
}

standard_spacepointhit3dbuilder:
{
  tool_type:               SpacePointHit3DBuilder
  SpacePointProducerLabel: "SpacePointSolver"
  HitProducerLabel:        "gaushit"
  EnableMonitoring:        true  # enable monitoring of functions
  MaxHitChiSquare:         6.0
  OutputHistograms:        false
}

standard_cluster3dprincipalcomponentsalg:
{
  ParallelLines:        0.00001 # delta theta to be parallel
}

standard_cluster3dParamsBuilder:
{
  tool_type:                ClusterParamsBuilder
  ClusterMinHits:           3
  ClusterMinUniqueFraction: 0.5
  ClusterMaxLostFraction:   0.5
  PrincipalComponentsAlg:   @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dMergeAlg:
{
  tool_type:              ClusterMergeAlg
  EnableMonitoring:       true    # enable monitoring of functions
  AxisAngleScaleFactor:   5.
  MinTransEigenVal:       0.09
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3ddbscanalg:
{
  tool_type:              DBScanAlg
  EnableMonitoring:       true    # enable monitoring of functions
  MinPairPts:             2       # minimum number of hit pairs for DBScan to consider
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dminSpanTreeAlg:
{
  tool_type:              MinSpanTreeAlg
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dskeletonalg:
{
  MinimumDeltaTicks:      0.05  # minimum delta time (in ticks) when matching hits
  MaximumDeltaTicks:      10.0  # maximum delta time (in ticks) when matching hits
}

standard_cluster3dhoughseedfinderalg:
{
  Minimum3DHits:            5      # Minimum number 3D hits to run transform
  ThetaBins:              360      # Number of bins in theta (pi)
  HalfRhoBins:             75      # Half of the number of bins in rho
  HiThresholdMin:           5      # Minimum value for hi threshold in hough scan
  HiThresholdFrac:       0.05      # Fraction of total hits for hi threshold
  LoThresholdFrac:       0.85      # Fraction of peak bin count for lo threshold
  NumSeed2DHits:           80      # number of 2D hits in the seed
  NumAveDocas:             6.      # number of "docas" from axis to accept hits
  NumSkippedHits:          10      # number hits allowed to be skipped for seed hits
  MaxLoopsPerCluster:       3      # Maximum number of loops to search for tracks
  MaximumGap:              5.      # Maximum gap in arc length for seed hits
  DisplayHoughHist:       false
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dpcaseedfinderalg:
{
  GapDistance:             5.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  MinAllowedCosAng:       0.7      # minimum angle allowed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dparallelhitsseedfinderalg:
{
  MaxNumEdgeHits:        1000      # Maximum number hits each end of PCA axis
  GapDistance:            20.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dPathAlg:
{
  tool_type:              ClusterPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_voronoiPathAlg:
{
  tool_type:              VoronoiPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_convexhullPathAlg:
{
  tool_type:              ConvexHullPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_MSTPathAlg:
{
  tool_type:              MSTPathFinder
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

microboone_standardhit3dbuilder:               @local::standard_standardhit3dbuilder
microboone_spacepointhit3dbuilder:             @local::standard_spacepointhit3dbuilder
microboone_cluster3dMergeAlg:                  @local::standard_cluster3dMergeAlg
microboone_cluster3dPathAlg:                   @local::standard_cluster3dPathAlg
microboone_voronoiPathAlg:                     @local::standard_voronoiPathAlg
microboone_cluster3ddbscanalg:                 @local::standard_cluster3ddbscanalg
microboone_cluster3dminSpanTreeAlg:            @local::standard_cluster3dminSpanTreeAlg
microboone_cluster3dprincipalcomponentsalg:    @local::standard_cluster3dprincipalcomponentsalg
microboone_cluster3dskeletonalg:               @local::standard_cluster3dskeletonalg 
microboone_cluster3dhoughseedfinderalg:        @local::standard_cluster3dhoughseedfinderalg 
microboone_cluster3dpcaseedfinderalg:          @local::standard_cluster3dpcaseedfinderalg
microboone_cluster3dparallelhitsseedfinderalg: @local::standard_cluster3dparallelhitsseedfinderalg
microboone_cluster3dkdtree:                    @local::standard_cluster3dkdTree

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG
BEGIN_PROLOG
mcsfitproducer: {
  module_type:  MCSFitProducer
  inputs: {
        inputLabel: @nil
  }
  fitter: {
  	pIdHypothesis: 13
	minNumSegments: 3
	segmentLength: 14.0
	minHitsPerSegment: 2
	nElossSteps: 10
	eLossMode: 0
	pMin: 0.01
	pMax: 7.50
	pStep: 0.01
	angResol: 3.0
  }
}
END_PROLOG
BEGIN_PROLOG
kalmanfilterfittrackmakertool: {
   tool_type: KalmanFilterFitTrackMaker
   options: {
      defaultMomInGeV: 1.0
      momFromMCSCollection: false
      mcsInputTag: ""
      momFromCombAndPid: false
      contInputTag: ""
      pidFromCollection: false
      pidInputTag: ""
      pidFromLengthCut: -1.
      defaultPdgId: 13
      dirFromVec: false
      dirVec: [0,0,1]
      alwaysInvertDir: false
      keepInputTrajectoryPoints: false
   }
   fitter: {
      useRMSError: true
      sortHitsByPlane: true
      sortHitsByWire: false
      sortOutputHitsMinLength: true
      skipNegProp: true
      cleanZigzag: false
      rejectHighMultHits: false
      rejectHitsNegativeGOF: true
      hitErr2ScaleFact: 1.0
      tryNoSkipWhenFails: true
      tryBothDirs: false
      pickBestHitOnWire: false
      maxResidue: -1.
      maxResidueFirstHit: -1.
      maxChi2: -1.
      maxDist: -1.
      negDistTolerance: 0.
      dumpLevel: 0
   }
   propagator: {
      minStep: 1.0
      maxElossFrac: 0.1
      maxNit: 10
      tcut: 10.
      wrongDirDistTolerance: 0.01
      propPinvErr: false
   }
   mcsfit: @local::mcsfitproducer.fitter
}
END_PROLOG
BEGIN_PROLOG

standard_trajclusteralg:
{
   Mode: 1                  # 1(-1) step from US(DS) to DS(US), 2 = don't use
   NPtsAve: 10              # Number of points to find average charge, Ave chg rms
   MinPtsFit: [3, 3, 3]     # Min number of points in the trajectory fit required on each pass
   MinPts:    [3, 3, 3]     # Min number of points in the trajectory required on each pass
   MaxAngleCode: [0, 1, 2]  # Max angle range code allowed on each pass
   MinMCSMom: [0, 0, 0]   # Minimum MCSMom for each pass
   MaxChi: 20               # Max Chi/DOF for accepting a trajectory fit (long muons)
   HitErrFac: 0.4          # hit time error for fitting = fHitErrFac * (hit RMS)
   MinAmp:  1               # Min amplitude for a wire signal being considered present (must be > 0)
   AngleRanges: [40, 85, 90]  # Max angle (degrees) for small, intermediate and large angle trajectories
   MultHitSep: 2.5          # Hits separated by < MultHitSep * RMS may be combined in a trajectory point
   ChargeCuts: [4, 0.15, 0.25]  # [Max(min) chg pull, Min allowed chg RMS, Max allowed chg RMS]
#   KinkCuts: [0.4, 1.5, 3] # kink angle, MCS kink significance, nPts fit << OLD
   KinkCuts: [ 8, 15, 1, 10 ] # << NEW
   # 0 Number of points to fit at the end of the trajectory
   # 1 Minimum kink significance
   # 2 Use charge in significance calculation? (yes if > 0)
   # 3 3D kink fit length (cm)
   ProjectionErrFactor: 2   # Factor applied to calculated trajectory error
   VLAStepSize: 1.5         # Step size for Very Large Angle trajectories
   JTMaxHitSep: 3           # max hit separation (WSE units) for making Junk Trajectories (<0) turn off
   MaxWireSkipNoSignal:  3  # max allowed number of not-dead wires if no signal is present
   MaxWireSkipWithSignal: 100  # max allowed number of not-dead wires if a signal is present
   QualityCuts: [ 0.8, 3] # Min points/wire, min consecutive pts after a gap
   MuonTag: [40, 500, 40, 3]    # minLength, minMCSMom, maxWireSkip,(min delta-ray length for muon direction tag)
   DeltaRayTag:  [10, 5, 500] # Tag short TJs as delta-rays close to muons [min sep, min MCSMom, max MCSMom]
#               0   1   2   3   4  5    6   7  8  9 10 11 12
   ShowerTag: [ 1, 100, 10, 50, 2.5, 1, 0, 3, 5, 0.7, 1, 10, -13]
# 0 Mode (<= 0 OFF, 1 = tag only, 2 = find showers)
  # 1 Max Tj MCSMom for a shower tag
  # 2 Max separation
  # 3 Min energy (MeV)
  # 4 rms width factor
  # 5 Min shower 1/2 width (WSE units)
  # 6 Min ElectronLikelihood (if > 0)
  # 7 Min Tjs
  # 8 max parent FOM
  # 9 max direction FOM
  # 10 max aspect ratio
  # 11 not used
  # 12 Print 2D showers in plane (0,1,2) or all planes (3) or just 3D matching (4)
   SaveShowerTree: false
   SaveCRTree: false
   TagCosmics: false
   ChkStopCuts: [10, 8, 1.5] # [Min chg slope, nFitPts, Chg fit ChiDOF cut]
   VertexScoreWeights: [1, 2, 10, 2]
    # 0 = Vertex error weight
    # 1 = 3D match weight
    # 2 = Charge fraction of vertex Tjs near the vertex weight
    # 3 = Tj MCSMom, ChgRMS, Angle difference significance between Tjs weight
   Vertex2DCuts:  [6, 8, 45, 3, 3, 50, 0.6, 30, 0.8, 0.8] # << NEW increase min Score
   # 0 User definition of a short Tj => max number of Tj points
   # 1 max separation between a vertex and the start of a trajectory for a user-defined short Tj
   # 2 max separation for a user-defined long Tj
   # 3 max position pull when attaching a Tj to a vertex
   # 4 max position error for creating a Tj or attaching Tjs to an existing vertex
   # 5 Min MCSMom of Tjs that can be used to create a vertex
   # 6 min frac of Points/Wire between a vtx and a Tj. Ideally one if the efficiency is good
   # 7 min Score
   # 8 Min charge fraction near a vertex or merge point
   # 9 max MCSmom asymmetry for a merge
   Vertex3DCuts: [0.8, 2., 3.]
   # 0 dX match cut (cm)
   # 1 dY and dZ match cut (cm)
   # 2 max separation btw PFParticle end and 3D vertex
   Match3DCuts: [ 0.5, 10000, 1, 2, 2.0, 2.5, 1]
   # 0 dx (cm) matching cut
   # 1 max number of 3-plane matches for any Tj
   # 2 Attempt 2-view match?
   # 3 min number of TP3Ds in at least 2 planes to fit in each PFP section
   # 4 max pull for adding/rejecting TP3Ds in sections
   # 5 suggested max ChiDOF for a SectionFit
   # 6 > 0 Don't match muon shower tjs
   PFPStitchCuts: [ 0.02, 3, 2 ]
   # 0 = matching angle resolution (radians)
   # 1 = matching position resolution (cm)
   # 2 = max angle-position figure of merit
   SkipAlgs: [ ]   # List of algs that should not be used
   DebugConfig: []
}
standard_trajclusteralg.CaloAlg: @local::standard_calorimetryalgmc

standard_clustercrawleralg:
{
  NumPass:              3  # number of passes through the hit list. 0 = no cluster reco
  MaxHitsFit: [ 100,  8, 4] # number of hits fitted to a line
  MinHits:    [ 50,  8, 3] # minimum size of a cluster
  NHitsAve:   [ 20,  8, 2] # number of hits to find the average charge and width
                           # at the end of the cluster. NHitsAve should be 1 or 2
  ChgCut:    [ .8, .8, .8] # max fractional hit charge difference for adding hits
  ChiCut:    [ 4, 8, 10] # stop adding hits to clusters if ChiCut is reached
  MaxWirSkip:   [25, 8, 0] # max number of wires to skip without adding a hit
  MinWirAfterSkip: [2, 2, 1] # min reqd number of consecutive wires with a hit after a skip
  KinkChiRat: [1.2, 1.2, 0.] # Max consecutive chisq increase for the last 3 hits on the cluster
                             # 0. = no kink check when following
  KinkAngCut: [0.4, 0.4, 1.5] # kink angle cut (radians) used to follow and merge
  DoMerge:   [false, true, true] # run cluster merging code?
  TimeDelta: [ 8, 8, 20] # max time difference for cluster merging
  MergeChgCut: [0.8, 0.8, 0.8] # max charge ratio for cluster merging
  FindVertices: [true, true, true]  # make 2D vertices after clustering?
  LACrawl:     [true, true, true]  # crawl Large Angle clusters?
  LAClusAngleCut:       60 # Large cluster angle cut (0 < 90 degrees). <0 to turn off
	LAClusMaxHitsFit: 		 4 #
	MinHitFrac: 				 0.6 # Drop clusters having < (#hits/#wires)
	MinAmp: 			 [5, 5, 5] # Min hit signal amplitude for merging
	ChgNearWindow:				40 # #of ticks for summing charge near a cluster
	ChgNearCut: 				 1.5 # Cluster end is shower-like if (nearby chg)/(cls chg)> cut
  HitMergeChiCut:      2.5 # Merge cluster hit-multiplets if the separation chisq
                           # is < cut. Set < 0 for no merging
  MergeAllHits:      false # merge all hits before reconstructing clusters
  MergeOverlapAngCut:  0.1 # Set <= 0 to turn off overlapping cluster merging
  ChkClusterDS:       true # Check reconstruction at DS end of clusters?
  KillGarbageClusters: 0.1 # Kill ghost clusters, set to 0 to turn off
  VtxClusterSplit:    true # Split clusters that cross vertices
  FindStarVertices:   true # Find vertices with a star topology
  HitErrFac:           0.2 # hit time error for fitting = fHitErrFac * (hit width)
  HitMinAmp:             2 # ignore hits with PH < this value
  ClProjErrFac:          3 # cluster projection error factor
  AllowNoHitWire:        1 # Allow skipping N wires w no hits (if poor purity)
	Vertex2DCut:					10 # Max chisq cut for attaching a cluster to a vtx
  Vertex3DCut:           5 # 2D vtx -> 3D vtx matching cut (chisq)
	FindHammerClusters: true # look for hammer type clusters
  RefineVertexClusters: false # (not ready)
  FindVLAClusters: false # find Very Large Angle clusters (not ready)
  DebugPlane:          -1  # print info only in this plane
  DebugWire:            0  # set to the Begin Wire and Hit of a cluster to print
  DebugHit:             0  # out detailed information while crawling
}

standard_blurredclusteralg:
{
  BlurWire:            6
  BlurTick:            12
  SigmaWire:           4
  SigmaTick:           6
  ClusterWireDistance: 2
  ClusterTickDistance: 2
  MaxTickWidthBlur:    10
  NeighboursThreshold: 0
  MinNeighbours:       0
  MinSize:             2
  MinSeed:             0.1
  TimeThreshold:       500
  ChargeThreshold:     0.07
}

standard_mergeclusteralg:
{
  MinMergeClusterSize: 3
  MaxMergeSeparation:  30
  ProjWidthThreshold:  0.2
}

standard_houghbasealg:
{
  MaxLines:                 50   # The maximum number of Hough lines to look for, 20 had been working!
  MinHits:                  5
  SaveAccumulator:          0
  NumAngleCells:            20000 # The number of angle cells to create for the Hough transform,
  RhoResolutionFactor:      5    # Was set to 5
  MaxDistance:              1.0  # 0.1 was working (okay, not really, larger is probably better,
  MaxSlope:                 80.0 # 80 was working fine previously
  RhoZeroOutRange:          0
  ThetaZeroOutRange:        0
  HitsPerCluster:           1
  MissedHits:               1    # Was set to 0
  MissedHitsDistance:       2.0  #
  MissedHitsToLineSize:     0.25    # Was set to 0
}

standard_endpointalg:
{
  TimeBins:            256
  MaxCorners:          20
  Gsigma:              1.
  Window:              5
  Threshold:           0.1
  SaveVertexMap:       -1
}


standard_cornerfinderalg:
{
  RawDataModuleLabel:           "daq"
  CalDataModuleLabel:		"caldata"
  Trimming_threshold:      10
  Trimming_totalThreshold: 5e4
  Conversion_algorithm:         "standard"
  Conversion_function:          "TMath::Gaus(x,0,1)*TMath::Gaus(y,0,1)"
  Conversion_func_neighborhood: 3
  Conversion_threshold:		0
  Conversion_bins_per_input_x:	1
  Conversion_bins_per_input_y:	1
  Derivative_method: 		"Sobel" #Noble
  Derivative_neighborhood:	1
  Derivative_BlurFunc:	"NotImplemented"
  Derivative_BlurNeighborhood:	5
  CornerScore_Noble_epsilon:    1e-5
  CornerScore_Harris_kappa:     0.05
  CornerScore_neighborhood:	1
  CornerScore_algorithm:	"Nobel" #Harris
  MaxSuppress_neighborhood:	3
  MaxSuppress_threshold:	1000
  Integral_bin_threshold:       5
  Integral_fraction_threshold:  0.95


}

standard_dbscanalg:
{
  eps:    1.0
  epstwo: 1.5
  minPts: 2
  Method: 0   # 0 -- naive findNeighbor implemention
              # 1 -- findNeigbors with R*-tree
              # 2 -- DBScan from the paper with R*-tree
  Metric: 3   # Which RegionQuery distance metric to use.
              # **ONLY APPLIES** if Method is 1 or 2.
              #
	      # 0 -- rectangle (no bad channels) **not implemented**
	      # 1 -- Manhattan distance (only uses eps, no bad channels)
              #                                  **not implemented**
	      # 2 -- Eliptical (no bad channels) **not implemented**
	      # 3 -- findNeighbors-alike: Elliptical and bad
              #                           channel aware (not working)
}

standard_dbscan3dalg:
{
    epsilon:          5.0
    minpts:           2
    neighbors:        100
    badchannelweight: 0.
}

standard_tcshoweralg:
{
    CalorimetryAlg: @local::standard_calorimetryalgmc
    ProjectionMatchingAlg:    @local::standard_projectionmatchingalg
}

standard_fuzzyclusteralg:
{
  RunHough:       true    # Turns on and off the Hough line finder, useful for diagnostics
  NumberTimeBoundaries:             3	# Number of boundaries in ticks for the drift window to be divided up to make the Hough line finder easier on memory
  NumberWireBoundaries:             3	# Number of boundaries in wires for the drift window to be divided up to make the Hough line finder easier on memory
  GenerateHoughLinesOnly:       false # Show only the results of the Hough line finder, hits not in a line will not be clustered
  HoughBaseAlg:{
    MaxLines:             100
    MaxDistance:          1
    MinHits:              5
    NumAngleCells:        10800
    SaveAccumulator:          0
    RhoResolutionFactor:      5
    MaxSlope:                 80.0 # 80 was working fine previously
    RhoZeroOutRange:          0
    ThetaZeroOutRange:        0
    HitsPerCluster:           1
    MissedHits:               1    # Was set to 0
    MissedHitsDistance:       1.0  #
    MissedHitsToLineSize:     0.5    # Was set to 0
  }
  DBScanAlg:                @local::standard_dbscanalg
  DoFuzzyRemnantMerge:      true # Tell the algorithm to merge fuzzy cluster remnants into showers or tracks (0-off, 1-on)
  FuzzyRemnantMergeCutoff: 20    # Cut off on distance from hough line to hit in the remnant of the fuzzy cluster

  DoTrackClusterMerge:     true # Turns on merging of track-like Hough lines (0-off, 1-on)
  ChargeAsymAngleCut:        0.1 # Cut on product of charge asymmetry and the square of the sin of angle between slopes of lines, only for track-like
  SigmaChargeAsymAngleCut:   1.0  # Cut on product of charge sigma asymmetry and the sin of angle between slopes of lines, only for track-like
  TrackClusterMergeCutoff: 5.0 # The maximum distance between track-like Hough line endpoints before they can be merged,

  DoShowerClusterMerge:     true # Turns on merging of shower-like Hough line (0-off, 1-on)
  ShowerClusterMergeAngle: 30    # The maximum angle between slopes of shower-like lines to be merged,
  ShowerClusterMergeCutoff:  7.5 # The maximum distance between shower-like line endpoints before they can be merged,

  DoShowerTrackClusterMerge:     true # Turns on merging of shower-like and track-like lines (0-off, 1-on)
  ShowerTrackClusterMergeAngle:  15   # The maximum angle between slopes of shower-like and track-like lines to be merged,
  ShowerTrackClusterMergeCutoff: 7.5  # The maximum distance between shower-like and track-like line endpoints before they can be merged,
  ShowerLikenessCut:       10    # Cut on shower likeness (the larger the more shower like, the smaller the less shower like)
  MaxVertexLines:          100   # Max number of line end points allowed in a Hough line merge region for a merge to happen
  VertexLinesCutoff:       5.0   #  Size of the vertex region to count up lines for MaxVertexLines
}

standard_clusterparamsalg:
 {
  ChargeCutoffThreshold:    [500,500,1000]
  SelectBoxSizePar:               10     #distance along axis
  SelectBoxSizePerp:              3      #distance perpendicular to axis
  ForceRightGoing:        	  false
  MinHitListSize:		  40
  fOutlierRadius:		  5
  #HoughBaseAlg.NumAngleCells:       3000
  #HoughBaseAlg.RhoResolutionFactor:       4
  #HoughBaseAlg.MaxLines:       100
  HitDensityCutoff:             1.9  # Showers is high, tracks low, 0 don't use cut
  MultiHitWireCutoff: 		 2.1  # Showers is high, tracks low, 0 don't use cut
  OffAxisHitsCutoff:            0    # Showers is high, tracks low, 0 don't use cut
  PrincipalComponentCutoff:     0    # Tracks is high ~1, showers low, 0 don't use cut
  ShowerSelisORorAND:           0    # 0 = OR, 1 = AND

  HoughBaseAlg:                   @local::standard_houghbasealg

 }

 standard_clustermatchalg:
 {
  DebugMode: true
  StoreSpacePoint: true
  MatchAlgoList:                [0, 1, 2, 3] # Algorithms enum to be enabled
  CutParam_NumSpacePoint:       100          # Number of minimum space point to claim a cluster by kSpacePoint
  CutParam_OverlayTimeFraction: 0.0          # Minimum fraction of overlayed time period used by kRoughTime
  CutParam_SumChargeRatio:      1000.0       # Maximum difference in fraction of clusters' charge sum used by kSumCharge
  SpacePointAlg:                @local::microboone_spacepointalg
  }
 standard_clustermatchalg.SpacePointAlg.Filter: false

 standard_clustermergealg:
 {
  VerboseMode:    false
  MaxAngleDiff:   0
  MaxSquaredDist: 0
  }

standard_smallclustalg:
 {
  RadiusSizePar:   	3	  #radius of circle in "cm"
  NHitsInClust:		4	  # Max Number of hits in cluster
  Verbose:			false
 }

standard_clustermatchtq:
{
  KSCut: 0.9
  EnableU: true
  EnableV: true
  EnableZ: true
}

standard_dbscanalg_fast:        @local::standard_dbscanalg
standard_dbscanalg_fast.eps:    1.25
standard_dbscanalg_fast.epstwo: 1.75
standard_dbscanalg_fast.Method: 2

jp250L_dbscanalg:                  @local::standard_dbscanalg
jp250L_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
jp250L_houghbasealg:               @local::standard_houghbasealg
jp250L_houghbasealg.MaxLines:      15
jp250L_houghbasealg.MinHits:       3
jp250L_houghbasealg.NumAngleCells: 5000
jp250L_houghbasealg.MaxDistance:   5.0
jp250L_endpointalg:                @local::standard_endpointalg

bo_dbscanalg:                   @local::standard_dbscanalg
bo_fuzzyclusteralg:             @local::standard_fuzzyclusteralg
bo_houghbasealg:                @local::standard_houghbasealg
bo_houghbasealg.MaxLines:       15
bo_houghbasealg.MinHits:        3
bo_houghbasealg.NumAngleCells:  5000
bo_houghbasealg.MaxDistance:    5.0
bo_endpointalg:                 @local::standard_endpointalg
bo_clustercrawleralg:           @local::standard_clustercrawleralg
bo_clustercrawleralg.NumPass: 1
bo_clustercrawleralg.MaxHitsFit: [ 8 ]
bo_clustercrawleralg.MinHits: [ 3 ]
bo_clustercrawleralg.ChgCut: [ 2. ]
bo_clustercrawleralg.WidCut: [ 2. ]
bo_clustercrawleralg.ChiCut: [ 20. ]
bo_clustercrawleralg.MaxWirSkip: [ 25 ]
bo_clustercrawleralg.MinWirAfterSkip: [ 1 ]
bo_clustercrawleralg.KinkChiRat: [ 2. ]
bo_clustercrawleralg.KinkAngCut: [ 0.5 ]
bo_clustercrawleralg.DoMerge:  [ true ]
bo_clustercrawleralg.TimeDelta:  [ 10. ]
bo_clustercrawleralg.FindVertices: [ false ]
bo_clustercrawleralg.HitErrFac: 1.
bo_clustermatchtq:             @local::standard_clustermatchtq

argoneut_dbscanalg:                  @local::standard_dbscanalg
argoneut_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
argoneut_houghbasealg:               @local::standard_houghbasealg
argoneut_houghbasealg.MaxLines:      15
argoneut_houghbasealg.MinHits:       3
argoneut_houghbasealg.NumAngleCells: 5000
argoneut_houghbasealg.MaxDistance:   5.0
argoneut_endpointalg:                @local::standard_endpointalg
argoneut_cornerfinderalg:		      @local::standard_cornerfinderalg
argoneut_clusterparamsalg:       @local::standard_clusterparamsalg
argoneut_clusterparamsalg.HoughBaseAlg: @local::argoneut_houghbasealg
argoneut_clusterparamsalg.HoughBaseAlg.NumAngleCells:       3000
argoneut_clusterparamsalg.HoughBaseAlg.RhoResolutionFactor:       4
argoneut_clusterparamsalg.HoughBaseAlg.MaxLines:       100
argoneut_clusterparamsalg.ChargeCutoffThreshold:  [200,400]
argoneut_clusterparamsalg.ForceRightGoing:   true
argoneut_smallclustalg:	@local::standard_smallclustalg
argoneut_clustermatchtq:             @local::standard_clustermatchtq
argoneut_clustermatchtq.KSCut:              0.5


microboone_dbscanalg:                         @local::standard_dbscanalg_fast
microboone_endpointalg:                       @local::standard_endpointalg
microboone_houghbasealg:                      @local::standard_houghbasealg
microboone_houghbasealg.MaxLines:             20
microboone_houghbasealg.MaxDistance:          1.0
microboone_houghbasealg.MinHits:              5
microboone_houghbasealg.NumAngleCells:        20000
microboone_houghbasealg.DoHoughLineMerge:     1
microboone_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
microboone_fuzzyclusteralg.Threshold          : -20.0
microboone_cornerfinderalg:		      @local::standard_cornerfinderalg
microboone_clusterparamsalg:                  @local::standard_clusterparamsalg
microboone_smallclustalg:	              @local::standard_smallclustalg
microboone_clustercrawleralg:                 @local::standard_clustercrawleralg

microboone_trajclusteralg:                    @local::standard_trajclusteralg
microboone_trajclusteralg.MultHitSep: 3.2
microboone_trajclusteralg.MaxWireSkipNoSignal: 2
microboone_trajclusteralg.MuonTag: [40, 500, 10, 3]
microboone_trajclusteralg.VLAStepSize: 1
microboone_trajclusteralg.Vertex2DCuts: [ 6, 8, 45, 3, 3, 50, 0.6, 50, 0.8, 0.8]

microboone_clustermatchalg:                   @local::standard_clustermatchalg
microboone_clustermergealg:                   @local::standard_clustermergealg
microboone_clustermatchtq:                    @local::standard_clustermatchtq

dune35t_dbscanalg:    @local::standard_dbscanalg_fast
dune35t_dbscanalg.eps:    2.0
dune35t_dbscanalg.epstwo: 2.0
dune35t_houghbasealg: @local::standard_houghbasealg
#dune35t_houghbasealg.DoHoughLineMerge:     1
dune35t_endpointalg:  @local::standard_endpointalg
dune35t_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dune35t_fuzzyclusteralg.HoughBaseAlg:      @local::dune35t_houghbasealg
#dune35t_fuzzyclusteralg.Threshold:         -50.0
dune35t_clustercrawleralg:                 @local::standard_clustercrawleralg
dune35t_clustermatchtq:                    @local::standard_clustermatchtq
dune35t_clustermatchtq.KSCut:              0.7

dunefd_dbscanalg:    @local::standard_dbscanalg_fast
dunefd_houghbasealg: @local::standard_houghbasealg
dunefd_endpointalg:  @local::standard_endpointalg
dunefd_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dunefd_fuzzyclusteralg.HoughBaseAlg:      @local::dunefd_houghbasealg
dunefd_clustercrawleralg:                 @local::standard_clustercrawleralg
dunefd_clustermatchtq:                    @local::standard_clustermatchtq
dunefd_clustermatchtq.KSCut:              0.7


END_PROLOG

BEGIN_PROLOG


apa_geoalg:
{
}


apa_disambigalg:
{
 APAGeometryAlg:     @local::apa_geoalg
 Crawl:              true
 UseEndP:            true
 CompareViews:       true
 NChanJumps:         5
 CloseHitsRadius:    6.
 MaxEndPDegRange:    10.
}



END_PROLOG

BEGIN_PROLOG


standard_disambigcheat:
{
 module_type:         "DisambigCheater"
 ChanHitLabel:        "gaushit"
}

standard_disambigfromsp:
{
    module_type:      "DisambigFromSpacePoints"
    HitModuleLabel:   "gaushit"
    SpModuleLabel:    "reco3d"
    ExcludeTPCs:      []       # if there are TPC volumes with no actual drift towards wires, exclude them here
    UseNeighbors:     true     # use neigboring hits to resolve hits missed by spacepoints
    NumNeighbors:     2        # number of neigboring hits to resolve hits missed by spacepoints
    MaxDistance:      1000        # neighborhood max distance [cm] used to resolve hits missed with spacepoints
    MoveLeftovers:    "first"  # "repeat" - duplicate undisambiguated hits to every allowed wire segment
                               # "first"  - put undisambiguated hits on the first allowed wire segment
                               # "drop"   - drop undisambiguated hits from the output
    MonitoringPlots:  false    # create histograms of no. of unresolved hits at each stage, per plane
}

hit_repeater:
{
    module_type:      "HitRepeater"
    ChanHitLabel:     "gaushit"
}

emlikehits:
{
    module_type:      "EmLikeHits"
    HitModuleLabel:   "hit"   # hits used to reconstruct tagged tracks
    Trk3DModuleLabel: "track" # tagged tracks (hadron/muon- or cascade-like)
}

# This is the showerhitseparator that divides the output from MVA methods
# # identifying the shower hits and track hits.
standard_showerhitseparator:
{
  module_type: "ShowerHitSeparator"
  MVALabel: "emtrkmichelid:emtrkmichel"
  HitLabel: "linecluster"
  MVAOutputCut: 0.6
  SaveTree: false
}

apa_hitfinder:
{
 module_type:         "APAHitFinder"
 DisambigAlg:         @local::apa_disambigalg
 ChanHitLabel:        "gaushit"
 ClusLabel:           "fuzzy"
}

dunefd_disambigfromsp:                @local::standard_disambigfromsp
dunefd_disambigfromsp.ExcludeTPCs:    [] # workspace has no outer TPCs, but full FD has, I think

pdune_disambigfromsp:                 @local::standard_disambigfromsp
pdune_disambigfromsp.ExcludeTPCs:     []
pdune_disambigfromsp.MoveLeftovers:   "repeat"

dunefddphase_gaushitfinder:	@local::gaus_hitfinder
#dunefddphase_gaushitfinder.MinSig:    [6.0, 6.0]
#dunefddphase_gaushitfinder.MinWidth:  [1.0, 1.0]
dunefddphase_gaushitfinder.HitFinderToolVec.CandidateHitsPlane0.RoiThreshold: 6.0
dunefddphase_gaushitfinder.HitFinderToolVec.CandidateHitsPlane1.RoiThreshold: 6.0
dunefddphase_gaushitfinder.InitWidth: [6.0, 6.0]
dunefddphase_gaushitfinder.AreaNorms: [13.25, 13.25]
#dunefddphase_gaushitfinder.Chi2NDFRetry: 1000.

dunefddphase_dprawhitfinder:	@local::dpraw_hitfinder

dune35t_hit_repeater:    @local::hit_repeater
dune35t_disambigcheat:    @local::standard_disambigcheat

dune35t_gaushitfinder:    @local::gaus_hitfinder
dune35t_apahitfinder:     @local::apa_hitfinder
dune35t_emlikehits:    @local::emlikehits
dune35t_hitcheater:	  @local::standard_hitcheater

#dune35t_gaushitfinder.MinSig:    [6.0, 6.0, 6.0]
#dune35t_gaushitfinder.MinWidth:  [1.0, 1.0, 1.0]
dune35t_gaushitfinder.HitFinderToolVec.CandidateHitsPlane0.RoiThreshold: 6.0
dune35t_gaushitfinder.HitFinderToolVec.CandidateHitsPlane1.RoiThreshold: 6.0
dune35t_gaushitfinder.HitFinderToolVec.CandidateHitsPlane2.RoiThreshold: 6.0
dune35t_gaushitfinder.InitWidth: [6.0, 6.0, 6.0]
dune35t_gaushitfinder.AreaNorms: [13.25, 13.25, 13.25]
#dune35t_gaushitfinder.Chi2NDFRetry: 1000.

dune35t_disambigalg:
{
    TimeCut:          3.   #tolerance for 3 view hits matching, in ticks
    DistanceCut:      1.   #tolerance to determine whether wires cross, in cm
    DistanceCutClu:   4.   #tolerance to get disambiguated hits around a given hit, in cm
    TimeWiggle:       5.   #Buffer to extend cluster windows by to exclude small clusters
    		      	   # of mis-identified hits.
    ColChannelWiggle: 5    #Buffer to extend cluster windows by to exclude small clusters
                           # of mis-identified hits.
    DoCleanUpHits:    true #clean up wrong hit triplets
    DBScanAlg:        @local::standard_dbscanalg
}

dune35t_disambigalg.DBScanAlg.eps:       13.
dune35t_disambigalg.DBScanAlg.epstwo:    15.

dune35t_TimeBasedDisambigAlg:
{
    TimeCut:          3.   #tolerance for 3 view hits matching, in ticks
    DistanceCut:      1.   #tolerance to determine whether wires cross, in cm
    DistanceCutClu:   4.   #tolerance to get disambiguated hits around a given hit, in cm
    TimeWiggle:       5.   #Buffer to extend cluster windows by to exclude small clusters
                           # of mis-identified hits.
    ColChannelWiggle: 5    #Buffer to extend cluster windows by to exclude small clusters
                           # of mis-identified hits.
}

dune35t_hitfinder35t:
{
    module_type:      "HitFinder35t"
    DisambigAlg:      @local::dune35t_disambigalg
    TimeBasedDisambigAlg:      @local::dune35t_TimeBasedDisambigAlg
    ChanHitLabel:     "gaushit"
    Algorithm:        "TripletMatch"
}

dune35t_handscan:
{
    module_type:     "HitHandScan"
    HandScanFileName: "/dune/app/users/mthiesse/PersistentFiles/handscan.txt"
    PreviousHitModuleLabel: "hit35t"
}

dune35t_hitlinefitalg:
{
    FitPolN: 2
    MinStartPoints: 3
    MinAlsoPoints: 6
    IterationsMultiplier: 20
    InclusionThreshold: 2
    LogLevel: 2
}

dune35t_hitfindercounters:
{
    module_type:           "HitFinderCounter35t"
    Debug:                 false
    HitsModuleLabel:       "gaushit"
    CounterModuleLabel:    "SplitterInput:TRIGGER"
    CounterDir:            "/dune/app/users/mthiesse/PersistentFiles/"
    CounterFile:           "counterInformation.txt"
    CoincidenceTolerance:  2
    fConvCountTimeToTicks: 32
    ExtendCounters:        10
    AdjacentWireWidth:     10
    AdjacentTimeWidth:     100
    CollectionTimeWidth:   50
    DoHitLineFitAlg:       false
    HitLineFitAlg:         @local::dune35t_hitlinefitalg
}

dune35t_hitfindercounters_sim: @local::dune35t_hitfindercounters
dune35t_hitfindercounters_sim.CounterModuleLabel: "simcounter"
dune35t_hitfindercounters_sim.CounterDir: "/dune/app/users/mthiesse/PersistentFiles/"
dune35t_hitfindercounters_sim.CounterFile: "counterInformation_sim.txt"


dune35t_fasthitfinder:    @local::standard_fasthitfinder
dune35t_fasthitfinder.MinSigInd: 5.0
dune35t_fasthitfinder.MinSigCol: 5.0

dune35t_clustercrawlerhit: @local::standard_clustercrawlerhit
dune35t_clustercrawlerhit.CCHitFinderAlg.ChiNorms:           [ 0.31, 0.62, 0.6 ]
dune35t_clustercrawlerhit.CCHitFinderAlg.MinPeak:            [ 3., 3., 3. ]
dune35t_clustercrawlerhit.CCHitFinderAlg.MinRMS:             [ 2.3, 2.3, 2.1 ]
dune35t_clustercrawlerhit.CCHitFinderAlg.AllowNoHitWire:     2

dunefd_disambigcheat:     @local::standard_disambigcheat
dunefd_gaushitfinder:     @local::dune35t_gaushitfinder
dunefd_apahitfinder:      @local::apa_hitfinder
dunefd_hitcheater:	  @local::standard_hitcheater
dunefd_fasthitfinder:     @local::dune35t_fasthitfinder
dunefd_clustercrawlerhit: @local::dune35t_clustercrawlerhit
dunefd_hitfinderfd:       @local::dune35t_hitfinder35t
dunefd_hitfinderfd.DisambigAlg.DoCleanUpHits:  false
dunefd_hitfinderfd.DisambigAlg.DistanceCutClu: 100

protodunespmc_gaushitfinder: @local::gaus_hitfinder
protodunespmc_gaushitfinder.HitFinderToolVec.CandidateHitsPlane0.RoiThreshold: 0.6
protodunespmc_gaushitfinder.HitFinderToolVec.CandidateHitsPlane1.RoiThreshold: 0.6
protodunespmc_gaushitfinder.HitFinderToolVec.CandidateHitsPlane2.RoiThreshold: 0.6
protodunespmc_gaushitfinder.InitWidth: [6.0, 6.0, 6.0]
protodunespmc_gaushitfinder.AreaNorms: [13.25, 13.25, 13.25]
protodunespmc_gaushitfinder.MaxMultiHit: 4
protodunespmc_gaushitfinder.Chi2NDF: 50
protodunespmc_gaushitfinder.LongMaxHits: [ 25, 25, 25 ]
protodunespmc_gaushitfinder.LongPulseWidth: [ 10, 10, 10 ]
protodunespmc_gaushitfinder.PeakFitter:	@local::peakfitter_mrqdt

dune35t_rmshitfinderalg:
{
    WindowWidth: 50
    FilterWidth: 6
    SigmaRiseThreshold: 2.0
    SigmaFallThreshold: 0.25
}

dune35t_robusthitfinder:
{
    module_type: "RobustHitFinder"
    MakeTree: true
    Efield: [ 0.25, 0.620, 0.777, 1.772 ] #kV/cm --> 60kV cathode voltage
    CounterT0ModuleLabel: "t0counter"
    WireModuleLabel: "caldata"
    DigitModuleLabel: "caldata"
    DoWireAssns: true
    DoRawDigitAssns: false
    HitGeomDistanceCut: 25
    MinPedMean: -10
    MaxPedMean: 4000
    MinPedRms: 0
    MaxPedRms: 500
    MakeupMissedHits: true
    MissedBufferTicksLow: 0
    MissedBufferTicksHigh: 0
    HitLineFitAlg: @local::dune35t_hitlinefitalg
    RMSHitFinderAlg: @local::dune35t_rmshitfinderalg
    UseMeasuredCounterPositions: true
    ConstantHitWidth: true
    PreHitTicks: 50
    PostHitTicks: 100
    Simulation: false
}

dune35t_robusthitfindersim: @local::dune35t_robusthitfinder
dune35t_robusthitfindersim.SearchPreTicks: 100
dune35t_robusthitfindersim.SearchPostTicks: 4400
dune35t_robusthitfindersim.HitGeomDistanceCut: 25
dune35t_robusthitfindersim.UseMeasuredCounterPositions: false
dune35t_robusthitfindersim.Simulation: true

protodunesp_disambig:
{
    module_type: "HitFinderProtoDUNESP"
# so far there's only one algorithm so this value is ignored.
    ChanHitLabel: "gaushit"
    Algorithm: "Placeholder_Value"
    DisambigAlg:
     {
       TimeCut: 3
       DistanceCut: 1
     }
}

dune35t_trackhitbacktracker:
{
    module_type: "TrackHitBacktracker"
    WireModuleLabel: "caldata"
    TrackModuleLabel: "pmtrack"
    PrevHitModuleLabel: "linecluster"
    PreBaselineTicks: 100
    PostBaselineTicks: 100
    PulseStartWidthMult: 1.0
    PulseEndWidthMult: 1.5
    MakeTree: false
}


END_PROLOG
BEGIN_PROLOG

standard_Hits:
{
  tool_type:              HitsStandard
}

standard_HitsICARUS:
{
  tool_type:              HitsICARUS
}

END_PROLOG

BEGIN_PROLOG

standard_spacepointsolver:
{
  module_type: "SpacePointSolver"

  HitLabel: "gaushit"

  Fit: true

  # How close the intersections of three wire pairs need to be to form a
  # triplet (cm)
  WireIntersectThreshold: 0.7
  # How close intersections need to be in the drift direction
  WireIntersectThresholdDriftDir: 0.4

  Alpha: .05 # Regularization strength

  # Form triplets out of two hits and one bad induction wire
  AllowBadInductionHit: true
  # Form triplets out of two induction hits and a bad collection wire
  AllowBadCollectionHit: true

  MaxIterationsNoReg: 100
  MaxIterationsReg:   100

  XHitOffset:         0

  # Experiment specific tool for reading hits
  HitReaderTool: @local::standard_Hits
}

END_PROLOG


BEGIN_PROLOG

protodunespmc_spacepointsolver: @local::standard_spacepointsolver
protodunespmc_spacepointsolver.WireIntersectThreshold: 0.3
protodunespmc_spacepointsolver.WireIntersectThresholdDriftDir: 0.3

protodunespdata_spacepointsolver: @local::standard_spacepointsolver
protodunespdata_spacepointsolver.WireIntersectThreshold: 0.3
protodunespdata_spacepointsolver.WireIntersectThresholdDriftDir: 0.3

END_PROLOG
BEGIN_PROLOG

dune35t_cluster3ddbscanalg:
{
  EnableMonitoring:        true   # enable monitoring of functions
  NumPairPts:              2      # minimum number of hit pairs for DBScan to consider
  TimeAdvanceGap:          50.    # Window size (ticks) for comparing hits in different views
  NumSigmaPeakTime:        5.     # Number "sigma" for peak times when building hits
  EpsilonDistanceDBScan:   5.     # Distance (cm) between 3D hits for DBScan to cluster them together

}

dune35t_cluster3dprincipalcomponentsalg:
{
  ParallelLines:        0.00001 # delta theta to be parallel
}

dune35t_cluster3dskeletonalg:
{
  MinimumDeltaTicks:    0.05 # minimum delta time (in ticks) when matching hits
  MaximumDeltaTicks:   10.0  # maximum delta time (in ticks) when matching hits
}

dune35t_cluster3dhoughseedfinderalg:
{
  Minimum3DHits:            5      # Minimum number 3D hits to run transform
  ThetaBins:              360      # Number of bins in theta (pi)
  HalfRhoBins:             75      # Half of the number of bins in rho
  HiThresholdMin:           5      # Minimum value for hi threshold in hough scan
  HiThresholdFrac:       0.05      # Fraction of total hits for hi threshold
  LoThresholdFrac:       0.85      # Fraction of peak bin count for lo threshold
  NumSeed2DHits:           80      # number of 2D hits in the seed
  NumAveDocas:             6.      # number of "docas" from axis to accept hits
  NumSkippedHits:          10      # number hits allowed to be skipped for seed hits
  MaxLoopsPerCluster:       3      # Maximum number of loops to search for tracks
  MaximumGap:              5.      # Maximum gap in arc length for seed hits
  DisplayHoughHist:       false
  PrincipalComponentsAlg: @local::dune35t_cluster3dprincipalcomponentsalg
}

dune35t_cluster3dpcaseedfinderalg:
{
  GapDistance:             5.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  MinAllowedCosAng:       0.7      # minimum angle allowed
  PrincipalComponentsAlg: @local::dune35t_cluster3dprincipalcomponentsalg
}

dune35t_cluster3dparallelhitsseedfinderalg:
{
  MaxNumEdgeHits:        1000      # Maximum number hits each end of PCA axis
  GapDistance:            20.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  PrincipalComponentsAlg: @local::dune35t_cluster3dprincipalcomponentsalg
}

END_PROLOG

BEGIN_PROLOG



END_PROLOG
BEGIN_PROLOG

dune35t_cluster3ddbscanalg:
{
  EnableMonitoring:        true   # enable monitoring of functions
  NumPairPts:              2      # minimum number of hit pairs for DBScan to consider
  TimeAdvanceGap:          50.    # Window size (ticks) for comparing hits in different views
  NumSigmaPeakTime:        5.     # Number "sigma" for peak times when building hits
  EpsilonDistanceDBScan:   5.     # Distance (cm) between 3D hits for DBScan to cluster them together

}

dune35t_cluster3dprincipalcomponentsalg:
{
  ParallelLines:        0.00001 # delta theta to be parallel
}

dune35t_cluster3dskeletonalg:
{
  MinimumDeltaTicks:    0.05 # minimum delta time (in ticks) when matching hits
  MaximumDeltaTicks:   10.0  # maximum delta time (in ticks) when matching hits
}

dune35t_cluster3dhoughseedfinderalg:
{
  Minimum3DHits:            5      # Minimum number 3D hits to run transform
  ThetaBins:              360      # Number of bins in theta (pi)
  HalfRhoBins:             75      # Half of the number of bins in rho
  HiThresholdMin:           5      # Minimum value for hi threshold in hough scan
  HiThresholdFrac:       0.05      # Fraction of total hits for hi threshold
  LoThresholdFrac:       0.85      # Fraction of peak bin count for lo threshold
  NumSeed2DHits:           80      # number of 2D hits in the seed
  NumAveDocas:             6.      # number of "docas" from axis to accept hits
  NumSkippedHits:          10      # number hits allowed to be skipped for seed hits
  MaxLoopsPerCluster:       3      # Maximum number of loops to search for tracks
  MaximumGap:              5.      # Maximum gap in arc length for seed hits
  DisplayHoughHist:       false
  PrincipalComponentsAlg: @local::dune35t_cluster3dprincipalcomponentsalg
}

dune35t_cluster3dpcaseedfinderalg:
{
  GapDistance:             5.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  MinAllowedCosAng:       0.7      # minimum angle allowed
  PrincipalComponentsAlg: @local::dune35t_cluster3dprincipalcomponentsalg
}

dune35t_cluster3dparallelhitsseedfinderalg:
{
  MaxNumEdgeHits:        1000      # Maximum number hits each end of PCA axis
  GapDistance:            20.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  PrincipalComponentsAlg: @local::dune35t_cluster3dprincipalcomponentsalg
}

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

standard_dataprovideralg:
{
 DriftWindow:          6 # downsampling window (in drift ticks)
 DownscaleFullView: true # downsample full view

 DownscaleFn:     "mean" # "maxpool" takes the max value in the window,
                         # "maxmean" is mean from 3 ADC's around the max,
                         # "mean" is the mean value of all ADC's in the window

 BlurKernel:      []  # apply channel-channel blurring
 NoiseSigma:      0   # apply white noise
 CoherentSigma:   0   # apply coherent noise

 CalorimetryAlg:    @local::standard_calorimetryalgmc  # used to eliminate amplitude variation due to electron lifetime
 CalibrateAmpl:     false # calibrate ADC values with CalAmpConstants (allows different gains in MC and data)
 CalibrateLifetime: true  # calibrate ADC values according to the electron lifetime

 # The following settings allow to scale the interesting ADC range into desired range of values,
 # e.g. convenient for the CNN or for the conversion to decimal type range. Default values
 # provided here will result with the scaling factor of 0.1.
 AdcMax:            150.0 # input saturation max value
 AdcMin:            -50.0 # input saturation min value
 OutMax:             15.0 # output max value
 OutMin:             -5.0 # output min value
}

END_PROLOG

BEGIN_PROLOG

standard_spacepointalg:
{
  MaxDT:      2.0
  MaxS:       0.3
  MinViews:   2
  EnableU:    true
  EnableV:    true
  EnableW:    false
  Filter:     true
  Merge:      false
  PreferColl: false
}

standard_seedfinderalgorithm:
{
  SpacePointAlg:          @local::standard_spacepointalg
  InitSeedLength:         2
  MinPointsInSeed:        4
  Refits:                 5
  HitResolution:          1
  OccupancyCut:           0.8
  MaxViewRMS:             [2,2,2]
  ExtendSeeds:            true
  LengthCut:              0
}
standard_seedfinderalgorithm.SpacePointAlg.Filter: false

standard_projectionmatchingalg:
{
  OptimizationEps:        0.01    # relative change of the obj.fn which stops optimization after adding a node
  FineTuningEps:          0.0001  # relative change of the obj.fn which stops fine-tuning of optimized track
  TrkValidationDist2D:    1.0     # max. distance [cm] used in the track validation in the "third" plane
  HitTestingDist2D:       0.5     # max. distance [cm] used in testing compatibility of hits with the track
  MinTwoViewFraction:     0.4     # min. fraction of track length covered with hits from many 2D views intertwinted with each other
  NodeMargin3D:           3.0     # margin in [cm] around TPC for allowed track node positions
  HitWeightZ:             1.0     # weights used for hits in U, V, Z planes:
  HitWeightV:             1.0     #    - use lower values for planes where hit position is less reliable (e.g. due to S/N)
  HitWeightU:             1.0     #    - relative ratios matter, sum does not need to be 1.0
}

standard_pmalgtracker:
{
  MinSeedSize1stPass:     20      # min. cluster size used to start building a track in the 1st pass
  MinSeedSize2ndPass:     4       # ..and in the 2nd pass: differentiate to speed up finding long tracks
                                  # w/o checking large number of possibilities, then use as small size
                                  # as reasonnable for used clustering algorithm to complete the search
                                  # in the second pass
  TrackLikeThreshold:     0.0     # CNN output threshold for track-like recognition; ClusterModuleLabel
                                  # needs to be associated to CNN outputs in case of threshold > 0; will
                                  # exclude obvious EM from tracking and tag clean electron tracks as PDG=11
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
                                  #
  FlipToBeam:             false   # set the track direction to increasing Z values
  FlipDownward:           false   # set the track direction to decreasing Y values (like cosmic rays)
  FlipToX:             	  false   # set the track direction to decreasing X values (like cosmic rays in dual phase)
  AutoFlip_dQdx:          false   # set the track direction to increasing dQ/dx (overrides FlipToBeam,
                                  # FlipDownward and FlipToX if significant rise of dQ/dx at the track end)
                                  #
  MergeWithinTPC:         false   # merge witnin single TPC; finds tracks best matching by angle, with limits:
  MergeTransverseShift:   2.0     #    - max. transverse displacement [cm] between tracks
  MergeAngle:             2.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  StitchBetweenTPCs:      true    # stitch between TPCs; finds tracks best matching by angle, with limits:
  StitchDistToWall:       3.0     #    - max. track endpoint distance [cm] to TPC boundary
  StitchTransverseShift:  3.0     #    - max. transverse displacement [cm] between tracks
  StitchAngle:           10.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  MatchT0inAPACrossing:   false   # match T0 of APA-crossing tracks using PMAlgStitcher
  MatchT0inCPACrossing:   false   # match T0 of CPA-crossing tracks using PMAlgStitcher

  Validation:             "hits"  # "hits":   uses hits to validate track
                                  # "adc":   uses adc image to validate tracks
                                  # "calib": uses hits to validate tracks and produce histograms to find adc thresholds
                                  #          which should be used in "adc" mode
  AdcValidationThr:       [1.0, 1.0, 1.0]    # threshold for not-empty pixel in the ADC image used for the track validation, per plane
  AdcImageAlg:            @local::standard_dataprovideralg
}

standard_pmalgfitter:
{
  TrackingOnlyPdg:        [0]     # PDG list to select which PFParticles should be reconstructed;
                                  # all PFP's are used if the list is empty or starts with 0
  TrackingSkipPdg:        [0]    # PDG list to select which PFParticles should NOT be reconstructed,
                                  # e.g. skip EM showers; no skipping if the list is empty or starts with 0
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
}

standard_beziertrackeralgorithm:
{	
  OverlapCut:            0.2
  DirectJoinDistance:    10.0
  TrackJoinAngle:        0.5          
  VertexImpactThreshold: 2.0
  VertexExtrapDistance:  5.0
  OccupancyThresh:       0.8
  TrackResolution:       2.0
  SeedFinder:            @local::standard_seedfinderalgorithm

}
standard_beziertrackeralgorithm.SeedFinder.LengthCut: 2

standard_trackstitcheralg:
{
  CosAngTolerance: 0.98
  SpptSepTolerance: 30.0 # cm
  CommonComponentStitch: true
}

standard_kalmanfilteralg:
{
  Trace: false
  MaxPErr: 0.25      # Maximum pointing error for free propagation.
  GoodPErr: 0.1      # Pointing error threshold for switching from linearized to free propataion.
  MaxIncChisq: 10.   # Incremental chisquare cut.
  MaxSeedIncChisq: 1000.  # Incremental chisquare cut in seed phase.
  MaxSmoothIncChisq: 100. # Incremental chisquare cut in smooth phase.
  MaxEndChisq: 10.   # Maximum incremental chisquare for endpoint hit.
  MinLHits: 20       # Minimum number of measurements for linearized propagation.
  MaxLDist: 10.      # Maximum distance to use linearized propagation using starting guess.
  MaxPredDist: 5.    # Maximum prediction distance to accept a hit.
  MaxSeedPredDist: 50. # Maximum prediction distance to accept a hit in seed phase.
  MaxPropDist: 50.   # Maximum propagation distance to candidate surface.
  MinSortDist: 0.    # Low threshold to resort hits.
  MaxSortDist: 2.    # High threshold to resort hits.
  MaxSamePlane: 3    # Maximum consecutive hits in same plane.
  GapDist: 3.        # Minimum gap distance.
  MaxNoiseHits: 3    # Maximum number of hits in noise cluster.
  MinSampleDist: 20. # Minimum sample distance (for momentum measurement).
  FitMomRange: true  # Fit momentum using range.
  FitMomMS: false    # Fit momentum using multiple scattering.

  # Graphical trace options.
  # For any kine of graphical tracing to work, you need to configure
  # the event display service to initialize the graphics system.

  GTrace: false      # Graphical trace flag.
  GTraceWW: 1200     # Window width (pixels).
  GTraceWH: 800      # Window height (pixels).
  GTraceXMin: -256.  # Graphical trace minimum x (same for each view).
  GTraceXMax: 512.   # Graphical trace maximum x (same for each view).
  GTraceZMin: [    0.,    0.,    0.]  # Graphical trace minimum z for each view.
  GTraceZMax: [ 1040., 1040., 1040.]  # Graphical trace maximum z for each view
}

standard_track3Dkalmanhitalg:
{
  MaxTcut:            10.           # Maximum delta ray energy in MeV for restricted dE/dx
  DoDedx:             false         # dE/dx enable flag.
  SelfSeed:           false         # Generate seeds internally.
  LineSurface:        false         # Store hits on line surfaces.
  MinSeedHits:        12            # Minimum number of hits per track seed.
  MinSeedChopHits:    50            # Potentially chop seeds that exceed this length.
  MaxChopHits:        20            # Maximum number of hits to chop from each end of seed.
  MaxSeedChiDF:       20.           # Maximum seed track chisquare/dof.
  MinSeedSlope:       0.0           # Minimum seed slope (dx/dz).
  InitialMomentum:    0.5           # Initial momentum (GeV/c).
  KalmanFilterAlg:    @local::standard_kalmanfilteralg
  SeedFinderAlg:      @local::standard_seedfinderalgorithm
}

standard_cosmictrackeralg:
{
    SPTAlg:   0
    TrajOnly: false
    TMatch:   2.5
    SMatch:   1
}

argoneut_spacepointalg:      @local::standard_spacepointalg
argoneut_kalmanfilteralg:    @local::standard_kalmanfilteralg
argoneut_cosmictrackeralg:   @local::standard_cosmictrackeralg
argoneut_cosmictrackeralg.SPTAlg:   1
argoneut_cosmictrackeralg.TrajOnly: true

bo_spacepointalg: @local::standard_spacepointalg
bo_spacepointalg.MinViews: 2
bo_spacepointalg.EnableW:  true
bo_kalmanfilteralg:          @local::standard_kalmanfilteralg
bo_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
bo_seedfinderalgorithm.SpacePointAlg :           @local::bo_spacepointalg
bo_seedfinderalgorithm.SpacePointAlg.PreferColl: true
bo_seedfinderalgorithm.SpacePointAlg.Filter:     false
bo_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
bo_beziertrackeralgorithm.SeedFinder:            @local::bo_seedfinderalgorithm

microboone_spacepointalg:                                @local::standard_spacepointalg
microboone_spacepointalg.MinViews:                       3
microboone_spacepointalg.EnableW:                        true
microboone_kalmanfilteralg:                              @local::standard_kalmanfilteralg
microboone_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
microboone_seedfinderalgorithm.SpacePointAlg : {
  @table::microboone_spacepointalg
  PreferColl: true
  Filter:     false
}
microboone_track3Dkalmanhitalg: {
  @table::standard_track3Dkalmanhitalg
  KalmanFilterAlg: @local::microboone_kalmanfilteralg
  SeedFinderAlg:   @local::microboone_seedfinderalgorithm
}
microboone_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
microboone_beziertrackeralgorithm.SeedFinder:            @local::microboone_seedfinderalgorithm
microboone_trackstitcheralg:  @local::standard_trackstitcheralg

dune10kt_spacepointalg:          @local::standard_spacepointalg
dune10kt_spacepointalg.MinViews: 3
dune10kt_spacepointalg.EnableW:  true
dune10kt_kalmanfilteralg:        @local::standard_kalmanfilteralg
dune34kt_spacepointalg:          @local::dune10kt_spacepointalg
dune34kt_kalmanfilteralg:        @local::dune10kt_kalmanfilteralg
dune35t_spacepointalg: @local::standard_spacepointalg
dune35t_spacepointalg.MinViews:  3
dune35t_spacepointalg.EnableW:   true
dune35t_kalmanfilteralg:         @local::standard_kalmanfilteralg
dune35t_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
dune35t_seedfinderalgorithm.SpacePointAlg :           @local::dune35t_spacepointalg
dune35t_seedfinderalgorithm.SpacePointAlg.PreferColl: true
dune35t_seedfinderalgorithm.SpacePointAlg.Filter:     false


END_PROLOG
##include "cluster3dpathfindingtools.fcl"

BEGIN_PROLOG

standard_cluster3dkdTree:
{
  EnableMonitoring:  true    # enable monitoring of functions
  PairSigmaPeakTime: 3.      # "sigma" multiplier on peak time
  RefLeafBestDist:   0.5     # Initial distance once reference leaf found
}

standard_standardhit3dbuilder:
{
  tool_type:            StandardHit3DBuilder
  HitFinderTagVec:      ["gaushit"]
  EnableMonitoring:     true  # enable monitoring of functions
  NumSigmaPeakTime:     1.5   # Number "sigma" for peak times when building hits
  HitWidthScaleFactor:  6.    #
  DeltaPeakTimeSig:     1.7   # "Significance" of agreement between 2 hit peak times
  WirePitchScaleFactor: 1.9
  MaxHitChiSquare:      6.0
  OutputHistograms:     false
}

standard_spacepointhit3dbuilder:
{
  tool_type:               SpacePointHit3DBuilder
  SpacePointProducerLabel: "SpacePointSolver"
  HitProducerLabel:        "gaushit"
  EnableMonitoring:        true  # enable monitoring of functions
  MaxHitChiSquare:         6.0
  OutputHistograms:        false
}

standard_cluster3dprincipalcomponentsalg:
{
  ParallelLines:        0.00001 # delta theta to be parallel
}

standard_cluster3dParamsBuilder:
{
  tool_type:                ClusterParamsBuilder
  ClusterMinHits:           3
  ClusterMinUniqueFraction: 0.5
  ClusterMaxLostFraction:   0.5
  PrincipalComponentsAlg:   @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dMergeAlg:
{
  tool_type:              ClusterMergeAlg
  EnableMonitoring:       true    # enable monitoring of functions
  AxisAngleScaleFactor:   5.
  MinTransEigenVal:       0.09
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3ddbscanalg:
{
  tool_type:              DBScanAlg
  EnableMonitoring:       true    # enable monitoring of functions
  MinPairPts:             2       # minimum number of hit pairs for DBScan to consider
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dminSpanTreeAlg:
{
  tool_type:              MinSpanTreeAlg
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dskeletonalg:
{
  MinimumDeltaTicks:      0.05  # minimum delta time (in ticks) when matching hits
  MaximumDeltaTicks:      10.0  # maximum delta time (in ticks) when matching hits
}

standard_cluster3dhoughseedfinderalg:
{
  Minimum3DHits:            5      # Minimum number 3D hits to run transform
  ThetaBins:              360      # Number of bins in theta (pi)
  HalfRhoBins:             75      # Half of the number of bins in rho
  HiThresholdMin:           5      # Minimum value for hi threshold in hough scan
  HiThresholdFrac:       0.05      # Fraction of total hits for hi threshold
  LoThresholdFrac:       0.85      # Fraction of peak bin count for lo threshold
  NumSeed2DHits:           80      # number of 2D hits in the seed
  NumAveDocas:             6.      # number of "docas" from axis to accept hits
  NumSkippedHits:          10      # number hits allowed to be skipped for seed hits
  MaxLoopsPerCluster:       3      # Maximum number of loops to search for tracks
  MaximumGap:              5.      # Maximum gap in arc length for seed hits
  DisplayHoughHist:       false
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dpcaseedfinderalg:
{
  GapDistance:             5.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  MinAllowedCosAng:       0.7      # minimum angle allowed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dparallelhitsseedfinderalg:
{
  MaxNumEdgeHits:        1000      # Maximum number hits each end of PCA axis
  GapDistance:            20.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dPathAlg:
{
  tool_type:              ClusterPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_voronoiPathAlg:
{
  tool_type:              VoronoiPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_convexhullPathAlg:
{
  tool_type:              ConvexHullPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_MSTPathAlg:
{
  tool_type:              MSTPathFinder
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

microboone_standardhit3dbuilder:               @local::standard_standardhit3dbuilder
microboone_spacepointhit3dbuilder:             @local::standard_spacepointhit3dbuilder
microboone_cluster3dMergeAlg:                  @local::standard_cluster3dMergeAlg
microboone_cluster3dPathAlg:                   @local::standard_cluster3dPathAlg
microboone_voronoiPathAlg:                     @local::standard_voronoiPathAlg
microboone_cluster3ddbscanalg:                 @local::standard_cluster3ddbscanalg
microboone_cluster3dminSpanTreeAlg:            @local::standard_cluster3dminSpanTreeAlg
microboone_cluster3dprincipalcomponentsalg:    @local::standard_cluster3dprincipalcomponentsalg
microboone_cluster3dskeletonalg:               @local::standard_cluster3dskeletonalg 
microboone_cluster3dhoughseedfinderalg:        @local::standard_cluster3dhoughseedfinderalg 
microboone_cluster3dpcaseedfinderalg:          @local::standard_cluster3dpcaseedfinderalg
microboone_cluster3dparallelhitsseedfinderalg: @local::standard_cluster3dparallelhitsseedfinderalg
microboone_cluster3dkdtree:                    @local::standard_cluster3dkdTree

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG
BEGIN_PROLOG
mcsfitproducer: {
  module_type:  MCSFitProducer
  inputs: {
        inputLabel: @nil
  }
  fitter: {
  	pIdHypothesis: 13
	minNumSegments: 3
	segmentLength: 14.0
	minHitsPerSegment: 2
	nElossSteps: 10
	eLossMode: 0
	pMin: 0.01
	pMax: 7.50
	pStep: 0.01
	angResol: 3.0
  }
}
END_PROLOG
BEGIN_PROLOG
kalmanfilterfittrackmakertool: {
   tool_type: KalmanFilterFitTrackMaker
   options: {
      defaultMomInGeV: 1.0
      momFromMCSCollection: false
      mcsInputTag: ""
      momFromCombAndPid: false
      contInputTag: ""
      pidFromCollection: false
      pidInputTag: ""
      pidFromLengthCut: -1.
      defaultPdgId: 13
      dirFromVec: false
      dirVec: [0,0,1]
      alwaysInvertDir: false
      keepInputTrajectoryPoints: false
   }
   fitter: {
      useRMSError: true
      sortHitsByPlane: true
      sortHitsByWire: false
      sortOutputHitsMinLength: true
      skipNegProp: true
      cleanZigzag: false
      rejectHighMultHits: false
      rejectHitsNegativeGOF: true
      hitErr2ScaleFact: 1.0
      tryNoSkipWhenFails: true
      tryBothDirs: false
      pickBestHitOnWire: false
      maxResidue: -1.
      maxResidueFirstHit: -1.
      maxChi2: -1.
      maxDist: -1.
      negDistTolerance: 0.
      dumpLevel: 0
   }
   propagator: {
      minStep: 1.0
      maxElossFrac: 0.1
      maxNit: 10
      tcut: 10.
      wrongDirDistTolerance: 0.01
      propPinvErr: false
   }
   mcsfit: @local::mcsfitproducer.fitter
}
END_PROLOG
BEGIN_PROLOG

standard_trajclusteralg:
{
   Mode: 1                  # 1(-1) step from US(DS) to DS(US), 2 = don't use
   NPtsAve: 10              # Number of points to find average charge, Ave chg rms
   MinPtsFit: [3, 3, 3]     # Min number of points in the trajectory fit required on each pass
   MinPts:    [3, 3, 3]     # Min number of points in the trajectory required on each pass
   MaxAngleCode: [0, 1, 2]  # Max angle range code allowed on each pass
   MinMCSMom: [0, 0, 0]   # Minimum MCSMom for each pass
   MaxChi: 20               # Max Chi/DOF for accepting a trajectory fit (long muons)
   HitErrFac: 0.4          # hit time error for fitting = fHitErrFac * (hit RMS)
   MinAmp:  1               # Min amplitude for a wire signal being considered present (must be > 0)
   AngleRanges: [40, 85, 90]  # Max angle (degrees) for small, intermediate and large angle trajectories
   MultHitSep: 2.5          # Hits separated by < MultHitSep * RMS may be combined in a trajectory point
   ChargeCuts: [4, 0.15, 0.25]  # [Max(min) chg pull, Min allowed chg RMS, Max allowed chg RMS]
#   KinkCuts: [0.4, 1.5, 3] # kink angle, MCS kink significance, nPts fit << OLD
   KinkCuts: [ 8, 15, 1, 10 ] # << NEW
   # 0 Number of points to fit at the end of the trajectory
   # 1 Minimum kink significance
   # 2 Use charge in significance calculation? (yes if > 0)
   # 3 3D kink fit length (cm)
   ProjectionErrFactor: 2   # Factor applied to calculated trajectory error
   VLAStepSize: 1.5         # Step size for Very Large Angle trajectories
   JTMaxHitSep: 3           # max hit separation (WSE units) for making Junk Trajectories (<0) turn off
   MaxWireSkipNoSignal:  3  # max allowed number of not-dead wires if no signal is present
   MaxWireSkipWithSignal: 100  # max allowed number of not-dead wires if a signal is present
   QualityCuts: [ 0.8, 3] # Min points/wire, min consecutive pts after a gap
   MuonTag: [40, 500, 40, 3]    # minLength, minMCSMom, maxWireSkip,(min delta-ray length for muon direction tag)
   DeltaRayTag:  [10, 5, 500] # Tag short TJs as delta-rays close to muons [min sep, min MCSMom, max MCSMom]
#               0   1   2   3   4  5    6   7  8  9 10 11 12
   ShowerTag: [ 1, 100, 10, 50, 2.5, 1, 0, 3, 5, 0.7, 1, 10, -13]
# 0 Mode (<= 0 OFF, 1 = tag only, 2 = find showers)
  # 1 Max Tj MCSMom for a shower tag
  # 2 Max separation
  # 3 Min energy (MeV)
  # 4 rms width factor
  # 5 Min shower 1/2 width (WSE units)
  # 6 Min ElectronLikelihood (if > 0)
  # 7 Min Tjs
  # 8 max parent FOM
  # 9 max direction FOM
  # 10 max aspect ratio
  # 11 not used
  # 12 Print 2D showers in plane (0,1,2) or all planes (3) or just 3D matching (4)
   SaveShowerTree: false
   SaveCRTree: false
   TagCosmics: false
   ChkStopCuts: [10, 8, 1.5] # [Min chg slope, nFitPts, Chg fit ChiDOF cut]
   VertexScoreWeights: [1, 2, 10, 2]
    # 0 = Vertex error weight
    # 1 = 3D match weight
    # 2 = Charge fraction of vertex Tjs near the vertex weight
    # 3 = Tj MCSMom, ChgRMS, Angle difference significance between Tjs weight
   Vertex2DCuts:  [6, 8, 45, 3, 3, 50, 0.6, 30, 0.8, 0.8] # << NEW increase min Score
   # 0 User definition of a short Tj => max number of Tj points
   # 1 max separation between a vertex and the start of a trajectory for a user-defined short Tj
   # 2 max separation for a user-defined long Tj
   # 3 max position pull when attaching a Tj to a vertex
   # 4 max position error for creating a Tj or attaching Tjs to an existing vertex
   # 5 Min MCSMom of Tjs that can be used to create a vertex
   # 6 min frac of Points/Wire between a vtx and a Tj. Ideally one if the efficiency is good
   # 7 min Score
   # 8 Min charge fraction near a vertex or merge point
   # 9 max MCSmom asymmetry for a merge
   Vertex3DCuts: [0.8, 2., 3.]
   # 0 dX match cut (cm)
   # 1 dY and dZ match cut (cm)
   # 2 max separation btw PFParticle end and 3D vertex
   Match3DCuts: [ 0.5, 10000, 1, 2, 2.0, 2.5, 1]
   # 0 dx (cm) matching cut
   # 1 max number of 3-plane matches for any Tj
   # 2 Attempt 2-view match?
   # 3 min number of TP3Ds in at least 2 planes to fit in each PFP section
   # 4 max pull for adding/rejecting TP3Ds in sections
   # 5 suggested max ChiDOF for a SectionFit
   # 6 > 0 Don't match muon shower tjs
   PFPStitchCuts: [ 0.02, 3, 2 ]
   # 0 = matching angle resolution (radians)
   # 1 = matching position resolution (cm)
   # 2 = max angle-position figure of merit
   SkipAlgs: [ ]   # List of algs that should not be used
   DebugConfig: []
}
standard_trajclusteralg.CaloAlg: @local::standard_calorimetryalgmc

standard_clustercrawleralg:
{
  NumPass:              3  # number of passes through the hit list. 0 = no cluster reco
  MaxHitsFit: [ 100,  8, 4] # number of hits fitted to a line
  MinHits:    [ 50,  8, 3] # minimum size of a cluster
  NHitsAve:   [ 20,  8, 2] # number of hits to find the average charge and width
                           # at the end of the cluster. NHitsAve should be 1 or 2
  ChgCut:    [ .8, .8, .8] # max fractional hit charge difference for adding hits
  ChiCut:    [ 4, 8, 10] # stop adding hits to clusters if ChiCut is reached
  MaxWirSkip:   [25, 8, 0] # max number of wires to skip without adding a hit
  MinWirAfterSkip: [2, 2, 1] # min reqd number of consecutive wires with a hit after a skip
  KinkChiRat: [1.2, 1.2, 0.] # Max consecutive chisq increase for the last 3 hits on the cluster
                             # 0. = no kink check when following
  KinkAngCut: [0.4, 0.4, 1.5] # kink angle cut (radians) used to follow and merge
  DoMerge:   [false, true, true] # run cluster merging code?
  TimeDelta: [ 8, 8, 20] # max time difference for cluster merging
  MergeChgCut: [0.8, 0.8, 0.8] # max charge ratio for cluster merging
  FindVertices: [true, true, true]  # make 2D vertices after clustering?
  LACrawl:     [true, true, true]  # crawl Large Angle clusters?
  LAClusAngleCut:       60 # Large cluster angle cut (0 < 90 degrees). <0 to turn off
	LAClusMaxHitsFit: 		 4 #
	MinHitFrac: 				 0.6 # Drop clusters having < (#hits/#wires)
	MinAmp: 			 [5, 5, 5] # Min hit signal amplitude for merging
	ChgNearWindow:				40 # #of ticks for summing charge near a cluster
	ChgNearCut: 				 1.5 # Cluster end is shower-like if (nearby chg)/(cls chg)> cut
  HitMergeChiCut:      2.5 # Merge cluster hit-multiplets if the separation chisq
                           # is < cut. Set < 0 for no merging
  MergeAllHits:      false # merge all hits before reconstructing clusters
  MergeOverlapAngCut:  0.1 # Set <= 0 to turn off overlapping cluster merging
  ChkClusterDS:       true # Check reconstruction at DS end of clusters?
  KillGarbageClusters: 0.1 # Kill ghost clusters, set to 0 to turn off
  VtxClusterSplit:    true # Split clusters that cross vertices
  FindStarVertices:   true # Find vertices with a star topology
  HitErrFac:           0.2 # hit time error for fitting = fHitErrFac * (hit width)
  HitMinAmp:             2 # ignore hits with PH < this value
  ClProjErrFac:          3 # cluster projection error factor
  AllowNoHitWire:        1 # Allow skipping N wires w no hits (if poor purity)
	Vertex2DCut:					10 # Max chisq cut for attaching a cluster to a vtx
  Vertex3DCut:           5 # 2D vtx -> 3D vtx matching cut (chisq)
	FindHammerClusters: true # look for hammer type clusters
  RefineVertexClusters: false # (not ready)
  FindVLAClusters: false # find Very Large Angle clusters (not ready)
  DebugPlane:          -1  # print info only in this plane
  DebugWire:            0  # set to the Begin Wire and Hit of a cluster to print
  DebugHit:             0  # out detailed information while crawling
}

standard_blurredclusteralg:
{
  BlurWire:            6
  BlurTick:            12
  SigmaWire:           4
  SigmaTick:           6
  ClusterWireDistance: 2
  ClusterTickDistance: 2
  MaxTickWidthBlur:    10
  NeighboursThreshold: 0
  MinNeighbours:       0
  MinSize:             2
  MinSeed:             0.1
  TimeThreshold:       500
  ChargeThreshold:     0.07
}

standard_mergeclusteralg:
{
  MinMergeClusterSize: 3
  MaxMergeSeparation:  30
  ProjWidthThreshold:  0.2
}

standard_houghbasealg:
{
  MaxLines:                 50   # The maximum number of Hough lines to look for, 20 had been working!
  MinHits:                  5
  SaveAccumulator:          0
  NumAngleCells:            20000 # The number of angle cells to create for the Hough transform,
  RhoResolutionFactor:      5    # Was set to 5
  MaxDistance:              1.0  # 0.1 was working (okay, not really, larger is probably better,
  MaxSlope:                 80.0 # 80 was working fine previously
  RhoZeroOutRange:          0
  ThetaZeroOutRange:        0
  HitsPerCluster:           1
  MissedHits:               1    # Was set to 0
  MissedHitsDistance:       2.0  #
  MissedHitsToLineSize:     0.25    # Was set to 0
}

standard_endpointalg:
{
  TimeBins:            256
  MaxCorners:          20
  Gsigma:              1.
  Window:              5
  Threshold:           0.1
  SaveVertexMap:       -1
}


standard_cornerfinderalg:
{
  RawDataModuleLabel:           "daq"
  CalDataModuleLabel:		"caldata"
  Trimming_threshold:      10
  Trimming_totalThreshold: 5e4
  Conversion_algorithm:         "standard"
  Conversion_function:          "TMath::Gaus(x,0,1)*TMath::Gaus(y,0,1)"
  Conversion_func_neighborhood: 3
  Conversion_threshold:		0
  Conversion_bins_per_input_x:	1
  Conversion_bins_per_input_y:	1
  Derivative_method: 		"Sobel" #Noble
  Derivative_neighborhood:	1
  Derivative_BlurFunc:	"NotImplemented"
  Derivative_BlurNeighborhood:	5
  CornerScore_Noble_epsilon:    1e-5
  CornerScore_Harris_kappa:     0.05
  CornerScore_neighborhood:	1
  CornerScore_algorithm:	"Nobel" #Harris
  MaxSuppress_neighborhood:	3
  MaxSuppress_threshold:	1000
  Integral_bin_threshold:       5
  Integral_fraction_threshold:  0.95


}

standard_dbscanalg:
{
  eps:    1.0
  epstwo: 1.5
  minPts: 2
  Method: 0   # 0 -- naive findNeighbor implemention
              # 1 -- findNeigbors with R*-tree
              # 2 -- DBScan from the paper with R*-tree
  Metric: 3   # Which RegionQuery distance metric to use.
              # **ONLY APPLIES** if Method is 1 or 2.
              #
	      # 0 -- rectangle (no bad channels) **not implemented**
	      # 1 -- Manhattan distance (only uses eps, no bad channels)
              #                                  **not implemented**
	      # 2 -- Eliptical (no bad channels) **not implemented**
	      # 3 -- findNeighbors-alike: Elliptical and bad
              #                           channel aware (not working)
}

standard_dbscan3dalg:
{
    epsilon:          5.0
    minpts:           2
    neighbors:        100
    badchannelweight: 0.
}

standard_tcshoweralg:
{
    CalorimetryAlg: @local::standard_calorimetryalgmc
    ProjectionMatchingAlg:    @local::standard_projectionmatchingalg
}

standard_fuzzyclusteralg:
{
  RunHough:       true    # Turns on and off the Hough line finder, useful for diagnostics
  NumberTimeBoundaries:             3	# Number of boundaries in ticks for the drift window to be divided up to make the Hough line finder easier on memory
  NumberWireBoundaries:             3	# Number of boundaries in wires for the drift window to be divided up to make the Hough line finder easier on memory
  GenerateHoughLinesOnly:       false # Show only the results of the Hough line finder, hits not in a line will not be clustered
  HoughBaseAlg:{
    MaxLines:             100
    MaxDistance:          1
    MinHits:              5
    NumAngleCells:        10800
    SaveAccumulator:          0
    RhoResolutionFactor:      5
    MaxSlope:                 80.0 # 80 was working fine previously
    RhoZeroOutRange:          0
    ThetaZeroOutRange:        0
    HitsPerCluster:           1
    MissedHits:               1    # Was set to 0
    MissedHitsDistance:       1.0  #
    MissedHitsToLineSize:     0.5    # Was set to 0
  }
  DBScanAlg:                @local::standard_dbscanalg
  DoFuzzyRemnantMerge:      true # Tell the algorithm to merge fuzzy cluster remnants into showers or tracks (0-off, 1-on)
  FuzzyRemnantMergeCutoff: 20    # Cut off on distance from hough line to hit in the remnant of the fuzzy cluster

  DoTrackClusterMerge:     true # Turns on merging of track-like Hough lines (0-off, 1-on)
  ChargeAsymAngleCut:        0.1 # Cut on product of charge asymmetry and the square of the sin of angle between slopes of lines, only for track-like
  SigmaChargeAsymAngleCut:   1.0  # Cut on product of charge sigma asymmetry and the sin of angle between slopes of lines, only for track-like
  TrackClusterMergeCutoff: 5.0 # The maximum distance between track-like Hough line endpoints before they can be merged,

  DoShowerClusterMerge:     true # Turns on merging of shower-like Hough line (0-off, 1-on)
  ShowerClusterMergeAngle: 30    # The maximum angle between slopes of shower-like lines to be merged,
  ShowerClusterMergeCutoff:  7.5 # The maximum distance between shower-like line endpoints before they can be merged,

  DoShowerTrackClusterMerge:     true # Turns on merging of shower-like and track-like lines (0-off, 1-on)
  ShowerTrackClusterMergeAngle:  15   # The maximum angle between slopes of shower-like and track-like lines to be merged,
  ShowerTrackClusterMergeCutoff: 7.5  # The maximum distance between shower-like and track-like line endpoints before they can be merged,
  ShowerLikenessCut:       10    # Cut on shower likeness (the larger the more shower like, the smaller the less shower like)
  MaxVertexLines:          100   # Max number of line end points allowed in a Hough line merge region for a merge to happen
  VertexLinesCutoff:       5.0   #  Size of the vertex region to count up lines for MaxVertexLines
}

standard_clusterparamsalg:
 {
  ChargeCutoffThreshold:    [500,500,1000]
  SelectBoxSizePar:               10     #distance along axis
  SelectBoxSizePerp:              3      #distance perpendicular to axis
  ForceRightGoing:        	  false
  MinHitListSize:		  40
  fOutlierRadius:		  5
  #HoughBaseAlg.NumAngleCells:       3000
  #HoughBaseAlg.RhoResolutionFactor:       4
  #HoughBaseAlg.MaxLines:       100
  HitDensityCutoff:             1.9  # Showers is high, tracks low, 0 don't use cut
  MultiHitWireCutoff: 		 2.1  # Showers is high, tracks low, 0 don't use cut
  OffAxisHitsCutoff:            0    # Showers is high, tracks low, 0 don't use cut
  PrincipalComponentCutoff:     0    # Tracks is high ~1, showers low, 0 don't use cut
  ShowerSelisORorAND:           0    # 0 = OR, 1 = AND

  HoughBaseAlg:                   @local::standard_houghbasealg

 }

 standard_clustermatchalg:
 {
  DebugMode: true
  StoreSpacePoint: true
  MatchAlgoList:                [0, 1, 2, 3] # Algorithms enum to be enabled
  CutParam_NumSpacePoint:       100          # Number of minimum space point to claim a cluster by kSpacePoint
  CutParam_OverlayTimeFraction: 0.0          # Minimum fraction of overlayed time period used by kRoughTime
  CutParam_SumChargeRatio:      1000.0       # Maximum difference in fraction of clusters' charge sum used by kSumCharge
  SpacePointAlg:                @local::microboone_spacepointalg
  }
 standard_clustermatchalg.SpacePointAlg.Filter: false

 standard_clustermergealg:
 {
  VerboseMode:    false
  MaxAngleDiff:   0
  MaxSquaredDist: 0
  }

standard_smallclustalg:
 {
  RadiusSizePar:   	3	  #radius of circle in "cm"
  NHitsInClust:		4	  # Max Number of hits in cluster
  Verbose:			false
 }

standard_clustermatchtq:
{
  KSCut: 0.9
  EnableU: true
  EnableV: true
  EnableZ: true
}

standard_dbscanalg_fast:        @local::standard_dbscanalg
standard_dbscanalg_fast.eps:    1.25
standard_dbscanalg_fast.epstwo: 1.75
standard_dbscanalg_fast.Method: 2

jp250L_dbscanalg:                  @local::standard_dbscanalg
jp250L_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
jp250L_houghbasealg:               @local::standard_houghbasealg
jp250L_houghbasealg.MaxLines:      15
jp250L_houghbasealg.MinHits:       3
jp250L_houghbasealg.NumAngleCells: 5000
jp250L_houghbasealg.MaxDistance:   5.0
jp250L_endpointalg:                @local::standard_endpointalg

bo_dbscanalg:                   @local::standard_dbscanalg
bo_fuzzyclusteralg:             @local::standard_fuzzyclusteralg
bo_houghbasealg:                @local::standard_houghbasealg
bo_houghbasealg.MaxLines:       15
bo_houghbasealg.MinHits:        3
bo_houghbasealg.NumAngleCells:  5000
bo_houghbasealg.MaxDistance:    5.0
bo_endpointalg:                 @local::standard_endpointalg
bo_clustercrawleralg:           @local::standard_clustercrawleralg
bo_clustercrawleralg.NumPass: 1
bo_clustercrawleralg.MaxHitsFit: [ 8 ]
bo_clustercrawleralg.MinHits: [ 3 ]
bo_clustercrawleralg.ChgCut: [ 2. ]
bo_clustercrawleralg.WidCut: [ 2. ]
bo_clustercrawleralg.ChiCut: [ 20. ]
bo_clustercrawleralg.MaxWirSkip: [ 25 ]
bo_clustercrawleralg.MinWirAfterSkip: [ 1 ]
bo_clustercrawleralg.KinkChiRat: [ 2. ]
bo_clustercrawleralg.KinkAngCut: [ 0.5 ]
bo_clustercrawleralg.DoMerge:  [ true ]
bo_clustercrawleralg.TimeDelta:  [ 10. ]
bo_clustercrawleralg.FindVertices: [ false ]
bo_clustercrawleralg.HitErrFac: 1.
bo_clustermatchtq:             @local::standard_clustermatchtq

argoneut_dbscanalg:                  @local::standard_dbscanalg
argoneut_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
argoneut_houghbasealg:               @local::standard_houghbasealg
argoneut_houghbasealg.MaxLines:      15
argoneut_houghbasealg.MinHits:       3
argoneut_houghbasealg.NumAngleCells: 5000
argoneut_houghbasealg.MaxDistance:   5.0
argoneut_endpointalg:                @local::standard_endpointalg
argoneut_cornerfinderalg:		      @local::standard_cornerfinderalg
argoneut_clusterparamsalg:       @local::standard_clusterparamsalg
argoneut_clusterparamsalg.HoughBaseAlg: @local::argoneut_houghbasealg
argoneut_clusterparamsalg.HoughBaseAlg.NumAngleCells:       3000
argoneut_clusterparamsalg.HoughBaseAlg.RhoResolutionFactor:       4
argoneut_clusterparamsalg.HoughBaseAlg.MaxLines:       100
argoneut_clusterparamsalg.ChargeCutoffThreshold:  [200,400]
argoneut_clusterparamsalg.ForceRightGoing:   true
argoneut_smallclustalg:	@local::standard_smallclustalg
argoneut_clustermatchtq:             @local::standard_clustermatchtq
argoneut_clustermatchtq.KSCut:              0.5


microboone_dbscanalg:                         @local::standard_dbscanalg_fast
microboone_endpointalg:                       @local::standard_endpointalg
microboone_houghbasealg:                      @local::standard_houghbasealg
microboone_houghbasealg.MaxLines:             20
microboone_houghbasealg.MaxDistance:          1.0
microboone_houghbasealg.MinHits:              5
microboone_houghbasealg.NumAngleCells:        20000
microboone_houghbasealg.DoHoughLineMerge:     1
microboone_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
microboone_fuzzyclusteralg.Threshold          : -20.0
microboone_cornerfinderalg:		      @local::standard_cornerfinderalg
microboone_clusterparamsalg:                  @local::standard_clusterparamsalg
microboone_smallclustalg:	              @local::standard_smallclustalg
microboone_clustercrawleralg:                 @local::standard_clustercrawleralg

microboone_trajclusteralg:                    @local::standard_trajclusteralg
microboone_trajclusteralg.MultHitSep: 3.2
microboone_trajclusteralg.MaxWireSkipNoSignal: 2
microboone_trajclusteralg.MuonTag: [40, 500, 10, 3]
microboone_trajclusteralg.VLAStepSize: 1
microboone_trajclusteralg.Vertex2DCuts: [ 6, 8, 45, 3, 3, 50, 0.6, 50, 0.8, 0.8]

microboone_clustermatchalg:                   @local::standard_clustermatchalg
microboone_clustermergealg:                   @local::standard_clustermergealg
microboone_clustermatchtq:                    @local::standard_clustermatchtq

dune35t_dbscanalg:    @local::standard_dbscanalg_fast
dune35t_dbscanalg.eps:    2.0
dune35t_dbscanalg.epstwo: 2.0
dune35t_houghbasealg: @local::standard_houghbasealg
#dune35t_houghbasealg.DoHoughLineMerge:     1
dune35t_endpointalg:  @local::standard_endpointalg
dune35t_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dune35t_fuzzyclusteralg.HoughBaseAlg:      @local::dune35t_houghbasealg
#dune35t_fuzzyclusteralg.Threshold:         -50.0
dune35t_clustercrawleralg:                 @local::standard_clustercrawleralg
dune35t_clustermatchtq:                    @local::standard_clustermatchtq
dune35t_clustermatchtq.KSCut:              0.7

dunefd_dbscanalg:    @local::standard_dbscanalg_fast
dunefd_houghbasealg: @local::standard_houghbasealg
dunefd_endpointalg:  @local::standard_endpointalg
dunefd_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dunefd_fuzzyclusteralg.HoughBaseAlg:      @local::dunefd_houghbasealg
dunefd_clustercrawleralg:                 @local::standard_clustercrawleralg
dunefd_clustermatchtq:                    @local::standard_clustermatchtq
dunefd_clustermatchtq.KSCut:              0.7


END_PROLOG

BEGIN_PROLOG

standard_trackshowersepalg:
{
  ConeAngle: 15
  CylinderRadius: 20.
  TrackVertexCut: 5.
  CylinderCut: 0.2
  ShowerConeCut: 5.
  RectangleWidth: 1.
  RectangleCut: 0.5
}

standard_showerenergyalg:
{
  UGradient:   7.69985e-06
  UIntercept: -0.0160794
  VGradient:   7.70957e-06
  VIntercept: -0.0160174
  ZGradient:   7.30337e-06
  ZIntercept: -0.0191387
}

dune35t_showerenergy:
{
  # Last updated M Wallbank, 8/8/16
  # LArSoft v06_01_00
  UGradient:   8.1406e-06
  UIntercept: -0.00772234
  VGradient:   7.98303e-06
  VIntercept: -0.00442084
  ZGradient:   7.98278e-06
  ZIntercept: -0.0143167
}

dune35tdata_showerenergy:
{
  # Last updated M Wallbank, 10/4/16
  # Only calculated for the collection plane
  UGradient:   5.88161e-3
  UIntercept: -1.36686
  VGradient:   5.88161e-3
  VIntercept: -1.36686
  ZGradient:   5.88161e-3
  ZIntercept: -1.36686
  # M Wallbank 8/10/16
  # UGradient:   5.53072e-3
  # UIntercept: -33.6764
  # VGradient:   5.53072e-3
  # VIntercept: -33.6764
  # ZGradient:   5.53072e-3
  # ZIntercept: -33.6764
}

dune10kt_showerenergy:
{
  # Last updated M Wallbank, 8/8/16
  # LArSoft v06_00_01
  UGradient:   7.69985e-06
  UIntercept: -0.0160794
  VGradient:   7.70957e-06
  VIntercept: -0.0160174
  ZGradient:   7.30337e-06
  ZIntercept: -0.0191387
}


END_PROLOG

BEGIN_PROLOG

standard_trajcluster:
{
  module_type:          "TrajCluster"
  TrajClusterAlg:       @local::standard_trajclusteralg
  # don't recosntruct a slice if it has more than MaxSliceHits
  MaxSliceHits:     50000
  DoWireAssns: true
  DoRawDigitAssns: false
  SaveAll2DVertices: false
  HitModuleLabel:           "gaushit"
  SpacePointModuleLabel:    "NA"
  SpacePointHitAssnLabel:    "hitpdune"
} # standard_trajcluster

standard_blurredcluster:
{
 module_type:              "BlurredClustering"
 CreateDebugPDF:           false
 MergeClusters:            false
 GlobalTPCRecon:           true
 ShowerReconOnly:          false
 HitsModuleLabel:          "gaushit"
 TrackModuleLabel:         "pmtrack"
 VertexModuleLabel:        "linecluster"
 PFParticleModuleLabel:    "pandora"
 BlurredClusterAlg:        @local::standard_blurredclusteralg
 MergeClusterAlg:          @local::standard_mergeclusteralg
 TrackShowerSeparationAlg: @local::standard_trackshowersepalg
}

standard_clusterpca:
{
 module_type:        "ClusterPCA"
 ClusterModuleLabel: "dbcluster"
 NormPC:             true
}

standard_dbcluster:
{
 module_type:     "DBcluster"
 HitsModuleLabel: "ffthit"
 DBScanAlg:       @local::standard_dbscanalg
}

standard_dbcluster3d:
{
 module_type:                 "DBCluster3D"
 HitModuleLabel:              "hitpdune"
 SpacePointModuleLabel:       "reco3d"
 SPHitAssnLabel:              "hitpdune"
 DBScan3DAlg:                 @local::standard_dbscan3dalg
 MinHitDis:                   10
}

standard_clustercrawler:
{
 module_type:         "ClusterCrawler"
 ClusterCrawlerAlg:   @local::standard_clustercrawleralg
 CCHitFinderAlg:      @local::standard_cchitfinderalg
}

standard_linecluster:
{
# this is the cluster finding component of former ClusterCrawler
  module_type:          "LineCluster"
  HitFinderModuleLabel: "gaushit"
  DoWireAssns: true
  DoRawDigitAssns: false
  ClusterCrawlerAlg:    @local::standard_clustercrawleralg
} # standard_linecluster


standard_simplelinecluster:
{
# this is the cluster finding component of former ClusterCrawler
  module_type:          "SimpleLineCluster"
  HitFinderModuleLabel: "hitpdune"
  PFParticleModuleLabel: "dbcluster"
  ClusterCrawlerAlg:    @local::standard_clustercrawleralg
} # standard_linecluster

standard_fuzzycluster:
{
 module_type:     "fuzzyCluster"
 HitsModuleLabel: "gaushit"
 HoughSeed:       10      # The user supplied seed the generator uses for the
                         # Hough transform, if it is zero a seed is randomly created
 fuzzyClusterAlg: @local::standard_fuzzyclusteralg
}

standard_cluster3d:
{
  module_type:            "Cluster3D"
  HitFinderModuleLabel:   "gaushit"
  EnableMonitoring:       false
  EnableProduction:       false
  Hit3DBuilderAlg:        @local::standard_standardhit3dbuilder
  ClusterAlg:             @local::standard_cluster3dminSpanTreeAlg
  ClusterMergeAlg:        @local::standard_cluster3dMergeAlg
  ClusterPathAlg:         @local::standard_cluster3dPathAlg
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  SkeletonAlg:            @local::standard_cluster3dskeletonalg
  SeedFinderAlg:          @local::standard_cluster3dhoughseedfinderalg
  PCASeedFinderAlg:       @local::standard_cluster3dpcaseedfinderalg
  ParallelHitsAlg:        @local::standard_cluster3dparallelhitsseedfinderalg
}

standard_clustertrackana:
{
  module_type:              "ClusterTrackAna"
  HitModuleLabel:           "gaushit"
  ClusterModuleLabel:       "trajcluster"   # specify a cluster collection
  TrackModuleLabel:         "NA" # OR specify a track collection
  TruthOrigin:              0 # [0 (everything) 1(nu), 2(cosmic), 3(SN nu), 4(SingleParticle)]
  PrintLevel:               0
  # 0 = job summary, 1 = only BadEP clusters, 2 = all clusters, 3 = all planes, 4 = all MCParticles
  BadEP:                    0.0 # print cluster/track details if Efficiency * Purity is < BadEP
  #InTPC:                    1 # only consider cluster hits or track hits in one TPC (debugging)
}

standard_clusterana:
{
 module_type:              "ClusterAna"
 HitsModuleLabel:          "cccluster"
 ClusterModuleLabel:       "cccluster"
 VertexModuleLabel:        "cccluster"
 ElecKERange:              [50, 10000] # Min, max KE (MeV) for matching Primary only
 MuonKERange:              [50, 10000] # Min, max KE (MeV) for matching
 PionKERange:              [50, 10000] # Min, max KE (MeV) for matching
 KaonKERange:              [50, 10000] # Min, max KE (MeV) for matching
 ProtKERange:              [50, 10000] # Min, max KE (MeV) for matching
 TrackWeightOption:        1 # 0 = equal weighting, 1 = weight by kinetic energy
 MergeDaughters:           true # merge daughter MC particles with mothers (not electrons)
 SkipCosmics:              true # do not evaluate cosmic rays
 PrintLevel:               0 # 0 = none, 1 = event summary, 2 += each MC particle, 3 += truth
}

standard_clusteringvalidation:
{
 module_type:        "ClusteringValidation"
 MinHitsInPlane:     0
 HitsModuleLabel:    "dcheat"
 ClusterModuleLabel: [ "dbcluster", "blurredclustering" ]
}

standard_dbclusterana:
{
 module_type:              "DBclusterAna"
 DigitModuleLabel:         "daq"
 HitsModuleLabel:          "ffthit"
 LArGeantModuleLabel:      "largeant"
 CalDataModuleLabel:       "caldata"
 GenieGenModuleLabel:      "generator"
 ClusterFinderModuleLabel: "dbcluster"
}

standard_houghlinefinder:
{
 module_type:          "HoughLineFinder"
 DBScanModuleLabel:    "dbcluster"
 HoughSeed:       0      # The user supplied seed the generator uses for the
                         # Hough transform, if it is zero a seed is randomly created
 MaxLines:             5
 MinHits:              3
 SaveAccumulator:      0
 NumAngleCells:        5000
 RhoResolutionFactor:  5
 SmootherSigma:        0.
 MaxDistance:          5.
 RhoZeroOutRange:      0
 ThetaZeroOutRange:    0
 HitsPerCluster:       1
 HoughBaseAlg:         @local::standard_houghbasealg
}

standard_houghlinefinderana:
{
 module_type:         "HoughLineFinderAna"
 DigitModuleLabel:    "wiresim"
 HitsModuleLabel:     "ffthit"
 DBScanModuleLabel:   "fuzzycluster"
 HoughModuleLabel:    "hough"
}

standard_linemerger:
{
 module_type:        "LineMerger"
 ClusterModuleLabel: "hough"
 Slope:              0.35
 EndpointWindow:     50.
}

standard_endpointmod:
{
 module_type:       "EndPointModule"
 DBScanModuleLabel: "fuzzycluster"
 EndPointAlg:       @local::standard_endpointalg
}

standard_kingacluster:
{
 module_type:          "KingaCluster"
 DBScanModuleLabel:    "dbcluster"
 EndPoint2DModuleLabel: "vertex2d"
}

standard_kingaclusterana:
{
 module_type:               "KingaClusterAna"
 LineMergerModuleLabel:     "linemerger"
 EndPoint2DModuleLabel:     "vertex2d"
 ClusterCheaterModuleLabel: "cluster"
 KingaModuleLabel:          "kingacluster"
 GenieGenModuleLabel:       "generator"
 LArGeantModuleLabel:       "largeant"
}

standard_showeranglecluster:
{
 module_type:              "ShowerAngleCluster"
 ClusterModuleLabel:       "dbcluster"
 ClusterParamsAlg: 	   @local::standard_clusterparamsalg
 ClusterMatchAlg:          @local::standard_clustermatchalg
 ClusterMergeAlg:          @local::standard_clustermergealg
 ExternalStartPoints:	   false
 MinHitListSize:	  15
}


standard_showerangleclusterana:
{
 module_type:              "ShowerAngleClusterAna"
 ClusterModuleLabel:       "dbcluster"
 ClusterParamsAlg: 	   @local::standard_clusterparamsalg
 ExternalStartPoints:	   false
 MinHitListSize:	  15
}

standard_simpleclustermerger:
{
 module_type:       "SimpleClusterMerger"
 InputClusterLabel: "fuzzycluster"
}


standard_fuzzyclustermerger:
{
 module_type:       "FuzzyClusterMerger"
 InputClusterLabel: "fuzzycluster"
 TSep1UseEP:  true
 OOCS1MaxAngle:   20.     # OutOfConeSeparate 1st stage

 SDMinHits:      10.     # CBAlgoShortestDist # SetMinHits; SetSquaredDistanceCut
 SDSqDistCut:     5.

 # 2nd stage merge
#TSep2Debug:         false      # CBAlgoTrackSeparate // SetDebug(false); SetVerbose(false); SetUseEP(true);
# TSep2Verbose:          false
 TSep2UseEP:        true

# OOCS2Debug:         false        # CBAlgoOutOfConeSeparate // SetDebug(false); SetVerbose(false); SetMaxAngleSep(20.);
# OOCS2Verbose:       false
 OOCS2MaxAngle:      20.

 AI2MinHits:         50            # CBAlgoAngleIncompat // SetMinHits(50); SetAllow180Ambig(true); SetUseOpeningAngle(false);
 AI2Allow180Ambig:   true         #                     // SetAngleCut(10.); SetMinLength(20.); SetDebug(false);
 AI2UseOpeningAngle: false
 AI2AngleCut:        10.
 AI2MinLength:       20.
# AI2Debug:           false

# COM2Debug:         false      # CBAlgoCenterOfMass // SetDebug(false); SetVerbose(false); UseCOMInPoly(true);
# COM2Verbose:       false      # 		 	   //	UseCOMInCone(true); UseCOMNearClus(true); SetLengthReach(3.);
 COM2UseCOMInPoly:  true
 COM2UseCOMInCone:  true
 COM2UseCOMNearClus: true
 COM2SetLengthReach:  3.

 PO2MinHits:        0          # CBAlgoPolyOverlap  // SetMinNumHits(0);

 PSD2MinHits:        30        # CCBAlgoPolyShortestDist; // SetMinNumHits(30); SetMaxNumHits(9999); SetMinDistSquared(1.); SetDebug(false);
 PSD2MaxHits:        9999
 PSD2MinDistSqd:    1




}


standard_smallclusterfinder:
{
 module_type:			"SmallClusterFinder"
 HitFinderModuleLabel:	"hitfinder"
 smallClustAlg:			@local::standard_smallclustalg
 Verbose:				false
}


standard_clustercheater:
{
 module_type:    	"ClusterCheater"
 MCGeneratorLabel:      "generator"    #needed for MC vertex extraction
 HitModuleLabel: 	"hit"
 G4ModuleLabel:  	"largeant"
 HoughBaseAlg:   	@local::standard_houghbasealg
}

jp250L_dbcluster:                    @local::standard_dbcluster
jp250L_fuzzycluster:                 @local::standard_fuzzycluster
jp250L_fuzzycluster.HoughBaseAlg:    @local::standard_houghbasealg
jp250L_dbcluster.DBScanAlg:          @local::jp250L_dbscanalg
jp250L_dbclusterana:                 @local::standard_dbclusterana
jp250L_kingacluster:                 @local::standard_kingacluster
jp250L_kingaclusterana:              @local::standard_kingaclusterana
jp250L_houghlinefinder:              @local::standard_houghlinefinder
jp250L_houghlinefinder.HoughBaseAlg: @local::jp250L_houghbasealg
jp250L_houghlinefinderana:           @local::standard_houghlinefinderana
jp250L_linemerger:                   @local::standard_linemerger
jp250L_endpointmod:                  @local::standard_endpointmod
jp250L_endpointmod.EndPointAlg:      @local::jp250L_endpointalg
jp250L_showeranglecluster:           @local::standard_showeranglecluster


bo_clustercrawler:               @local::standard_clustercrawler
bo_dbcluster:                    @local::standard_dbcluster
bo_fuzzycluster:                 @local::standard_fuzzycluster
bo_fuzzycluster.HoughBaseAlg:    @local::standard_houghbasealg
bo_dbcluster.DBScanAlg:          @local::bo_dbscanalg
bo_dbclusterana:                 @local::standard_dbclusterana
bo_kingacluster:                 @local::standard_kingacluster
bo_kingaclusterana:              @local::standard_kingaclusterana
bo_houghlinefinder:              @local::standard_houghlinefinder
bo_houghlinefinder.HoughBaseAlg: @local::bo_houghbasealg
bo_houghlinefinderana:           @local::standard_houghlinefinderana
bo_linemerger:                   @local::standard_linemerger
bo_endpointmod:                  @local::standard_endpointmod
bo_endpointmod.EndPointAlg:      @local::bo_endpointalg
bo_showeranglecluster:           @local::standard_showeranglecluster


argoneut_clustercrawler:               @local::standard_clustercrawler
argoneut_dbcluster:                    @local::standard_dbcluster
argoneut_fuzzycluster:                 @local::standard_fuzzycluster
argoneut_fuzzycluster.HoughBaseAlg:    @local::standard_houghbasealg
argoneut_dbcluster.DBScanAlg:          @local::argoneut_dbscanalg
argoneut_dbclusterana:                 @local::standard_dbclusterana
argoneut_kingacluster:                 @local::standard_kingacluster
argoneut_kingaclusterana:              @local::standard_kingaclusterana
argoneut_houghlinefinder:              @local::standard_houghlinefinder
argoneut_houghlinefinder.HoughBaseAlg: @local::argoneut_houghbasealg
argoneut_houghlinefinderana:           @local::standard_houghlinefinderana
argoneut_linemerger:                   @local::standard_linemerger
argoneut_endpointmod:                  @local::standard_endpointmod
argoneut_endpointmod.EndPointAlg:      @local::argoneut_endpointalg
argoneut_showeranglecluster:           @local::standard_showeranglecluster
argoneut_smallclusterfinder:		   @local::standard_smallclusterfinder
argoneut_showerangleclusterana:           @local::standard_showerangleclusterana
argoneut_showerangleclusterana.ClusterParamsAlg:           @local::argoneut_clusterparamsalg

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

dune10kt_calorimetryalgdata:	@local::standard_calorimetryalgdata
dune10kt_calorimetryalgmc:	@local::standard_calorimetryalgmc

dune10kt_calorimetryalgmc.CalAmpConstants:  [ 0.9033e-3, 1.0287e-3, 0.8800e-3 ]
dune10kt_calorimetryalgmc.CalAreaConstants: [ 4.833e-3, 4.815e-3, 4.966e-3 ]

dune10kt_calodata:                       @local::standard_calodata
dune10kt_calodata.CaloAlg:               @local::dune10kt_calorimetryalgdata
dune10kt_calodata.CaloAlg.CaloUseModBox: true

dune10kt_calomc:                         @local::standard_calomc
dune10kt_calomc.CaloAlg:                 @local::dune10kt_calorimetryalgmc
dune10kt_calomc.CaloAlg.CaloUseModBox:   true

END_PROLOG

BEGIN_PROLOG

dune35t_cluster3d:
{
  module_type:            "Cluster3DDUNE35t"
  HitFinderModuleLabel:   "hitrepeater"
  EnableMonitoring:       true
  EnableProduction:       false
  DBScanAlg:              @local::dune35t_cluster3ddbscanalg
  PrincipalComponentsAlg: @local::dune35t_cluster3dprincipalcomponentsalg
  SkeletonAlg:            @local::dune35t_cluster3dskeletonalg
  SeedFinderAlg:          @local::dune35t_cluster3dhoughseedfinderalg
  PCASeedFinderAlg:       @local::dune35t_cluster3dpcaseedfinderalg
  ParallelHitsAlg:        @local::dune35t_cluster3dparallelhitsseedfinderalg

  EpsilonHoughBins:       5
  HoughSpikeThreshold:    20
  NumBinsPhi:             300
  NumBinsRho:             300
  HoughScaleFactor:       10
}

dune_dbscanalg:    @local::standard_dbscanalg_fast
dune_houghbasealg: @local::standard_houghbasealg
dune_endpointalg:  @local::standard_endpointalg 

dune10kt_blurredcluster:             @local::standard_blurredcluster
dune10kt_blurredcluster.BlurredClusterAlg.Detector: "dunefd"
dunefd_dbcluster:                    @local::standard_dbcluster      
dunefd_dbcluster.DBScanAlg:          @local::dunefd_dbscanalg          
dunefd_dbclusterana:                 @local::standard_dbclusterana   
dunefd_fuzzycluster:                 @local::standard_fuzzycluster
dunefd_fuzzycluster.HitsModuleLabel: "gaushit"
dunefd_houghlinefinder:              @local::standard_houghlinefinder
dunefd_houghlinefinder.HoughBaseAlg: @local::dunefd_houghbasealg
dunefd_houghlinefinderana:           @local::standard_houghlinefinderana
dunefd_linemerger:                   @local::standard_linemerger        
dunefd_endpointmod:                  @local::standard_endpointmod       
dunefd_endpointmod.EndPointAlg:      @local::dunefd_endpointalg
dunefd_clustercheater:               @local::standard_clustercheater
dunefd_linecluster:                       @local::standard_linecluster
dunefd_linecluster.ClusterCrawlerAlg:     @local::dunefd_clustercrawleralg

dune35t_blurredcluster:               @local::standard_blurredcluster
dune35t_blurredcluster.BlurredClusterAlg.Detector: "dune35t"
dune35t_dbcluster:                    @local::standard_dbcluster
dune35t_dbcluster.DBScanAlg:          @local::dune35t_dbscanalg
dune35t_dbclusterana:                 @local::standard_dbclusterana
dune35t_fuzzycluster:                 @local::standard_fuzzycluster
dune35t_fuzzycluster.fuzzyClusterAlg: @local::dune35t_fuzzyclusteralg
dune35t_fuzzycluster.HitsModuleLabel: "gaushit" 
dune35t_houghlinefinder:              @local::standard_houghlinefinder
dune35t_houghlinefinder.HoughBaseAlg: @local::dune35t_houghbasealg
dune35t_houghlinefinderana:           @local::standard_houghlinefinderana
dune35t_linemerger:                   @local::standard_linemerger
dune35t_endpointmod:                  @local::standard_endpointmod
dune35t_endpointmod.EndPointAlg:      @local::dune35t_endpointalg
dune35t_clustercheater:               @local::standard_clustercheater
dune35t_linecluster:                       @local::standard_linecluster
dune35t_linecluster.ClusterCrawlerAlg:     @local::dune35t_clustercrawleralg

dune35tdata_linecluster:              @local::dune35t_linecluster
dune35tdata_linecluster.HitFinderModuleLabel:  "hit35t"
dune35tdata_linecluster.ClusterCrawlerAlg.NumPass:               3  # number of passes through the hit list. 0 = no cluster reco
dune35tdata_linecluster.ClusterCrawlerAlg.MaxHitsFit: [ 100,  8, 4] # number of hits fitted to a line
dune35tdata_linecluster.ClusterCrawlerAlg.MinHits:     [ 50,  8, 3] # minimum size of a cluster
dune35tdata_linecluster.ClusterCrawlerAlg.NHitsAve:    [ 20,  8, 2] # number of hits to find the average charge and width
dune35tdata_linecluster.ClusterCrawlerAlg.ChgCut:     [ .8, .8, .8] # max fractional hit charge difference for adding hits
dune35tdata_linecluster.ClusterCrawlerAlg.ChiCut:       [ 4, 8, 10] # stop adding hits to clusters if ChiCut is reached
dune35tdata_linecluster.ClusterCrawlerAlg.MaxWirSkip: [100, 100, 2] # max number of wires to skip without adding a hit
dune35tdata_linecluster.ClusterCrawlerAlg.MinWirAfterSkip: [2, 2, 1] # min reqd number of consecutive wires with a hit after a skip
dune35tdata_linecluster.ClusterCrawlerAlg.KinkChiRat: [1.2, 1.2, 0.] # Max consecutive chisq increase for the last 3 hits on the cluster
dune35tdata_linecluster.ClusterCrawlerAlg.KinkAngCut: [0.4, 0.4, 0.4] # kink angle cut (radians) used to follow or merge
dune35tdata_linecluster.ClusterCrawlerAlg.DoMerge:   [false, true, true] # run cluster merging code?
dune35tdata_linecluster.ClusterCrawlerAlg.TimeDelta: [10., 10., 10.] # max time difference for cluster merging
dune35tdata_linecluster.ClusterCrawlerAlg.MergeChgCut: [0.8, 0.8, 0.8] # max charge ratio for cluster merging
dune35tdata_linecluster.ClusterCrawlerAlg.FindVertices: [true, true, true]  # make 2D vertices after clustering?
dune35tdata_linecluster.ClusterCrawlerAlg.LACrawl: [true, true, true]  # crawl Large Angle clusters?
dune35tdata_linecluster.ClusterCrawlerAlg.LAClusAngleCut:       60 # Large cluster angle cut (0 < 90 degrees). <0 to turn off
dune35tdata_linecluster.ClusterCrawlerAlg.LAClusMaxHitsFit:   		4 # Max hits fit on Large Angle clusters
dune35tdata_linecluster.ClusterCrawlerAlg.MinHitFrac: 				  0.5 # Drop clusters having < (#hits/#wires)
dune35tdata_linecluster.ClusterCrawlerAlg.MinAmp: 				[5, 1, 5] # Min hit signal amplitude for merging per plane
dune35tdata_linecluster.ClusterCrawlerAlg.HitMergeChiCut:        4 # Merge cluster hit-multiplets if the separation chisq
dune35tdata_linecluster.ClusterCrawlerAlg.MergeAllHits:       true # merge all hits before reconstructing clusters
dune35tdata_linecluster.ClusterCrawlerAlg.MergeOverlapAngCut:  0.1 # Set <= 0 to turn off overlapping cluster merging
dune35tdata_linecluster.ClusterCrawlerAlg.ChkClusterDS:      true  # Check reconstruction at DS end of clusters?
dune35tdata_linecluster.ClusterCrawlerAlg.KillGarbageClusters: 0.1 # Kill ghost clusters, etc
dune35tdata_linecluster.ClusterCrawlerAlg.VtxClusterSplit:    true # Split clusters that cross vertices
dune35tdata_linecluster.ClusterCrawlerAlg.FindStarVertices:  false # Find vertices with a star topology
dune35tdata_linecluster.ClusterCrawlerAlg.HitErrFac:           0.8 # hit time error for fitting = fHitErrFac * (hit width)
dune35tdata_linecluster.ClusterCrawlerAlg.HitMinAmp:             2 # ignore hits with PH < this value (seed clusters)
dune35tdata_linecluster.ClusterCrawlerAlg.ClProjErrFac:          3 # cluster projection error factor
dune35tdata_linecluster.ClusterCrawlerAlg.AllowNoHitWire:        5 # Allow skipping N wires w no hits
dune35tdata_linecluster.ClusterCrawlerAlg.Vertex2DCut:          20 # Max equiv dTick cut for attaching a cluster to a vtx
dune35tdata_linecluster.ClusterCrawlerAlg.fVertex2DWireErrCut:	  3 # Max wire error on the fitted vertex position
dune35tdata_linecluster.ClusterCrawlerAlg.Vertex3DCut:          10 # 2D vtx -> 3D vtx matching cut (chisq)
dune35tdata_linecluster.ClusterCrawlerAlg.FindHammerClusters: false # look for hammer type clusters
dune35tdata_linecluster.ClusterCrawlerAlg.RefineVertexClusters:  false

dunefdmc_trajclusteralg:             @local::standard_trajclusteralg
dunefdmc_trajclusteralg.CaloAlg:     @local::dune10kt_calorimetryalgmc
dunefdmc_trajcluster:                @local::standard_trajcluster
dunefdmc_trajcluster.TrajClusterAlg: @local::dunefdmc_trajclusteralg
dunefdmc_trajcluster.HitModuleLabel: "hitfd"

protodunespmc_trajclusteralg:       @local::standard_trajclusteralg
protodunespmc_trajclusteralg.NeutrinoMode: false
protodunespmc_trajclusteralg.HitErrFac:   0.5
protodunespmc_trajclusteralg.MaxWireSkipNoSignal:   5
protodunespmc_trajclusteralg.MultHitSep:  3
protodunespmc_trajclusteralg.AveHitRMS: [ 4.0, 4.7, 4.0 ] # RMS in ticks
protodunespmc_trajclusteralg.Match3DCuts: [ 0.5, 10000, 0, 2, 2.0, 2.5, 1000 ]
# 0 dx (cm) matching cut
# 1 max number of 3-plane matches for any Tj
# 2 Attempt 2-view match?
# 3 min number of TP3Ds in at least 2 planes to fit in each PFP section
# 4 max pull for adding/rejecting TP3Ds in sections
# 5 suggested max ChiDOF for a SectionFit
# 6 don't attempt 3D matching of shower-like Tjs if too many shower-like TPs exist in a slice

protodunespmc_trajclusteralg.AngleRanges: [ 50, 85, 90 ]
protodunespmc_trajclusteralg.VertexScoreWeights: [1, 2, 10, 2]
# 0 = Vertex error weight (<= turn off vertex scoring)
# 1 = 3D match weight
# 2 = Charge fraction of vertex Tjs near the vertex weight
# 3 = Tj MCSMom, ChgRMS, Angle difference significance between Tjs weight
#                                             0  1   2  3  4  5    6   7   8    9
protodunespmc_trajclusteralg.Vertex2DCuts:  [ 6, 8, 45, 3, 3, 50, 0.6, 10, 0.8, 0.8] 
# 0 User definition of a short Tj => max number of Tj points
# 1 max separation between a vertex and the start of a trajectory for a user-defined short Tj
# 2 max separation for a user-defined long Tj
# 3 max position pull when attaching a Tj to a vertex
# 4 max position error for creating a Tj or attaching Tjs to an existing vertex
# 5 Min MCSMom of Tjs that can be used to create a vertex
# 6 min frac of Points/Wire between a vtx and a Tj. Ideally one if the efficiency is good
# 7 min Score (when scoring is enabled)
# 8 Min charge fraction near a merge point (not a vertex)
# 9 max MCSmom asymmetry for a merge
protodunespmc_trajclusteralg.ChargeCuts: [4, 0.15, 0.25]
protodunespmc_trajclusteralg.SkipAlgs:  [ ]
protodunespmc_trajclusteralg.JTMaxHitSep: 5

protodunespmc_trajcluster:                @local::standard_trajcluster
protodunespmc_trajcluster.TrajClusterAlg: @local::protodunespmc_trajclusteralg
protodunespmc_trajcluster.HitModuleLabel: "hitpdune"

protodunespmc_dbcluster3d:                @local::standard_dbcluster3d
protodunespmc_dbcluster3d.DBScan3DAlg.epsilon: 10
protodunespmc_dbcluster3d.DBScan3DAlg.minpts: 2
protodunespmc_dbcluster3d.MinHitDis: 1000

protodunespmc_linecluster:                    @local::standard_linecluster
protodunespmc_linecluster.DoRawDigitAssns:    true
protodunespmc_linecluster.ClusterCrawlerAlg.KinkAngCut: [0.2, 0.2, 0.2] # Max kink angle
END_PROLOG

# The content of this fcl file has been moved to dunetpc/dune/ClusterFinderDUNE/clusterfinder_dune.fcl. TY 6/12/16
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

standard_dataprovideralg:
{
 DriftWindow:          6 # downsampling window (in drift ticks)
 DownscaleFullView: true # downsample full view

 DownscaleFn:     "mean" # "maxpool" takes the max value in the window,
                         # "maxmean" is mean from 3 ADC's around the max,
                         # "mean" is the mean value of all ADC's in the window

 BlurKernel:      []  # apply channel-channel blurring
 NoiseSigma:      0   # apply white noise
 CoherentSigma:   0   # apply coherent noise

 CalorimetryAlg:    @local::standard_calorimetryalgmc  # used to eliminate amplitude variation due to electron lifetime
 CalibrateAmpl:     false # calibrate ADC values with CalAmpConstants (allows different gains in MC and data)
 CalibrateLifetime: true  # calibrate ADC values according to the electron lifetime

 # The following settings allow to scale the interesting ADC range into desired range of values,
 # e.g. convenient for the CNN or for the conversion to decimal type range. Default values
 # provided here will result with the scaling factor of 0.1.
 AdcMax:            150.0 # input saturation max value
 AdcMin:            -50.0 # input saturation min value
 OutMax:             15.0 # output max value
 OutMin:             -5.0 # output min value
}

END_PROLOG

BEGIN_PROLOG

standard_spacepointalg:
{
  MaxDT:      2.0
  MaxS:       0.3
  MinViews:   2
  EnableU:    true
  EnableV:    true
  EnableW:    false
  Filter:     true
  Merge:      false
  PreferColl: false
}

standard_seedfinderalgorithm:
{
  SpacePointAlg:          @local::standard_spacepointalg
  InitSeedLength:         2
  MinPointsInSeed:        4
  Refits:                 5
  HitResolution:          1
  OccupancyCut:           0.8
  MaxViewRMS:             [2,2,2]
  ExtendSeeds:            true
  LengthCut:              0
}
standard_seedfinderalgorithm.SpacePointAlg.Filter: false

standard_projectionmatchingalg:
{
  OptimizationEps:        0.01    # relative change of the obj.fn which stops optimization after adding a node
  FineTuningEps:          0.0001  # relative change of the obj.fn which stops fine-tuning of optimized track
  TrkValidationDist2D:    1.0     # max. distance [cm] used in the track validation in the "third" plane
  HitTestingDist2D:       0.5     # max. distance [cm] used in testing compatibility of hits with the track
  MinTwoViewFraction:     0.4     # min. fraction of track length covered with hits from many 2D views intertwinted with each other
  NodeMargin3D:           3.0     # margin in [cm] around TPC for allowed track node positions
  HitWeightZ:             1.0     # weights used for hits in U, V, Z planes:
  HitWeightV:             1.0     #    - use lower values for planes where hit position is less reliable (e.g. due to S/N)
  HitWeightU:             1.0     #    - relative ratios matter, sum does not need to be 1.0
}

standard_pmalgtracker:
{
  MinSeedSize1stPass:     20      # min. cluster size used to start building a track in the 1st pass
  MinSeedSize2ndPass:     4       # ..and in the 2nd pass: differentiate to speed up finding long tracks
                                  # w/o checking large number of possibilities, then use as small size
                                  # as reasonnable for used clustering algorithm to complete the search
                                  # in the second pass
  TrackLikeThreshold:     0.0     # CNN output threshold for track-like recognition; ClusterModuleLabel
                                  # needs to be associated to CNN outputs in case of threshold > 0; will
                                  # exclude obvious EM from tracking and tag clean electron tracks as PDG=11
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
                                  #
  FlipToBeam:             false   # set the track direction to increasing Z values
  FlipDownward:           false   # set the track direction to decreasing Y values (like cosmic rays)
  FlipToX:             	  false   # set the track direction to decreasing X values (like cosmic rays in dual phase)
  AutoFlip_dQdx:          false   # set the track direction to increasing dQ/dx (overrides FlipToBeam,
                                  # FlipDownward and FlipToX if significant rise of dQ/dx at the track end)
                                  #
  MergeWithinTPC:         false   # merge witnin single TPC; finds tracks best matching by angle, with limits:
  MergeTransverseShift:   2.0     #    - max. transverse displacement [cm] between tracks
  MergeAngle:             2.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  StitchBetweenTPCs:      true    # stitch between TPCs; finds tracks best matching by angle, with limits:
  StitchDistToWall:       3.0     #    - max. track endpoint distance [cm] to TPC boundary
  StitchTransverseShift:  3.0     #    - max. transverse displacement [cm] between tracks
  StitchAngle:           10.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  MatchT0inAPACrossing:   false   # match T0 of APA-crossing tracks using PMAlgStitcher
  MatchT0inCPACrossing:   false   # match T0 of CPA-crossing tracks using PMAlgStitcher

  Validation:             "hits"  # "hits":   uses hits to validate track
                                  # "adc":   uses adc image to validate tracks
                                  # "calib": uses hits to validate tracks and produce histograms to find adc thresholds
                                  #          which should be used in "adc" mode
  AdcValidationThr:       [1.0, 1.0, 1.0]    # threshold for not-empty pixel in the ADC image used for the track validation, per plane
  AdcImageAlg:            @local::standard_dataprovideralg
}

standard_pmalgfitter:
{
  TrackingOnlyPdg:        [0]     # PDG list to select which PFParticles should be reconstructed;
                                  # all PFP's are used if the list is empty or starts with 0
  TrackingSkipPdg:        [0]    # PDG list to select which PFParticles should NOT be reconstructed,
                                  # e.g. skip EM showers; no skipping if the list is empty or starts with 0
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
}

standard_beziertrackeralgorithm:
{	
  OverlapCut:            0.2
  DirectJoinDistance:    10.0
  TrackJoinAngle:        0.5          
  VertexImpactThreshold: 2.0
  VertexExtrapDistance:  5.0
  OccupancyThresh:       0.8
  TrackResolution:       2.0
  SeedFinder:            @local::standard_seedfinderalgorithm

}
standard_beziertrackeralgorithm.SeedFinder.LengthCut: 2

standard_trackstitcheralg:
{
  CosAngTolerance: 0.98
  SpptSepTolerance: 30.0 # cm
  CommonComponentStitch: true
}

standard_kalmanfilteralg:
{
  Trace: false
  MaxPErr: 0.25      # Maximum pointing error for free propagation.
  GoodPErr: 0.1      # Pointing error threshold for switching from linearized to free propataion.
  MaxIncChisq: 10.   # Incremental chisquare cut.
  MaxSeedIncChisq: 1000.  # Incremental chisquare cut in seed phase.
  MaxSmoothIncChisq: 100. # Incremental chisquare cut in smooth phase.
  MaxEndChisq: 10.   # Maximum incremental chisquare for endpoint hit.
  MinLHits: 20       # Minimum number of measurements for linearized propagation.
  MaxLDist: 10.      # Maximum distance to use linearized propagation using starting guess.
  MaxPredDist: 5.    # Maximum prediction distance to accept a hit.
  MaxSeedPredDist: 50. # Maximum prediction distance to accept a hit in seed phase.
  MaxPropDist: 50.   # Maximum propagation distance to candidate surface.
  MinSortDist: 0.    # Low threshold to resort hits.
  MaxSortDist: 2.    # High threshold to resort hits.
  MaxSamePlane: 3    # Maximum consecutive hits in same plane.
  GapDist: 3.        # Minimum gap distance.
  MaxNoiseHits: 3    # Maximum number of hits in noise cluster.
  MinSampleDist: 20. # Minimum sample distance (for momentum measurement).
  FitMomRange: true  # Fit momentum using range.
  FitMomMS: false    # Fit momentum using multiple scattering.

  # Graphical trace options.
  # For any kine of graphical tracing to work, you need to configure
  # the event display service to initialize the graphics system.

  GTrace: false      # Graphical trace flag.
  GTraceWW: 1200     # Window width (pixels).
  GTraceWH: 800      # Window height (pixels).
  GTraceXMin: -256.  # Graphical trace minimum x (same for each view).
  GTraceXMax: 512.   # Graphical trace maximum x (same for each view).
  GTraceZMin: [    0.,    0.,    0.]  # Graphical trace minimum z for each view.
  GTraceZMax: [ 1040., 1040., 1040.]  # Graphical trace maximum z for each view
}

standard_track3Dkalmanhitalg:
{
  MaxTcut:            10.           # Maximum delta ray energy in MeV for restricted dE/dx
  DoDedx:             false         # dE/dx enable flag.
  SelfSeed:           false         # Generate seeds internally.
  LineSurface:        false         # Store hits on line surfaces.
  MinSeedHits:        12            # Minimum number of hits per track seed.
  MinSeedChopHits:    50            # Potentially chop seeds that exceed this length.
  MaxChopHits:        20            # Maximum number of hits to chop from each end of seed.
  MaxSeedChiDF:       20.           # Maximum seed track chisquare/dof.
  MinSeedSlope:       0.0           # Minimum seed slope (dx/dz).
  InitialMomentum:    0.5           # Initial momentum (GeV/c).
  KalmanFilterAlg:    @local::standard_kalmanfilteralg
  SeedFinderAlg:      @local::standard_seedfinderalgorithm
}

standard_cosmictrackeralg:
{
    SPTAlg:   0
    TrajOnly: false
    TMatch:   2.5
    SMatch:   1
}

argoneut_spacepointalg:      @local::standard_spacepointalg
argoneut_kalmanfilteralg:    @local::standard_kalmanfilteralg
argoneut_cosmictrackeralg:   @local::standard_cosmictrackeralg
argoneut_cosmictrackeralg.SPTAlg:   1
argoneut_cosmictrackeralg.TrajOnly: true

bo_spacepointalg: @local::standard_spacepointalg
bo_spacepointalg.MinViews: 2
bo_spacepointalg.EnableW:  true
bo_kalmanfilteralg:          @local::standard_kalmanfilteralg
bo_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
bo_seedfinderalgorithm.SpacePointAlg :           @local::bo_spacepointalg
bo_seedfinderalgorithm.SpacePointAlg.PreferColl: true
bo_seedfinderalgorithm.SpacePointAlg.Filter:     false
bo_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
bo_beziertrackeralgorithm.SeedFinder:            @local::bo_seedfinderalgorithm

microboone_spacepointalg:                                @local::standard_spacepointalg
microboone_spacepointalg.MinViews:                       3
microboone_spacepointalg.EnableW:                        true
microboone_kalmanfilteralg:                              @local::standard_kalmanfilteralg
microboone_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
microboone_seedfinderalgorithm.SpacePointAlg : {
  @table::microboone_spacepointalg
  PreferColl: true
  Filter:     false
}
microboone_track3Dkalmanhitalg: {
  @table::standard_track3Dkalmanhitalg
  KalmanFilterAlg: @local::microboone_kalmanfilteralg
  SeedFinderAlg:   @local::microboone_seedfinderalgorithm
}
microboone_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
microboone_beziertrackeralgorithm.SeedFinder:            @local::microboone_seedfinderalgorithm
microboone_trackstitcheralg:  @local::standard_trackstitcheralg

dune10kt_spacepointalg:          @local::standard_spacepointalg
dune10kt_spacepointalg.MinViews: 3
dune10kt_spacepointalg.EnableW:  true
dune10kt_kalmanfilteralg:        @local::standard_kalmanfilteralg
dune34kt_spacepointalg:          @local::dune10kt_spacepointalg
dune34kt_kalmanfilteralg:        @local::dune10kt_kalmanfilteralg
dune35t_spacepointalg: @local::standard_spacepointalg
dune35t_spacepointalg.MinViews:  3
dune35t_spacepointalg.EnableW:   true
dune35t_kalmanfilteralg:         @local::standard_kalmanfilteralg
dune35t_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
dune35t_seedfinderalgorithm.SpacePointAlg :           @local::dune35t_spacepointalg
dune35t_seedfinderalgorithm.SpacePointAlg.PreferColl: true
dune35t_seedfinderalgorithm.SpacePointAlg.Filter:     false


END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

standard_dataprovideralg:
{
 DriftWindow:          6 # downsampling window (in drift ticks)
 DownscaleFullView: true # downsample full view

 DownscaleFn:     "mean" # "maxpool" takes the max value in the window,
                         # "maxmean" is mean from 3 ADC's around the max,
                         # "mean" is the mean value of all ADC's in the window

 BlurKernel:      []  # apply channel-channel blurring
 NoiseSigma:      0   # apply white noise
 CoherentSigma:   0   # apply coherent noise

 CalorimetryAlg:    @local::standard_calorimetryalgmc  # used to eliminate amplitude variation due to electron lifetime
 CalibrateAmpl:     false # calibrate ADC values with CalAmpConstants (allows different gains in MC and data)
 CalibrateLifetime: true  # calibrate ADC values according to the electron lifetime

 # The following settings allow to scale the interesting ADC range into desired range of values,
 # e.g. convenient for the CNN or for the conversion to decimal type range. Default values
 # provided here will result with the scaling factor of 0.1.
 AdcMax:            150.0 # input saturation max value
 AdcMin:            -50.0 # input saturation min value
 OutMax:             15.0 # output max value
 OutMin:             -5.0 # output min value
}

END_PROLOG

BEGIN_PROLOG

standard_spacepointalg:
{
  MaxDT:      2.0
  MaxS:       0.3
  MinViews:   2
  EnableU:    true
  EnableV:    true
  EnableW:    false
  Filter:     true
  Merge:      false
  PreferColl: false
}

standard_seedfinderalgorithm:
{
  SpacePointAlg:          @local::standard_spacepointalg
  InitSeedLength:         2
  MinPointsInSeed:        4
  Refits:                 5
  HitResolution:          1
  OccupancyCut:           0.8
  MaxViewRMS:             [2,2,2]
  ExtendSeeds:            true
  LengthCut:              0
}
standard_seedfinderalgorithm.SpacePointAlg.Filter: false

standard_projectionmatchingalg:
{
  OptimizationEps:        0.01    # relative change of the obj.fn which stops optimization after adding a node
  FineTuningEps:          0.0001  # relative change of the obj.fn which stops fine-tuning of optimized track
  TrkValidationDist2D:    1.0     # max. distance [cm] used in the track validation in the "third" plane
  HitTestingDist2D:       0.5     # max. distance [cm] used in testing compatibility of hits with the track
  MinTwoViewFraction:     0.4     # min. fraction of track length covered with hits from many 2D views intertwinted with each other
  NodeMargin3D:           3.0     # margin in [cm] around TPC for allowed track node positions
  HitWeightZ:             1.0     # weights used for hits in U, V, Z planes:
  HitWeightV:             1.0     #    - use lower values for planes where hit position is less reliable (e.g. due to S/N)
  HitWeightU:             1.0     #    - relative ratios matter, sum does not need to be 1.0
}

standard_pmalgtracker:
{
  MinSeedSize1stPass:     20      # min. cluster size used to start building a track in the 1st pass
  MinSeedSize2ndPass:     4       # ..and in the 2nd pass: differentiate to speed up finding long tracks
                                  # w/o checking large number of possibilities, then use as small size
                                  # as reasonnable for used clustering algorithm to complete the search
                                  # in the second pass
  TrackLikeThreshold:     0.0     # CNN output threshold for track-like recognition; ClusterModuleLabel
                                  # needs to be associated to CNN outputs in case of threshold > 0; will
                                  # exclude obvious EM from tracking and tag clean electron tracks as PDG=11
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
                                  #
  FlipToBeam:             false   # set the track direction to increasing Z values
  FlipDownward:           false   # set the track direction to decreasing Y values (like cosmic rays)
  FlipToX:             	  false   # set the track direction to decreasing X values (like cosmic rays in dual phase)
  AutoFlip_dQdx:          false   # set the track direction to increasing dQ/dx (overrides FlipToBeam,
                                  # FlipDownward and FlipToX if significant rise of dQ/dx at the track end)
                                  #
  MergeWithinTPC:         false   # merge witnin single TPC; finds tracks best matching by angle, with limits:
  MergeTransverseShift:   2.0     #    - max. transverse displacement [cm] between tracks
  MergeAngle:             2.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  StitchBetweenTPCs:      true    # stitch between TPCs; finds tracks best matching by angle, with limits:
  StitchDistToWall:       3.0     #    - max. track endpoint distance [cm] to TPC boundary
  StitchTransverseShift:  3.0     #    - max. transverse displacement [cm] between tracks
  StitchAngle:           10.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  MatchT0inAPACrossing:   false   # match T0 of APA-crossing tracks using PMAlgStitcher
  MatchT0inCPACrossing:   false   # match T0 of CPA-crossing tracks using PMAlgStitcher

  Validation:             "hits"  # "hits":   uses hits to validate track
                                  # "adc":   uses adc image to validate tracks
                                  # "calib": uses hits to validate tracks and produce histograms to find adc thresholds
                                  #          which should be used in "adc" mode
  AdcValidationThr:       [1.0, 1.0, 1.0]    # threshold for not-empty pixel in the ADC image used for the track validation, per plane
  AdcImageAlg:            @local::standard_dataprovideralg
}

standard_pmalgfitter:
{
  TrackingOnlyPdg:        [0]     # PDG list to select which PFParticles should be reconstructed;
                                  # all PFP's are used if the list is empty or starts with 0
  TrackingSkipPdg:        [0]    # PDG list to select which PFParticles should NOT be reconstructed,
                                  # e.g. skip EM showers; no skipping if the list is empty or starts with 0
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
}

standard_beziertrackeralgorithm:
{	
  OverlapCut:            0.2
  DirectJoinDistance:    10.0
  TrackJoinAngle:        0.5          
  VertexImpactThreshold: 2.0
  VertexExtrapDistance:  5.0
  OccupancyThresh:       0.8
  TrackResolution:       2.0
  SeedFinder:            @local::standard_seedfinderalgorithm

}
standard_beziertrackeralgorithm.SeedFinder.LengthCut: 2

standard_trackstitcheralg:
{
  CosAngTolerance: 0.98
  SpptSepTolerance: 30.0 # cm
  CommonComponentStitch: true
}

standard_kalmanfilteralg:
{
  Trace: false
  MaxPErr: 0.25      # Maximum pointing error for free propagation.
  GoodPErr: 0.1      # Pointing error threshold for switching from linearized to free propataion.
  MaxIncChisq: 10.   # Incremental chisquare cut.
  MaxSeedIncChisq: 1000.  # Incremental chisquare cut in seed phase.
  MaxSmoothIncChisq: 100. # Incremental chisquare cut in smooth phase.
  MaxEndChisq: 10.   # Maximum incremental chisquare for endpoint hit.
  MinLHits: 20       # Minimum number of measurements for linearized propagation.
  MaxLDist: 10.      # Maximum distance to use linearized propagation using starting guess.
  MaxPredDist: 5.    # Maximum prediction distance to accept a hit.
  MaxSeedPredDist: 50. # Maximum prediction distance to accept a hit in seed phase.
  MaxPropDist: 50.   # Maximum propagation distance to candidate surface.
  MinSortDist: 0.    # Low threshold to resort hits.
  MaxSortDist: 2.    # High threshold to resort hits.
  MaxSamePlane: 3    # Maximum consecutive hits in same plane.
  GapDist: 3.        # Minimum gap distance.
  MaxNoiseHits: 3    # Maximum number of hits in noise cluster.
  MinSampleDist: 20. # Minimum sample distance (for momentum measurement).
  FitMomRange: true  # Fit momentum using range.
  FitMomMS: false    # Fit momentum using multiple scattering.

  # Graphical trace options.
  # For any kine of graphical tracing to work, you need to configure
  # the event display service to initialize the graphics system.

  GTrace: false      # Graphical trace flag.
  GTraceWW: 1200     # Window width (pixels).
  GTraceWH: 800      # Window height (pixels).
  GTraceXMin: -256.  # Graphical trace minimum x (same for each view).
  GTraceXMax: 512.   # Graphical trace maximum x (same for each view).
  GTraceZMin: [    0.,    0.,    0.]  # Graphical trace minimum z for each view.
  GTraceZMax: [ 1040., 1040., 1040.]  # Graphical trace maximum z for each view
}

standard_track3Dkalmanhitalg:
{
  MaxTcut:            10.           # Maximum delta ray energy in MeV for restricted dE/dx
  DoDedx:             false         # dE/dx enable flag.
  SelfSeed:           false         # Generate seeds internally.
  LineSurface:        false         # Store hits on line surfaces.
  MinSeedHits:        12            # Minimum number of hits per track seed.
  MinSeedChopHits:    50            # Potentially chop seeds that exceed this length.
  MaxChopHits:        20            # Maximum number of hits to chop from each end of seed.
  MaxSeedChiDF:       20.           # Maximum seed track chisquare/dof.
  MinSeedSlope:       0.0           # Minimum seed slope (dx/dz).
  InitialMomentum:    0.5           # Initial momentum (GeV/c).
  KalmanFilterAlg:    @local::standard_kalmanfilteralg
  SeedFinderAlg:      @local::standard_seedfinderalgorithm
}

standard_cosmictrackeralg:
{
    SPTAlg:   0
    TrajOnly: false
    TMatch:   2.5
    SMatch:   1
}

argoneut_spacepointalg:      @local::standard_spacepointalg
argoneut_kalmanfilteralg:    @local::standard_kalmanfilteralg
argoneut_cosmictrackeralg:   @local::standard_cosmictrackeralg
argoneut_cosmictrackeralg.SPTAlg:   1
argoneut_cosmictrackeralg.TrajOnly: true

bo_spacepointalg: @local::standard_spacepointalg
bo_spacepointalg.MinViews: 2
bo_spacepointalg.EnableW:  true
bo_kalmanfilteralg:          @local::standard_kalmanfilteralg
bo_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
bo_seedfinderalgorithm.SpacePointAlg :           @local::bo_spacepointalg
bo_seedfinderalgorithm.SpacePointAlg.PreferColl: true
bo_seedfinderalgorithm.SpacePointAlg.Filter:     false
bo_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
bo_beziertrackeralgorithm.SeedFinder:            @local::bo_seedfinderalgorithm

microboone_spacepointalg:                                @local::standard_spacepointalg
microboone_spacepointalg.MinViews:                       3
microboone_spacepointalg.EnableW:                        true
microboone_kalmanfilteralg:                              @local::standard_kalmanfilteralg
microboone_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
microboone_seedfinderalgorithm.SpacePointAlg : {
  @table::microboone_spacepointalg
  PreferColl: true
  Filter:     false
}
microboone_track3Dkalmanhitalg: {
  @table::standard_track3Dkalmanhitalg
  KalmanFilterAlg: @local::microboone_kalmanfilteralg
  SeedFinderAlg:   @local::microboone_seedfinderalgorithm
}
microboone_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
microboone_beziertrackeralgorithm.SeedFinder:            @local::microboone_seedfinderalgorithm
microboone_trackstitcheralg:  @local::standard_trackstitcheralg

dune10kt_spacepointalg:          @local::standard_spacepointalg
dune10kt_spacepointalg.MinViews: 3
dune10kt_spacepointalg.EnableW:  true
dune10kt_kalmanfilteralg:        @local::standard_kalmanfilteralg
dune34kt_spacepointalg:          @local::dune10kt_spacepointalg
dune34kt_kalmanfilteralg:        @local::dune10kt_kalmanfilteralg
dune35t_spacepointalg: @local::standard_spacepointalg
dune35t_spacepointalg.MinViews:  3
dune35t_spacepointalg.EnableW:   true
dune35t_kalmanfilteralg:         @local::standard_kalmanfilteralg
dune35t_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
dune35t_seedfinderalgorithm.SpacePointAlg :           @local::dune35t_spacepointalg
dune35t_seedfinderalgorithm.SpacePointAlg.PreferColl: true
dune35t_seedfinderalgorithm.SpacePointAlg.Filter:     false


END_PROLOG
##include "cluster3dpathfindingtools.fcl"

BEGIN_PROLOG

standard_cluster3dkdTree:
{
  EnableMonitoring:  true    # enable monitoring of functions
  PairSigmaPeakTime: 3.      # "sigma" multiplier on peak time
  RefLeafBestDist:   0.5     # Initial distance once reference leaf found
}

standard_standardhit3dbuilder:
{
  tool_type:            StandardHit3DBuilder
  HitFinderTagVec:      ["gaushit"]
  EnableMonitoring:     true  # enable monitoring of functions
  NumSigmaPeakTime:     1.5   # Number "sigma" for peak times when building hits
  HitWidthScaleFactor:  6.    #
  DeltaPeakTimeSig:     1.7   # "Significance" of agreement between 2 hit peak times
  WirePitchScaleFactor: 1.9
  MaxHitChiSquare:      6.0
  OutputHistograms:     false
}

standard_spacepointhit3dbuilder:
{
  tool_type:               SpacePointHit3DBuilder
  SpacePointProducerLabel: "SpacePointSolver"
  HitProducerLabel:        "gaushit"
  EnableMonitoring:        true  # enable monitoring of functions
  MaxHitChiSquare:         6.0
  OutputHistograms:        false
}

standard_cluster3dprincipalcomponentsalg:
{
  ParallelLines:        0.00001 # delta theta to be parallel
}

standard_cluster3dParamsBuilder:
{
  tool_type:                ClusterParamsBuilder
  ClusterMinHits:           3
  ClusterMinUniqueFraction: 0.5
  ClusterMaxLostFraction:   0.5
  PrincipalComponentsAlg:   @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dMergeAlg:
{
  tool_type:              ClusterMergeAlg
  EnableMonitoring:       true    # enable monitoring of functions
  AxisAngleScaleFactor:   5.
  MinTransEigenVal:       0.09
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3ddbscanalg:
{
  tool_type:              DBScanAlg
  EnableMonitoring:       true    # enable monitoring of functions
  MinPairPts:             2       # minimum number of hit pairs for DBScan to consider
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dminSpanTreeAlg:
{
  tool_type:              MinSpanTreeAlg
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dskeletonalg:
{
  MinimumDeltaTicks:      0.05  # minimum delta time (in ticks) when matching hits
  MaximumDeltaTicks:      10.0  # maximum delta time (in ticks) when matching hits
}

standard_cluster3dhoughseedfinderalg:
{
  Minimum3DHits:            5      # Minimum number 3D hits to run transform
  ThetaBins:              360      # Number of bins in theta (pi)
  HalfRhoBins:             75      # Half of the number of bins in rho
  HiThresholdMin:           5      # Minimum value for hi threshold in hough scan
  HiThresholdFrac:       0.05      # Fraction of total hits for hi threshold
  LoThresholdFrac:       0.85      # Fraction of peak bin count for lo threshold
  NumSeed2DHits:           80      # number of 2D hits in the seed
  NumAveDocas:             6.      # number of "docas" from axis to accept hits
  NumSkippedHits:          10      # number hits allowed to be skipped for seed hits
  MaxLoopsPerCluster:       3      # Maximum number of loops to search for tracks
  MaximumGap:              5.      # Maximum gap in arc length for seed hits
  DisplayHoughHist:       false
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dpcaseedfinderalg:
{
  GapDistance:             5.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  MinAllowedCosAng:       0.7      # minimum angle allowed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dparallelhitsseedfinderalg:
{
  MaxNumEdgeHits:        1000      # Maximum number hits each end of PCA axis
  GapDistance:            20.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dPathAlg:
{
  tool_type:              ClusterPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_voronoiPathAlg:
{
  tool_type:              VoronoiPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_convexhullPathAlg:
{
  tool_type:              ConvexHullPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_MSTPathAlg:
{
  tool_type:              MSTPathFinder
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

microboone_standardhit3dbuilder:               @local::standard_standardhit3dbuilder
microboone_spacepointhit3dbuilder:             @local::standard_spacepointhit3dbuilder
microboone_cluster3dMergeAlg:                  @local::standard_cluster3dMergeAlg
microboone_cluster3dPathAlg:                   @local::standard_cluster3dPathAlg
microboone_voronoiPathAlg:                     @local::standard_voronoiPathAlg
microboone_cluster3ddbscanalg:                 @local::standard_cluster3ddbscanalg
microboone_cluster3dminSpanTreeAlg:            @local::standard_cluster3dminSpanTreeAlg
microboone_cluster3dprincipalcomponentsalg:    @local::standard_cluster3dprincipalcomponentsalg
microboone_cluster3dskeletonalg:               @local::standard_cluster3dskeletonalg 
microboone_cluster3dhoughseedfinderalg:        @local::standard_cluster3dhoughseedfinderalg 
microboone_cluster3dpcaseedfinderalg:          @local::standard_cluster3dpcaseedfinderalg
microboone_cluster3dparallelhitsseedfinderalg: @local::standard_cluster3dparallelhitsseedfinderalg
microboone_cluster3dkdtree:                    @local::standard_cluster3dkdTree

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG
BEGIN_PROLOG
mcsfitproducer: {
  module_type:  MCSFitProducer
  inputs: {
        inputLabel: @nil
  }
  fitter: {
  	pIdHypothesis: 13
	minNumSegments: 3
	segmentLength: 14.0
	minHitsPerSegment: 2
	nElossSteps: 10
	eLossMode: 0
	pMin: 0.01
	pMax: 7.50
	pStep: 0.01
	angResol: 3.0
  }
}
END_PROLOG
BEGIN_PROLOG
kalmanfilterfittrackmakertool: {
   tool_type: KalmanFilterFitTrackMaker
   options: {
      defaultMomInGeV: 1.0
      momFromMCSCollection: false
      mcsInputTag: ""
      momFromCombAndPid: false
      contInputTag: ""
      pidFromCollection: false
      pidInputTag: ""
      pidFromLengthCut: -1.
      defaultPdgId: 13
      dirFromVec: false
      dirVec: [0,0,1]
      alwaysInvertDir: false
      keepInputTrajectoryPoints: false
   }
   fitter: {
      useRMSError: true
      sortHitsByPlane: true
      sortHitsByWire: false
      sortOutputHitsMinLength: true
      skipNegProp: true
      cleanZigzag: false
      rejectHighMultHits: false
      rejectHitsNegativeGOF: true
      hitErr2ScaleFact: 1.0
      tryNoSkipWhenFails: true
      tryBothDirs: false
      pickBestHitOnWire: false
      maxResidue: -1.
      maxResidueFirstHit: -1.
      maxChi2: -1.
      maxDist: -1.
      negDistTolerance: 0.
      dumpLevel: 0
   }
   propagator: {
      minStep: 1.0
      maxElossFrac: 0.1
      maxNit: 10
      tcut: 10.
      wrongDirDistTolerance: 0.01
      propPinvErr: false
   }
   mcsfit: @local::mcsfitproducer.fitter
}
END_PROLOG
BEGIN_PROLOG

standard_trajclusteralg:
{
   Mode: 1                  # 1(-1) step from US(DS) to DS(US), 2 = don't use
   NPtsAve: 10              # Number of points to find average charge, Ave chg rms
   MinPtsFit: [3, 3, 3]     # Min number of points in the trajectory fit required on each pass
   MinPts:    [3, 3, 3]     # Min number of points in the trajectory required on each pass
   MaxAngleCode: [0, 1, 2]  # Max angle range code allowed on each pass
   MinMCSMom: [0, 0, 0]   # Minimum MCSMom for each pass
   MaxChi: 20               # Max Chi/DOF for accepting a trajectory fit (long muons)
   HitErrFac: 0.4          # hit time error for fitting = fHitErrFac * (hit RMS)
   MinAmp:  1               # Min amplitude for a wire signal being considered present (must be > 0)
   AngleRanges: [40, 85, 90]  # Max angle (degrees) for small, intermediate and large angle trajectories
   MultHitSep: 2.5          # Hits separated by < MultHitSep * RMS may be combined in a trajectory point
   ChargeCuts: [4, 0.15, 0.25]  # [Max(min) chg pull, Min allowed chg RMS, Max allowed chg RMS]
#   KinkCuts: [0.4, 1.5, 3] # kink angle, MCS kink significance, nPts fit << OLD
   KinkCuts: [ 8, 15, 1, 10 ] # << NEW
   # 0 Number of points to fit at the end of the trajectory
   # 1 Minimum kink significance
   # 2 Use charge in significance calculation? (yes if > 0)
   # 3 3D kink fit length (cm)
   ProjectionErrFactor: 2   # Factor applied to calculated trajectory error
   VLAStepSize: 1.5         # Step size for Very Large Angle trajectories
   JTMaxHitSep: 3           # max hit separation (WSE units) for making Junk Trajectories (<0) turn off
   MaxWireSkipNoSignal:  3  # max allowed number of not-dead wires if no signal is present
   MaxWireSkipWithSignal: 100  # max allowed number of not-dead wires if a signal is present
   QualityCuts: [ 0.8, 3] # Min points/wire, min consecutive pts after a gap
   MuonTag: [40, 500, 40, 3]    # minLength, minMCSMom, maxWireSkip,(min delta-ray length for muon direction tag)
   DeltaRayTag:  [10, 5, 500] # Tag short TJs as delta-rays close to muons [min sep, min MCSMom, max MCSMom]
#               0   1   2   3   4  5    6   7  8  9 10 11 12
   ShowerTag: [ 1, 100, 10, 50, 2.5, 1, 0, 3, 5, 0.7, 1, 10, -13]
# 0 Mode (<= 0 OFF, 1 = tag only, 2 = find showers)
  # 1 Max Tj MCSMom for a shower tag
  # 2 Max separation
  # 3 Min energy (MeV)
  # 4 rms width factor
  # 5 Min shower 1/2 width (WSE units)
  # 6 Min ElectronLikelihood (if > 0)
  # 7 Min Tjs
  # 8 max parent FOM
  # 9 max direction FOM
  # 10 max aspect ratio
  # 11 not used
  # 12 Print 2D showers in plane (0,1,2) or all planes (3) or just 3D matching (4)
   SaveShowerTree: false
   SaveCRTree: false
   TagCosmics: false
   ChkStopCuts: [10, 8, 1.5] # [Min chg slope, nFitPts, Chg fit ChiDOF cut]
   VertexScoreWeights: [1, 2, 10, 2]
    # 0 = Vertex error weight
    # 1 = 3D match weight
    # 2 = Charge fraction of vertex Tjs near the vertex weight
    # 3 = Tj MCSMom, ChgRMS, Angle difference significance between Tjs weight
   Vertex2DCuts:  [6, 8, 45, 3, 3, 50, 0.6, 30, 0.8, 0.8] # << NEW increase min Score
   # 0 User definition of a short Tj => max number of Tj points
   # 1 max separation between a vertex and the start of a trajectory for a user-defined short Tj
   # 2 max separation for a user-defined long Tj
   # 3 max position pull when attaching a Tj to a vertex
   # 4 max position error for creating a Tj or attaching Tjs to an existing vertex
   # 5 Min MCSMom of Tjs that can be used to create a vertex
   # 6 min frac of Points/Wire between a vtx and a Tj. Ideally one if the efficiency is good
   # 7 min Score
   # 8 Min charge fraction near a vertex or merge point
   # 9 max MCSmom asymmetry for a merge
   Vertex3DCuts: [0.8, 2., 3.]
   # 0 dX match cut (cm)
   # 1 dY and dZ match cut (cm)
   # 2 max separation btw PFParticle end and 3D vertex
   Match3DCuts: [ 0.5, 10000, 1, 2, 2.0, 2.5, 1]
   # 0 dx (cm) matching cut
   # 1 max number of 3-plane matches for any Tj
   # 2 Attempt 2-view match?
   # 3 min number of TP3Ds in at least 2 planes to fit in each PFP section
   # 4 max pull for adding/rejecting TP3Ds in sections
   # 5 suggested max ChiDOF for a SectionFit
   # 6 > 0 Don't match muon shower tjs
   PFPStitchCuts: [ 0.02, 3, 2 ]
   # 0 = matching angle resolution (radians)
   # 1 = matching position resolution (cm)
   # 2 = max angle-position figure of merit
   SkipAlgs: [ ]   # List of algs that should not be used
   DebugConfig: []
}
standard_trajclusteralg.CaloAlg: @local::standard_calorimetryalgmc

standard_clustercrawleralg:
{
  NumPass:              3  # number of passes through the hit list. 0 = no cluster reco
  MaxHitsFit: [ 100,  8, 4] # number of hits fitted to a line
  MinHits:    [ 50,  8, 3] # minimum size of a cluster
  NHitsAve:   [ 20,  8, 2] # number of hits to find the average charge and width
                           # at the end of the cluster. NHitsAve should be 1 or 2
  ChgCut:    [ .8, .8, .8] # max fractional hit charge difference for adding hits
  ChiCut:    [ 4, 8, 10] # stop adding hits to clusters if ChiCut is reached
  MaxWirSkip:   [25, 8, 0] # max number of wires to skip without adding a hit
  MinWirAfterSkip: [2, 2, 1] # min reqd number of consecutive wires with a hit after a skip
  KinkChiRat: [1.2, 1.2, 0.] # Max consecutive chisq increase for the last 3 hits on the cluster
                             # 0. = no kink check when following
  KinkAngCut: [0.4, 0.4, 1.5] # kink angle cut (radians) used to follow and merge
  DoMerge:   [false, true, true] # run cluster merging code?
  TimeDelta: [ 8, 8, 20] # max time difference for cluster merging
  MergeChgCut: [0.8, 0.8, 0.8] # max charge ratio for cluster merging
  FindVertices: [true, true, true]  # make 2D vertices after clustering?
  LACrawl:     [true, true, true]  # crawl Large Angle clusters?
  LAClusAngleCut:       60 # Large cluster angle cut (0 < 90 degrees). <0 to turn off
	LAClusMaxHitsFit: 		 4 #
	MinHitFrac: 				 0.6 # Drop clusters having < (#hits/#wires)
	MinAmp: 			 [5, 5, 5] # Min hit signal amplitude for merging
	ChgNearWindow:				40 # #of ticks for summing charge near a cluster
	ChgNearCut: 				 1.5 # Cluster end is shower-like if (nearby chg)/(cls chg)> cut
  HitMergeChiCut:      2.5 # Merge cluster hit-multiplets if the separation chisq
                           # is < cut. Set < 0 for no merging
  MergeAllHits:      false # merge all hits before reconstructing clusters
  MergeOverlapAngCut:  0.1 # Set <= 0 to turn off overlapping cluster merging
  ChkClusterDS:       true # Check reconstruction at DS end of clusters?
  KillGarbageClusters: 0.1 # Kill ghost clusters, set to 0 to turn off
  VtxClusterSplit:    true # Split clusters that cross vertices
  FindStarVertices:   true # Find vertices with a star topology
  HitErrFac:           0.2 # hit time error for fitting = fHitErrFac * (hit width)
  HitMinAmp:             2 # ignore hits with PH < this value
  ClProjErrFac:          3 # cluster projection error factor
  AllowNoHitWire:        1 # Allow skipping N wires w no hits (if poor purity)
	Vertex2DCut:					10 # Max chisq cut for attaching a cluster to a vtx
  Vertex3DCut:           5 # 2D vtx -> 3D vtx matching cut (chisq)
	FindHammerClusters: true # look for hammer type clusters
  RefineVertexClusters: false # (not ready)
  FindVLAClusters: false # find Very Large Angle clusters (not ready)
  DebugPlane:          -1  # print info only in this plane
  DebugWire:            0  # set to the Begin Wire and Hit of a cluster to print
  DebugHit:             0  # out detailed information while crawling
}

standard_blurredclusteralg:
{
  BlurWire:            6
  BlurTick:            12
  SigmaWire:           4
  SigmaTick:           6
  ClusterWireDistance: 2
  ClusterTickDistance: 2
  MaxTickWidthBlur:    10
  NeighboursThreshold: 0
  MinNeighbours:       0
  MinSize:             2
  MinSeed:             0.1
  TimeThreshold:       500
  ChargeThreshold:     0.07
}

standard_mergeclusteralg:
{
  MinMergeClusterSize: 3
  MaxMergeSeparation:  30
  ProjWidthThreshold:  0.2
}

standard_houghbasealg:
{
  MaxLines:                 50   # The maximum number of Hough lines to look for, 20 had been working!
  MinHits:                  5
  SaveAccumulator:          0
  NumAngleCells:            20000 # The number of angle cells to create for the Hough transform,
  RhoResolutionFactor:      5    # Was set to 5
  MaxDistance:              1.0  # 0.1 was working (okay, not really, larger is probably better,
  MaxSlope:                 80.0 # 80 was working fine previously
  RhoZeroOutRange:          0
  ThetaZeroOutRange:        0
  HitsPerCluster:           1
  MissedHits:               1    # Was set to 0
  MissedHitsDistance:       2.0  #
  MissedHitsToLineSize:     0.25    # Was set to 0
}

standard_endpointalg:
{
  TimeBins:            256
  MaxCorners:          20
  Gsigma:              1.
  Window:              5
  Threshold:           0.1
  SaveVertexMap:       -1
}


standard_cornerfinderalg:
{
  RawDataModuleLabel:           "daq"
  CalDataModuleLabel:		"caldata"
  Trimming_threshold:      10
  Trimming_totalThreshold: 5e4
  Conversion_algorithm:         "standard"
  Conversion_function:          "TMath::Gaus(x,0,1)*TMath::Gaus(y,0,1)"
  Conversion_func_neighborhood: 3
  Conversion_threshold:		0
  Conversion_bins_per_input_x:	1
  Conversion_bins_per_input_y:	1
  Derivative_method: 		"Sobel" #Noble
  Derivative_neighborhood:	1
  Derivative_BlurFunc:	"NotImplemented"
  Derivative_BlurNeighborhood:	5
  CornerScore_Noble_epsilon:    1e-5
  CornerScore_Harris_kappa:     0.05
  CornerScore_neighborhood:	1
  CornerScore_algorithm:	"Nobel" #Harris
  MaxSuppress_neighborhood:	3
  MaxSuppress_threshold:	1000
  Integral_bin_threshold:       5
  Integral_fraction_threshold:  0.95


}

standard_dbscanalg:
{
  eps:    1.0
  epstwo: 1.5
  minPts: 2
  Method: 0   # 0 -- naive findNeighbor implemention
              # 1 -- findNeigbors with R*-tree
              # 2 -- DBScan from the paper with R*-tree
  Metric: 3   # Which RegionQuery distance metric to use.
              # **ONLY APPLIES** if Method is 1 or 2.
              #
	      # 0 -- rectangle (no bad channels) **not implemented**
	      # 1 -- Manhattan distance (only uses eps, no bad channels)
              #                                  **not implemented**
	      # 2 -- Eliptical (no bad channels) **not implemented**
	      # 3 -- findNeighbors-alike: Elliptical and bad
              #                           channel aware (not working)
}

standard_dbscan3dalg:
{
    epsilon:          5.0
    minpts:           2
    neighbors:        100
    badchannelweight: 0.
}

standard_tcshoweralg:
{
    CalorimetryAlg: @local::standard_calorimetryalgmc
    ProjectionMatchingAlg:    @local::standard_projectionmatchingalg
}

standard_fuzzyclusteralg:
{
  RunHough:       true    # Turns on and off the Hough line finder, useful for diagnostics
  NumberTimeBoundaries:             3	# Number of boundaries in ticks for the drift window to be divided up to make the Hough line finder easier on memory
  NumberWireBoundaries:             3	# Number of boundaries in wires for the drift window to be divided up to make the Hough line finder easier on memory
  GenerateHoughLinesOnly:       false # Show only the results of the Hough line finder, hits not in a line will not be clustered
  HoughBaseAlg:{
    MaxLines:             100
    MaxDistance:          1
    MinHits:              5
    NumAngleCells:        10800
    SaveAccumulator:          0
    RhoResolutionFactor:      5
    MaxSlope:                 80.0 # 80 was working fine previously
    RhoZeroOutRange:          0
    ThetaZeroOutRange:        0
    HitsPerCluster:           1
    MissedHits:               1    # Was set to 0
    MissedHitsDistance:       1.0  #
    MissedHitsToLineSize:     0.5    # Was set to 0
  }
  DBScanAlg:                @local::standard_dbscanalg
  DoFuzzyRemnantMerge:      true # Tell the algorithm to merge fuzzy cluster remnants into showers or tracks (0-off, 1-on)
  FuzzyRemnantMergeCutoff: 20    # Cut off on distance from hough line to hit in the remnant of the fuzzy cluster

  DoTrackClusterMerge:     true # Turns on merging of track-like Hough lines (0-off, 1-on)
  ChargeAsymAngleCut:        0.1 # Cut on product of charge asymmetry and the square of the sin of angle between slopes of lines, only for track-like
  SigmaChargeAsymAngleCut:   1.0  # Cut on product of charge sigma asymmetry and the sin of angle between slopes of lines, only for track-like
  TrackClusterMergeCutoff: 5.0 # The maximum distance between track-like Hough line endpoints before they can be merged,

  DoShowerClusterMerge:     true # Turns on merging of shower-like Hough line (0-off, 1-on)
  ShowerClusterMergeAngle: 30    # The maximum angle between slopes of shower-like lines to be merged,
  ShowerClusterMergeCutoff:  7.5 # The maximum distance between shower-like line endpoints before they can be merged,

  DoShowerTrackClusterMerge:     true # Turns on merging of shower-like and track-like lines (0-off, 1-on)
  ShowerTrackClusterMergeAngle:  15   # The maximum angle between slopes of shower-like and track-like lines to be merged,
  ShowerTrackClusterMergeCutoff: 7.5  # The maximum distance between shower-like and track-like line endpoints before they can be merged,
  ShowerLikenessCut:       10    # Cut on shower likeness (the larger the more shower like, the smaller the less shower like)
  MaxVertexLines:          100   # Max number of line end points allowed in a Hough line merge region for a merge to happen
  VertexLinesCutoff:       5.0   #  Size of the vertex region to count up lines for MaxVertexLines
}

standard_clusterparamsalg:
 {
  ChargeCutoffThreshold:    [500,500,1000]
  SelectBoxSizePar:               10     #distance along axis
  SelectBoxSizePerp:              3      #distance perpendicular to axis
  ForceRightGoing:        	  false
  MinHitListSize:		  40
  fOutlierRadius:		  5
  #HoughBaseAlg.NumAngleCells:       3000
  #HoughBaseAlg.RhoResolutionFactor:       4
  #HoughBaseAlg.MaxLines:       100
  HitDensityCutoff:             1.9  # Showers is high, tracks low, 0 don't use cut
  MultiHitWireCutoff: 		 2.1  # Showers is high, tracks low, 0 don't use cut
  OffAxisHitsCutoff:            0    # Showers is high, tracks low, 0 don't use cut
  PrincipalComponentCutoff:     0    # Tracks is high ~1, showers low, 0 don't use cut
  ShowerSelisORorAND:           0    # 0 = OR, 1 = AND

  HoughBaseAlg:                   @local::standard_houghbasealg

 }

 standard_clustermatchalg:
 {
  DebugMode: true
  StoreSpacePoint: true
  MatchAlgoList:                [0, 1, 2, 3] # Algorithms enum to be enabled
  CutParam_NumSpacePoint:       100          # Number of minimum space point to claim a cluster by kSpacePoint
  CutParam_OverlayTimeFraction: 0.0          # Minimum fraction of overlayed time period used by kRoughTime
  CutParam_SumChargeRatio:      1000.0       # Maximum difference in fraction of clusters' charge sum used by kSumCharge
  SpacePointAlg:                @local::microboone_spacepointalg
  }
 standard_clustermatchalg.SpacePointAlg.Filter: false

 standard_clustermergealg:
 {
  VerboseMode:    false
  MaxAngleDiff:   0
  MaxSquaredDist: 0
  }

standard_smallclustalg:
 {
  RadiusSizePar:   	3	  #radius of circle in "cm"
  NHitsInClust:		4	  # Max Number of hits in cluster
  Verbose:			false
 }

standard_clustermatchtq:
{
  KSCut: 0.9
  EnableU: true
  EnableV: true
  EnableZ: true
}

standard_dbscanalg_fast:        @local::standard_dbscanalg
standard_dbscanalg_fast.eps:    1.25
standard_dbscanalg_fast.epstwo: 1.75
standard_dbscanalg_fast.Method: 2

jp250L_dbscanalg:                  @local::standard_dbscanalg
jp250L_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
jp250L_houghbasealg:               @local::standard_houghbasealg
jp250L_houghbasealg.MaxLines:      15
jp250L_houghbasealg.MinHits:       3
jp250L_houghbasealg.NumAngleCells: 5000
jp250L_houghbasealg.MaxDistance:   5.0
jp250L_endpointalg:                @local::standard_endpointalg

bo_dbscanalg:                   @local::standard_dbscanalg
bo_fuzzyclusteralg:             @local::standard_fuzzyclusteralg
bo_houghbasealg:                @local::standard_houghbasealg
bo_houghbasealg.MaxLines:       15
bo_houghbasealg.MinHits:        3
bo_houghbasealg.NumAngleCells:  5000
bo_houghbasealg.MaxDistance:    5.0
bo_endpointalg:                 @local::standard_endpointalg
bo_clustercrawleralg:           @local::standard_clustercrawleralg
bo_clustercrawleralg.NumPass: 1
bo_clustercrawleralg.MaxHitsFit: [ 8 ]
bo_clustercrawleralg.MinHits: [ 3 ]
bo_clustercrawleralg.ChgCut: [ 2. ]
bo_clustercrawleralg.WidCut: [ 2. ]
bo_clustercrawleralg.ChiCut: [ 20. ]
bo_clustercrawleralg.MaxWirSkip: [ 25 ]
bo_clustercrawleralg.MinWirAfterSkip: [ 1 ]
bo_clustercrawleralg.KinkChiRat: [ 2. ]
bo_clustercrawleralg.KinkAngCut: [ 0.5 ]
bo_clustercrawleralg.DoMerge:  [ true ]
bo_clustercrawleralg.TimeDelta:  [ 10. ]
bo_clustercrawleralg.FindVertices: [ false ]
bo_clustercrawleralg.HitErrFac: 1.
bo_clustermatchtq:             @local::standard_clustermatchtq

argoneut_dbscanalg:                  @local::standard_dbscanalg
argoneut_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
argoneut_houghbasealg:               @local::standard_houghbasealg
argoneut_houghbasealg.MaxLines:      15
argoneut_houghbasealg.MinHits:       3
argoneut_houghbasealg.NumAngleCells: 5000
argoneut_houghbasealg.MaxDistance:   5.0
argoneut_endpointalg:                @local::standard_endpointalg
argoneut_cornerfinderalg:		      @local::standard_cornerfinderalg
argoneut_clusterparamsalg:       @local::standard_clusterparamsalg
argoneut_clusterparamsalg.HoughBaseAlg: @local::argoneut_houghbasealg
argoneut_clusterparamsalg.HoughBaseAlg.NumAngleCells:       3000
argoneut_clusterparamsalg.HoughBaseAlg.RhoResolutionFactor:       4
argoneut_clusterparamsalg.HoughBaseAlg.MaxLines:       100
argoneut_clusterparamsalg.ChargeCutoffThreshold:  [200,400]
argoneut_clusterparamsalg.ForceRightGoing:   true
argoneut_smallclustalg:	@local::standard_smallclustalg
argoneut_clustermatchtq:             @local::standard_clustermatchtq
argoneut_clustermatchtq.KSCut:              0.5


microboone_dbscanalg:                         @local::standard_dbscanalg_fast
microboone_endpointalg:                       @local::standard_endpointalg
microboone_houghbasealg:                      @local::standard_houghbasealg
microboone_houghbasealg.MaxLines:             20
microboone_houghbasealg.MaxDistance:          1.0
microboone_houghbasealg.MinHits:              5
microboone_houghbasealg.NumAngleCells:        20000
microboone_houghbasealg.DoHoughLineMerge:     1
microboone_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
microboone_fuzzyclusteralg.Threshold          : -20.0
microboone_cornerfinderalg:		      @local::standard_cornerfinderalg
microboone_clusterparamsalg:                  @local::standard_clusterparamsalg
microboone_smallclustalg:	              @local::standard_smallclustalg
microboone_clustercrawleralg:                 @local::standard_clustercrawleralg

microboone_trajclusteralg:                    @local::standard_trajclusteralg
microboone_trajclusteralg.MultHitSep: 3.2
microboone_trajclusteralg.MaxWireSkipNoSignal: 2
microboone_trajclusteralg.MuonTag: [40, 500, 10, 3]
microboone_trajclusteralg.VLAStepSize: 1
microboone_trajclusteralg.Vertex2DCuts: [ 6, 8, 45, 3, 3, 50, 0.6, 50, 0.8, 0.8]

microboone_clustermatchalg:                   @local::standard_clustermatchalg
microboone_clustermergealg:                   @local::standard_clustermergealg
microboone_clustermatchtq:                    @local::standard_clustermatchtq

dune35t_dbscanalg:    @local::standard_dbscanalg_fast
dune35t_dbscanalg.eps:    2.0
dune35t_dbscanalg.epstwo: 2.0
dune35t_houghbasealg: @local::standard_houghbasealg
#dune35t_houghbasealg.DoHoughLineMerge:     1
dune35t_endpointalg:  @local::standard_endpointalg
dune35t_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dune35t_fuzzyclusteralg.HoughBaseAlg:      @local::dune35t_houghbasealg
#dune35t_fuzzyclusteralg.Threshold:         -50.0
dune35t_clustercrawleralg:                 @local::standard_clustercrawleralg
dune35t_clustermatchtq:                    @local::standard_clustermatchtq
dune35t_clustermatchtq.KSCut:              0.7

dunefd_dbscanalg:    @local::standard_dbscanalg_fast
dunefd_houghbasealg: @local::standard_houghbasealg
dunefd_endpointalg:  @local::standard_endpointalg
dunefd_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dunefd_fuzzyclusteralg.HoughBaseAlg:      @local::dunefd_houghbasealg
dunefd_clustercrawleralg:                 @local::standard_clustercrawleralg
dunefd_clustermatchtq:                    @local::standard_clustermatchtq
dunefd_clustermatchtq.KSCut:              0.7


END_PROLOG
BEGIN_PROLOG

# default parameters for the pma cosmic tracks tagging algorithm
standard_pmalgtagger:
{

  TagOutOfDriftTracks: false # Tag tracks sticking out of 1 drift window.
  OutOfDriftMargin:    5.0   # The minimum distance beyond 1 drift window required for tagging track as a cosmic background.

  TagFullHeightTracks: false # Tag tracks crossing full height.
  TagFullWidthTracks:  false # Tag tracks crossing full width.
  TagFullLengthTracks: false # Tag tracks crossing full length.
  FullCrossingMargin:  15.0  # The maximum difference in size between the detector and track required for tagging track as crossing full dimensions.

	TagNonBeamT0Tracks:  false # Tag tracks that have a reconstructed T0 incompatible with the beam
	NonBeamT0Margin:     100.0 # Number of nanoseconds away from the beam time to be tagged.

  TagTopFrontBack: true
  TopFrontBackMargin: 5.0

  TagApparentStopper: false
  ApparentStopperMargin: 5.0
  VetoActualStopper: false
  StopperBuffer: 2.0
}

END_PROLOG


BEGIN_PROLOG

# separate fcl since there is no other place for vertex algorithm configurations yet
# please, feel free to move this configuration to a common place when there is such

standard_pmavertexalg:
{
  MinTrackLength:         3.0  # min. length of tracks used to find vtx candidates (short tracks attached later)
  FindKinks:              false # detect significant kinks on long tracks
  KinkMinDeg:             2.5  # min. angle [deg] in XY of a kink
  KinkMinStd:             5.0  # threshold in no. of stdev of all segment angles needed to tag a kink

# InputVtxDist2D:         0.5  # use vtx given at input if dist. [cm] to track in all 2D projections is below this max. value
# InputVtxDistY:          5.0  # use vtx given at input if dist. [cm] to track in 3D-Y is below this max. value
}

END_PROLOG
BEGIN_PROLOG

# fcl file for default parameters for the pma stitching algorithm
standard_pmastitchalg:
{

  StitchingThreshold: 10.0 # This is the tolerance on allowing stitching to happen. Larger is more tolerant.
  NodesFromEnd: 2          # Number of nodes from the end of the track used for extrapolations for stitching.
                           # This is important to avoid problems from end effects of tracks. 
                           # Setting this equal to 2 means it skips two nodes at each end.
}

END_PROLOG

BEGIN_PROLOG

# only save standard configuration, save experiment-specific configuration in experiment-specific fcl file

standard_cctrackmaker:
{
  module_type:            "CCTrackMaker"
  HitModuleLabel:         "cccluster"
  ClusterModuleLabel:     "cccluster"
  VertexModuleLabel:      "cccluster"
  MaxDAng:           0.6  # kink angle cut (radians)
  ChainMaxdX:        1.0  # max dX for merging broken clusters
  ChainVtxAng:       0.1  # kill 2-cluster US-DS vertices if angle diff < this cut
  MergeChgAsym:      0.7  # charge asymmetry cut for merging clusters
  # Order of algorithm calls (1 = vtx, 2 = pln)
  # First find track matches using clusters associated with 3D vertices (neutrino interactions)
  # Make tracks from the matches
  # Next find long track matches (cosmic rays)
  # Make tracks from the matches
  # Last find track matches with looser cuts (garbage collection)
  # Make tracks from the matches
  MatchAlgs:         [1, 2, 2]
  XMatchErr:      [0.2, 0.2, 2]       # end X match uncertainty for alg
  AngleMatchErr:  [0.02, 0.02, 0.03]  # end angle match uncertainty for alg
  ChgAsymFactor:  [1, 1, 1]           # scale rms by charge asymmetry * this factor for alg
  MatchMinLen:    [2, 20, 5]           # cluster match minimum length in 2/3 planes for alg
  MakeAlgTracks:  [true, true, true]  # Sort track matches from alg and make tracks?
  MakePFPs:       true    # make PFParticles
  NVtxTrkHitsFit:    4    # number of hits/plane fitted to a vertex, 0 = no vertex fit
  FiducialCut:      5     # cut (cm) for tagging cosmic rays
  DeltaRayCut:      5     # cut (cm) for tagging delta-rays
  HitFitErrFac:   0.1     # Factor applied to SigmaPeakTime for vertex fit
  uBCode:     true        # uB code patches
  DebugAlg:       -1      # 1 = vtx, 2 = pln, 666 = MakeClusterChains
  DebugPlane:    -1       # -1 = none
  DebugCluster:  -1
  PrintAllClusters: false # print clusters as well as cluster chains
  errorOnFailureToPut: false
}

# Does the full PMA job.
# Input: collection of unassociated clusters in 2D views.
# Output: 3D track-vertex structure.
# First, loops over clusters from each view in order to find/fit individual 3D tracks:
# - cluster pairs are processed from the largest, best matching by time, down to small
#   clusters, new tracks are created and iteratively extended;
# - cluster are selected from any pair of views, and the 3rd view is used to validate
#   the result (if available); all 3 views are used to fine-tune good track candidates;
# - track parts are stitched between TPCs;
# - vertex candidates are estimated from tracks, tracks connected in vtx are reoptimized
# - track-vertex structures are extended and finally PFParticle hierarchy is created,
#   with tracks and vertices associated to PFPs.
standard_pmalgtrackmaker:
{
  module_type:            "PMAlgTrackMaker"
  ProjectionMatchingAlg:  @local::standard_projectionmatchingalg
  PMAlgTracking:          @local::standard_pmalgtracker
  PMAlgCosmicTagging:     @local::standard_pmalgtagger
  PMAlgVertexing:         @local::standard_pmavertexalg
  PMAlgStitching:         @local::standard_pmastitchalg
                                      #
  SaveOnlyBranchingVtx:   false       # use true to save only vertices interconnecting many tracks, otherwise
                                      # vertex is added to the front of each track
  SavePmaNodes:           false       # save track nodes (only for algorithm development purposes)
                                      #
  HitModuleLabel:         "hits"      # unclustered hits are used for tracks validation
  WireModuleLabel:        "caldata"   # deconvoluted adc is also used for tracks validation

  ClusterModuleLabel:     "cluster"   # cluster module label, these clusters are used for track building
  EmClusterModuleLabel:   ""          # EM-like clusters, will be excluded from tracking if provided
}

# Trajectory fit using PMA.
# Input: clusters associated to PFParticles.
# Output: 3D trajectories associated to PFParticles.
# Simply use all clusters associated to each PFParticle and fit 3D trajectories (no pattern recognition at all,
# no corrections to input objects, etc). Resulting trajectories are associated to existing PFPs.
standard_pmalgtrajfitter:
{
  module_type:            "PMAlgTrajFitter"
  ProjectionMatchingAlg:  @local::standard_projectionmatchingalg
  PMAlgFitting:           @local::standard_pmalgfitter
  PMAlgVertexing:         @local::standard_pmavertexalg
                                      #
  SaveOnlyBranchingVtx:   false       # use true to save only vertices interconnecting many tracks, otherwise
                                      # vertex is added to the front of each track
  SavePmaNodes:           false       # save track nodes (only for algorithm development purposes)
                                      #
  HitModuleLabel:         "hits"      # tag of unclustered hits, which were used to produce PFPs and clusters
  PfpModuleLabel:         "pandora"   # tag of the input PFParticles and associated clusters
}

standard_featuretracker:
{
 module_type:         "FeatureTracker"
 HitModuleLabel:      "ffthit"
 LineIntFraction:     0.90
 LineIntThreshold:    3
 CornerPset:          @local::standard_cornerfinderalg
 SpacepointPset:      @local::microboone_spacepointalg
}

standard_featuretracker.SpacepointPset.MinViews: 2


standard_seedfindermodule:
{
 module_type:         "SeedFinderModule"
 InputSource:          1                     # 1: use clusters
                                             # 2: use hits
 InputModuleLabel:     "dbcluster"     
 SeedAlg:              @local::standard_seedfinderalgorithm
}

standard_beziertrackermodule:
{
 module_type:         "BezierTrackerModule"
 SeedModuleLabel:     "seedfinder"
 HitModuleLabel:      "ffthit"
 ClusterModuleLabel:  "dbcluster"
 TrackMode:           3
 MakeHitAssns:        true
 EnableCalo:          false
 BezierTrackerAlgorithm: @local::standard_beziertrackeralgorithm
}

standard_trackcheater:
{
 module_type:         "TrackCheater"
 CheatedClusterLabel: "cluster"
 G4ModuleLabel:       "largeant"
}

standard_trackkalmancheater:
{
  module_type:        "TrackKalmanCheater"
  Hist:               false
  UseClusterHits:     true
  HitModuleLabel:     "ffthit"
  ClusterModuleLabel: "dbcluster"
  MaxTcut:            10.           # Maximum delta ray energy in MeV for restricted dE/dx
  KalmanFilterAlg:    @local::standard_kalmanfilteralg
  SpacePointAlg:      @local::standard_spacepointalg
}

standard_track3Dreco:
{
 module_type:        "Track3Dreco"
 ClusterModuleLabel: "linemerger"
 TMatch:             35
 Chi2DOFmax:         10.0
}

standard_cosmictracker:
{
 module_type:        "CosmicTracker"
 ClusterModuleLabel: "linemerger"
 SortDirection:      "+z"
 StitchTracks:       false
 DisCut:             20
 AngCut:             0.1
 TrajOnly:           false
 ClusterMatch:       @local::standard_clustermatchtq
 CTAlg:              @local::standard_cosmictrackeralg
}

standard_track3Dkalman:
{
 module_type:         "Track3DKalman"
 SpacePtsModuleLabel: "spacepts"
 GenieGenModuleLabel: "generator"        # comment out for real data.
 G4ModuleLabel:       "largeant"
 PosErr3:             [0.02,0.02,0.02]   #  position resolution, cm.
 MomErr3:             [0.10,0.10,0.2]    #  momentum resolution, GeV/c.
 MomStart3:           [0.10,0.10,1.5]    #  GeV/c. Will *not* be Unit norm'd.
 PerpLimit:           2.0
 GenfPRINT:           true
}

standard_track3DkalmanSPS:
{
 module_type:         "Track3DKalmanSPS"
 ClusterModuleLabel:  "dbscan"
 SpptModuleLabel:     "spacepointfinder"
 GenieGenModuleLabel: "generator"        # comment out for real data.
 G4ModuleLabel:       "largeant"
 PosErr3:             [0.05,0.1,0.1]   #  position resolution, cm.
 MomErr3:             [0.5,0.5,1.8]    #  momentum resolution, GeV/c.
 MomStart3:           [0.10,0.10,1.5]    #  GeV/c. Will *not* be Unit norm'd.
 PerpLimit:           50.0
 PdgCode:	      -13 # mu+
 ErrScaleSim:         0.
 ErrScaleMeas:        500.
 DecimateC:           1
 MaxUpdateC:          0.1
 DecimateU:           1 # on first pass. after that its increased.
 DistanceU:           15.0
 MaxUpdateU:          0.1
 Chi2HitThresh:       1000000.0
 SortDirection:       "z"
 SpacePointAlg:       @local::standard_spacepointalg
}

standard_pfpana:
{
  module_type:              "PFPAna"
  HitsModuleLabel:          "linecluster"
  ClusterModuleLabel:       "linecluster"
  TrackModuleLabel:         "cctrackmaker"
  PFParticleModuleLabel:    "cctrackmaker"
  VertexModuleLabel:        "cctrackmaker"
  ElecKERange:              [50, 10000] # Min, max KE (MeV) for matching Primary only
  MuonKERange:              [50, 10000] # Min, max KE (MeV) for matching
  PionKERange:              [50, 10000] # Min, max KE (MeV) for matching
  KaonKERange:              [50, 10000] # Min, max KE (MeV) for matching
  ProtKERange:              [50, 10000] # Min, max KE (MeV) for matching
  TrackWeightOption:        1 # 0 = equal weighting, 1 = weight by kinetic energy
  MergeDaughters:           true # merge daughter MC particles with mothers (not electrons)
  SkipCosmics:              true # do not evaluate cosmic rays
  PrintLevel:               0 # 0 = none, 1 = event summary, 2 += each MC particle, 3 += truth
}


standard_trackana:
{
   module_type: "TrackAna"
   TrackModuleLabel: "trackkalmanhit"
   MCTrackModuleLabel: "mcreco"
   SpacepointModuleLabel: "spacepointfinder"
   StitchModuleLabel: "stitch"
   TrkSpptAssocModuleLabel: "trackkalmanhit"
   HitSpptAssocModuleLabel: "gaushit"
   HitModuleLabel: "gaushit"
   Dump: 10
   MinMCKE:  0.02
   MinMCLen:  10.
   MatchColinearity: 0.98
   MatchDisp:  2.0
   WMatchDisp: 15.0
   MatchLength: 0.8
   IgnoreSign: true
   StitchedAnalysis: false
   MCTrackOrigin: "Any"
   PrintLevel: 0
}


standard_seedana:
{
  module_type:        "SeedAna"
  SeedModuleLabel:    "seedfinder"
  MCTrackModuleLabel: "mcreco"
  Dump:               10
  MinMCKE:            0.05
  MinMCLen:           20.
  MatchColinearity:   0.97
  MatchDisp:          2.0
  IgnoreSign:         true
}

standard_spacepts:
{
 module_type:           "SpacePts"
 TicksOffset:           75.0
 ClusterModuleLabel:    "linemerger"
 EndPoint2DModuleLabel: "vertex2d"
 TMatch:                50.0
 vertexclusterWindow:   100.
}

standard_spacepointana:
{
  module_type:             "SpacePointAna"
  HitModuleLabel:          "ffthit"
  UseClusterHits:          true
  ClusterModuleLabel:      "dbcluster"
  UseMC:                   false
  SpacePointAlgTime:       @local::standard_spacepointalg
  SpacePointAlgSep:        @local::standard_spacepointalg
  SpacePointAlgDefault:    @local::standard_spacepointalg
}

standard_spacepointfinder:
{
  module_type:        "SpacePointFinder"
  ClusterModuleLabel: "dbcluster"
  MinHits:            10
  ClusterAssns:       true
  SpacePointAlg:      @local::standard_spacepointalg
}

standard_spacepointcheater:
{
  module_type:        "SpacePointCheater"
  ClusterModuleLabel: "dbcluster"
  MinHits:            10
  ClusterAssns:       true
  SpacePointAlg:      @local::standard_spacepointalg
}

development_beziertrackjoiner:
{  
  module_type:         "BezierTrackJoiner"
  TrackModuleLabel:    "beziertracker"
  JoinThreshold:       1
  VertexAngle:         0.26
  ExtrapDistance:      10

}

development_beziertrackana:
{
  module_type:            "BezierTrackAna"
  BezierTrackModuleLabel: "beziertracker"
}

standard_track3Dkalmanhit:
{
  module_type:        "Track3DKalmanHit"
  Hist:               false
  UseClusterHits:     true
  UsePFParticleHits:  false
  UsePFParticleSeeds: false
  HitModuleLabel:     "ffthit"
  ClusterModuleLabel: "dbcluster"
  PFParticleModuleLabel: "pandora"
  #MaxTcut:            10.           # Maximum delta ray energy in MeV for restricted dE/dx
  #DoDedx:             false         # dE/dx enable flag.
  #SelfSeed:           false         # Generate seeds internally.
  #LineSurface:        false         # Store hits on line surfaces.
  #MinSeedHits:        12            # Minimum number of hits per track seed.
  #MinSeedChopHits:    50            # Potentially chop seeds that exceed this length.
  #MaxChopHits:        20            # Maximum number of hits to chop from each end of seed.
  #MaxSeedChiDF:       20.           # Maximum seed track chisquare/dof.
  #MinSeedSlope:       0.0           # Minimum seed slope (dx/dz).
  #InitialMomentum:    0.5           # Initial momentum (GeV/c).
  #KalmanFilterAlg:    @local::standard_kalmanfilteralg
  #SeedFinderAlg:      @local::standard_seedfinderalgorithm
  Track3DKalmanHitAlg: @local::standard_track3Dkalmanhitalg
  SpacePointAlg:       @local::standard_spacepointalg
}

standard_trackstitcher:
{
    module_type: "TrackStitcher"
    TrackModuleLabel: "trk3dsps"
    SpptModuleLabel: "spacepts"
    StitchAlg:      @local::standard_trackstitcheralg
}

standard_magdriftana:
{
 module_type:           "MagDriftAna"
 HitsModuleLabel:       "ffthit"
 LArGeantModuleLabel:   "largeant"
}

standard_neutrinotrackingeff:
{
      module_type:      	"NeutrinoTrackingEff"
      MCTruthModuleLabel:	"generator"
      TrackModuleLabel: 	"pandora"
      isNeutrinoInt:		true
      NeutrinoPDGcode:		14
      LeptonPDGcode:		13
      MaxNeutrinoE:		25.0
      MaxLeptonP:               3.0
      SaveMCTree:		false
      FidVolCutX:               10
      FidVolCutY:               10
      FidVolCutZ:               10
}

standard_muontrackingeff:
{
      module_type:      	"MuonTrackingEff"
      MCTruthModuleLabel:	"generator"
      TrackModuleLabel: 	"pmtrack"
      MuonPDGCode:		13
      FidVolCutX:               0
      FidVolCutY:               0
      FidVolCutZ:               0
}

END_PROLOG

BEGIN_PROLOG

standard_trackanact:
{
  module_type:        "TrackAnaCT"
  TrackModuleLabel:   "ct"
  SpacepointModuleLabel:  "spacepts"
  StitchModuleLabel:  "stitch"
  TrkSpptAssocModuleLabel:  "ct"
  HitSpptAssocModuleLabel:  "hitcheat"
  Dump:               10
  MinMCKE:            0.05
  MinMCLen:           20.
  MatchColinearity:   0.97
  MatchDisp:          2.0
  WMatchDisp:         15.0
  IgnoreSign:         true
}

dune35t_trackcheater:                     @local::standard_trackcheater

dune35t_cosmictracker:                    @local::standard_cosmictracker
#dune35t_cosmictracker.CleanUpHits:        true
dune35t_cosmictracker.SortDirection:      "-y"
dune35t_cosmictracker.StitchTracks:       true
dune35t_cosmictracker.DisCut:             100.
dune35t_cosmictracker.AngCut:             0.2
dune35t_cosmictracker.ClusterMatch:       @local::dune35t_clustermatchtq
dune35t_cosmictracker.TrajOnly:           false
dune35t_trackstitcher:                    @local::standard_trackstitcher
dune35t_trackstitcher.SpptSepTolerance:   100
dune35t_trackstitcher.CosAngTolerance:    0.80

dune35t_track3Dkalmanhit:                            @local::standard_track3Dkalmanhit
dune35t_track3Dkalmanhit.MaxSeedChiDF:               50
dune35t_track3Dkalmanhit.MinSeedHits:                10
dune35t_track3Dkalmanhit.KalmanFilterAlg:            @local::dune35t_kalmanfilteralg
dune35t_track3Dkalmanhit.SeedFinderAlg:              @local::dune35t_seedfinderalgorithm
dune35t_track3Dkalmanhit.SpacePointAlg:              @local::dune35t_spacepointalg

dune35t_cctrackmaker:                          @local::standard_cctrackmaker
dune35t_cctrackmaker.HitModuleLabel:           "linecluster"
dune35t_cctrackmaker.ClusterModuleLabel:       "linecluster"
dune35t_cctrackmaker.VertexModuleLabel:        "linecluster"

dune35t_pmalgtrackmaker:                     @local::standard_pmalgtrackmaker
dune35t_pmalgtrackmaker.HitModuleLabel:      "linecluster"
dune35t_pmalgtrackmaker.ClusterModuleLabel:  "linecluster"
dune35t_pmalgtrackmaker.ProjectionMatchingAlg.HitWeightZ: 1.0
dune35t_pmalgtrackmaker.ProjectionMatchingAlg.HitWeightV: 1.0
dune35t_pmalgtrackmaker.ProjectionMatchingAlg.HitWeightU: 1.0
dune35t_pmalgtrackmaker.PMAlgTracking.RunVertexing:       true
dune35t_pmalgtrackmaker.PMAlgTracking.FlipDownward:       true
#dune35t_pmalgtrackmaker.PMAlgTracking.AutoFlip_dQdx:     true

dune35t_pmalgtrajfitter:                     @local::standard_pmalgtrajfitter
dune35t_pmalgtrajfitter.HitModuleLabel:      "linecluster"
dune35t_pmalgtrajfitter.PfpModuleLabel:      "pandora"
dune35t_pmalgtrajfitter.ProjectionMatchingAlg.HitWeightZ: 1.0
dune35t_pmalgtrajfitter.ProjectionMatchingAlg.HitWeightV: 1.0
dune35t_pmalgtrajfitter.ProjectionMatchingAlg.HitWeightU: 1.0
dune35t_pmalgtrajfitter.PMAlgFitting.RunVertexing:        false

dunefd_trackcheater:                      @local::standard_trackcheater

dunefd_cosmictracker:                    @local::standard_cosmictracker
dunefd_cosmictracker.SortDirection:      "-y"
dunefd_cosmictracker.StitchTracks:       true
dunefd_cosmictracker.DisCut:             100.
dunefd_cosmictracker.AngCut:             0.2
dunefd_cosmictracker.ClusterMatch:       @local::dunefd_clustermatchtq
dunefd_cosmictracker.TrajOnly:           false

dunefd_pmalgtrackmaker:                     @local::standard_pmalgtrackmaker
dunefd_pmalgtrackmaker.HitModuleLabel:      "linecluster"
dunefd_pmalgtrackmaker.ClusterModuleLabel:  "linecluster"
dunefd_pmalgtrackmaker.PMAlgTracking.FlipToBeam:         true
dunefd_pmalgtrackmaker.PMAlgTracking.AutoFlip_dQdx:      false
dunefd_pmalgtrackmaker.PMAlgTracking.RunVertexing:       true
dunefd_pmalgtrackmaker.ProjectionMatchingAlg.HitWeightZ: 1.0
dunefd_pmalgtrackmaker.ProjectionMatchingAlg.HitWeightV: 1.0
dunefd_pmalgtrackmaker.ProjectionMatchingAlg.HitWeightU: 1.0

dunefd_pmalgtrajfitter:                     @local::standard_pmalgtrajfitter
dunefd_pmalgtrajfitter.HitModuleLabel:      "linecluster"
dunefd_pmalgtrajfitter.PfpModuleLabel:      "pandora"
dunefd_pmalgtrajfitter.ProjectionMatchingAlg.HitWeightZ: 1.0
dunefd_pmalgtrajfitter.ProjectionMatchingAlg.HitWeightV: 1.0
dunefd_pmalgtrajfitter.ProjectionMatchingAlg.HitWeightU: 1.0
dunefd_pmalgtrajfitter.PMAlgFitting.RunVertexing:        false
END_PROLOG
BEGIN_PROLOG

dune_pandora:
{
    module_type:                                                    "StandardPandora"
    GeantModuleLabel:                                               "largeant"
    HitFinderModuleLabel:                                           "linecluster"
    EnableMCParticles:                                              false
    EnableProduction:                                               true
    EnableLineGaps:                                                 true
    UseGlobalCoordinates:                                           true
    UseHitWidths:                                                   true
    ShouldRunAllHitsCosmicReco:                                     false
    ShouldRunStitching:                                             false
    ShouldRunCosmicHitRemoval:                                      false
    ShouldRunSlicing:                                               false
    ShouldRunNeutrinoRecoOption:                                    false
    ShouldRunCosmicRecoOption:                                      false
    ShouldPerformSliceId:                                           false
    PrintOverallRecoStatus:                                         false
}

dune35t_pandora:                                                    @local::dune_pandora
dune35t_pandora.ConfigFile:                                         "PandoraSettings_Master_Standard.xml"
dune35t_pandora.ShouldRunAllHitsCosmicReco:                         true
dune35t_pandora.ShouldRunStitching:                                 true

dunefd_pandora_neutrino:                                            @local::dune_pandora
dunefd_pandora_neutrino.ConfigFile:                                 "PandoraSettings_Master_DUNEFD.xml"
dunefd_pandora_neutrino.ShouldRunNeutrinoRecoOption:                true

dunefd_pandora_cosmic:                                              @local::dune_pandora
dunefd_pandora_cosmic.ConfigFile:                                   "PandoraSettings_Master_DUNEFD.xml"
dunefd_pandora_cosmic.ShouldRunCosmicRecoOption:                    true

protodune_pandora:                                                  @local::dune_pandora
protodune_pandora.ConfigFile:                                       "PandoraSettings_Master_ProtoDUNE.xml"
protodune_pandora.ShouldRunAllHitsCosmicReco:                       true
protodune_pandora.ShouldRunStitching:                               true
protodune_pandora.ShouldRunCosmicHitRemoval:                        true
protodune_pandora.ShouldRunSlicing:                                 true
protodune_pandora.ShouldRunNeutrinoRecoOption:                      true
protodune_pandora.ShouldRunCosmicRecoOption:                        true
protodune_pandora.ShouldPerformSliceId:                             true

protodune_dp_pandora:                                               @local::dune_pandora
protodune_dp_pandora.ConfigFile:                                    "PandoraSettings_Master_ProtoDUNE_DP.xml"
protodune_dp_pandora.ShouldRunAllHitsCosmicReco:                    true
protodune_dp_pandora.ShouldRunStitching:			    false
protodune_dp_pandora.ShouldRunCosmicHitRemoval:                     true
protodune_dp_pandora.ShouldRunSlicing:                              true
protodune_dp_pandora.ShouldRunNeutrinoRecoOption:                   true
protodune_dp_pandora.ShouldRunCosmicRecoOption:                     true
protodune_dp_pandora.ShouldPerformSliceId:                          true

dune_pandorawriter:                                                 @local::dune_pandora
dune_pandorawriter.ConfigFile:                                      "PandoraSettings_Write.xml"
dune_pandorawriter.EnableMCParticles:                               true
dune_pandorawriter.EnableProduction:                                false

dune_pandoraTrackCreation:
{
    module_type:                                                    "LArPandoraTrackCreation"
}

dune_pandoraShowerCreation:
{
    module_type:                                                    "LArPandoraShowerCreation"
}

dunefd_pandora:                                                      @local::dunefd_pandora_neutrino

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG
BEGIN_PROLOG

protodunesp_calorimetryalgmc: {
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
  CalAmpConstants:  [ 0.9033e-3, 1.0287e-3, 0.8800e-3 ]
  CalAreaConstants: [ 4.833e-3, 4.815e-3, 4.966e-3 ]
}

shower_calorimetry:
{
  module_type:     "ShowerCalorimetry"
  ShowerTag:       "pandoraShower"
  SpacePointTag:   "pandora"
  CorrectSCE:      false
  CalorimetryAlg:  @local::protodunesp_calorimetryalgmc
}
END_PROLOG

BEGIN_PROLOG

# Single-Phase parameters (initially copied from FD)

pdune_sp_calorimetryalgdata:             @local::standard_calorimetryalgdata
pdune_sp_calorimetryalgdata.CalAreaConstants:  [ 1e-3, 1e-3, 1e-3 ]
pdune_sp_calorimetryalgdata.CaloDoLifeTimeCorrection: false
pdune_sp_calorimetryalgdata.CaloUseModBox: true

pdune_sp_calorimetryalgmc:	         @local::standard_calorimetryalgmc
pdune_sp_calorimetryalgmc.CaloDoLifeTimeCorrection: false
pdune_sp_calorimetryalgmc.CalAreaConstants: [ 1e-3, 1e-3, 1e-3 ]
pdune_sp_calorimetryalgmc.CaloUseModBox: true

pdune_sp_calodata:                       @local::standard_calodata
pdune_sp_calodata.CaloAlg:               @local::pdune_sp_calorimetryalgdata
pdune_sp_calodata.CaloAlg.CaloUseModBox: true
pdune_sp_calodata.TrackModuleLabel:      "pandoraTrack"
pdune_sp_calodata.SpacePointModuleLabel: "pandora"
pdune_sp_calodata.CorrectSCE:            true
pdune_sp_calodata.T0ModuleLabel:         ""
pdune_sp_calodata.MakeTree:              false

pdune_sp_calodatanosce:                  @local::pdune_sp_calodata
pdune_sp_calodatanosce.CorrectSCE:       false

pdune_sp_calomcsce:                      @local::pdune_sp_calodata
pdune_sp_calomcsce.CaloAlg:              @local::pdune_sp_calorimetryalgmc

pdune_sp_calomcnosce:                    @local::pdune_sp_calomcsce
pdune_sp_calomcnosce.CorrectSCE:         false

pdune_sp_alltrackcalodata:               @local::pdune_sp_calodata
pdune_sp_alltrackcalodata.TrackModuleLabel: "pandora2Track"
pdune_sp_alltrackcalodata.SpacePointModuleLabel: "pandora"
pdune_sp_alltrackcalodata.T0ModuleLabel: ""
pdune_sp_alltrackcalodata.MakeTree:      false
pdune_sp_alltrackcalodata.CorrectSCE:    true
pdune_sp_alltrackcalodata.CaloAlg:       @local::pdune_sp_calorimetryalgdata

pdune_sp_alltrackcalodatanosce:          @local::pdune_sp_alltrackcalodata
pdune_sp_alltrackcalodatanosce.CorrectSCE:    false

pdune_sp_alltrackcalomcsce:              @local::pdune_sp_alltrackcalodata
pdune_sp_alltrackcalomcsce.CaloAlg:      @local::pdune_sp_calorimetryalgmc

pdune_sp_alltrackcalomcnosce:            @local::pdune_sp_alltrackcalomcsce
pdune_sp_alltrackcalomcnosce.CorrectSCE: false

pdune_sp_showercalodata:                 @local::shower_calorimetry
pdune_sp_showercalodata.CalorimetryAlg:  @local::pdune_sp_calorimetryalgdata
pdune_sp_showercalodata.ShowerTag:       "pandoraShower"
pdune_sp_showercalodata.CorrectSCE:      true

pdune_sp_showercalodatanosce:            @local::pdune_sp_showercalodata
pdune_sp_showercalodatanosce.CorrectSCE: false

pdune_sp_showercalomcsce:                @local::pdune_sp_showercalodata
pdune_sp_showercalomcsce.CaloAlg:        @local::pdune_sp_calorimetryalgmc

pdune_sp_showercalomcnosce:              @local::pdune_sp_showercalomcsce
pdune_sp_showercalomcnosce.CorrectSCE:   false

pdune_sp_allshowercalodata:              @local::pdune_sp_showercalodata
pdune_sp_allshowercalodata.ShowerTag:    "pandora2Shower"
pdune_sp_allshowercalodata.CalorimetryAlg:  @local::pdune_sp_calorimetryalgdata

pdune_sp_allshowercalodatanosce:         @local::pdune_sp_allshowercalodata
pdune_sp_allshowercalodatanosce.CorrectSCE:   false

pdune_sp_allshowercalomcsce:             @local::pdune_sp_allshowercalodata
pdune_sp_allshowercalomcsce.CaloAlg:     @local::pdune_sp_calorimetryalgmc

pdune_sp_allshowercalomcnosce:           @local::pdune_sp_allshowercalomcsce
pdune_sp_allshowercalomcnosce.CorrectSCE:   false

# Dual-Phase parameters

pdune_dp_calorimetryalgdata:             @local::standard_calorimetryalgdata
pdune_dp_calorimetryalgdata.CalAreaConstants:  [ 14.275E-3, 14.275E-3 ]
pdune_dp_calorimetryalgdata.CaloDoLifeTimeCorrection: false
pdune_dp_calorimetryalgdata.CaloUseModBox: true

pdune_dp_calorimetryalgmc:	         @local::standard_calorimetryalgmc
pdune_dp_calorimetryalgmc.CaloDoLifeTimeCorrection: false
pdune_dp_calorimetryalgmc.CalAreaConstants: [ 14.275E-3, 14.275E-3 ]
pdune_dp_calorimetryalgmc.CaloUseModBox: true

pdune_dp_calodata:                       @local::standard_calodata
pdune_dp_calodata.CaloAlg:               @local::pdune_dp_calorimetryalgdata
pdune_dp_calodata.CaloAlg.CaloUseModBox: true
pdune_dp_calodata.TrackModuleLabel:      "pandoraTrack"
pdune_dp_calodata.SpacePointModuleLabel: "pandora"
pdune_dp_calodata.CorrectSCE:            false
pdune_dp_calodata.T0ModuleLabel:         ""
pdune_dp_calodata.MakeTree:              false


END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG
BEGIN_PROLOG

protodunesp_calorimetryalgmc: {
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
  CalAmpConstants:  [ 0.9033e-3, 1.0287e-3, 0.8800e-3 ]
  CalAreaConstants: [ 4.833e-3, 4.815e-3, 4.966e-3 ]
}

shower_calorimetry:
{
  module_type:     "ShowerCalorimetry"
  ShowerTag:       "pandoraShower"
  SpacePointTag:   "pandora"
  CorrectSCE:      false
  CalorimetryAlg:  @local::protodunesp_calorimetryalgmc
}
END_PROLOG

BEGIN_PROLOG

# Single-Phase parameters (initially copied from FD)

pdune_sp_calorimetryalgdata:             @local::standard_calorimetryalgdata
pdune_sp_calorimetryalgdata.CalAreaConstants:  [ 1e-3, 1e-3, 1e-3 ]
pdune_sp_calorimetryalgdata.CaloDoLifeTimeCorrection: false
pdune_sp_calorimetryalgdata.CaloUseModBox: true

pdune_sp_calorimetryalgmc:	         @local::standard_calorimetryalgmc
pdune_sp_calorimetryalgmc.CaloDoLifeTimeCorrection: false
pdune_sp_calorimetryalgmc.CalAreaConstants: [ 1e-3, 1e-3, 1e-3 ]
pdune_sp_calorimetryalgmc.CaloUseModBox: true

pdune_sp_calodata:                       @local::standard_calodata
pdune_sp_calodata.CaloAlg:               @local::pdune_sp_calorimetryalgdata
pdune_sp_calodata.CaloAlg.CaloUseModBox: true
pdune_sp_calodata.TrackModuleLabel:      "pandoraTrack"
pdune_sp_calodata.SpacePointModuleLabel: "pandora"
pdune_sp_calodata.CorrectSCE:            true
pdune_sp_calodata.T0ModuleLabel:         ""
pdune_sp_calodata.MakeTree:              false

pdune_sp_calodatanosce:                  @local::pdune_sp_calodata
pdune_sp_calodatanosce.CorrectSCE:       false

pdune_sp_calomcsce:                      @local::pdune_sp_calodata
pdune_sp_calomcsce.CaloAlg:              @local::pdune_sp_calorimetryalgmc

pdune_sp_calomcnosce:                    @local::pdune_sp_calomcsce
pdune_sp_calomcnosce.CorrectSCE:         false

pdune_sp_alltrackcalodata:               @local::pdune_sp_calodata
pdune_sp_alltrackcalodata.TrackModuleLabel: "pandora2Track"
pdune_sp_alltrackcalodata.SpacePointModuleLabel: "pandora"
pdune_sp_alltrackcalodata.T0ModuleLabel: ""
pdune_sp_alltrackcalodata.MakeTree:      false
pdune_sp_alltrackcalodata.CorrectSCE:    true
pdune_sp_alltrackcalodata.CaloAlg:       @local::pdune_sp_calorimetryalgdata

pdune_sp_alltrackcalodatanosce:          @local::pdune_sp_alltrackcalodata
pdune_sp_alltrackcalodatanosce.CorrectSCE:    false

pdune_sp_alltrackcalomcsce:              @local::pdune_sp_alltrackcalodata
pdune_sp_alltrackcalomcsce.CaloAlg:      @local::pdune_sp_calorimetryalgmc

pdune_sp_alltrackcalomcnosce:            @local::pdune_sp_alltrackcalomcsce
pdune_sp_alltrackcalomcnosce.CorrectSCE: false

pdune_sp_showercalodata:                 @local::shower_calorimetry
pdune_sp_showercalodata.CalorimetryAlg:  @local::pdune_sp_calorimetryalgdata
pdune_sp_showercalodata.ShowerTag:       "pandoraShower"
pdune_sp_showercalodata.CorrectSCE:      true

pdune_sp_showercalodatanosce:            @local::pdune_sp_showercalodata
pdune_sp_showercalodatanosce.CorrectSCE: false

pdune_sp_showercalomcsce:                @local::pdune_sp_showercalodata
pdune_sp_showercalomcsce.CaloAlg:        @local::pdune_sp_calorimetryalgmc

pdune_sp_showercalomcnosce:              @local::pdune_sp_showercalomcsce
pdune_sp_showercalomcnosce.CorrectSCE:   false

pdune_sp_allshowercalodata:              @local::pdune_sp_showercalodata
pdune_sp_allshowercalodata.ShowerTag:    "pandora2Shower"
pdune_sp_allshowercalodata.CalorimetryAlg:  @local::pdune_sp_calorimetryalgdata

pdune_sp_allshowercalodatanosce:         @local::pdune_sp_allshowercalodata
pdune_sp_allshowercalodatanosce.CorrectSCE:   false

pdune_sp_allshowercalomcsce:             @local::pdune_sp_allshowercalodata
pdune_sp_allshowercalomcsce.CaloAlg:     @local::pdune_sp_calorimetryalgmc

pdune_sp_allshowercalomcnosce:           @local::pdune_sp_allshowercalomcsce
pdune_sp_allshowercalomcnosce.CorrectSCE:   false

# Dual-Phase parameters

pdune_dp_calorimetryalgdata:             @local::standard_calorimetryalgdata
pdune_dp_calorimetryalgdata.CalAreaConstants:  [ 14.275E-3, 14.275E-3 ]
pdune_dp_calorimetryalgdata.CaloDoLifeTimeCorrection: false
pdune_dp_calorimetryalgdata.CaloUseModBox: true

pdune_dp_calorimetryalgmc:	         @local::standard_calorimetryalgmc
pdune_dp_calorimetryalgmc.CaloDoLifeTimeCorrection: false
pdune_dp_calorimetryalgmc.CalAreaConstants: [ 14.275E-3, 14.275E-3 ]
pdune_dp_calorimetryalgmc.CaloUseModBox: true

pdune_dp_calodata:                       @local::standard_calodata
pdune_dp_calodata.CaloAlg:               @local::pdune_dp_calorimetryalgdata
pdune_dp_calodata.CaloAlg.CaloUseModBox: true
pdune_dp_calodata.TrackModuleLabel:      "pandoraTrack"
pdune_dp_calodata.SpacePointModuleLabel: "pandora"
pdune_dp_calodata.CorrectSCE:            false
pdune_dp_calodata.T0ModuleLabel:         ""
pdune_dp_calodata.MakeTree:              false


END_PROLOG

BEGIN_PROLOG

protodunespdata_calibrationdedx :
{
    module_type:             CalibrationdEdXPDSP
    TrackModuleLabel:        "pandoraTrack"
    CalorimetryModuleLabel:  "pandoracalo"
    CaloAlg:                 @local::pdune_sp_calorimetryalgdata
    #default modified boxmodel parameters for MC
    ModBoxA:		     0.930
    ModBoxB:		     0.212
    CorrectSCE:              true
    ApplyNormCorrection:     false
    ApplyXCorrection:        false
    ApplyYZCorrection:       false
    ApplyLifetimeCorrection: true
    UseLifetimeFromDatabase: true  # false: lifetime from DetectorProperties
}

protodunespmcsce_calibrationdedx:     @local::protodunespdata_calibrationdedx
protodunespmcsce_calibrationdedx.CaloAlg:    @local::pdune_sp_calorimetryalgmc
protodunespmcsce_calibrationdedx.UseLifetimeFromDatabase: false

protodunespmcnosce_calibrationdedx:   @local::protodunespmcsce_calibrationdedx
protodunespmcnosce_calibrationdedx.CorrectSCE: false
protodunespmcnosce_calibrationdedx.UseLifetimeFromDatabase: false

END_PROLOG
# R.Sulej, Oct. 2017
# Update: A. Reynolds, May 2019
#
# CNN bsed pixel-level feature labeling modules for DUNE.

BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

standard_dataprovideralg:
{
 DriftWindow:          6 # downsampling window (in drift ticks)
 DownscaleFullView: true # downsample full view

 DownscaleFn:     "mean" # "maxpool" takes the max value in the window,
                         # "maxmean" is mean from 3 ADC's around the max,
                         # "mean" is the mean value of all ADC's in the window

 BlurKernel:      []  # apply channel-channel blurring
 NoiseSigma:      0   # apply white noise
 CoherentSigma:   0   # apply coherent noise

 CalorimetryAlg:    @local::standard_calorimetryalgmc  # used to eliminate amplitude variation due to electron lifetime
 CalibrateAmpl:     false # calibrate ADC values with CalAmpConstants (allows different gains in MC and data)
 CalibrateLifetime: true  # calibrate ADC values according to the electron lifetime

 # The following settings allow to scale the interesting ADC range into desired range of values,
 # e.g. convenient for the CNN or for the conversion to decimal type range. Default values
 # provided here will result with the scaling factor of 0.1.
 AdcMax:            150.0 # input saturation max value
 AdcMin:            -50.0 # input saturation min value
 OutMax:             15.0 # output max value
 OutMin:             -5.0 # output min value
}

END_PROLOG

BEGIN_PROLOG

standard_pointidalg:                 @local::standard_dataprovideralg
standard_pointidalg.NNetModelFile:   "modelfile.pb" # path and file name to the network model and weights
standard_pointidalg.NNetOutputs:     [] # string labels of the network outputs, empty or exactly corresponding to the model outputs
standard_pointidalg.PatchSizeW:      32 # important: wire/drift patch size and drift window have to be consistent
standard_pointidalg.PatchSizeD:      44 # with training data prep configuration used in neural net model preparation



standard_trainingdataalg:                 @local::standard_dataprovideralg
standard_trainingdataalg.WireLabel:       "caldata"
standard_trainingdataalg.SimulationLabel: "largeant"
standard_trainingdataalg.SaveVtxFlags:     true
standard_trainingdataalg.HitLabel:        ""    # used by functions dumping real data (so one has no MC truth
standard_trainingdataalg.TrackLabel:      ""    # and need to go by reconstructed objects)
standard_trainingdataalg.AdcDelayTicks:   0     # ADC pulse peak delay in ticks (non-zero for not deconvoluted waveforms)

END_PROLOG

BEGIN_PROLOG

standard_pointidtrainingdata:
{
  module_type:     "PointIdTrainingData"

  SelectedTPC:     []
  SelectedView:    []
  OutTextFilePath: "."    # path to text files with data dumps
  DumpToRoot:      false  # if true then data is dumped to root histograms

  Crop:            true

  TrainingDataAlg:  @local::standard_trainingdataalg
}

standard_pointidtrainingnuevent:
{
  module_type:     "PointIdTrainingNuevent"

  SelectedView:    []
  SaveDepositMap:  false
  SavePdgMap:      false

  GenModuleLabel:  "generator"
  FidVolCut:	      20.0
  Crop:             true

  TrainingDataAlg:        @local::standard_trainingdataalg
}

standard_pointidefftest:
{
  module_type:            "PointIdEffTest"
  CalorimetryAlg:         @local::standard_calorimetryalgmc

  SimModuleLabel:         "largeant"

  PfpModuleLabel:         "pandora" # for comparison

  NNetModuleLabel:        "emtrackid"
  View:                   2

  SaveHitsFile:           false
}

standard_emtrackclusterid:
{
  module_type:            "EmTrackClusterId3out"

  WireLabel:              "caldata"     # tag of deconvoluted ADC on wires (recob::Wire)
  HitModuleLabel:         "linecluster" # tag of hits made to create clusters and/or tracks, nnet outputs are saved for each hit
  ClusterModuleLabel:     "linecluster" # tag of clusters which are to be EM/track tagged, unclustered leftovers will be EM/track
  # tagged new collection of clusters is made (including single-hit clusters made of leftovers)
  # and each accumulated nnet output is assigned to eacch cluster
  # - SKIP processing clusters if the label is set to ""
  # - NOTE: use clusters made of hits configured with HitModuleLabel
  TrackModuleLabel:       ""            # tag of 3D tracks which are to be EM/track tagged, nnet outputs are accumulated over
  # hits from the best track projection and assigned for each track, now collection view is
  # prefered: use the view with max(nhist_coll/2, nhits_ind1, nhits_ind2);
  # - SKIP processing tracks if the label is set to ""
  # - NOTE: use tracks made of hits configured with HitModuleLabel

  PointIdAlg:             @local::standard_pointidalg
  BatchSize:              256  # number of inputs to process in a single batch (parallelized with TF)

  Views:                  []  # do processing in selected views only, or use all views if empty list
}
standard_emtrackclusterid2out:             @local::standard_emtrackclusterid  # the same config, only use 4-output CNN
standard_emtrackclusterid2out.module_type: "EmTrackClusterId2out"
standard_emtrackclusterid3out:             @local::standard_emtrackclusterid  # the same config, 3-output CNN for convenience
standard_emtrackclusterid3out.module_type: "EmTrackClusterId3out"
standard_emtrackmichelid:                  @local::standard_emtrackclusterid  # the same config, only use 4-output CNN
standard_emtrackmichelid.module_type:      "EmTrackMichelId"

standard_particledecayid:
{
  module_type:            "ParticleDecayId"

  WireLabel:              "caldata"     # tag of deconvoluted ADC on wires (recob::Wire)
  TrackModuleLabel:       "pmtrack"     # tag of tracks where decay points should be tagged

  PointIdAlg:             @local::standard_pointidalg

  RoiThreshold:           0.8   # search for decay points where the net output > ROI threshold
  PointThreshold:         0.998 # tag decay point if it is detected in at least two planes with net outputs product > POINT threshold
  SkipView:               -1    # use all views to find decays if -1, or skip the view with provided index and use only the two other views
}

END_PROLOG

BEGIN_PROLOG

protodune_emtrkmichelid:                              @local::standard_emtrackmichelid
protodune_emtrkmichelid.PointIdAlg.NNetModelFile:     "CnnModels/cnn_emtrkmichl_pitch_5_wire_48_drift_48_down_6_mean_notes_protoduneBeamAndCosmicsMCC11.pb"
protodune_emtrkmichelid.PointIdAlg.NNetOutputs:       ["track", "em", "none", "michel"]
protodune_emtrkmichelid.PointIdAlg.CalorimetryAlg:    @local::dune10kt_calorimetryalgmc
protodune_emtrkmichelid.PointIdAlg.CalibrateAmpl:     true
protodune_emtrkmichelid.PointIdAlg.PatchSizeW:        48
protodune_emtrkmichelid.PointIdAlg.PatchSizeD:        48
protodune_emtrkmichelid.PointIdAlg.DriftWindow:       6
protodune_emtrkmichelid.PointIdAlg.DownscaleFn:       "mean"
protodune_emtrkmichelid.PointIdAlg.DownscaleFullView: false
protodune_emtrkmichelid.HitModuleLabel:               "hitpdune"
protodune_emtrkmichelid.ClusterModuleLabel:           "pandora"
protodune_emtrkmichelid.WireLabel:                    "wclsdatasp:gauss"
protodune_emtrkmichelid.Views:                        []

protodunespdata_emtrkmichelid:                        @local::protodune_emtrkmichelid
#protodunespdata_emtrkmichelid.WireLabel:              "wclsdatasp:gauss"

END_PROLOG

BEGIN_PROLOG

standard_chi2pidalg:
{
    TemplateFile:           "dEdxrestemplates.root"
    UseMedian:              true
}

standard_pidaalg:
{
  ExponentConstant: 0.42
  MinResRange:      0.00
  MaxResRange:      30.0
  MaxPIDAValue:     50.0

  KDEEvalMaxSigma:  3.0
  KDEEvalStepSize:  0.01
  KDEBandwidths:    [ -1, 0.5, 1, 2, 3, 5 ]
}

END_PROLOG
BEGIN_PROLOG

standard_chi2pid:
{
 module_type:            "Chi2ParticleID"
 TrackModuleLabel:       "spacepts"
 CalorimetryModuleLabel: "calo"
 Chi2PIDAlg:             @local::standard_chi2pidalg
}

standard_pidaanalyzer:
{
  module_type:      "PIDAAnalyzer"
  CaloModuleLabel:  "calo"
  PIDAAlg:          @local::standard_pidaalg
}

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

standard_dataprovideralg:
{
 DriftWindow:          6 # downsampling window (in drift ticks)
 DownscaleFullView: true # downsample full view

 DownscaleFn:     "mean" # "maxpool" takes the max value in the window,
                         # "maxmean" is mean from 3 ADC's around the max,
                         # "mean" is the mean value of all ADC's in the window

 BlurKernel:      []  # apply channel-channel blurring
 NoiseSigma:      0   # apply white noise
 CoherentSigma:   0   # apply coherent noise

 CalorimetryAlg:    @local::standard_calorimetryalgmc  # used to eliminate amplitude variation due to electron lifetime
 CalibrateAmpl:     false # calibrate ADC values with CalAmpConstants (allows different gains in MC and data)
 CalibrateLifetime: true  # calibrate ADC values according to the electron lifetime

 # The following settings allow to scale the interesting ADC range into desired range of values,
 # e.g. convenient for the CNN or for the conversion to decimal type range. Default values
 # provided here will result with the scaling factor of 0.1.
 AdcMax:            150.0 # input saturation max value
 AdcMin:            -50.0 # input saturation min value
 OutMax:             15.0 # output max value
 OutMin:             -5.0 # output min value
}

END_PROLOG

BEGIN_PROLOG

standard_spacepointalg:
{
  MaxDT:      2.0
  MaxS:       0.3
  MinViews:   2
  EnableU:    true
  EnableV:    true
  EnableW:    false
  Filter:     true
  Merge:      false
  PreferColl: false
}

standard_seedfinderalgorithm:
{
  SpacePointAlg:          @local::standard_spacepointalg
  InitSeedLength:         2
  MinPointsInSeed:        4
  Refits:                 5
  HitResolution:          1
  OccupancyCut:           0.8
  MaxViewRMS:             [2,2,2]
  ExtendSeeds:            true
  LengthCut:              0
}
standard_seedfinderalgorithm.SpacePointAlg.Filter: false

standard_projectionmatchingalg:
{
  OptimizationEps:        0.01    # relative change of the obj.fn which stops optimization after adding a node
  FineTuningEps:          0.0001  # relative change of the obj.fn which stops fine-tuning of optimized track
  TrkValidationDist2D:    1.0     # max. distance [cm] used in the track validation in the "third" plane
  HitTestingDist2D:       0.5     # max. distance [cm] used in testing compatibility of hits with the track
  MinTwoViewFraction:     0.4     # min. fraction of track length covered with hits from many 2D views intertwinted with each other
  NodeMargin3D:           3.0     # margin in [cm] around TPC for allowed track node positions
  HitWeightZ:             1.0     # weights used for hits in U, V, Z planes:
  HitWeightV:             1.0     #    - use lower values for planes where hit position is less reliable (e.g. due to S/N)
  HitWeightU:             1.0     #    - relative ratios matter, sum does not need to be 1.0
}

standard_pmalgtracker:
{
  MinSeedSize1stPass:     20      # min. cluster size used to start building a track in the 1st pass
  MinSeedSize2ndPass:     4       # ..and in the 2nd pass: differentiate to speed up finding long tracks
                                  # w/o checking large number of possibilities, then use as small size
                                  # as reasonnable for used clustering algorithm to complete the search
                                  # in the second pass
  TrackLikeThreshold:     0.0     # CNN output threshold for track-like recognition; ClusterModuleLabel
                                  # needs to be associated to CNN outputs in case of threshold > 0; will
                                  # exclude obvious EM from tracking and tag clean electron tracks as PDG=11
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
                                  #
  FlipToBeam:             false   # set the track direction to increasing Z values
  FlipDownward:           false   # set the track direction to decreasing Y values (like cosmic rays)
  FlipToX:             	  false   # set the track direction to decreasing X values (like cosmic rays in dual phase)
  AutoFlip_dQdx:          false   # set the track direction to increasing dQ/dx (overrides FlipToBeam,
                                  # FlipDownward and FlipToX if significant rise of dQ/dx at the track end)
                                  #
  MergeWithinTPC:         false   # merge witnin single TPC; finds tracks best matching by angle, with limits:
  MergeTransverseShift:   2.0     #    - max. transverse displacement [cm] between tracks
  MergeAngle:             2.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  StitchBetweenTPCs:      true    # stitch between TPCs; finds tracks best matching by angle, with limits:
  StitchDistToWall:       3.0     #    - max. track endpoint distance [cm] to TPC boundary
  StitchTransverseShift:  3.0     #    - max. transverse displacement [cm] between tracks
  StitchAngle:           10.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  MatchT0inAPACrossing:   false   # match T0 of APA-crossing tracks using PMAlgStitcher
  MatchT0inCPACrossing:   false   # match T0 of CPA-crossing tracks using PMAlgStitcher

  Validation:             "hits"  # "hits":   uses hits to validate track
                                  # "adc":   uses adc image to validate tracks
                                  # "calib": uses hits to validate tracks and produce histograms to find adc thresholds
                                  #          which should be used in "adc" mode
  AdcValidationThr:       [1.0, 1.0, 1.0]    # threshold for not-empty pixel in the ADC image used for the track validation, per plane
  AdcImageAlg:            @local::standard_dataprovideralg
}

standard_pmalgfitter:
{
  TrackingOnlyPdg:        [0]     # PDG list to select which PFParticles should be reconstructed;
                                  # all PFP's are used if the list is empty or starts with 0
  TrackingSkipPdg:        [0]    # PDG list to select which PFParticles should NOT be reconstructed,
                                  # e.g. skip EM showers; no skipping if the list is empty or starts with 0
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
}

standard_beziertrackeralgorithm:
{	
  OverlapCut:            0.2
  DirectJoinDistance:    10.0
  TrackJoinAngle:        0.5          
  VertexImpactThreshold: 2.0
  VertexExtrapDistance:  5.0
  OccupancyThresh:       0.8
  TrackResolution:       2.0
  SeedFinder:            @local::standard_seedfinderalgorithm

}
standard_beziertrackeralgorithm.SeedFinder.LengthCut: 2

standard_trackstitcheralg:
{
  CosAngTolerance: 0.98
  SpptSepTolerance: 30.0 # cm
  CommonComponentStitch: true
}

standard_kalmanfilteralg:
{
  Trace: false
  MaxPErr: 0.25      # Maximum pointing error for free propagation.
  GoodPErr: 0.1      # Pointing error threshold for switching from linearized to free propataion.
  MaxIncChisq: 10.   # Incremental chisquare cut.
  MaxSeedIncChisq: 1000.  # Incremental chisquare cut in seed phase.
  MaxSmoothIncChisq: 100. # Incremental chisquare cut in smooth phase.
  MaxEndChisq: 10.   # Maximum incremental chisquare for endpoint hit.
  MinLHits: 20       # Minimum number of measurements for linearized propagation.
  MaxLDist: 10.      # Maximum distance to use linearized propagation using starting guess.
  MaxPredDist: 5.    # Maximum prediction distance to accept a hit.
  MaxSeedPredDist: 50. # Maximum prediction distance to accept a hit in seed phase.
  MaxPropDist: 50.   # Maximum propagation distance to candidate surface.
  MinSortDist: 0.    # Low threshold to resort hits.
  MaxSortDist: 2.    # High threshold to resort hits.
  MaxSamePlane: 3    # Maximum consecutive hits in same plane.
  GapDist: 3.        # Minimum gap distance.
  MaxNoiseHits: 3    # Maximum number of hits in noise cluster.
  MinSampleDist: 20. # Minimum sample distance (for momentum measurement).
  FitMomRange: true  # Fit momentum using range.
  FitMomMS: false    # Fit momentum using multiple scattering.

  # Graphical trace options.
  # For any kine of graphical tracing to work, you need to configure
  # the event display service to initialize the graphics system.

  GTrace: false      # Graphical trace flag.
  GTraceWW: 1200     # Window width (pixels).
  GTraceWH: 800      # Window height (pixels).
  GTraceXMin: -256.  # Graphical trace minimum x (same for each view).
  GTraceXMax: 512.   # Graphical trace maximum x (same for each view).
  GTraceZMin: [    0.,    0.,    0.]  # Graphical trace minimum z for each view.
  GTraceZMax: [ 1040., 1040., 1040.]  # Graphical trace maximum z for each view
}

standard_track3Dkalmanhitalg:
{
  MaxTcut:            10.           # Maximum delta ray energy in MeV for restricted dE/dx
  DoDedx:             false         # dE/dx enable flag.
  SelfSeed:           false         # Generate seeds internally.
  LineSurface:        false         # Store hits on line surfaces.
  MinSeedHits:        12            # Minimum number of hits per track seed.
  MinSeedChopHits:    50            # Potentially chop seeds that exceed this length.
  MaxChopHits:        20            # Maximum number of hits to chop from each end of seed.
  MaxSeedChiDF:       20.           # Maximum seed track chisquare/dof.
  MinSeedSlope:       0.0           # Minimum seed slope (dx/dz).
  InitialMomentum:    0.5           # Initial momentum (GeV/c).
  KalmanFilterAlg:    @local::standard_kalmanfilteralg
  SeedFinderAlg:      @local::standard_seedfinderalgorithm
}

standard_cosmictrackeralg:
{
    SPTAlg:   0
    TrajOnly: false
    TMatch:   2.5
    SMatch:   1
}

argoneut_spacepointalg:      @local::standard_spacepointalg
argoneut_kalmanfilteralg:    @local::standard_kalmanfilteralg
argoneut_cosmictrackeralg:   @local::standard_cosmictrackeralg
argoneut_cosmictrackeralg.SPTAlg:   1
argoneut_cosmictrackeralg.TrajOnly: true

bo_spacepointalg: @local::standard_spacepointalg
bo_spacepointalg.MinViews: 2
bo_spacepointalg.EnableW:  true
bo_kalmanfilteralg:          @local::standard_kalmanfilteralg
bo_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
bo_seedfinderalgorithm.SpacePointAlg :           @local::bo_spacepointalg
bo_seedfinderalgorithm.SpacePointAlg.PreferColl: true
bo_seedfinderalgorithm.SpacePointAlg.Filter:     false
bo_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
bo_beziertrackeralgorithm.SeedFinder:            @local::bo_seedfinderalgorithm

microboone_spacepointalg:                                @local::standard_spacepointalg
microboone_spacepointalg.MinViews:                       3
microboone_spacepointalg.EnableW:                        true
microboone_kalmanfilteralg:                              @local::standard_kalmanfilteralg
microboone_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
microboone_seedfinderalgorithm.SpacePointAlg : {
  @table::microboone_spacepointalg
  PreferColl: true
  Filter:     false
}
microboone_track3Dkalmanhitalg: {
  @table::standard_track3Dkalmanhitalg
  KalmanFilterAlg: @local::microboone_kalmanfilteralg
  SeedFinderAlg:   @local::microboone_seedfinderalgorithm
}
microboone_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
microboone_beziertrackeralgorithm.SeedFinder:            @local::microboone_seedfinderalgorithm
microboone_trackstitcheralg:  @local::standard_trackstitcheralg

dune10kt_spacepointalg:          @local::standard_spacepointalg
dune10kt_spacepointalg.MinViews: 3
dune10kt_spacepointalg.EnableW:  true
dune10kt_kalmanfilteralg:        @local::standard_kalmanfilteralg
dune34kt_spacepointalg:          @local::dune10kt_spacepointalg
dune34kt_kalmanfilteralg:        @local::dune10kt_kalmanfilteralg
dune35t_spacepointalg: @local::standard_spacepointalg
dune35t_spacepointalg.MinViews:  3
dune35t_spacepointalg.EnableW:   true
dune35t_kalmanfilteralg:         @local::standard_kalmanfilteralg
dune35t_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
dune35t_seedfinderalgorithm.SpacePointAlg :           @local::dune35t_spacepointalg
dune35t_seedfinderalgorithm.SpacePointAlg.PreferColl: true
dune35t_seedfinderalgorithm.SpacePointAlg.Filter:     false


END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

###################################################################
# Added July-2013: These are the parameters/modules associated with
# the MicroBooNE PMT ADC and FEMs.
###################################################################

standard_optdetdigitizer:
{
  module_type:            "OptDetDigitizer"  # The module we're trying to execute
  InputModule:            "largeant"         # The name of the process that generated the photons
  SimGainSpread:          true
}

###################################################################


standard_beamflashcompat:
{
  module_type:            "BeamFlashCompatibilityCheck"
  TrackModuleLabel:       "beziertracker"
  FlashModuleLabel:       "opflash"
  BezierResolution:       100
  SingleChannelCut:       4
  IntegralCut:            4
}

###################################################################


standard_flashclustermatch:
{
  module_type:            "FlashClusterMatch"
  ClusterModuleLabel:     "fuzzycluster"
  FlashModuleLabel:       "opflash"
  SingleChannelCut:       5
  IntegralCut:            5
  MinSptsForOverlap:      5
  SpacePointAlg:          @local::standard_spacepointalg
  CaloAlg:                @local::standard_calorimetryalgmc

}

###################################################################


standard_fifohistana:
{
  module_type:            "FIFOHistogramAna"
  InputModule:            "daq" 
}

###################################################################

#
# OpHit finding algorithms
#

standard_algo_sipm:
{
    Name:           "SiPM"
    ADCThreshold:      13
    MinWidth:          60
    SecondThreshold:    1
    Pedestal:        1500
}

standard_algo_threshold:
{
    Name:           "Threshold"
    StartADCThreshold : 3
    EndADCThreshold :   2
    NSigmaThresholdStart : 5
    NSigmaThresholdEnd : 3
}

standard_algo_fixedwindow:
{ 
    Name:      "FixedWindow"
    StartIndex: 0
    EndIndex:  20
}

standard_algo_slidingwindow:
{
    Name:           "SlidingWindow"
    NumPreSample:    3
    ADCThreshold:    4
    NSigmaThreshold: 4
    EndADCThreshold: 2
    EndNSigmaThreshold: 1
    Verbosity:       false
}

standard_algo_cfd:
{
   Name: "CFD"
   # CFD fraction
   Fraction: 0.9
   # CFD number of samples delay
   Delay: 2
   # Number of samples to average before pulse
   # to use as constant baseline under waveform
   # BaselinePreSample: 5
   # Threshold * mode_sigma used to determine if we inside a peak
   # for CFD crossing
   PeakThresh: 7.5
   # Threshold * mode_sigma to determine ending of inside peak @ pulse start
   StartThresh: 5.0
   # Threshold * mode_sigma to determine pulse ending @ tail
   EndThresh: 1.5 
}

###################################################################

#
# Pedestal algorithms
#

standard_algo_pedestal_edges:
{
    Name: "Edges"
    NumSampleFront: 3
    NumSampleTail:  3
    Method:         0
}

standard_algo_pedestal_rollingmean:
{
    Name: "RollingMean"
    SampleSize:      2
    MaxSigma:        0.5
    PedRangeMax:     2150
    PedRangeMin:     100
}

standard_algo_pedestal_rmsslider:
{
    Name: "RmsSlider"
    SampleSize:       7
    Threshold:        0.6
    MaxSigma:         0.5
    PedRangeMax:      2150
    PedRangeMin:      100 
    Verbose:          false
    NWaveformsToFile: 12
}

standard_algo_pedestal_ub:
{
    Name: "UB"
    BeamGateSamples : 1500
    # You need to include parameters fed to PedTruncatedMean since that
    # algo is called for beam gate sample as well
    # Sliding mean number of samples
    SampleSize:      2
    MaxSigma:        0.5
    PedRangeMax:     2150
    PedRangeMin:     100
    
    # RandomRange: 5
    # RandomRangeDivisions: 4.0
    Threshold: 4
    # Number of ADC count to shift during random sampling
    # RandomRangeShift: -0.5
    # This parameter get's multiplied by mode_sigma to determine
    # whether or not samples are close enough to be filled with random baseline
    # between gaps
    DiffBetweenGapsThreshold: 2
    DiffADCCounts: 2
    NPrePostSamples: 5
}

###################################################################

standard_preco_manager:
{
    module_type: "PulseRecoManager"
}

###################################################################

standard_ophit:
{
  module_type:    "OpHitFinder"
  GenModule:      "generator"
  InputModule:    "optreadout"
  InputLabels:    [ "" ]
  ChannelMasks:   []
  HitThreshold:   0.2    # PE
  UseCalibrator:  false  # If set to false, SPE parameters below
                         # are used     
  AreaToPE:       false  # Use area to calculate number of PEs
  SPEArea:        1330   # If AreaToPE is true, this number is 
                         # used as single PE area (in ADC counts)
  SPEShift:       0      # Baseline offset in ADC->SPE conversion
  reco_man:       @local::standard_preco_manager
  HitAlgoPset:    @local::standard_algo_threshold
  PedAlgoPset:    @local::standard_algo_pedestal_edges
}

###################################################################

standard_opflash:
{
  module_type:   "OpFlashFinder"
  InputModule:   "ophit"
  BinWidth:       1   # us | Pulse finding parameters
  FlashThreshold: 2   # PE
  WidthTolerance: 0.5 # unitless 
  TrigCoinc:      2.5 # in microseconds!
}

###################################################################

standard_ledcalibrationana:
{
  module_type:            "LEDCalibrationAna"
  InputModule:            "daq"
  TriggerDelay:           0
  CoincThreshold:         5
  TriggerChannel:         32
  AreaMin:                0
  AreaMax:                30000
  AreaDivs:               200
  MaxTimeMean:            700
  MaxTimeThresh:          50
  MakeNonCoincTree:       true
  reco_man:               @local::standard_preco_manager
  algo_threshold:         @local::standard_algo_threshold
}

###################################################################

standard_simphotoncounter:
{
  module_type:            "SimPhotonCounter"
  Verbosity:               0 
  InputModule:            "largeant" 
  MakeAllPhotonsTree:      true
  MakeDetectedPhotonsTree: true
  MakeOpDetsTree:          true
  MakeOpDetEventsTree:     true
}


standard_opdigiana:
{
  module_type:            "OpDigiAna"
  InputModule:            "opdigi"
  InstanceName:           "" 
  ZeroSupThresh:           0.5

  MakeBipolarHist:         true
  MakeUnipolarHist:        true
}

standard_flashpurity:
{
  module_type:            "FlashPurityCheckAna"
  GenieGenModuleLabel:    "generator"  
  TrackModuleLabel:       "beziertracker"
  MatchModuleLabel:       "beamflashcompat"
  OpFlashModuleLabel:     "opflash" 		
}


standard_opflashtruth:
{
  module_type:            "OpFlashMCTruthAna"
  TruthInputModule:       "nugenerator"  
  FlashInputModule:       "opflash"  
 		
}

standard_opflashana:
{
  module_type:            "OpFlashAna"
  OpFlashModuleLabel:     "opflash"  
  OpHitModuleLabel:       "ophit"  
  YMin:                    -50
  YMax:                    50
  ZMin:                    0
  ZMax:                    1200
	
  MakeFlashTimeHist:       false
  MakeFlashPosHist:        false
  MakePerFlashHists:       false

  MakePerFlashTree:        true
  MakePerOpHitTree:        true
  MakeFlashBreakdownTree:  true
  MakeFlashHitMatchTree:   true
  MakePerEventFlashTree:   false

}

standard_opdigi:
{
  module_type:		  "OpMCDigi"
  InputModule:		  "largeant"
  QE:                      0.01 
  SaturationScale:         2000
  DarkRate:                10000
  CompressionType:    "none"        # 
}

standard_tracktimeassoc:
{
  module_type:            "TrackTimeAssoc"
  TrackModuleLabel:       "beziertracker"
  FlashModuleLabel:       "opflash"
  BezierResolution:       100
  PairingMode:            1
  LengthCut:              20
  PECut:                  20
}


standard_tracktimeassocana:
{
  module_type:            "TrackTimeAssocAna"
  MatchModuleLabel:       "tracktimeassoc"
}

standard_bodataframeinput:
{
   module_type:          "BoDataFrameInput"
   InputFile:            "rawdata.txt" 
}

standard_stitchpmtframes:
{
   module_type:          "StitchPMTFrames"
   InputModule:          "bodataframeinput"
   FrameSize:            2048
   ADCOffset:            2048
}

standard_simphotoncounteralg:
{
  SimPhotonCounterParams:
  [
   { 
     MinPromptTime: -9e9
     MaxPromptTime: 100
     MinLateTime:   100
     MaxLateTime:   9e9
     MinWavelength: 0
     MaxWavelength: 1e6
   }
  ]
}

standard_flashhypothesisanaalg:
{
    SimPhotonCounterIndex: 0
    dEdx: 2.1
    XOffset: 0.0
    SimPhotonCounterAlgParams: @local::standard_simphotoncounteralg
}

standard_flashhypothesisanamodule:
{
    module_type: "FlashHypothesisAna"
    MCTrackLabel: "mctrack"
    MCSimPhotonsLabel: "largeant"
    FlashHypothesisAnaAlgParams: @local::standard_flashhypothesisanaalg
}

standard_opflashsimpleanamodule:
{
    module_type: "OpFlashSimpleAna"
    OpFlashModuleLabel: "opflash"
    OpHitModuleLabel:   "ophit"
    MakeOpDetPEHist:    "true"
}

microboone_opdetreformatter:
{
   module_type: "OpticalRawDigitReformatter"
   GenModule:       "generator"
   InputModule:     "optreadout"
}


microboone_simphotoncounter: @local::standard_simphotoncounter
microboone_opdigi:           @local::standard_opdigi
microboone_tracktimeassoc:   @local::standard_tracktimeassoc
microboone_opflashtruth:     @local::standard_opflashtruth

microboone_opdigiana:        @local::standard_opdigiana
microboone_opflashana:       @local::standard_opflashana

#microboone_optdetdigitizer:  @local::standard_optdetdigitizer
#microboone_optical_readout:  @local::standard_optical_readout

END_PROLOG
BEGIN_PROLOG

##################################################
#
# SSP module algorithms
#

standard_algo_sspleadingedge:
{
    Name:        "SSP_LED"
    ADCThreshold:      10
   #MinWidth:          10
   #SecondThreshold:    1
    Pedestal:        1500
    DWindow:           10
    ReadoutWd:        700
    PreTrg:            20
}

####################################################

END_PROLOG


BEGIN_PROLOG

dunefd_opdigi_unganged:
{
   module_type:          "OpDetDigitizerDUNE"
   InputModule:          "largeant" # Module that created simphotons

   # Assume 25 V bias with Sensl C-series SiPMs
   # Gain at this voltage is 4e6 -- that this corresponds to
   # the MaxAmplitude and VoltageToADC below has not been confirmed.
   
   VoltageToADC:         151.5      # Converting mV to ADC counts (counts in 1 mV)
   LineNoiseRMS:           2.6      # Pedestal RMS in ADC counts, likely an underestimate
   DarkNoiseRate:         10.0      # In Hz, Ranges 2-50 depending on Vbias
   CrossTalk:              0.20     # Probability of producing 2 PE for 1 incident photon
   # Afterpulsing:         0.006    # Afterpulsing is not yet simulated
   Pedestal:            1500        # in ADC counts
   DefaultSimWindow:    true        # Use -1*drift window as the start time and
                                    # the TPC readout window end time as the end time
   FullWaveformOutput: false        # Output full waveform. Be careful with this option:
                                    # setting it to "true" can result in large output files
   TimeBegin:              0        # In us (not used if DefaultSimWindow is set to true)
   TimeEnd:             1600        # In us (not used if DefaultSimWindow is set to true)
   PreTrigger:           100        # In ticks
   ReadoutWindow:       1000        # In ticks
   algo_threshold: @local::standard_algo_sspleadingedge

   Padding:              100        # In ticks

   PulseLength:		         5.2
   PeakTime:		           0.260
   MaxAmplitude:	         0.12
   FrontTime:		           0.009
   BackTime:		           0.476
   SSP_LED_DigiTree:    false	    #To create a SSP LED trigger Ttree
   
   # readout window in optical ticks
   # buffer before waveform
   # see SSP manual, dune-doc-9928, p. 58
   #
   # IU waveform window
   # ReadoutWindow:       700
   # ReadoutPretrigger:   100
   #
   # SSP Maximum window
   # ReadoutWindow:      2046
   # ReadoutPretrigger:   100
   
   # SaturationScale:         16383 # 2^14 - 1, based on SSP Data
}

dunefd_opdigi_threegang:	                            @local::dunefd_opdigi_unganged
dunefd_opdigi_threegang.PulseLength:	                5.2
dunefd_opdigi_threegang.PeakTime:	                    0.028
dunefd_opdigi_threegang.MaxAmplitude:	                0.0594 # * VoltageToADC = 9 ADC/PE
dunefd_opdigi_threegang.FrontTime:	                  0.013
dunefd_opdigi_threegang.BackTime:	                    0.386
dunefd_opdigi_threegang.algo_threshold.ADCThreshold: 15.000 # "2 PE" threshold = 1.7 PE

dunefd_opdigi: @local::dunefd_opdigi_threegang

protodune_opdigi: @local::dunefd_opdigi_threegang
protodune_opdigi.algo_threshold: @local::standard_algo_sspleadingedge


dunefd_simphotoncounter:
{
  module_type:            "SimPhotonCounter"
  Verbosity:               0
  InputModule:            "largeant"
  MakeAllPhotonsTree:      true
  MakeDetectedPhotonsTree: true
  MakeOpDetsTree:          true
  MakeOpDetEventsTree:     true
}

dunefd_tracktimeassoc:           @local::standard_tracktimeassoc
dunefd_ophit_single:             @local::standard_ophit
dunefd_ophit_single.InputModule: "opdigi"
dunefd_ophit_single.HitAlgoPset: @local::standard_algo_sipm
dunefd_ophit_single.AreaToPE:    true
dunefd_ophit_single.SPEArea:     1106
dunefd_ophit_single.SPEShift:    0.304

dunefd_ophit_threegang:          @local::dunefd_ophit_single
dunefd_ophit_threegang.SPEArea:  264
dunefd_ophit_threegang.SPEShift: 0.430
dunefd_ophit_threegang.HitAlgoPset.ADCThreshold: 6

dunefd_ophit: @local::dunefd_ophit_threegang

dunefd_opflash:                 @local::standard_opflash
dunefd_opflash.FlashThreshold:  3.5


# These calib values would be for MC only
protodune_ophit: @local::dunefd_ophit
protodune_ophit.SPEArea: 410
protodune_ophit.SPESize: 0.451
protodune_opflash: @local::dunefd_opflash

# For real data set the input module and label
# Use the PD Calibrator service for calibration 
# instead of above values.
protodune_ophit_data_unsplit: @local::protodune_ophit
protodune_ophit_data_unsplit.InputModule:  ssprawdecoder
protodune_ophit_data_unsplit.InputLabels: [ "daq" ]
protodune_ophit_data_unsplit.UseCalibrator: true
protodune_ophit_data_unsplit.HitAlgoPset.ADCThreshold: 10

# Make variants for internal/external split waveforms
protodune_ophit_data_internal: @local::protodune_ophit_data_unsplit
protodune_ophit_data_external: @local::protodune_ophit_data_unsplit
protodune_ophit_data_both:     @local::protodune_ophit_data_unsplit
protodune_ophit_data_internal.InputLabels: [ "internal" ]
protodune_ophit_data_external.InputLabels: [ "external" ]
protodune_ophit_data_both.InputLabels:     [ "internal", "external" ]

protodune_opflash_data_internal: @local::protodune_opflash
protodune_opflash_data_internal.InputModule: "ophitInternal"
protodune_opflash_data_external: @local::protodune_opflash
protodune_opflash_data_external.InputModule: "ophitExternal"


dunefd_opdigiana:
{
   module_type:      "OpDetDigiAnaDUNE"
   InputModule:      "opdigi"  # Module that created raw::OpDetWaveforms
   InstanceName:     ""    
   SSP_LED_AnaTree:  false 
}
dunefd_opflashana:       @local::standard_opflashana
dunefd_opflashana.MakePerEventFlashTree: true


dunefd_averagewaveform:
{
   module_type:  "AverageWaveform"
   InputModule:  "opdigi"  # Module that created raw::OpDetWaveforms
   InstanceName: ""     
}

dunefd_calibrationanalysis:
{
   module_type:  "CalibrationAnalysis"
   InputModule:  "opdigi"  # Module that created raw::OpDetWaveforms
   OpHitModule:  "ophit"   # Module that created recob::OpHits
   InstanceName: ""     
}

dune35t_simphotoncounter: @local::standard_simphotoncounter

dune35t_opdigi:         @local::dunefd_opdigi
dune35t_tracktimeassoc: @local::standard_tracktimeassoc

dune35t_ophit:   @local::dunefd_ophit
dune35t_opflash: @local::dunefd_opflash

dune35t_ophit_data:             @local::dune35t_ophit
dune35t_ophit_data.InputModule:  ssptooffline
dune35t_ophit_data.InputLabels: [ "offlinePhoton" ]
dune35t_opflash_data:           @local::dune35t_opflash

dune35t_ophit_splitdata:             @local::dune35t_ophit
dune35t_ophit_splitdata.InputModule:  SplitterInput
dune35t_ophit_splitdata.InputLabels: [ "PHOTON" ]
dune35t_opflash_splitdata:           @local::dune35t_opflash

dune35t_opdigiana:        @local::dunefd_opdigiana
dune35t_opflashana:       @local::standard_opflashana
dune35t_opdigiana.MakeUnipolarHist: false

dune35t_opdigiana_data:   @local::dune35t_opdigiana
dune35t_opdigiana_data.InputModule: ssptooffline
dune35t_opdigiana_data.InstanceName: offlinePhoton

dune35t_opdigiana_splitdata:   @local::dune35t_opdigiana
dune35t_opdigiana_splitdata.InputModule: SplitterInput
dune35t_opdigiana_splitdata.InstanceName: PHOTON


dune35t_averagewaveform: @local::dunefd_averagewaveform
dune35t_averagewaveform_data: @local::dune35t_averagewaveform
dune35t_averagewaveform_data.InputModule: ssptooffline
dune35t_averagewaveform_data.InstanceName: offlinePhoton

dune35t_averagewaveform_splitdata: @local::dune35t_averagewaveform
dune35t_averagewaveform_splitdata.InputModule: SplitterInput
dune35t_averagewaveform_splitdata.InstanceName: Photon

dune35t_calibrationanalysis: @local::dunefd_calibrationanalysis
dune35t_calibrationanalysis_data: @local::dune35t_calibrationanalysis
dune35t_calibrationanalysis_data.InputModule: ssptooffline
dune35t_calibrationanalysis_data.OpHitModule: ophit
dune35t_calibrationanalysis_data.InstanceName: offlinePhoton



dunedphase3x1x1_opdigi:
{
   module_type:          "OpDetDigitizerDUNEDP"
#  InputModule:          ["largeant","photPropS2"] # Module that created simphotons - Use this when simulating S2 light
   InputModule:          ["largeant"] # Module that created simphotons
   VoltageToADC:         2.048      # Converting mV to ADC counts (counts in 1 mV)
   LineNoiseRMS:         0.8      # Pedestal RMS in ADC counts, likely an underestimate
   CrossTalk:            0#0.20     # Probability of producing 2 PE for 1 incident photon
   Pedestal:             100        # in ADC counts
   Gain:                 4.1        # in ADC counts
   DefaultSimWindow:     false        # Use -1*drift window as the start time and
                                     # the TPC readout window end time as the end time
   FullWaveformOutput:   true        # Output full waveform. Be careful with this option:
                                    # setting it to "true" can result in large output files
   NegativeSignal:       false
   PreTrigger:           0        # In ticks This must be zero, otherwise we won't find hits in the pretrigger.
   ReadoutWindow:        25e4        # In ticks
   algo_threshold: @local::standard_algo_sspleadingedge

   Padding:              4000        # In ticks
   SSP_LED_DigiTree:     false	    #To create a SSP LED trigger Ttree
}

dunedphase3x1x1_opdigiana: @local::dunefd_opdigiana

protodunedphase_opdigi: @local::dunedphase3x1x1_opdigi
protodunedphase_opdigi.FullWaveformOutput: false
protodunedphase_opdigi.Gain:            10.25        # in ADC counts x ticks
protodunedphase_opdigi.DefaultSimWindow: false
protodunedphase_opdigi.PreTrigger: 0
protodunedphase_opdigi.ReadoutWindow: 5e5
protodunedphase_opdigi.Padding: 4000
protodunedphase_opdigi.CustomQEperOpDet: true
protodunedphase_opdigi.QEVector:
[0.036,0.036,0.120,0.036,0.036,0.036,0.036,0.036,0.036,0.036,
 0.120,0.036,0.036,0.036,0.036,0.120,0.036,0.036,0.036,0.036,
 0.036,0.120,0.036,0.036,0.036,0.036,0.120,0.036,0.036,0.036,
 0.036,0.036,0.036,0.036,0.120,0.036]
protodunedphase_opdigi.algo_threshold: #algorith used to split the waveforms when FullWaveformOutput: false
{
    Name:            "SSP_LED"
    ADCThreshold:    4
    Pedestal:        100
    DWindow:         10
    ReadoutWd:       4000
    PreTrg:          300
}

protodunedphase_opdigiana: @local::dunefd_opdigiana

dunefddphase_opdigi: @local::dunedphase3x1x1_opdigi
dunefddphase_opdigi.FullWaveformOutput: false
dunefddphase_opdigi.Gain:            41        # in ADC counts x ticks
dunefddphase_opdigi.DefaultSimWindow: true
dunefddphase_opdigi.PreTrigger: 0
dunefddphase_opdigi.Padding: 4000
dunefddphase_opdigi.algo_threshold: #algorith used to split the waveforms when FullWaveformOutput: false
{
    Name:            "SSP_LED"
    ADCThreshold:    10
    Pedestal:        100
    DWindow:         10
    ReadoutWd:       4000
    PreTrg:          300
}

dunefddphase_opdigiana: @local::dunefd_opdigiana


END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

dune35t_calorimetryalgdata:	@local::standard_calorimetryalgdata
dune35t_calorimetryalgmc:	@local::standard_calorimetryalgmc

### Consts at 250 V cm-1
#dune35t_calorimetryalgmc.CalAmpConstants:  [ 0.9033e-3, 1.0287e-3, 0.8800e-3 ]
#dune35t_calorimetryalgmc.CalAreaConstants: [ 5.1822e-3, 5.2682e-3, 5.3962e-3 ]

### Consts at 500 V cm-1
dune35t_calorimetryalgmc.CalAmpConstants:  [ 6.522e-4, 7.427e-4, 7.822e-4 ]
dune35t_calorimetryalgmc.CalAreaConstants: [ 3.742e-3, 3.804e-3, 4.796e-3 ]

dune35t_calodata:                        @local::standard_calodata
dune35t_calodata.CaloAlg:                @local::dune35t_calorimetryalgdata
dune35t_calodata.T0ModuleLabel:          "mctrutht0"
dune35t_calodata.CaloAlg.CaloUseModBox:   true

dune35t_calomc:                        @local::standard_calomc
dune35t_calomc.CaloAlg:	               @local::dune35t_calorimetryalgmc
dune35t_calomc.T0ModuleLabel:          "mctrutht0"
dune35t_calomc.CaloAlg.CaloUseModBox:  true

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

dune10kt_calorimetryalgdata:	@local::standard_calorimetryalgdata
dune10kt_calorimetryalgmc:	@local::standard_calorimetryalgmc

dune10kt_calorimetryalgmc.CalAmpConstants:  [ 0.9033e-3, 1.0287e-3, 0.8800e-3 ]
dune10kt_calorimetryalgmc.CalAreaConstants: [ 4.833e-3, 4.815e-3, 4.966e-3 ]

dune10kt_calodata:                       @local::standard_calodata
dune10kt_calodata.CaloAlg:               @local::dune10kt_calorimetryalgdata
dune10kt_calodata.CaloAlg.CaloUseModBox: true

dune10kt_calomc:                         @local::standard_calomc
dune10kt_calomc.CaloAlg:                 @local::dune10kt_calorimetryalgmc
dune10kt_calomc.CaloAlg.CaloUseModBox:   true

END_PROLOG

BEGIN_PROLOG

standard_trackshowersepalg:
{
  ConeAngle: 15
  CylinderRadius: 20.
  TrackVertexCut: 5.
  CylinderCut: 0.2
  ShowerConeCut: 5.
  RectangleWidth: 1.
  RectangleCut: 0.5
}

standard_showerenergyalg:
{
  UGradient:   7.69985e-06
  UIntercept: -0.0160794
  VGradient:   7.70957e-06
  VIntercept: -0.0160174
  ZGradient:   7.30337e-06
  ZIntercept: -0.0191387
}

dune35t_showerenergy:
{
  # Last updated M Wallbank, 8/8/16
  # LArSoft v06_01_00
  UGradient:   8.1406e-06
  UIntercept: -0.00772234
  VGradient:   7.98303e-06
  VIntercept: -0.00442084
  ZGradient:   7.98278e-06
  ZIntercept: -0.0143167
}

dune35tdata_showerenergy:
{
  # Last updated M Wallbank, 10/4/16
  # Only calculated for the collection plane
  UGradient:   5.88161e-3
  UIntercept: -1.36686
  VGradient:   5.88161e-3
  VIntercept: -1.36686
  ZGradient:   5.88161e-3
  ZIntercept: -1.36686
  # M Wallbank 8/10/16
  # UGradient:   5.53072e-3
  # UIntercept: -33.6764
  # VGradient:   5.53072e-3
  # VIntercept: -33.6764
  # ZGradient:   5.53072e-3
  # ZIntercept: -33.6764
}

dune10kt_showerenergy:
{
  # Last updated M Wallbank, 8/8/16
  # LArSoft v06_00_01
  UGradient:   7.69985e-06
  UIntercept: -0.0160794
  VGradient:   7.70957e-06
  VIntercept: -0.0160174
  ZGradient:   7.30337e-06
  ZIntercept: -0.0191387
}


END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

standard_dataprovideralg:
{
 DriftWindow:          6 # downsampling window (in drift ticks)
 DownscaleFullView: true # downsample full view

 DownscaleFn:     "mean" # "maxpool" takes the max value in the window,
                         # "maxmean" is mean from 3 ADC's around the max,
                         # "mean" is the mean value of all ADC's in the window

 BlurKernel:      []  # apply channel-channel blurring
 NoiseSigma:      0   # apply white noise
 CoherentSigma:   0   # apply coherent noise

 CalorimetryAlg:    @local::standard_calorimetryalgmc  # used to eliminate amplitude variation due to electron lifetime
 CalibrateAmpl:     false # calibrate ADC values with CalAmpConstants (allows different gains in MC and data)
 CalibrateLifetime: true  # calibrate ADC values according to the electron lifetime

 # The following settings allow to scale the interesting ADC range into desired range of values,
 # e.g. convenient for the CNN or for the conversion to decimal type range. Default values
 # provided here will result with the scaling factor of 0.1.
 AdcMax:            150.0 # input saturation max value
 AdcMin:            -50.0 # input saturation min value
 OutMax:             15.0 # output max value
 OutMin:             -5.0 # output min value
}

END_PROLOG

BEGIN_PROLOG

standard_spacepointalg:
{
  MaxDT:      2.0
  MaxS:       0.3
  MinViews:   2
  EnableU:    true
  EnableV:    true
  EnableW:    false
  Filter:     true
  Merge:      false
  PreferColl: false
}

standard_seedfinderalgorithm:
{
  SpacePointAlg:          @local::standard_spacepointalg
  InitSeedLength:         2
  MinPointsInSeed:        4
  Refits:                 5
  HitResolution:          1
  OccupancyCut:           0.8
  MaxViewRMS:             [2,2,2]
  ExtendSeeds:            true
  LengthCut:              0
}
standard_seedfinderalgorithm.SpacePointAlg.Filter: false

standard_projectionmatchingalg:
{
  OptimizationEps:        0.01    # relative change of the obj.fn which stops optimization after adding a node
  FineTuningEps:          0.0001  # relative change of the obj.fn which stops fine-tuning of optimized track
  TrkValidationDist2D:    1.0     # max. distance [cm] used in the track validation in the "third" plane
  HitTestingDist2D:       0.5     # max. distance [cm] used in testing compatibility of hits with the track
  MinTwoViewFraction:     0.4     # min. fraction of track length covered with hits from many 2D views intertwinted with each other
  NodeMargin3D:           3.0     # margin in [cm] around TPC for allowed track node positions
  HitWeightZ:             1.0     # weights used for hits in U, V, Z planes:
  HitWeightV:             1.0     #    - use lower values for planes where hit position is less reliable (e.g. due to S/N)
  HitWeightU:             1.0     #    - relative ratios matter, sum does not need to be 1.0
}

standard_pmalgtracker:
{
  MinSeedSize1stPass:     20      # min. cluster size used to start building a track in the 1st pass
  MinSeedSize2ndPass:     4       # ..and in the 2nd pass: differentiate to speed up finding long tracks
                                  # w/o checking large number of possibilities, then use as small size
                                  # as reasonnable for used clustering algorithm to complete the search
                                  # in the second pass
  TrackLikeThreshold:     0.0     # CNN output threshold for track-like recognition; ClusterModuleLabel
                                  # needs to be associated to CNN outputs in case of threshold > 0; will
                                  # exclude obvious EM from tracking and tag clean electron tracks as PDG=11
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
                                  #
  FlipToBeam:             false   # set the track direction to increasing Z values
  FlipDownward:           false   # set the track direction to decreasing Y values (like cosmic rays)
  FlipToX:             	  false   # set the track direction to decreasing X values (like cosmic rays in dual phase)
  AutoFlip_dQdx:          false   # set the track direction to increasing dQ/dx (overrides FlipToBeam,
                                  # FlipDownward and FlipToX if significant rise of dQ/dx at the track end)
                                  #
  MergeWithinTPC:         false   # merge witnin single TPC; finds tracks best matching by angle, with limits:
  MergeTransverseShift:   2.0     #    - max. transverse displacement [cm] between tracks
  MergeAngle:             2.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  StitchBetweenTPCs:      true    # stitch between TPCs; finds tracks best matching by angle, with limits:
  StitchDistToWall:       3.0     #    - max. track endpoint distance [cm] to TPC boundary
  StitchTransverseShift:  3.0     #    - max. transverse displacement [cm] between tracks
  StitchAngle:           10.0     #    - max. angle [degree] between tracks (nearest segments)
                                  #
  MatchT0inAPACrossing:   false   # match T0 of APA-crossing tracks using PMAlgStitcher
  MatchT0inCPACrossing:   false   # match T0 of CPA-crossing tracks using PMAlgStitcher

  Validation:             "hits"  # "hits":   uses hits to validate track
                                  # "adc":   uses adc image to validate tracks
                                  # "calib": uses hits to validate tracks and produce histograms to find adc thresholds
                                  #          which should be used in "adc" mode
  AdcValidationThr:       [1.0, 1.0, 1.0]    # threshold for not-empty pixel in the ADC image used for the track validation, per plane
  AdcImageAlg:            @local::standard_dataprovideralg
}

standard_pmalgfitter:
{
  TrackingOnlyPdg:        [0]     # PDG list to select which PFParticles should be reconstructed;
                                  # all PFP's are used if the list is empty or starts with 0
  TrackingSkipPdg:        [0]    # PDG list to select which PFParticles should NOT be reconstructed,
                                  # e.g. skip EM showers; no skipping if the list is empty or starts with 0
                                  #
  RunVertexing:           false   # find vertices, join with tracks, reoptimize track-vertex structure
}

standard_beziertrackeralgorithm:
{	
  OverlapCut:            0.2
  DirectJoinDistance:    10.0
  TrackJoinAngle:        0.5          
  VertexImpactThreshold: 2.0
  VertexExtrapDistance:  5.0
  OccupancyThresh:       0.8
  TrackResolution:       2.0
  SeedFinder:            @local::standard_seedfinderalgorithm

}
standard_beziertrackeralgorithm.SeedFinder.LengthCut: 2

standard_trackstitcheralg:
{
  CosAngTolerance: 0.98
  SpptSepTolerance: 30.0 # cm
  CommonComponentStitch: true
}

standard_kalmanfilteralg:
{
  Trace: false
  MaxPErr: 0.25      # Maximum pointing error for free propagation.
  GoodPErr: 0.1      # Pointing error threshold for switching from linearized to free propataion.
  MaxIncChisq: 10.   # Incremental chisquare cut.
  MaxSeedIncChisq: 1000.  # Incremental chisquare cut in seed phase.
  MaxSmoothIncChisq: 100. # Incremental chisquare cut in smooth phase.
  MaxEndChisq: 10.   # Maximum incremental chisquare for endpoint hit.
  MinLHits: 20       # Minimum number of measurements for linearized propagation.
  MaxLDist: 10.      # Maximum distance to use linearized propagation using starting guess.
  MaxPredDist: 5.    # Maximum prediction distance to accept a hit.
  MaxSeedPredDist: 50. # Maximum prediction distance to accept a hit in seed phase.
  MaxPropDist: 50.   # Maximum propagation distance to candidate surface.
  MinSortDist: 0.    # Low threshold to resort hits.
  MaxSortDist: 2.    # High threshold to resort hits.
  MaxSamePlane: 3    # Maximum consecutive hits in same plane.
  GapDist: 3.        # Minimum gap distance.
  MaxNoiseHits: 3    # Maximum number of hits in noise cluster.
  MinSampleDist: 20. # Minimum sample distance (for momentum measurement).
  FitMomRange: true  # Fit momentum using range.
  FitMomMS: false    # Fit momentum using multiple scattering.

  # Graphical trace options.
  # For any kine of graphical tracing to work, you need to configure
  # the event display service to initialize the graphics system.

  GTrace: false      # Graphical trace flag.
  GTraceWW: 1200     # Window width (pixels).
  GTraceWH: 800      # Window height (pixels).
  GTraceXMin: -256.  # Graphical trace minimum x (same for each view).
  GTraceXMax: 512.   # Graphical trace maximum x (same for each view).
  GTraceZMin: [    0.,    0.,    0.]  # Graphical trace minimum z for each view.
  GTraceZMax: [ 1040., 1040., 1040.]  # Graphical trace maximum z for each view
}

standard_track3Dkalmanhitalg:
{
  MaxTcut:            10.           # Maximum delta ray energy in MeV for restricted dE/dx
  DoDedx:             false         # dE/dx enable flag.
  SelfSeed:           false         # Generate seeds internally.
  LineSurface:        false         # Store hits on line surfaces.
  MinSeedHits:        12            # Minimum number of hits per track seed.
  MinSeedChopHits:    50            # Potentially chop seeds that exceed this length.
  MaxChopHits:        20            # Maximum number of hits to chop from each end of seed.
  MaxSeedChiDF:       20.           # Maximum seed track chisquare/dof.
  MinSeedSlope:       0.0           # Minimum seed slope (dx/dz).
  InitialMomentum:    0.5           # Initial momentum (GeV/c).
  KalmanFilterAlg:    @local::standard_kalmanfilteralg
  SeedFinderAlg:      @local::standard_seedfinderalgorithm
}

standard_cosmictrackeralg:
{
    SPTAlg:   0
    TrajOnly: false
    TMatch:   2.5
    SMatch:   1
}

argoneut_spacepointalg:      @local::standard_spacepointalg
argoneut_kalmanfilteralg:    @local::standard_kalmanfilteralg
argoneut_cosmictrackeralg:   @local::standard_cosmictrackeralg
argoneut_cosmictrackeralg.SPTAlg:   1
argoneut_cosmictrackeralg.TrajOnly: true

bo_spacepointalg: @local::standard_spacepointalg
bo_spacepointalg.MinViews: 2
bo_spacepointalg.EnableW:  true
bo_kalmanfilteralg:          @local::standard_kalmanfilteralg
bo_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
bo_seedfinderalgorithm.SpacePointAlg :           @local::bo_spacepointalg
bo_seedfinderalgorithm.SpacePointAlg.PreferColl: true
bo_seedfinderalgorithm.SpacePointAlg.Filter:     false
bo_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
bo_beziertrackeralgorithm.SeedFinder:            @local::bo_seedfinderalgorithm

microboone_spacepointalg:                                @local::standard_spacepointalg
microboone_spacepointalg.MinViews:                       3
microboone_spacepointalg.EnableW:                        true
microboone_kalmanfilteralg:                              @local::standard_kalmanfilteralg
microboone_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
microboone_seedfinderalgorithm.SpacePointAlg : {
  @table::microboone_spacepointalg
  PreferColl: true
  Filter:     false
}
microboone_track3Dkalmanhitalg: {
  @table::standard_track3Dkalmanhitalg
  KalmanFilterAlg: @local::microboone_kalmanfilteralg
  SeedFinderAlg:   @local::microboone_seedfinderalgorithm
}
microboone_beziertrackeralgorithm:                       @local::standard_beziertrackeralgorithm
microboone_beziertrackeralgorithm.SeedFinder:            @local::microboone_seedfinderalgorithm
microboone_trackstitcheralg:  @local::standard_trackstitcheralg

dune10kt_spacepointalg:          @local::standard_spacepointalg
dune10kt_spacepointalg.MinViews: 3
dune10kt_spacepointalg.EnableW:  true
dune10kt_kalmanfilteralg:        @local::standard_kalmanfilteralg
dune34kt_spacepointalg:          @local::dune10kt_spacepointalg
dune34kt_kalmanfilteralg:        @local::dune10kt_kalmanfilteralg
dune35t_spacepointalg: @local::standard_spacepointalg
dune35t_spacepointalg.MinViews:  3
dune35t_spacepointalg.EnableW:   true
dune35t_kalmanfilteralg:         @local::standard_kalmanfilteralg
dune35t_seedfinderalgorithm:                          @local::standard_seedfinderalgorithm
dune35t_seedfinderalgorithm.SpacePointAlg :           @local::dune35t_spacepointalg
dune35t_seedfinderalgorithm.SpacePointAlg.PreferColl: true
dune35t_seedfinderalgorithm.SpacePointAlg.Filter:     false


END_PROLOG
##include "cluster3dpathfindingtools.fcl"

BEGIN_PROLOG

standard_cluster3dkdTree:
{
  EnableMonitoring:  true    # enable monitoring of functions
  PairSigmaPeakTime: 3.      # "sigma" multiplier on peak time
  RefLeafBestDist:   0.5     # Initial distance once reference leaf found
}

standard_standardhit3dbuilder:
{
  tool_type:            StandardHit3DBuilder
  HitFinderTagVec:      ["gaushit"]
  EnableMonitoring:     true  # enable monitoring of functions
  NumSigmaPeakTime:     1.5   # Number "sigma" for peak times when building hits
  HitWidthScaleFactor:  6.    #
  DeltaPeakTimeSig:     1.7   # "Significance" of agreement between 2 hit peak times
  WirePitchScaleFactor: 1.9
  MaxHitChiSquare:      6.0
  OutputHistograms:     false
}

standard_spacepointhit3dbuilder:
{
  tool_type:               SpacePointHit3DBuilder
  SpacePointProducerLabel: "SpacePointSolver"
  HitProducerLabel:        "gaushit"
  EnableMonitoring:        true  # enable monitoring of functions
  MaxHitChiSquare:         6.0
  OutputHistograms:        false
}

standard_cluster3dprincipalcomponentsalg:
{
  ParallelLines:        0.00001 # delta theta to be parallel
}

standard_cluster3dParamsBuilder:
{
  tool_type:                ClusterParamsBuilder
  ClusterMinHits:           3
  ClusterMinUniqueFraction: 0.5
  ClusterMaxLostFraction:   0.5
  PrincipalComponentsAlg:   @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dMergeAlg:
{
  tool_type:              ClusterMergeAlg
  EnableMonitoring:       true    # enable monitoring of functions
  AxisAngleScaleFactor:   5.
  MinTransEigenVal:       0.09
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3ddbscanalg:
{
  tool_type:              DBScanAlg
  EnableMonitoring:       true    # enable monitoring of functions
  MinPairPts:             2       # minimum number of hit pairs for DBScan to consider
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dminSpanTreeAlg:
{
  tool_type:              MinSpanTreeAlg
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

standard_cluster3dskeletonalg:
{
  MinimumDeltaTicks:      0.05  # minimum delta time (in ticks) when matching hits
  MaximumDeltaTicks:      10.0  # maximum delta time (in ticks) when matching hits
}

standard_cluster3dhoughseedfinderalg:
{
  Minimum3DHits:            5      # Minimum number 3D hits to run transform
  ThetaBins:              360      # Number of bins in theta (pi)
  HalfRhoBins:             75      # Half of the number of bins in rho
  HiThresholdMin:           5      # Minimum value for hi threshold in hough scan
  HiThresholdFrac:       0.05      # Fraction of total hits for hi threshold
  LoThresholdFrac:       0.85      # Fraction of peak bin count for lo threshold
  NumSeed2DHits:           80      # number of 2D hits in the seed
  NumAveDocas:             6.      # number of "docas" from axis to accept hits
  NumSkippedHits:          10      # number hits allowed to be skipped for seed hits
  MaxLoopsPerCluster:       3      # Maximum number of loops to search for tracks
  MaximumGap:              5.      # Maximum gap in arc length for seed hits
  DisplayHoughHist:       false
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dpcaseedfinderalg:
{
  GapDistance:             5.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  MinAllowedCosAng:       0.7      # minimum angle allowed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dparallelhitsseedfinderalg:
{
  MaxNumEdgeHits:        1000      # Maximum number hits each end of PCA axis
  GapDistance:            20.      # Distance to declare a gap in hits
  NumSeed2DHits:           80      # number of 2D hits in the seed
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
}

standard_cluster3dPathAlg:
{
  tool_type:              ClusterPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_voronoiPathAlg:
{
  tool_type:              VoronoiPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_convexhullPathAlg:
{
  tool_type:              ConvexHullPathFinder
  EnableMonitoring:       true    # enable monitoring of functions
  MinTinyClusterSize:     40      # minimum number of hits to consider splitting
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  ClusterAlg:             @local::standard_cluster3ddbscanalg
}

standard_MSTPathAlg:
{
  tool_type:              MSTPathFinder
  EnableMonitoring:       true           # enable monitoring of functions
  ClusterParamsBuilder:   @local::standard_cluster3dParamsBuilder
  PrincipalComponentsAlg: @local::standard_cluster3dprincipalcomponentsalg
  kdTree:                 @local::standard_cluster3dkdTree
}

microboone_standardhit3dbuilder:               @local::standard_standardhit3dbuilder
microboone_spacepointhit3dbuilder:             @local::standard_spacepointhit3dbuilder
microboone_cluster3dMergeAlg:                  @local::standard_cluster3dMergeAlg
microboone_cluster3dPathAlg:                   @local::standard_cluster3dPathAlg
microboone_voronoiPathAlg:                     @local::standard_voronoiPathAlg
microboone_cluster3ddbscanalg:                 @local::standard_cluster3ddbscanalg
microboone_cluster3dminSpanTreeAlg:            @local::standard_cluster3dminSpanTreeAlg
microboone_cluster3dprincipalcomponentsalg:    @local::standard_cluster3dprincipalcomponentsalg
microboone_cluster3dskeletonalg:               @local::standard_cluster3dskeletonalg 
microboone_cluster3dhoughseedfinderalg:        @local::standard_cluster3dhoughseedfinderalg 
microboone_cluster3dpcaseedfinderalg:          @local::standard_cluster3dpcaseedfinderalg
microboone_cluster3dparallelhitsseedfinderalg: @local::standard_cluster3dparallelhitsseedfinderalg
microboone_cluster3dkdtree:                    @local::standard_cluster3dkdTree

END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG
BEGIN_PROLOG
mcsfitproducer: {
  module_type:  MCSFitProducer
  inputs: {
        inputLabel: @nil
  }
  fitter: {
  	pIdHypothesis: 13
	minNumSegments: 3
	segmentLength: 14.0
	minHitsPerSegment: 2
	nElossSteps: 10
	eLossMode: 0
	pMin: 0.01
	pMax: 7.50
	pStep: 0.01
	angResol: 3.0
  }
}
END_PROLOG
BEGIN_PROLOG
kalmanfilterfittrackmakertool: {
   tool_type: KalmanFilterFitTrackMaker
   options: {
      defaultMomInGeV: 1.0
      momFromMCSCollection: false
      mcsInputTag: ""
      momFromCombAndPid: false
      contInputTag: ""
      pidFromCollection: false
      pidInputTag: ""
      pidFromLengthCut: -1.
      defaultPdgId: 13
      dirFromVec: false
      dirVec: [0,0,1]
      alwaysInvertDir: false
      keepInputTrajectoryPoints: false
   }
   fitter: {
      useRMSError: true
      sortHitsByPlane: true
      sortHitsByWire: false
      sortOutputHitsMinLength: true
      skipNegProp: true
      cleanZigzag: false
      rejectHighMultHits: false
      rejectHitsNegativeGOF: true
      hitErr2ScaleFact: 1.0
      tryNoSkipWhenFails: true
      tryBothDirs: false
      pickBestHitOnWire: false
      maxResidue: -1.
      maxResidueFirstHit: -1.
      maxChi2: -1.
      maxDist: -1.
      negDistTolerance: 0.
      dumpLevel: 0
   }
   propagator: {
      minStep: 1.0
      maxElossFrac: 0.1
      maxNit: 10
      tcut: 10.
      wrongDirDistTolerance: 0.01
      propPinvErr: false
   }
   mcsfit: @local::mcsfitproducer.fitter
}
END_PROLOG
BEGIN_PROLOG

standard_trajclusteralg:
{
   Mode: 1                  # 1(-1) step from US(DS) to DS(US), 2 = don't use
   NPtsAve: 10              # Number of points to find average charge, Ave chg rms
   MinPtsFit: [3, 3, 3]     # Min number of points in the trajectory fit required on each pass
   MinPts:    [3, 3, 3]     # Min number of points in the trajectory required on each pass
   MaxAngleCode: [0, 1, 2]  # Max angle range code allowed on each pass
   MinMCSMom: [0, 0, 0]   # Minimum MCSMom for each pass
   MaxChi: 20               # Max Chi/DOF for accepting a trajectory fit (long muons)
   HitErrFac: 0.4          # hit time error for fitting = fHitErrFac * (hit RMS)
   MinAmp:  1               # Min amplitude for a wire signal being considered present (must be > 0)
   AngleRanges: [40, 85, 90]  # Max angle (degrees) for small, intermediate and large angle trajectories
   MultHitSep: 2.5          # Hits separated by < MultHitSep * RMS may be combined in a trajectory point
   ChargeCuts: [4, 0.15, 0.25]  # [Max(min) chg pull, Min allowed chg RMS, Max allowed chg RMS]
#   KinkCuts: [0.4, 1.5, 3] # kink angle, MCS kink significance, nPts fit << OLD
   KinkCuts: [ 8, 15, 1, 10 ] # << NEW
   # 0 Number of points to fit at the end of the trajectory
   # 1 Minimum kink significance
   # 2 Use charge in significance calculation? (yes if > 0)
   # 3 3D kink fit length (cm)
   ProjectionErrFactor: 2   # Factor applied to calculated trajectory error
   VLAStepSize: 1.5         # Step size for Very Large Angle trajectories
   JTMaxHitSep: 3           # max hit separation (WSE units) for making Junk Trajectories (<0) turn off
   MaxWireSkipNoSignal:  3  # max allowed number of not-dead wires if no signal is present
   MaxWireSkipWithSignal: 100  # max allowed number of not-dead wires if a signal is present
   QualityCuts: [ 0.8, 3] # Min points/wire, min consecutive pts after a gap
   MuonTag: [40, 500, 40, 3]    # minLength, minMCSMom, maxWireSkip,(min delta-ray length for muon direction tag)
   DeltaRayTag:  [10, 5, 500] # Tag short TJs as delta-rays close to muons [min sep, min MCSMom, max MCSMom]
#               0   1   2   3   4  5    6   7  8  9 10 11 12
   ShowerTag: [ 1, 100, 10, 50, 2.5, 1, 0, 3, 5, 0.7, 1, 10, -13]
# 0 Mode (<= 0 OFF, 1 = tag only, 2 = find showers)
  # 1 Max Tj MCSMom for a shower tag
  # 2 Max separation
  # 3 Min energy (MeV)
  # 4 rms width factor
  # 5 Min shower 1/2 width (WSE units)
  # 6 Min ElectronLikelihood (if > 0)
  # 7 Min Tjs
  # 8 max parent FOM
  # 9 max direction FOM
  # 10 max aspect ratio
  # 11 not used
  # 12 Print 2D showers in plane (0,1,2) or all planes (3) or just 3D matching (4)
   SaveShowerTree: false
   SaveCRTree: false
   TagCosmics: false
   ChkStopCuts: [10, 8, 1.5] # [Min chg slope, nFitPts, Chg fit ChiDOF cut]
   VertexScoreWeights: [1, 2, 10, 2]
    # 0 = Vertex error weight
    # 1 = 3D match weight
    # 2 = Charge fraction of vertex Tjs near the vertex weight
    # 3 = Tj MCSMom, ChgRMS, Angle difference significance between Tjs weight
   Vertex2DCuts:  [6, 8, 45, 3, 3, 50, 0.6, 30, 0.8, 0.8] # << NEW increase min Score
   # 0 User definition of a short Tj => max number of Tj points
   # 1 max separation between a vertex and the start of a trajectory for a user-defined short Tj
   # 2 max separation for a user-defined long Tj
   # 3 max position pull when attaching a Tj to a vertex
   # 4 max position error for creating a Tj or attaching Tjs to an existing vertex
   # 5 Min MCSMom of Tjs that can be used to create a vertex
   # 6 min frac of Points/Wire between a vtx and a Tj. Ideally one if the efficiency is good
   # 7 min Score
   # 8 Min charge fraction near a vertex or merge point
   # 9 max MCSmom asymmetry for a merge
   Vertex3DCuts: [0.8, 2., 3.]
   # 0 dX match cut (cm)
   # 1 dY and dZ match cut (cm)
   # 2 max separation btw PFParticle end and 3D vertex
   Match3DCuts: [ 0.5, 10000, 1, 2, 2.0, 2.5, 1]
   # 0 dx (cm) matching cut
   # 1 max number of 3-plane matches for any Tj
   # 2 Attempt 2-view match?
   # 3 min number of TP3Ds in at least 2 planes to fit in each PFP section
   # 4 max pull for adding/rejecting TP3Ds in sections
   # 5 suggested max ChiDOF for a SectionFit
   # 6 > 0 Don't match muon shower tjs
   PFPStitchCuts: [ 0.02, 3, 2 ]
   # 0 = matching angle resolution (radians)
   # 1 = matching position resolution (cm)
   # 2 = max angle-position figure of merit
   SkipAlgs: [ ]   # List of algs that should not be used
   DebugConfig: []
}
standard_trajclusteralg.CaloAlg: @local::standard_calorimetryalgmc

standard_clustercrawleralg:
{
  NumPass:              3  # number of passes through the hit list. 0 = no cluster reco
  MaxHitsFit: [ 100,  8, 4] # number of hits fitted to a line
  MinHits:    [ 50,  8, 3] # minimum size of a cluster
  NHitsAve:   [ 20,  8, 2] # number of hits to find the average charge and width
                           # at the end of the cluster. NHitsAve should be 1 or 2
  ChgCut:    [ .8, .8, .8] # max fractional hit charge difference for adding hits
  ChiCut:    [ 4, 8, 10] # stop adding hits to clusters if ChiCut is reached
  MaxWirSkip:   [25, 8, 0] # max number of wires to skip without adding a hit
  MinWirAfterSkip: [2, 2, 1] # min reqd number of consecutive wires with a hit after a skip
  KinkChiRat: [1.2, 1.2, 0.] # Max consecutive chisq increase for the last 3 hits on the cluster
                             # 0. = no kink check when following
  KinkAngCut: [0.4, 0.4, 1.5] # kink angle cut (radians) used to follow and merge
  DoMerge:   [false, true, true] # run cluster merging code?
  TimeDelta: [ 8, 8, 20] # max time difference for cluster merging
  MergeChgCut: [0.8, 0.8, 0.8] # max charge ratio for cluster merging
  FindVertices: [true, true, true]  # make 2D vertices after clustering?
  LACrawl:     [true, true, true]  # crawl Large Angle clusters?
  LAClusAngleCut:       60 # Large cluster angle cut (0 < 90 degrees). <0 to turn off
	LAClusMaxHitsFit: 		 4 #
	MinHitFrac: 				 0.6 # Drop clusters having < (#hits/#wires)
	MinAmp: 			 [5, 5, 5] # Min hit signal amplitude for merging
	ChgNearWindow:				40 # #of ticks for summing charge near a cluster
	ChgNearCut: 				 1.5 # Cluster end is shower-like if (nearby chg)/(cls chg)> cut
  HitMergeChiCut:      2.5 # Merge cluster hit-multiplets if the separation chisq
                           # is < cut. Set < 0 for no merging
  MergeAllHits:      false # merge all hits before reconstructing clusters
  MergeOverlapAngCut:  0.1 # Set <= 0 to turn off overlapping cluster merging
  ChkClusterDS:       true # Check reconstruction at DS end of clusters?
  KillGarbageClusters: 0.1 # Kill ghost clusters, set to 0 to turn off
  VtxClusterSplit:    true # Split clusters that cross vertices
  FindStarVertices:   true # Find vertices with a star topology
  HitErrFac:           0.2 # hit time error for fitting = fHitErrFac * (hit width)
  HitMinAmp:             2 # ignore hits with PH < this value
  ClProjErrFac:          3 # cluster projection error factor
  AllowNoHitWire:        1 # Allow skipping N wires w no hits (if poor purity)
	Vertex2DCut:					10 # Max chisq cut for attaching a cluster to a vtx
  Vertex3DCut:           5 # 2D vtx -> 3D vtx matching cut (chisq)
	FindHammerClusters: true # look for hammer type clusters
  RefineVertexClusters: false # (not ready)
  FindVLAClusters: false # find Very Large Angle clusters (not ready)
  DebugPlane:          -1  # print info only in this plane
  DebugWire:            0  # set to the Begin Wire and Hit of a cluster to print
  DebugHit:             0  # out detailed information while crawling
}

standard_blurredclusteralg:
{
  BlurWire:            6
  BlurTick:            12
  SigmaWire:           4
  SigmaTick:           6
  ClusterWireDistance: 2
  ClusterTickDistance: 2
  MaxTickWidthBlur:    10
  NeighboursThreshold: 0
  MinNeighbours:       0
  MinSize:             2
  MinSeed:             0.1
  TimeThreshold:       500
  ChargeThreshold:     0.07
}

standard_mergeclusteralg:
{
  MinMergeClusterSize: 3
  MaxMergeSeparation:  30
  ProjWidthThreshold:  0.2
}

standard_houghbasealg:
{
  MaxLines:                 50   # The maximum number of Hough lines to look for, 20 had been working!
  MinHits:                  5
  SaveAccumulator:          0
  NumAngleCells:            20000 # The number of angle cells to create for the Hough transform,
  RhoResolutionFactor:      5    # Was set to 5
  MaxDistance:              1.0  # 0.1 was working (okay, not really, larger is probably better,
  MaxSlope:                 80.0 # 80 was working fine previously
  RhoZeroOutRange:          0
  ThetaZeroOutRange:        0
  HitsPerCluster:           1
  MissedHits:               1    # Was set to 0
  MissedHitsDistance:       2.0  #
  MissedHitsToLineSize:     0.25    # Was set to 0
}

standard_endpointalg:
{
  TimeBins:            256
  MaxCorners:          20
  Gsigma:              1.
  Window:              5
  Threshold:           0.1
  SaveVertexMap:       -1
}


standard_cornerfinderalg:
{
  RawDataModuleLabel:           "daq"
  CalDataModuleLabel:		"caldata"
  Trimming_threshold:      10
  Trimming_totalThreshold: 5e4
  Conversion_algorithm:         "standard"
  Conversion_function:          "TMath::Gaus(x,0,1)*TMath::Gaus(y,0,1)"
  Conversion_func_neighborhood: 3
  Conversion_threshold:		0
  Conversion_bins_per_input_x:	1
  Conversion_bins_per_input_y:	1
  Derivative_method: 		"Sobel" #Noble
  Derivative_neighborhood:	1
  Derivative_BlurFunc:	"NotImplemented"
  Derivative_BlurNeighborhood:	5
  CornerScore_Noble_epsilon:    1e-5
  CornerScore_Harris_kappa:     0.05
  CornerScore_neighborhood:	1
  CornerScore_algorithm:	"Nobel" #Harris
  MaxSuppress_neighborhood:	3
  MaxSuppress_threshold:	1000
  Integral_bin_threshold:       5
  Integral_fraction_threshold:  0.95


}

standard_dbscanalg:
{
  eps:    1.0
  epstwo: 1.5
  minPts: 2
  Method: 0   # 0 -- naive findNeighbor implemention
              # 1 -- findNeigbors with R*-tree
              # 2 -- DBScan from the paper with R*-tree
  Metric: 3   # Which RegionQuery distance metric to use.
              # **ONLY APPLIES** if Method is 1 or 2.
              #
	      # 0 -- rectangle (no bad channels) **not implemented**
	      # 1 -- Manhattan distance (only uses eps, no bad channels)
              #                                  **not implemented**
	      # 2 -- Eliptical (no bad channels) **not implemented**
	      # 3 -- findNeighbors-alike: Elliptical and bad
              #                           channel aware (not working)
}

standard_dbscan3dalg:
{
    epsilon:          5.0
    minpts:           2
    neighbors:        100
    badchannelweight: 0.
}

standard_tcshoweralg:
{
    CalorimetryAlg: @local::standard_calorimetryalgmc
    ProjectionMatchingAlg:    @local::standard_projectionmatchingalg
}

standard_fuzzyclusteralg:
{
  RunHough:       true    # Turns on and off the Hough line finder, useful for diagnostics
  NumberTimeBoundaries:             3	# Number of boundaries in ticks for the drift window to be divided up to make the Hough line finder easier on memory
  NumberWireBoundaries:             3	# Number of boundaries in wires for the drift window to be divided up to make the Hough line finder easier on memory
  GenerateHoughLinesOnly:       false # Show only the results of the Hough line finder, hits not in a line will not be clustered
  HoughBaseAlg:{
    MaxLines:             100
    MaxDistance:          1
    MinHits:              5
    NumAngleCells:        10800
    SaveAccumulator:          0
    RhoResolutionFactor:      5
    MaxSlope:                 80.0 # 80 was working fine previously
    RhoZeroOutRange:          0
    ThetaZeroOutRange:        0
    HitsPerCluster:           1
    MissedHits:               1    # Was set to 0
    MissedHitsDistance:       1.0  #
    MissedHitsToLineSize:     0.5    # Was set to 0
  }
  DBScanAlg:                @local::standard_dbscanalg
  DoFuzzyRemnantMerge:      true # Tell the algorithm to merge fuzzy cluster remnants into showers or tracks (0-off, 1-on)
  FuzzyRemnantMergeCutoff: 20    # Cut off on distance from hough line to hit in the remnant of the fuzzy cluster

  DoTrackClusterMerge:     true # Turns on merging of track-like Hough lines (0-off, 1-on)
  ChargeAsymAngleCut:        0.1 # Cut on product of charge asymmetry and the square of the sin of angle between slopes of lines, only for track-like
  SigmaChargeAsymAngleCut:   1.0  # Cut on product of charge sigma asymmetry and the sin of angle between slopes of lines, only for track-like
  TrackClusterMergeCutoff: 5.0 # The maximum distance between track-like Hough line endpoints before they can be merged,

  DoShowerClusterMerge:     true # Turns on merging of shower-like Hough line (0-off, 1-on)
  ShowerClusterMergeAngle: 30    # The maximum angle between slopes of shower-like lines to be merged,
  ShowerClusterMergeCutoff:  7.5 # The maximum distance between shower-like line endpoints before they can be merged,

  DoShowerTrackClusterMerge:     true # Turns on merging of shower-like and track-like lines (0-off, 1-on)
  ShowerTrackClusterMergeAngle:  15   # The maximum angle between slopes of shower-like and track-like lines to be merged,
  ShowerTrackClusterMergeCutoff: 7.5  # The maximum distance between shower-like and track-like line endpoints before they can be merged,
  ShowerLikenessCut:       10    # Cut on shower likeness (the larger the more shower like, the smaller the less shower like)
  MaxVertexLines:          100   # Max number of line end points allowed in a Hough line merge region for a merge to happen
  VertexLinesCutoff:       5.0   #  Size of the vertex region to count up lines for MaxVertexLines
}

standard_clusterparamsalg:
 {
  ChargeCutoffThreshold:    [500,500,1000]
  SelectBoxSizePar:               10     #distance along axis
  SelectBoxSizePerp:              3      #distance perpendicular to axis
  ForceRightGoing:        	  false
  MinHitListSize:		  40
  fOutlierRadius:		  5
  #HoughBaseAlg.NumAngleCells:       3000
  #HoughBaseAlg.RhoResolutionFactor:       4
  #HoughBaseAlg.MaxLines:       100
  HitDensityCutoff:             1.9  # Showers is high, tracks low, 0 don't use cut
  MultiHitWireCutoff: 		 2.1  # Showers is high, tracks low, 0 don't use cut
  OffAxisHitsCutoff:            0    # Showers is high, tracks low, 0 don't use cut
  PrincipalComponentCutoff:     0    # Tracks is high ~1, showers low, 0 don't use cut
  ShowerSelisORorAND:           0    # 0 = OR, 1 = AND

  HoughBaseAlg:                   @local::standard_houghbasealg

 }

 standard_clustermatchalg:
 {
  DebugMode: true
  StoreSpacePoint: true
  MatchAlgoList:                [0, 1, 2, 3] # Algorithms enum to be enabled
  CutParam_NumSpacePoint:       100          # Number of minimum space point to claim a cluster by kSpacePoint
  CutParam_OverlayTimeFraction: 0.0          # Minimum fraction of overlayed time period used by kRoughTime
  CutParam_SumChargeRatio:      1000.0       # Maximum difference in fraction of clusters' charge sum used by kSumCharge
  SpacePointAlg:                @local::microboone_spacepointalg
  }
 standard_clustermatchalg.SpacePointAlg.Filter: false

 standard_clustermergealg:
 {
  VerboseMode:    false
  MaxAngleDiff:   0
  MaxSquaredDist: 0
  }

standard_smallclustalg:
 {
  RadiusSizePar:   	3	  #radius of circle in "cm"
  NHitsInClust:		4	  # Max Number of hits in cluster
  Verbose:			false
 }

standard_clustermatchtq:
{
  KSCut: 0.9
  EnableU: true
  EnableV: true
  EnableZ: true
}

standard_dbscanalg_fast:        @local::standard_dbscanalg
standard_dbscanalg_fast.eps:    1.25
standard_dbscanalg_fast.epstwo: 1.75
standard_dbscanalg_fast.Method: 2

jp250L_dbscanalg:                  @local::standard_dbscanalg
jp250L_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
jp250L_houghbasealg:               @local::standard_houghbasealg
jp250L_houghbasealg.MaxLines:      15
jp250L_houghbasealg.MinHits:       3
jp250L_houghbasealg.NumAngleCells: 5000
jp250L_houghbasealg.MaxDistance:   5.0
jp250L_endpointalg:                @local::standard_endpointalg

bo_dbscanalg:                   @local::standard_dbscanalg
bo_fuzzyclusteralg:             @local::standard_fuzzyclusteralg
bo_houghbasealg:                @local::standard_houghbasealg
bo_houghbasealg.MaxLines:       15
bo_houghbasealg.MinHits:        3
bo_houghbasealg.NumAngleCells:  5000
bo_houghbasealg.MaxDistance:    5.0
bo_endpointalg:                 @local::standard_endpointalg
bo_clustercrawleralg:           @local::standard_clustercrawleralg
bo_clustercrawleralg.NumPass: 1
bo_clustercrawleralg.MaxHitsFit: [ 8 ]
bo_clustercrawleralg.MinHits: [ 3 ]
bo_clustercrawleralg.ChgCut: [ 2. ]
bo_clustercrawleralg.WidCut: [ 2. ]
bo_clustercrawleralg.ChiCut: [ 20. ]
bo_clustercrawleralg.MaxWirSkip: [ 25 ]
bo_clustercrawleralg.MinWirAfterSkip: [ 1 ]
bo_clustercrawleralg.KinkChiRat: [ 2. ]
bo_clustercrawleralg.KinkAngCut: [ 0.5 ]
bo_clustercrawleralg.DoMerge:  [ true ]
bo_clustercrawleralg.TimeDelta:  [ 10. ]
bo_clustercrawleralg.FindVertices: [ false ]
bo_clustercrawleralg.HitErrFac: 1.
bo_clustermatchtq:             @local::standard_clustermatchtq

argoneut_dbscanalg:                  @local::standard_dbscanalg
argoneut_fuzzyclusteralg:            @local::standard_fuzzyclusteralg
argoneut_houghbasealg:               @local::standard_houghbasealg
argoneut_houghbasealg.MaxLines:      15
argoneut_houghbasealg.MinHits:       3
argoneut_houghbasealg.NumAngleCells: 5000
argoneut_houghbasealg.MaxDistance:   5.0
argoneut_endpointalg:                @local::standard_endpointalg
argoneut_cornerfinderalg:		      @local::standard_cornerfinderalg
argoneut_clusterparamsalg:       @local::standard_clusterparamsalg
argoneut_clusterparamsalg.HoughBaseAlg: @local::argoneut_houghbasealg
argoneut_clusterparamsalg.HoughBaseAlg.NumAngleCells:       3000
argoneut_clusterparamsalg.HoughBaseAlg.RhoResolutionFactor:       4
argoneut_clusterparamsalg.HoughBaseAlg.MaxLines:       100
argoneut_clusterparamsalg.ChargeCutoffThreshold:  [200,400]
argoneut_clusterparamsalg.ForceRightGoing:   true
argoneut_smallclustalg:	@local::standard_smallclustalg
argoneut_clustermatchtq:             @local::standard_clustermatchtq
argoneut_clustermatchtq.KSCut:              0.5


microboone_dbscanalg:                         @local::standard_dbscanalg_fast
microboone_endpointalg:                       @local::standard_endpointalg
microboone_houghbasealg:                      @local::standard_houghbasealg
microboone_houghbasealg.MaxLines:             20
microboone_houghbasealg.MaxDistance:          1.0
microboone_houghbasealg.MinHits:              5
microboone_houghbasealg.NumAngleCells:        20000
microboone_houghbasealg.DoHoughLineMerge:     1
microboone_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
microboone_fuzzyclusteralg.Threshold          : -20.0
microboone_cornerfinderalg:		      @local::standard_cornerfinderalg
microboone_clusterparamsalg:                  @local::standard_clusterparamsalg
microboone_smallclustalg:	              @local::standard_smallclustalg
microboone_clustercrawleralg:                 @local::standard_clustercrawleralg

microboone_trajclusteralg:                    @local::standard_trajclusteralg
microboone_trajclusteralg.MultHitSep: 3.2
microboone_trajclusteralg.MaxWireSkipNoSignal: 2
microboone_trajclusteralg.MuonTag: [40, 500, 10, 3]
microboone_trajclusteralg.VLAStepSize: 1
microboone_trajclusteralg.Vertex2DCuts: [ 6, 8, 45, 3, 3, 50, 0.6, 50, 0.8, 0.8]

microboone_clustermatchalg:                   @local::standard_clustermatchalg
microboone_clustermergealg:                   @local::standard_clustermergealg
microboone_clustermatchtq:                    @local::standard_clustermatchtq

dune35t_dbscanalg:    @local::standard_dbscanalg_fast
dune35t_dbscanalg.eps:    2.0
dune35t_dbscanalg.epstwo: 2.0
dune35t_houghbasealg: @local::standard_houghbasealg
#dune35t_houghbasealg.DoHoughLineMerge:     1
dune35t_endpointalg:  @local::standard_endpointalg
dune35t_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dune35t_fuzzyclusteralg.HoughBaseAlg:      @local::dune35t_houghbasealg
#dune35t_fuzzyclusteralg.Threshold:         -50.0
dune35t_clustercrawleralg:                 @local::standard_clustercrawleralg
dune35t_clustermatchtq:                    @local::standard_clustermatchtq
dune35t_clustermatchtq.KSCut:              0.7

dunefd_dbscanalg:    @local::standard_dbscanalg_fast
dunefd_houghbasealg: @local::standard_houghbasealg
dunefd_endpointalg:  @local::standard_endpointalg
dunefd_fuzzyclusteralg:                   @local::standard_fuzzyclusteralg
dunefd_fuzzyclusteralg.HoughBaseAlg:      @local::dunefd_houghbasealg
dunefd_clustercrawleralg:                 @local::standard_clustercrawleralg
dunefd_clustermatchtq:                    @local::standard_clustermatchtq
dunefd_clustermatchtq.KSCut:              0.7


END_PROLOG
BEGIN_PROLOG

standard_calorimetryalgdata:
{
  CalAmpConstants:  	[ 0.582554e-3 , 1.16594e-3 ]
  CalAreaConstants:  	[ 0.544391e-2 , 2.0376e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0 # 0 is single exponential and 1 is constant+exponential using database values (only works for microboone.
  CaloDoLifeTimeCorrection: true
}

standard_calorimetryalgmc:
{
  CalAmpConstants:   	[ 0.588726e-3 , 1.18998e-3 ]
  CalAreaConstants:   	[ 0.773887e-2 , 1.78186e-2 ]
  CaloUseModBox:        true   #use modified Box model recombination correction
  CaloLifeTimeForm:     0
  CaloDoLifeTimeCorrection: true
}

standard_calodata:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgdata
}

standard_calomc:
{
 module_type:            "Calorimetry"
 TrackModuleLabel:       "track3d" #this must have track-spacepoint and track-hit associations
 SpacePointModuleLabel:  "spacepointfinder" #this must have spacepoint-hit associations
 T0ModuleLabel:          "mctrutht0"
 UseArea:		 true
 CorrectSCE:		 false
 FlipTrack_dQdx:         false
 CaloAlg:	         @local::standard_calorimetryalgmc
}

standard_gnocchicalo:
{
  module_type: "GnocchiCalorimetry"
  TrackModuleLabel: "track3d"
  SpacePointModuleLabel: "spacepointfinder"
  T0ModuleLabel: ""
  AssocHitModuleLabel: ""
  ChargeMethod: 1
  FieldDistortion: false
  TrackIsFieldDistortionCorrected: false
  Cryostat: 0
  CaloAlg: @local::standard_calorimetryalgdata
}

standard_generalcalorimetry:
{
 module_type:      "GeneralCalorimetry"
 TrackModuleLabel: "track"
 CaloAlg:          @local::standard_calorimetryalgmc
}

standard_beziercalorimetry:
{
 module_type:       "BezierCalorimetry"
 BTrackModuleLabel: "beziertracker"
 CaloAlg:           @local::standard_calorimetryalgmc
}

standard_trackcalorimetryalg:
{
 NHitsToDetermineStart:  3
 CalorimetryAlg:         @local::standard_calorimetryalgmc
}

standard_trackcalorimetry:
{
 module_type:            "TrackCalorimetry"
 TrackModuleLabel:       "track"
 HitModuleLabel:         "hit"
 SpacePointModuleLabel:  "sppt"
 TrackCalorimetryAlg:    @local::standard_trackcalorimetryalg
}

standard_printcalorimetry:
{
  module_type:       "PrintCalorimetry"
  TrackModuleLabel:  "track"
  CaloModuleLabels:  [ "calo" ]
}

standard_calocheck: {
  module_type: CaloChecker
  TrackLabel: track # overwrite with the track producer
  CaloLabels: [oldcalo, newcalo] # overwrite with the two Calo producers 
}

END_PROLOG

BEGIN_PROLOG

standard_shower:
{
 module_type:              "ShowerReco"
 ClusterModuleLabel:       "showeranglecluster"
 CaloAlg:            	   @local::standard_calorimetryalgmc
 UseArea:		   true
 dEdxlength:		   2.4	#distance that gets used to determine e/gamma separation
 calodEdxlength:	   30   # cutoff distance for hits saved to the calo object.
}

standard_tcshower:
{
 module_type: "TCShower"
 ClusterModuleLabel: "trajcluster"
 TrackModuleLabel:   "pmtrack"
 CalorimetryModuleLabel:  "calo"
# CalorimetryAlg:           @local::standard_calorimetryalgmc
 TCAlg:                    @local::standard_tcshoweralg
# ProjectionMatchingAlg:    @local::standard_projectionmatchingalg
}

standard_tcshoweranalysis:
{
 module_type: "TCShowerAnalysis"
 ShowerModuleLabel:  "tcshower"
 DigitModuleLabel:   "largeant"
 HitModuleLabel:     "trajcluster"
 CalorimetryAlg:      @local::standard_calorimetryalgmc
}

standard_tcshowertemplatemaker:
{
 module_type: "TCShowerTemplateMaker"
 ShowerModuleLabel:  "tcshower"
 DigitModuleLabel:        "largeant"
 CalorimetryAlg:           @local::standard_calorimetryalgmc
}

standard_tcshowerelectronlikelihood:
{
 module_type: "TCShowerElectronLikelihood"
 ShowerModuleLabel:  "tcshower"
 CalorimetryAlg:           @local::standard_calorimetryalgmc
}

#standard_showerana:
#{
# module_type:              "ShowerRecoAna"
# ClusterModuleLabel:       "showeranglecluster"
# CaloAlg:            	   @local::standard_calorimetryalgmc
# UseArea:		   true
# dEdxlength:		   2.4	#distance that gets used to determine e/gamma separation
# calodEdxlength:	   30   # cutoff distance for hits saved to the calo object.
#}

standard_showercheater:
{
 module_type:         "ShowerCheater"
 CheatedClusterLabel: "cluster"
 G4ModuleLabel:       "largeant"
}

standard_emshoweralg:
{
 CalorimetryAlg:        @local::standard_calorimetryalgmc
 ShowerEnergyAlg:       @local::standard_showerenergyalg
 ProjectionMatchingAlg: @local::standard_projectionmatchingalg
 MinTrackLength:  3
 dEdxTrackLength: 3
 SpacePointSize:  0.1
 Nfitpass:        4
 Nfithits:        [50, 30, 20, 20]
 Toler:           [30., 5., 2., 2.]
}

standard_emshower:
{
 module_type:            "EMShower"
 HitsModuleLabel:        "linecluster"
 ClusterModuleLabel:     "blurredcluster"
 TrackModuleLabel:       "pmtrack"
 PFParticleModuleLabel:  ""
 VertexModuleLabel:      "pandora"
 CNNEMModuleLabel:       ""
 SaveNonCompleteShowers: true
 FindBadPlanes:          true
 MakeSpacePoints:        true
 UseCNNtoIDEMPFP:        false
 UseCNNtoIDEMHit:        false
 MinTrackLikeScore:      0.04
 EMShowerAlg:            @local::standard_emshoweralg
}

argoneut_shower:     @local::standard_shower
microboone_shower:   @local::standard_shower 
microboone_shower.UseArea:   false

#argoneut_showerana:     @local::standard_showerana
#microboone_showerana:   @local::standard_showerana 
#microboone_showerana.UseArea:   false


standard_neutrinoshowereff:
{
    module_type:      	      "NeutrinoShowerEff"
    MCTruthModuleLabel:	      "generator"
    HitModuleLabel:           "trajcluster"
    ShowerModuleLabel: 	      "trajcluster"
    CNNEMModuleLabel:         ""
    NeutrinoPDGcode:	      12
    LeptonPDGcode:	      11
    MaxNeutrinoE:	      25.0
    MaxEfrac:		      0.30
    MinCompleteness:	      0.70	
    SaveMCTree:		      false
    FidVolCutX:		      10
    FidVolCutY:		      10
    FidVolCutZ:		      10	
}

END_PROLOG

BEGIN_PROLOG

standard_trackshowersepalg:
{
  ConeAngle: 15
  CylinderRadius: 20.
  TrackVertexCut: 5.
  CylinderCut: 0.2
  ShowerConeCut: 5.
  RectangleWidth: 1.
  RectangleCut: 0.5
}

standard_showerenergyalg:
{
  UGradient:   7.69985e-06
  UIntercept: -0.0160794
  VGradient:   7.70957e-06
  VIntercept: -0.0160174
  ZGradient:   7.30337e-06
  ZIntercept: -0.0191387
}

dune35t_showerenergy:
{
  # Last updated M Wallbank, 8/8/16
  # LArSoft v06_01_00
  UGradient:   8.1406e-06
  UIntercept: -0.00772234
  VGradient:   7.98303e-06
  VIntercept: -0.00442084
  ZGradient:   7.98278e-06
  ZIntercept: -0.0143167
}

dune35tdata_showerenergy:
{
  # Last updated M Wallbank, 10/4/16
  # Only calculated for the collection plane
  UGradient:   5.88161e-3
  UIntercept: -1.36686
  VGradient:   5.88161e-3
  VIntercept: -1.36686
  ZGradient:   5.88161e-3
  ZIntercept: -1.36686
  # M Wallbank 8/10/16
  # UGradient:   5.53072e-3
  # UIntercept: -33.6764
  # VGradient:   5.53072e-3
  # VIntercept: -33.6764
  # ZGradient:   5.53072e-3
  # ZIntercept: -33.6764
}

dune10kt_showerenergy:
{
  # Last updated M Wallbank, 8/8/16
  # LArSoft v06_00_01
  UGradient:   7.69985e-06
  UIntercept: -0.0160794
  VGradient:   7.70957e-06
  VIntercept: -0.0160174
  ZGradient:   7.30337e-06
  ZIntercept: -0.0191387
}


END_PROLOG

BEGIN_PROLOG

dune35t_emshower: @local::standard_emshower
dune35t_emshower.EMShowerAlg: @local::standard_emshoweralg
dune35t_emshower.EMShowerAlg.Detector: "dune35t"
dune35t_emshower.EMShowerAlg.CalorimetryAlg: @local::dune35t_calorimetryalgmc
dune35t_emshower.EMShowerAlg.ShowerEnergyAlg: @local::dune35t_showerenergy

dune35tdata_emshower: @local::standard_emshower
dune35tdata_emshower.EMShowerAlg: @local::standard_emshoweralg
dune35tdata_emshower.EMShowerAlg.Detector: "dune35t"
dune35tdata_emshower.EMShowerAlg.CalorimetryAlg: @local::dune35t_calorimetryalgdata
dune35tdata_emshower.EMShowerAlg.ShowerEnergyAlg: @local::dune35tdata_showerenergy

dune10kt_emshower: @local::standard_emshower
dune10kt_emshower.EMShowerAlg: @local::standard_emshoweralg
dune10kt_emshower.EMShowerAlg.Detector: "dune10kt"
dune10kt_emshower.EMShowerAlg.CalorimetryAlg: @local::dune10kt_calorimetryalgmc
dune10kt_emshower.EMShowerAlg.ShowerEnergyAlg: @local::dune10kt_showerenergy

END_PROLOG

BEGIN_PROLOG

standard_opslicer:
{
   module_type:          "OpSlicer"
   OpHitModuleLabel:     "ophit"

   TScale:                "0.15" # distance scale in cm
   RScale:                "600" # time scale in ns
   R0:                    "1" # distance cut around centroid for delayed light
   BreakTime:             "5" # max time delay for integrating up delayed light
   MinN:                  "3" # min # of ophits to make a cluster

   TrigCoinc:             "2.5" # max time (us) to beam spill for coincidence
}

protodune_opslicer: @local::standard_opslicer

protodune_opslicer_data_internal: @local::protodune_opslicer
protodune_opslicer_data_internal.OpHitModuleLabel: "ophitInternal"
protodune_opslicer_data_external: @local::protodune_opslicer
protodune_opslicer_data_external.OpHitModuleLabel: "ophitExternal"


END_PROLOG
#File: CRT.fcl
#Brief: Defines default parameters for CRT-related modules
#Author: Andrew Olivier aolivier@ur.rochester.edu

BEGIN_PROLOG

# Simulation
# CRTSim module
CRTSim_standard: 
{
  module_type:       "CRTSim"
  SimLabel:          "largeant"
  GeVToADC:          5e5 #MIP gives ~1000 ADC in commissioning
  IntegrationTime:   20 #ns
  ReadoutWindowSize: 4 #IntegrationTimes
  Deadtime:          5 #Discriminator dead time in IntegrationTimes
  DACThreshold:      100 #TODO: Set DAC threshold to 2 PE for commissioning.  In ADC countss for now.
}

CRTSimRefac_standard: 
{
  module_type:       "CRTSimRefac"
  SimLabel:          "largeant:LArG4DetectorServicevolAuxDetSensitiveCRTPaddle"
  GeVToADC:          5e5 #MIP gives ~1000 ADC in commissioning
  IntegrationTime:   20 #ns
  ReadoutWindowSize: 4 #IntegrationTimes
  Deadtime:          5 #Discriminator dead time in IntegrationTimes
  DACThreshold:      100 #TODO: Set DAC threshold to 2 PE for commissioning.  In ADC countss for now.
}


# CRTSimValidation module
CRTSimValidation_standard:
{
  module_type: "CRTSimValidation"
  CRTLabel: "CRTSim"
}

CRTOnlineMonitor_standard:
{
  module_type: "CRTOnlineMonitor"
  CRTLabel: "crt"
}

CRTRecoValidation_standard:
{
  module_type: "CRTRecoValidation"
  CRTLabel: "crt"
}

TwoCRTMatching_standard:
{
module_type: "TwoCRTMatching"
CRTLabel: "crt"
MCC: "true"
CTBLabel: "ctbrawdecoder:daq"
CTBOnly: "false"
SCECorrection: "false"
}



TwoCRTMatching_data:
{
module_type: "TwoCRTMatching"
CRTLabel: "crtrawdecoder"
MCC: "false"
CTBLabel: "ctbrawdecoder:daq"
CTBOnly: "false"
SCECorrection: "false"
}

TwoCRTMatching_producer:
{
module_type: "TwoCRTMatchingProducer"
CRTLabel: "crt"
MCC: "true"
SCECorrection: "true"

}

TwoCRTMatching_producerData:
{
module_type: "TwoCRTMatchingProducer"
CRTLabel: "crtrawdecoder"
MCC: "false"
SCECorrection: "true"

}


CRTTimingValidation_data:
{
module_type: "CRTTimingValidation"
CRTLabel: "crtrawdecoder"
MCC: "false"
CTBLabel: "ctbrawdecoder:daq"
}

CRTTimeOffset_standard:
{
module_type: "TimeOffset"
CRTLabel: "crtrawdecoder"
TimestampLabel: "timingrawdecoder:daq"

}

SingleCRTMatching_standard:
{
module_type: "SingleCRTMatching"
CRTLabel: "crt"
MCC: "true"
CTBLabel: "ctbrawdecoder:daq"
CTBOnly: "false"
SCECorrection: "false"
}

SingleCRTMatching_data:
{
module_type: "SingleCRTMatching"
CRTLabel: "crtrawdecoder"
MCC: "false"
CTBLabel: "ctbrawdecoder:daq"
CTBOnly: "false"
SCECorrection: "false"
}


SingleCRTMatching_producer:
{
module_type: "SingleCRTMatchingProducer"
CRTLabel: "crt"
MCC: "true"
SCECorrection: "true"
}


SingleCRTMatching_producerData:
{
module_type: "SingleCRTMatchingProducer"
CRTLabel: "crtrawdecoder"
MCC: "false"
SCECorrection: "true"
}




END_PROLOG
BEGIN_PROLOG

T0RecoAnodePiercers: {
 	module_type: 		"T0RecoAnodePiercers"
 	TrackProducer: 		"pandoraTrack"
 	HitProducer: 		"pandoraTrack"
 	PFPProducer: 		"pandora"
 	EdgeWidth: 			40.0  # cm
	ReadoutEdgeTicks:	50
	DataFlashProducer: 	"opflashInternal"
	MCFlashProducer: 	"opflash"
	TriggerProducer: 	"opflashExternal"
	FlashScaleFactor: 	1.0
	FlashTPCOffset:		0 #us
	MinTrackLength: 	50 #cm
	MinPE: 				1000
	MinDtFlashRecoData:	-1 #us
	MaxDtFlashRecoData:	1.5 #us
	MinDtFlashRecoMC:	-1.4 #us
	MaxDtFlashRecoMC:	0.2 #us
	Debug: 				false
	}

END_PROLOG
BEGIN_PROLOG


standard_numberofhitsfilter:
{
 module_type:     "NumberOfHitsFilter"
 LimitPerTPC: true
 HitModule:   "gaushit"
 HitLimit:    40000
 ScaleThresholdForReadoutWindow: true
}

END_PROLOG

BEGIN_PROLOG

protoDUNE_rawdecoding_producers:
{
    ### Raw Decoder 
    timingrawdecoder:   @local::timing_raw_decoder   
    ssprawdecoder:      @local::ssp_raw_decoder_split  
    tpcrawdecoder:      @local::pdsp_tpc_raw_decoder
    crtrawdecoder:      @local::crt_raw_decoder
    ctbrawdecoder:      @local::ctb_raw_decoder
    beamevent:          @local::proto_beamevent
}

protoDUNE_reco_data_stage1_producers:
{
    ### Reconstruction Chain
    # TPC wire signals
    caldata:            @local::producer_adcprep_byapa
    # WireCell
    wclsdatasp:         @local::protodunespdata_wctsp
    # Hit finder
    gaushit:            @local::protodunespmc_gaushitfinder
    # Space point finder
    reco3d:             @local::protodunespdata_spacepointsolver
    # Hit disambiguation
    hitpdune:           @local::pdune_disambigfromsp
    # CNN track/shower ID
    emtrkmichelid:      @local::protodunespdata_emtrkmichelid
    # Pandora and its track and shower building
    pandora:            @local::protodune_pandora
    pandoraWriter:      @local::dune_pandorawriter
    pandoraTrack:       @local::dune_pandoraTrackCreation
    pandoraShower:      @local::dune_pandoraShowerCreation
    # Calorimetry and PID for pandora
    pandoracalo:        @local::pdune_sp_calodata
    pandoracalonosce:   @local::pdune_sp_calodatanosce
    pandorapid:         @local::standard_chi2pid
    pandoracalinoxyzt:	@local::protodunespdata_calibrationdedx
    pandoracalipidnoxyzt:	@local::standard_chi2pid
    #pandoracali:	@local::protodunespdata_calibrationdedx
    #pandoracalipid:	@local::standard_chi2pid
    pandoraShowercalo:  @local::pdune_sp_showercalodata
    pandoraShowercalonosce:  @local::pdune_sp_showercalodatanosce
    # Photon detector reco modules
    ophitInternal:      @local::protodune_ophit_data_internal
    ophitExternal:      @local::protodune_ophit_data_external
    opflashInternal:    @local::protodune_opflash_data_internal
    opflashExternal:    @local::protodune_opflash_data_external
    opslicerInternal:   @local::protodune_opslicer_data_internal
    opslicerExternal:   @local::protodune_opslicer_data_external
    crtreco:            @local::TwoCRTMatching_producerData
    crttag:             @local::SingleCRTMatching_producerData
    anodepiercerst0: 	@local::T0RecoAnodePiercers

    ##Producers for forcing pandora to create track or shower objects 
    ##for each PFParticle
    pandora2Track:         @local::dune_pandoraTrackCreation
    pandora2calo:          @local::pdune_sp_alltrackcalodata
    pandora2calonosce:     @local::pdune_sp_alltrackcalodatanosce
    pandora2pid:           @local::standard_chi2pid
    pandora2calinoxyzt:	   @local::protodunespdata_calibrationdedx
    pandora2calipidnoxyzt:	   @local::standard_chi2pid
    #pandora2cali:	   @local::protodunespdata_calibrationdedx
    #pandora2calipid:	   @local::standard_chi2pid
    
    pandora2Shower:        @local::dune_pandoraShowerCreation 
    pandora2Showercalo:    @local::pdune_sp_allshowercalodata
    pandora2Showercalonosce:    @local::pdune_sp_allshowercalodatanosce
}

protoDUNE_reco_data_stage2_producers:
{
    pandoracali:	@local::protodunespdata_calibrationdedx
    pandoracalipid:	@local::standard_chi2pid
    pandora2cali:	   @local::protodunespdata_calibrationdedx
    pandora2calipid:	   @local::standard_chi2pid
}

protoDUNE_reco_data_filters:
{
  nhitsfilter: @local::standard_numberofhitsfilter
}

### Below are a list of convenient sequences that can be used for production/typical users. ###

protoDUNE_rawdecoding: [ timingrawdecoder,
                         ssprawdecoder,
                         tpcrawdecoder,
                         crtrawdecoder,
                         ctbrawdecoder,
                         beamevent
                       ]

#TPC decoding is now done in dataprep
protoDUNE_notpcdecoding: [ timingrawdecoder,
                           ssprawdecoder,
                           #tpcrawdecoder,
                           crtrawdecoder,
                           ctbrawdecoder,
                           beamevent
                         ]

protoDUNE_reco_data_stage1: [ caldata,
                              wclsdatasp,
                              gaushit,
                              nhitsfilter,
                              reco3d,
                              hitpdune,
                              pandora,
                              pandoraWriter,
                              pandoraTrack,
                              pandoraShower,
                              pandoracalo,
                              pandoracalonosce,
                              pandorapid,
                              pandoracalinoxyzt,
                              pandoracalipidnoxyzt,
                              #pandoracali,
                              #pandoracalipid,
                              pandoraShowercalo,
                              pandoraShowercalonosce,
                              emtrkmichelid,
                              ophitInternal,
                              ophitExternal,
                              opflashInternal,
                              opflashExternal,
                              opslicerInternal,
                              opslicerExternal,
                              crttag,
                              crtreco,
                              anodepiercerst0,
                              pandora2Track, 
                              pandora2calo, 
                              pandora2calonosce, 
                              pandora2pid,
                              pandora2calinoxyzt,
                              pandora2calipidnoxyzt,
                              #pandora2cali,
                              #pandora2calipid,
                              pandora2Shower, 
                              pandora2Showercalo,
                              pandora2Showercalonosce
                            ]

protoDUNE_reco_data_stage2: [ pandoracali,
                              pandoracalipid,
                              pandora2cali,
                              pandora2calipid
                            ]

protoDUNE_reco_data_stage1_producers.caldata.DigitLabel: "tpcrawdecoder:daq"

protoDUNE_reco_data_stage1_producers.gaushit.CalDataModuleLabel: "wclsdatasp:gauss"

# Make sure we can use cryostat-side APA hits
protoDUNE_reco_data_stage1_producers.hitpdune.ExcludeTPCs: []

#Pandora configurations
protoDUNE_reco_data_stage1_producers.pandora.HitFinderModuleLabel:             "hitpdune"
protoDUNE_reco_data_stage1_producers.pandoraWriter.HitFinderModuleLabel:       "hitpdune"
protoDUNE_reco_data_stage1_producers.pandoraTrack.PFParticleLabel:             "pandora"
protoDUNE_reco_data_stage1_producers.pandoraShower.PFParticleLabel:            "pandora"

protoDUNE_reco_data_stage1_producers.pandorapid.CalorimetryModuleLabel:        "pandoracalo"
protoDUNE_reco_data_stage1_producers.pandorapid.TrackModuleLabel:              "pandoraTrack"

protoDUNE_reco_data_stage1_producers.pandoracalinoxyzt.CalorimetryModuleLabel:  "pandoracalo"
protoDUNE_reco_data_stage1_producers.pandoracalinoxyzt.TrackModuleLabel:  "pandoraTrack"
protoDUNE_reco_data_stage1_producers.pandoracalinoxyzt.ApplyLifetimeCorrection: true
protoDUNE_reco_data_stage1_producers.pandoracalinoxyzt.ApplyYZCorrection:       false
protoDUNE_reco_data_stage1_producers.pandoracalinoxyzt.ApplyXCorrection:        false
protoDUNE_reco_data_stage1_producers.pandoracalinoxyzt.ApplyNormCorrection:     false

protoDUNE_reco_data_stage1_producers.pandoracalipidnoxyzt.CalorimetryModuleLabel: "pandoracalinoxyzt"
protoDUNE_reco_data_stage1_producers.pandoracalipidnoxyzt.TrackModuleLabel:       "pandoraTrack"

#Forcing Pandora to create either all tracks or all showers on each PFParticle object
protoDUNE_reco_data_stage1_producers.pandora2Track.PFParticleLabel:             "pandora"
protoDUNE_reco_data_stage1_producers.pandora2Track.UseAllParticles:             true
####The above line forces pandora to fit a track to all PFParticles

protoDUNE_reco_data_stage1_producers.pandora2pid.CalorimetryModuleLabel:        "pandora2calo"
protoDUNE_reco_data_stage1_producers.pandora2pid.TrackModuleLabel:              "pandora2Track"

protoDUNE_reco_data_stage1_producers.pandora2calinoxyzt.CalorimetryModuleLabel:  "pandora2calo"
protoDUNE_reco_data_stage1_producers.pandora2calinoxyzt.TrackModuleLabel:        "pandora2Track"
protoDUNE_reco_data_stage1_producers.pandora2calinoxyzt.ApplyLifetimeCorrection: true   
protoDUNE_reco_data_stage1_producers.pandora2calinoxyzt.ApplyYZCorrection:       false   
protoDUNE_reco_data_stage1_producers.pandora2calinoxyzt.ApplyXCorrection:        false
protoDUNE_reco_data_stage1_producers.pandora2calinoxyzt.ApplyNormCorrection:     false

protoDUNE_reco_data_stage1_producers.pandora2calipidnoxyzt.CalorimetryModuleLabel:   "pandora2calinoxyzt"
protoDUNE_reco_data_stage1_producers.pandora2calipidnoxyzt.TrackModuleLabel:          "pandora2Track"

protoDUNE_reco_data_stage1_producers.pandora2Shower.PFParticleLabel:       "pandora"
protoDUNE_reco_data_stage1_producers.pandora2Shower.UseAllParticles:       true

protoDUNE_reco_data_stage2_producers.pandoracali.CalorimetryModuleLabel:       "pandoracalinoxyzt"
protoDUNE_reco_data_stage2_producers.pandoracali.TrackModuleLabel:       "pandoraTrack"
protoDUNE_reco_data_stage2_producers.pandoracali.ApplyLifetimeCorrection:       false
protoDUNE_reco_data_stage2_producers.pandoracali.ApplyYZCorrection:             true
protoDUNE_reco_data_stage2_producers.pandoracali.ApplyXCorrection:              true
protoDUNE_reco_data_stage2_producers.pandoracali.ApplyNormCorrection:           true

protoDUNE_reco_data_stage2_producers.pandoracalipid.CalorimetryModuleLabel:    "pandoracali"
protoDUNE_reco_data_stage2_producers.pandoracalipid.TrackModuleLabel:          "pandoraTrack"

protoDUNE_reco_data_stage2_producers.pandora2cali.TrackModuleLabel:             "pandora2Track"
protoDUNE_reco_data_stage2_producers.pandora2cali.CalorimetryModuleLabel:       "pandora2calinoxyzt"
protoDUNE_reco_data_stage2_producers.pandora2cali.ApplyLifetimeCorrection:      false   
protoDUNE_reco_data_stage2_producers.pandora2cali.ApplyYZCorrection:            true   
protoDUNE_reco_data_stage2_producers.pandora2cali.ApplyXCorrection:             true
protoDUNE_reco_data_stage2_producers.pandora2cali.ApplyNormCorrection:          true

protoDUNE_reco_data_stage2_producers.pandora2calipid.CalorimetryModuleLabel:    "pandora2cali"
protoDUNE_reco_data_stage2_producers.pandora2calipid.TrackModuleLabel:          "pandora2Track"

END_PROLOG
# protodune_tools_dune.fcl

# David Adams
# April 2018
#
# Collect all tool definitions for protoDUNE.

# destimtools_dune.fcl

# David Adams
# Aprils 2017

# Tool definitions for DUNE DetSim.

# Ideal ADC simulator with a gain of 1.0.
# For use where the input voltage is already converte dot ADC counts.
tools.adcsim_ideal: {
  tool_type: IdealAdcSimulator
  Vsen: 1.0
  Nbit: 12
}
# dunecommon_tools.fcl

# David Adams
# August 2017

# Dune common tools.

# ProtoDUNE run data tool.
tools.protoduneRunDataTool: {
  tool_type: FclRunDataTool
  LogLevel: 1
  FileNames: ["rundata/protodune/rundata.fcl", "rundata/protodune/rundata%RUN%.fcl"]
}

# Tick range tool.
# So tools can share tick ranges.
tools.tickRanges: {
  tool_type: FclIndexRangeTool
  LogLevel: 1
  allTicks:  { begin:0     end:0     labels:["All ticks"]  }
}

# Channel status from service.
tools.channelStatusFromService: {
  tool_type: ChannelStatusServiceTool
  LogLevel: 1
}

tools.channelStatus: @local::tools.channelStatusFromService

# Histogram manager.
tools.histMgr: {
  LogLevel: 1
  tool_type: SimpleHistogramManager
}
# pdsp_decoder.fcl

# David Adams
# August 2019
#
# Default configuration for the protoDUNE TPC decoder tool.
#
# This is a duplicate of the prolog definition for pdsrd_tool in pdsprd.fcl.

tools.pdsp_decoder: {
  tool_type: "PDSPTPCDataInterface"

  APA1InputLabels: [ "daq:TPC001", "daq:ContainerTPC001", "daq:FELIX001", "daq:ContainerFELIX001",  "daq:TPC", "daq:ContainerTPC", "daq:FELIX", "daq:ContainerFELIX" ]
  APA2InputLabels: [ "daq:TPC002", "daq:ContainerTPC002", "daq:FELIX002", "daq:ContainerFELIX002",  "daq:TPC", "daq:ContainerTPC", "daq:FELIX", "daq:ContainerFELIX" ]
  APA3InputLabels: [ "daq:TPC003", "daq:ContainerTPC003", "daq:FELIX003", "daq:ContainerFELIX003",  "daq:TPC", "daq:ContainerTPC", "daq:FELIX", "daq:ContainerFELIX" ]
  APA4InputLabels: [ "daq:TPC004", "daq:ContainerTPC004", "daq:FELIX004", "daq:ContainerFELIX004",  "daq:TPC", "daq:ContainerTPC", "daq:FELIX", "daq:ContainerFELIX" ]
  APA5InputLabels: [ "daq:TPC005", "daq:ContainerTPC005", "daq:FELIX005", "daq:ContainerFELIX005",  "daq:TPC", "daq:ContainerTPC", "daq:FELIX", "daq:ContainerFELIX" ]
  APA6InputLabels: [ "daq:TPC006", "daq:ContainerTPC006", "daq:FELIX006", "daq:ContainerFELIX006",  "daq:TPC", "daq:ContainerTPC", "daq:FELIX", "daq:ContainerFELIX" ]
  APA7InputLabels: [ "daq:TPC007", "daq:ContainerTPC007", "daq:FELIX007", "daq:ContainerFELIX007",  "daq:TPC", "daq:ContainerTPC", "daq:FELIX", "daq:ContainerFELIX",
                     "daq:TPC000", "daq:ContainerTPC000", "daq:FELIX000", "daq:ContainerFELIX000" ]
  APA8InputLabels: [ "daq:TPC008", "daq:ContainerTPC008", "daq:FELIX008", "daq:ContainerFELIX008",  "daq:TPC", "daq:ContainerTPC", "daq:FELIX", "daq:ContainerFELIX",
                     "daq:TPC000", "daq:ContainerTPC000", "daq:FELIX000", "daq:ContainerFELIX000" ]
  MISCAPAInputLabels: [ "daq:TPC", "daq:ContainerTPC", "daq:FELIX", "daq:ContainerFELIX" ]  # use for example for coldbox-test data
  DefaultCrateIfUnexpected:  3     #  Use for coldbox data -- unexpected means not in the range 1-6.

  RCEDropSmallFrags: true
  RCESmallFragSize: 500000
  RCEDropFragsWithBadSF: true    # skip fragments with invalid  slot and fiber numbers
  RCEDropFragsWithBadC:  true    # skip fragments with invalid crate numbers
  RCEHexDump: false
  RCESaveFragsToFiles: false
  RCECheckBufferSize: true
  RCEBufferSizeCheckLimit: 10000000
  RCEFIX110:                         true   # shift waveforms for ASIC 3 on FEMB 110
  RCEFIX110NTICKS:                   18     # number of ticks to shift waveforms on FEMB 110 ASIC 3

  FELIXDropFragsWithBadSF: true
  FELIXDropFragsWithBadC: true
  FELIXHexDump: false
  FELIXDropSmallFrags: true
  FELIXSmallFragSize: 10000
  FELIXCheckBufferSize: true
  FELIXBufferSizeCheckLimit: 10000000

# enforcement flags.  If these are set to true and the data completeness 
# conditions are not met, then an emtpy collection of raw::RawDigits is 
# put in the event

# requires that we don't see the same channel twice in in an event

  EnforceNoDuplicateChannels: true

# requires that all channels have the same number of ticks (on each event separately)

  EnforceSameTickCount: false

# requires that all channels have the specified number of ticks

  EnforceFullTickCount: false
  FullTickCount: 6000

# requires that no errors are reported by the unpacker (checksum or capture errors)

  EnforceErrorFree: false
}

tools.iceberg_decoder: @local::tools.pdsp_decoder
tools.iceberg_decoder.RCEFIX110: false

# protodune_dataprep_tools.fcl
#
# David Adams
# August 2019
#
# Define protodune tools.

# dataprep_tools.fcl

# David Adams
# July 2017

# Some example tools for use in data prep.
#
# April 2018. Some protoDUNE-specific tools are moved to protodune_dataprep_tools.fcl

################################################################################
# Job ranges.
################################################################################

tools.jobRanges: {
  tool_type: FclIndexRangeTool
  LogLevel: 1
  events: { begin:0 end:0 labels: [] }  # Event range for selection and plotting.
}

################################################################################
# Ranges for channel-tick plots.
################################################################################

# tools.tickRanges is defined in DuneCommon/fcl/dunecommon_tools.fcl

tools.tickRanges.plotTicks: { begin:3000 end:4000 labels:["Plot ticks"] }
tools.tickRanges.plotAllTicks: { begin:0 end:0 labels:["All ticks"] }

################################################################################
# Dumpers.
################################################################################

# Dump ADC channel contents to the log file.
tools.adcChannelDumper: {
  tool_type: AdcChannelDumper
  FileName: ""
  Prefix: "ADC dump: "
  NewFile: false
  MaxSample: 0
}

################################################################################
# Event displays.
################################################################################

# Add ADC info to names and titles, e.g.
#  MyTitle = "Run %RUN%-%SUBRUN% event %EVENT% channel %CHAN%"
#  MyFileName = "run%0RUN%-%0SUBRUN%_evt%0EVENT%_cha%0CHAN%"
tools.adcStringBuilder: {
  tool_type: StandardAdcChannelStringTool
  LogLevel: 1
  RunWidth: 6
  SubRunWidth: 4
  EventWidth: 6
  ChannelWidth: 5
  CountWidth: 4
  FembWidth: 3
  TriggerWidth: 2
  TrigNames: [ "flag 0",  "flag 1",  "flag 2",  "flag 3",  "flag 4",
               "flag 5",  "flag 6",  "flag 7",  "random",  "flag 9",
               "flag 10", "flag 11",    "beam",     "CRT", "NGT"]
}

# Dump raw ADC channel waveform to a histogram.
tools.adcPlotRaw: {
  tool_type: AdcChannelPlotter
  LogLevel: 1
  HistTypes: ["raw"]
  HistName: "adc_%TYPE%_ev%EVENT%_ch%CHAN%"
  HistTitle: "ADC %TYPE% run %RUN% event %EVENT% channel %CHAN%"
  RootFileName: ""
  PlotFileName: ""
  PlotSamMin:    0
  PlotSamMax: 1000
  PlotSigOpt: pedestal
  PlotSigMin:  100
  PlotSigMax:    0
  PlotDistMin:   0
  PlotDistMax:   0
  ColorBad:   633
  ColorNoisy: 636
  LabelSize: 0.01
  SkipFlags: []
}

# Dump prepared ADC channel waveform to a histogram.
tools.adcPlotPrepared: {
  tool_type: AdcChannelPlotter
  LogLevel: 1
  HistTypes: ["prepared"]
  HistName: "adc_%TYPE%_ev%EVENT%_ch%CHAN%"
  HistTitle: "ADC %TYPE% run %RUN% event %EVENT% channel %CHAN%"
  RootFileName: ""
  PlotFileName: ""
  PlotSamMin:    0
  PlotSamMax: 1000
  PlotSigOpt: full
  PlotSigMin:    0
  PlotSigMax:    0
  PlotDistMin:   0
  PlotDistMax:   0
  ColorBad:   633
  ColorNoisy: 636
  LabelSize: 0.01
  SkipFlags: []
}

# Dump ADC channel distribution to a histogram.
tools.adcPlotRawDist: {
  tool_type: AdcChannelPlotter
  LogLevel: 1
  HistTypes: ["rawdist"]
  HistName: "adc_%TYPE%_ev%EVENT%_ch%CHAN%"
  HistTitle: "ADC %TYPE% run %RUN% event %EVENT% channel %CHAN%"
  RootFileName: ""
  PlotFileName: ""
  PlotSamMin:    0
  PlotSamMax: 1000
  PlotSigOpt: full
  PlotSigMin:    0
  PlotSigMax:    0
  PlotDistMin:   0
  PlotDistMax:   0
  ColorBad:   633
  ColorNoisy: 636
  LabelSize: 0.01
  SkipFlags: []
}

# Fit ADC distribution to get pedestal.
tools.def_adcPedestalFit: {
  tool_type: AdcPedestalFitter
  LogLevel: 1
  SkipFlags: []
  AdcFitRange: 100
  FitRmsMin:  1.0
  FitRmsMax: 20.0
  RemoveStickyCode: false
  HistName: "adcped_ev%0EVENT%_ch%0CHAN%"
  HistTitle: "ADC pedestal fit for run %RUN% event %EVENT% channel %CHAN%"
  PlotFileName: ""
  RootFileName: ""
  HistManager: ""
  PlotSizeX: 0
  PlotSizeY: 0
  PlotSplitX: 0
  PlotSplitY: 0
  PlotShowFit: 1
}

# Dump ADC map contents to the log file.
tools.adcDumper: {
  tool_type: AdcDataDumper
  FileName: ""
  Prefix: "ADC dump for "
  NewFile: false
  ShowChannelCount: true
  ShowTickCounts: false
  ShowRaw: false
  ShowPrepared: true
  ShowFirst: 10
  ShowRebin: 5
  ShowMax: 30
  ShowThreshold: 10
  ShowOpt: 2
}

# Create png files showing ADC contents (ADC vs. channel vs. time).
tools.preparedAdcPlotter: {
  tool_type: AdcDataPlotter
  LogLevel: 1
  DataType: 0      # 0 for prepared, 1 for raw-pedestal
  DataView: ""
  TickRange: plotTicks
  TickRebin: 1
  ChannelRanges: []
  ClockFactor: 0.0
  ClockOffset: 0.0
  FembTickOffsets: []
  MaxSignal: 200
  SkipBadChannels: false
  EmptyColor: 18
  ChannelLineModulus: 2560
  ChannelLinePattern: [0, 800, 1600, 2080]
  Palette: 2020
  HistName: "hadcprp_evt%EVENT%_ch_%CHAN1%"
  HistTitle: "Prepared ADC for event %EVENT%"
  PlotTitle: ""
  PlotSizeX: 1400
  PlotSizeY: 1000
  PlotFileName: "adcprep_evt%EVENT%_ch%CHAN1%-%CHAN2%.png"
  RootFileName: ""    # or "adc_evt%EVENT%.root"
}
tools.signalAdcPlotter: {
  tool_type: AdcDataPlotter
  LogLevel: 1
  DataType: 2      # 0 for prepared, 1 for raw-pedestal
  DataView: ""
  TickRange: plotTicks
  TickRebin: 1
  ChannelRanges: []
  ClockFactor: 0.0
  ClockOffset: 0.0
  FembTickOffsets: []
  MaxSignal: 200
  SkipBadChannels: false
  EmptyColor: 18
  ChannelLineModulus: 2560
  ChannelLinePattern: [0, 800, 1600, 2080]
  Palette: 2020
  HistName: "hadcsig_evt%EVENT%_ch_%CHAN1%"
  HistTitle: "Signal ADC for event %EVENT%"
  PlotTitle: ""
  PlotSizeX: 1400
  PlotSizeY: 1000
  PlotFileName: "adcsig_evt%EVENT%_ch%CHAN1%-%CHAN2%.png"
  RootFileName: ""    # or "adc_evt%EVENT%.root"
}
tools.rawAdcPlotter: {
  tool_type: AdcDataPlotter
  LogLevel: 1
  DataType: 1      # 0 for prepared, 1 for raw-pedestal
  DataView: ""
  TickRange: plotTicks
  TickRebin: 1
  ChannelRanges: []
  ClockFactor: 0.0
  ClockOffset: 0.0
  FembTickOffsets: []
  MaxSignal: 200
  SkipBadChannels: false
  EmptyColor: 18
  ChannelLineModulus: 2560
  ChannelLinePattern: [0, 800, 1600, 2080]
  Palette: 2020
  HistName: "hadcraw_evt%EVENT%_ch_%CHAN1%"
  HistTitle: "Raw ADC for event %EVENT%"
  PlotTitle: ""
  PlotSizeX: 1400
  PlotSizeY: 1000
  PlotFileName: "adcraw_run%RUN%_evt%EVENT%_ch%CHAN1%-%CHAN2%.png"
  RootFileName: ""   # or "adc_evt%EVENT%.root"
}

################################################################################
# Metric plotters.
################################################################################

# Pedestal for each channel.
tools.adcChannelPedestalPlotter: {
  tool_type: AdcChannelMetric
  LogLevel: 1
  DataView: ""
  Metric: pedestal
  PedestalReference: ""
  MetricSummaryView: ""
  MetricMin: 0
  MetricMax: 4096
  MetricBins: 0
  MetricLabel: "Pedestal"
  PlotUsesStatus: 0
  ChannelRanges: []
  ChannelLineModulus: 0
  ChannelLinePattern: []
  HistName: "hchped_%0RUN%_%0EVENT%_%0CHAN1%_%0CHAN2%"
  HistTitle: "ADC pedestals for run %RUN% event %EVENT%"
  PlotSizeX: 1400
  PlotSizeY:  500
  PlotFileName: "hchped_run%0RUN%_evt%0EVENT%_chans%0CHAN1%-%0CHAN2%.png"
  RootFileName: ""
}

# Pedestal RMS for each channel.
tools.adcChannelPedestalRmsPlotter: {
  tool_type: AdcChannelMetric
  LogLevel: 1
  DataView: ""
  Metric: pedestalRms
  PedestalReference: ""
  MetricSummaryView: ""
  MetricMin: 0
  MetricMax: 11
  MetricBins: 0
  MetricLabel: "RMS"
  PlotUsesStatus: 0
  ChannelRanges: []
  ChannelLineModulus: 0
  ChannelLinePattern: []
  HistName: "hchpedrms_%0RUN%_%0EVENT%_%0CHAN1%_%0CHAN2%"
  HistTitle: "ADC pedestal RMS for run %RUN% event %EVENT%"
  PlotSizeX: 1400
  PlotSizeY:  500
  PlotFileName: "hchpedrms_run%0RUN%_evt%0EVENT%_chans%0CHAN1%-%0CHAN2%.png"
  RootFileName: ""
}

# Sample RMS
tools.adcChannelSamplelRmsPlotter: @local::tools.adcChannelPedestalRmsPlotter
tools.adcChannelSamplelRmsPlotter.Metric: samRms
tools.adcChannelSamplelRmsPlotter.HistName: "hchsamrms_%0RUN%_%0EVENT%_%0CHAN1%_%0CHAN2%"
tools.adcChannelSamplelRmsPlotter.HistTitle: "ADC sample RMS for run %RUN% event %EVENT%"
tools.adcChannelSamplelRmsPlotter.PlotFileName: "hchsamrms_run%0RUN%_evt%0EVENT%_chans%0CHAN1%-%0CHAN2%.png"

# Signal RMS
tools.adcChannelSignalRmsPlotter: @local::tools.adcChannelPedestalRmsPlotter
tools.adcChannelSignalRmsPlotter.Metric: sigRms
tools.adcChannelSignalRmsPlotter.HistName: "hchsigrms_%0RUN%_%0EVENT%_%0CHAN1%_%0CHAN2%"
tools.adcChannelSignalRmsPlotter.HistTitle: "ADC signal RMS for run %RUN% event %EVENT%"
tools.adcChannelSignalRmsPlotter.PlotFileName: "hchsigrms_run%0RUN%_evt%0EVENT%_chans%0CHAN1%-%0CHAN2%.png"

adcSampleFreq: 2000
adcPlotDftTemplate: {
          tool_type: AdcChannelDftPlotter
           LogLevel: 1
       PlotDataView: ""
  ChannelStatusFlag: 0
         SampleFreq: @local::adcSampleFreq
           PlotName: ""
   PlotSummaryNames: []
   HistSummaryTitle: ""
               XMin: 0.0
               XMax: 0.0
            YMinLog: 0.0
  PlotChannelRanges: []    # Empty makes one plot for each channel
  PlotChannelGroups: []    # Empty makes one plot for each channel
  PlotOverlayGroups: 1     # Rnages in a group are drawn on the same pad.
          PlotSizeX: 1400
          PlotSizeY: 1000
         PlotSplitX: 4
         PlotSplitY: 4
}

# DFT amplitudes
tools.adcPlotDftMag: @local::adcPlotDftTemplate
tools.adcPlotDftMag.Variable: magnitude
tools.adcPlotDftMag.SampleFreq: @local::adcSampleFreq
tools.adcPlotDftMag.YMax: 50
tools.adcPlotDftMag.HistName: "hdftmags_run%0RUN%_evt%0EVENT_ch%0CHAN%%"
tools.adcPlotDftMag.HistTitle: "DFT amplitudes for run %RUN% event %EVENT% channel %CHAN%"
tools.adcPlotDftMag.PlotName: "dftmag_run%0RUN%_evt%0EVENT%_ch%0CHAN%.png"

# DFT Phases
tools.adcPlotDftPhase: @local::adcPlotDftTemplate
tools.adcPlotDftPhase.Variable: phase
tools.adcPlotDftPhase.HistName: "hdftphas_run%0RUN%_evt%0EVENT%_ch%0CHAN%"
tools.adcPlotDftPhase.HistTitle: "DFT phases for run %RUN% event %EVENT% channel %CHAN%"
tools.adcPlotDftPhase.PlotName: "dftpha_run%0RUN%_evt%0EVENT%_ch%0CHAN%.png"

# DFT power
tools.adcPlotDftPower: @local::adcPlotDftTemplate
tools.adcPlotDftPower.Variable: power
tools.adcPlotDftPower.YMax: 10000
tools.adcPlotDftPower.NBinX: 50
tools.adcPlotDftPower.HistName: "hdftpower_run%0RUN%_evt%0EVENT_ch%0CHAN%%"
tools.adcPlotDftPower.HistTitle: "DFT power for run %RUN% event %EVENT% channel %CHAN%"
tools.adcPlotDftPower.HistSummaryTitles:["DFT power for run %RUN%", "DFT power for run %RUN% event %EVENT%"]
tools.adcPlotDftPower.PlotName: "dftpower_run%0RUN%_evt%0EVENT%_ch%0CHAN%.png"
tools.adcPlotDftPower.PlotSummaryNames: ["dftpowtlog_run%0RUN%.{png,tpad}", ""]


# DFT power/tick
tools.adcPlotDftTickPower: @local::tools.adcPlotDftPower
tools.adcPlotDftTickPower.Variable: "power/tick"
tools.adcPlotDftTickPower.YMax: -2.0
tools.adcPlotDftTickPower.NBinX: 50
tools.adcPlotDftTickPower.HistName: "hdftpowt_run%0RUN%_evt%0EVENT_ch%0CHAN%%"
tools.adcPlotDftTickPower.HistTitle: "DFT power for run %RUN% event %EVENT% channel %CHAN%"
tools.adcPlotDftTickPower.PlotName: "dftpowt_run%0RUN%_evt%0EVENT%_ch%0CHAN%.png"

# DFT power/tick with log scale.
tools.adcPlotDftTickPowerLog: @local::tools.adcPlotDftTickPower
tools.adcPlotDftTickPowerLog.YMinLog: 0.01
tools.adcPlotDftTickPowerLog.YMax: 100.0
tools.adcPlotDftTickPowerLog.HistName: "hdftpowtlog_run%0RUN%_evt%0EVENT%_ch%0CHAN%"
tools.adcPlotDftTickPowerLog.PlotName: "dftpowtlog_run%0RUN%_evt%0EVENT%_ch%0CHAN%.png"

################################################################################
# Data prep reconstruction tools.
################################################################################

# Extract raw data from a digit.
tools.digitReader: {
  tool_type: AcdDigitReader
  LogLevel: 1
}

# Fill sample from 12-bit ADC data.
tools.adcSampleFiller: {
  tool_type: AdcSampleFiller
  LogLevel: 1
  AdcUnderflow: 0
  AdcOverflow: 4095
}

# Fill sample and apply calibration.
# May 2020: Switch to fix01 of calib based on 2018-dec data.
tools.adcSampleCalibration: {
  tool_type: FloatArrayGainCalibration
  LogLevel: 1
  Unit: "ke/tick"
  GainDefault: 0.0
  AdcUnderflowDefault: 0
  AdcOverflowDefault: 4095
  GainTool: "areaGain_calib20191213_dec18ext"
}

# Perform deconvolution with SignalShapingService.
tools.adcVintageDeconvoluter: {
  tool_type: VintageDeconvoluter
  LogLevel: 1
}

# Subtract baseline after deconvolution
tools.adcSubtractBaseline: {
  tool_type: SubtractBaseline
  LogLevel: 1
  BaseSampleBins: 32
  BaseVarCut: 5.
}

# Find one ROI signals that includes all samples.
tools.adcKeepAllSignalFinder: {
  tool_type: AdcKeepAllSignalFinder
  LogLevel: 1
  DataPath: ""
}

# Scale samples from ke to ADC count.
tools.adcScaleKeToAdc: {
  tool_type: AdcSampleScaler
  LogLevel: 1
  ScaleFactor: 40.0
  InputUnit: "ke/tick"
  OutputUnit: "ADC count"
}

# Scale samples from ke to ADC count.
tools.adcScaleAdcToKe: {
  tool_type: AdcSampleScaler
  LogLevel: 1
  ScaleFactor: 0.025
  InputUnit: "ADC count"
  OutputUnit: "ke/tick"
}

# Find ADC signals with simple threshold algorithm.
tools.adcThresholdSignalFinder: {
  tool_type: AdcThresholdSignalFinder
  LogLevel: 1
  Threshold: 3.0   # Works for MC may2018
  BinsBefore: 10
  BinsAfter: 20
  FlagPositive: true
  FlagNegative: true
}

# Find ADC signals with Dune 35t algorithm.
tools.adcDuneSignalFinder: {
  tool_type: DuneAdcSignalFinder
  LogLevel: 1
  NoiseSigma:  0.0
  NSigmaStart: 3.0
  NSigmaEnd:   1.0
  TicksBefore: 50
  TicksAfter:  50
}

# Do FFT.
tools.adcFFT: {
  tool_type: AdcChannelFFT
  LogLevel:  1
  FirstTick: 0
  NTick:     0
  NormOpt:   1
  Action:    3
  ReturnOpt: 1
  DataView: ""
}

# Undo FFT.
tools.adcFFTinv: {
  tool_type:  AdcChannelFFT
  LogLevel:   1
  FirstTick:  0
  NTick:      0
  NormOpt:    1
  Action:    13
  ReturnOpt: 10
  DataView: ""
}

# Fetch ROI info and hists.
tools.adcRoiViewer: {
  tool_type: AdcRoiViewer
  LogLevel: 1
  SigThresh: 0.0
  TickBorder: 0
  RoiHistOpt:  1
  FitOpt:   0
  RoiPlotOpt:  2
  StartTime: 0
  PulserStepCharge: 0.0
  PulserDacOffset: 0.0
  PulserChargeUnit: ""
  RunDataTool: ""
  TickOffsetTool: ""
  MaxRoiPlots: 1000
  RoiPlotPadX: 4
  RoiPlotPadY: 4
  SumPlotPadX: 4
  SumPlotPadY: 4
  ChannelLineModulus: 0
  ChannelLinePattern: []
  SumNegate: false
  SumHists: []
  ChanSumHists: []
  ChannelRanges: []
  RoiRootFileName: ""
  SumRootFileName: ""
  ChanSumRootFileName: ""
  PlotLabels: []
}
tools.adcRoiFitter: {
  tool_type: AdcRoiViewer
  SigThresh: 0.0
  TickBorder: 0
  LogLevel: 1
  RoiHistOpt:  1
  FitOpt:   1
  RoiPlotOpt:  2
  StartTime: 0
  PulserStepCharge: 0.0
  PulserDacOffset: 0.0
  PulserChargeUnit: ""
  RunDataTool: ""
  TickOffsetTool: ""
  MaxRoiPlots: 1000
  RoiPlotPadX: 4
  RoiPlotPadY: 4
  SumPlotPadX: 4
  SumPlotPadY: 4
  ChannelLineModulus: 0
  ChannelLinePattern: []
  SumNegate: false
  SumHists: []
  ChanSumHists: []
  ChannelRanges: []
  RoiRootFileName: ""
  SumRootFileName: ""
  ChanSumRootFileName: ""
  PlotLabels: []
}

# Build ROI w.r.t. local baseline
tools.adcDPhase3x1x1LocalRoiBuilder: {
  tool_type: AdcDPhase3x1x1LocalRoiBuilder
  LogLevel: 1
  BinsToAverageForPedestal: 100
  BinsToSkip: 2
  UseStandardDeviation: true
  NConsecBinsAboveThreshold1: 9
  NSigmaStart1: 0.5
  NSigmaEnd1: 0.0
  NConsecBinsAboveThreshold2: 4
  NSigmaStart2: 1.8
  NSigmaMax: 5
  PadLow: 10
  PadHigh: 30
}

# Build ROI w.r.t 0
tools.adcDPhase3x1x1RoiBuilder: {
  tool_type: AdcDPhase3x1x1RoiBuilder
  LogLevel: 1
  BinsToAverageForRMS: 100
  BinsToSkip: 0
  UseStandardDeviation: false
  NConsecBinsAboveThreshold1: 30
  NSigmaStart1: 1.0
  NSigmaEnd1: 0.0
  NConsecBinsAboveThreshold2: 10
  NSigmaStart2: 2.0
  NSigmaMax: 7.0
  PadLow: 20
  PadHigh: 50
}

# Split data keeping ROIs.
tools.adcSliceRoi: {
  tool_type: AdcRoiSlicer
  LogLevel: 1
  OutViewName: rois
  SliceOpt: 1
  CopyRaw: false
}

# Split data keeping not ROIs.
tools.adcSliceNotRoi: {
  tool_type: AdcRoiSlicer
  LogLevel: 1
  OutViewName: notrois
  SliceOpt: 2
  CopyRaw: false
}


################################################################################
# Shared data.
################################################################################

# Flag so other fcl files can check if this file has been included.
have_protodune_dataprep_tools: true

data.pd_tpsChannelRanges: [tps0, tps1, tps2, tps3, tps4, tps5]
data.pd_ClockUnit: "Mtick"
data.pd_TriggerClockRate: 50000000.0
data.pd_Tick0: 500

tools.tickRanges.plotTicks.begin: 4000
tools.tickRanges.plotTicks.end:   5000

################################################################################
# Channel mapping.
################################################################################

tools.pd_onlineChannelMap: {
  tool_type: ProtoduneOnlineChannel
}

tools.pd_onlineChannelMapByWib: {
  tool_type: PdspOnlineChannel
   LogLevel: 1
   Ordering: "WIB"
}

tools.pd_onlineChannelMapByConnector: {
  tool_type: PdspOnlineChannel
   LogLevel: 1
   Ordering: "connector"
}

tools.pd_onlineChannelMapByFemb: {
  tool_type: PdspOnlineChannel
   LogLevel: 1
   Ordering: "FEMB"
}

tools.channelRanges: {
  tool_type: ProtoDuneChannelRanges
  LogLevel: 0
  ExtraRanges: ""
}

tools.channelRangesApa7: {
  tool_type: ApaChannelRanges
  LogLevel: 0
  ApaNumbers: [7]
  ApaLocationNames: ["ColdBox"]
  ExtraRanges: ""
}

tools.channelRangesIceberg: {
  tool_type: HalfApaChannelRanges
  LogLevel: 0
  ApaNumbers: [1]
  ApaLocationNames: ["Iceberg"]
  ExtraRanges: ""
}

tools.channelGroups: {
  tool_type: ProtoDuneChannelGroups
  LogLevel: 0
  IndexRangeTool: channelRanges
}

tools.channelGroupsApa7: {
  tool_type: ApaChannelGroups
  LogLevel: 0
  ApaNumbers: [7]
  IndexRangeTool: channelRanges
}

tools.channelGroupsIceberg: {
  tool_type: ApaChannelGroups
  LogLevel: 0
  ApaNumbers: [8]
  IndexRangeTool: channelRanges
}

# Map channels to APA views: 0:U, 1:v, 2:X
tools.pdspChannelToPlane: {
  tool_type: BlockIndexMapTool
  LogLevel: 0
  Starts: [ 0, 800, 1600]
  Values: [ 0,   1,    2]
  Period: 2560
}

################################################################################
# Reco.
################################################################################

# Fit ADC distribution to get pedestal.
tools.pd_adcPedestalFit: {
  tool_type: AdcPedestalFitter
  LogLevel: 1
  FitOpt: 3
  FitPrecision: 1.0
  SkipFlags: [8, 9, 10, 11, 12]
  AdcFitRange: 100
  FitRmsMin:  3.0
  FitRmsMax: 20.0
  RemoveStickyCode: true
  HistName: "adcped_ev%0EVENT%_ch%0CHAN%"
  HistTitle: "ADC pedestal fit for run %RUN% event %EVENT% channel %CHAN%"
  PlotFileName: ""
  RootFileName: ""
  HistManager: ""
  PlotSizeX: 0
  PlotSizeY: 0
  PlotSplitX: 0
  PlotSplitY: 0
  PlotShowFit: 1
}

# Sticky code mitigation.
tools.pdsp_adcMitigate: {
  tool_type: AdcCodeMitigator
  LogLevel: 1
  FixFlags: []
  InterpolateFlags: [8, 9, 10, 11, 12]
  SkipFlags: []
  FixedCurvThresh: 20.0
}

###########

# Timing mitigation.
# Adjust the timing for FEMB 302 (aka femb 1)

# Rough tune Dec 2018.
tools.pdsp_timingMitigateDec2018: {
  tool_type: AdcTimingMitigator
  LogLevel: 1
  SamplingRatio: 0.9995
  SamplingOffset: 3
  FEMBs: [1]
}

# Better tune Mar 2019.
# See ProtoDUNE sim/reco meeting March 27, 2019.
tools.pdsp_timingMitigateMar2019: {
  tool_type: AdcTimingMitigator
  LogLevel: 1
  SamplingRatio: 0.9993
  SamplingOffset: 1.0
  FEMBs: [1]
}

# Default for reco.
tools.pdsp_timingMitigate: @local::tools.pdsp_timingMitigateMar2019

###########

# Subtract baseline after deconvolution
tools.adcCorrectUndershootAdc: {
  tool_type: UndershootCorr
  LogLevel: 1
  SignalUnit: "ADC count"
  CorrectFlag:     [    false,     false,     true ]  # Apply correction (U, V, and Collection)
  SignalThreshold: [       20,        20,       20 ]  # Above this value, ticks are deweighted in fit
  TDecayConst:     [  0.99955,   0.99955,  0.99955 ]  # Corrn params (tuned for collection plane)
  FSubConst:       [   0.0005,    0.0005,   0.0005 ]  #  "
  RestoreBaseline: [    false,     false,    false ]  # If true, add back medians to restore orig baseline
  LCA:             [     1980,      1980,     1980 ]  # Params used in fit to determine the ped and
  LCB:             [ -0.08277,  -0.08277, -0.08277 ]  # and initial pedestal offset
  LCC:             [ -2043.65, -2043.65 , -2043.65 ]  #  "
  LCD:             [     1.03,      1.03,     1.03 ]  #  "
}

tools.adcCorrectUndershootKe: @local::tools.adcCorrectUndershootAdc
tools.adcCorrectUndershootKe.SignalUnit: "ke/tick"
tools.adcCorrectUndershootKe.SignalThreshold: [      0.50,      0.50,     0.50 ]

tools.adcCorrectUndershoot: @local::tools.adcCorrectUndershootAdc

# Signal finder to use with tail removal.
tools.adcTailSignalFinderAdc: {
  tool_type: AdcThresholdSignalFinder
  LogLevel: 1
  Threshold: 20.0
  BinsBefore: 10
  BinsAfter: 20
  FlagPositive: true
  FlagNegative: true
}

# Tail removal 2019.
tools.adcTailRemovalAdc: {
  tool_type: ExpTailRemover
  LogLevel: 1
  DecayTime: 2000
  SignalFlag: 3
  SignalIterationLimit: 10
  SignalTool: adcTailSignalFinderAdc
  IncludeChannelRanges: ["apa1z", "apa2z", "apa3z", "apa4z", "apa5z", "apa6z"]
  ExcludeChannelRanges: []
}

tools.adcTailSignalFinderKe: @local::tools.adcTailSignalFinderAdc
tools.adcTailSignalFinderKe.Threshold: 0.5
tools.adcTailRemovalKe: @local::tools.adcTailRemovalAdc
tools.adcTailRemovalKe.SignalTool: adcTailSignalFinderKe

# Tail removal 2020.
tools.pdspTailPedRemovalZKe: {
  tool_type: ExpTailPedRemover
  LogLevel: 1
  DecayTime: 2200
  SignalFlag: 3
  SignalIterationLimit: 10
  SignalTool: adcTailSignalFinderKe
  MaxTick: 21000
  PedDegree: 0
  PedTick0: 3000
  PedFreqs: []
  NoWarnStatuses: [1]
  IncludeChannelRanges: ["apa1z", "apa2z", "apa3z", "apa4z", "apa5z", "apa6z",
                         "apa1c", "apa2c", "apa3c", "apa4c", "apa5c", "apa6c"]
  ExcludeChannelRanges: []
}

tools.pdspTailPedRemovalIKe: @local::tools.pdspTailPedRemovalZKe
tools.pdspTailPedRemovalIKe.DecayTime: 6000
tools.pdspTailPedRemovalIKe.IncludeChannelRanges: ["apa1i", "apa2i", "apa3i", "apa4i", "apa5i", "apa6i"]

# Correct gain calibration for new induction capacitance and estimates
# of out-of-plane charge sharing.
# See D. Adams talk at ProtoDUNE sim/reco 8/26/2020:
# https://indico.fnal.gov/event/44166/contributions/195159/attachments/133594/164846/adams_dunepdsimrec_20200826_dataprep.pdf
tools.pdsp_gainCorrection: {
  tool_type: AdcRangeSampleScaler
  LogLevel: 1
  RangeLimits: [800, 1600]
  RangeModulus: 2560
  ScaleFactors: [1.052, 1.030, 1.047]
}

# Scale ADC to ke
tools.adcScaleAdcToKe.ScaleFactor: 2.401e-2 #24.01 e/ADC/ticks

# Scale ke to ADC
tools.adcScaleKeToAdc.ScaleFactor: 41.649 # 24.01 e/ADC/ticks

################################################################################
# Event metrics.
################################################################################

tools.pd_evtviewNfemb: {
  tool_type: AdcEventViewer
  LogLevel: 2
  EventHists: ["hnfemb:125:0:125"]
  EventGraphs: ["event:events:1:nfemb:0:125"]
  ChannelRanges: []
  ChannelRangeLabel: "%CRLABEL%"
  ClockUnit: @local::data.pd_ClockUnit
  ClockRate: @local::data.pd_TriggerClockRate
}

tools.pd_evtviewPed: {
  tool_type: AdcEventViewer
  LogLevel: 2
  EventHists: ["meanPed:80:0:4000"]
  EventGraphs: ["event:1:1:meanPed:0:0"]
  ChannelRanges: []
  ChannelRangeLabel: "%CRLABEL%"
  ClockUnit: @local::data.pd_ClockUnit
  ClockRate: @local::data.pd_TriggerClockRate
}

tools.pd_evtviewPedpwr: {
  tool_type: AdcEventViewer
  LogLevel: 2
  EventHists: ["rmPedPower:50:0:25"]
  EventGraphs: ["event:1:1:rmPedPower:0:14"]
  ChannelRanges: []
  ChannelRangeLabel: "%CRLABEL%"
  ClockUnit: @local::data.pd_ClockUnit
  ClockRate: @local::data.pd_TriggerClockRate
}

tools.pd_evtviewNfembByTps: {
  tool_type: AdcEventViewer
  LogLevel: 2
  EventHists: ["hnfemb:21:0:21"]
  EventGraphs: ["event:events:1:nfemb:0:21"]
  ChannelRanges: @local::data.pd_tpsChannelRanges
  ChannelRangeLabel: "%CRLABEL% (%CRLABEL2% %CRLABEL1%)"
  ClockUnit: @local::data.pd_ClockUnit
  ClockRate: @local::data.pd_TriggerClockRate
}

################################################################################
# Detector event display.
################################################################################

# Event display: wire coodinate vs. drift coordinate.

# Raw data.
tools.rawAdcDetectorPlotColl: {
  tool_type: AdcDetectorPlotter
  LogLevel: 1
  WireAngle: 0.0
  DataType: 1
  Tick0: @local::data.pd_Tick0
  DriftSpeed: 0.08
  XMin:  400.0
  XMax: -400.0
  ZMin:  -20.0
  ZMax:  720.0
  SignalThreshold:  20
  SkipBadChannels: false
  ShowAllTicks: false
  FirstTick: 0
  LastTick: 0
  ShowWires: true
  ShowCathode: true
  ShowTpcSets: []
  ShowGrid: true
  Title: "Raw ADC collection view"
  PlotTitle: "Run %RUN% event %EVENT% %UTCTIME2% UTC (%TRIGNAME% trigger)"
  FileName: "detraw-run%0RUN%-evt%0EVENT%-coll.{png,tpad}"
}
tools.rawAdcDetectorPlotInd1: {
  tool_type: AdcDetectorPlotter
  LogLevel: 1
  WireAngle: 0.623
  DataType: 1
  Tick0: @local::data.pd_Tick0
  DriftSpeed: 0.08
  XMin:  400.0
  XMax: -400.0
  ZMin:  -20.0
  ZMax:  940.0
  SignalThreshold:  20
  SkipBadChannels: false
  ShowAllTicks: false
  FirstTick: 0
  LastTick: 0
  ShowWires: true
  ShowCathode: true
  ShowTpcSets: []
  ShowGrid: true
  Title: "Raw ADC induction view 1"
  PlotTitle: "Run %RUN% event %EVENT% %UTCTIME2% UTC (%TRIGNAME% trigger)"
  FileName: "detraw-run%0RUN%-evt%0EVENT%-ind1.{png,tpad}"
}
tools.rawAdcDetectorPlotInd2: {
  tool_type: AdcDetectorPlotter
  LogLevel: 1
  WireAngle: -0.623
  DataType: 1
  Tick0: @local::data.pd_Tick0
  DriftSpeed: 0.08
  XMin:  400.0
  XMax: -400.0
  ZMin: -380.0
  ZMax:  580.0
  SignalThreshold:  20
  SkipBadChannels: false
  ShowAllTicks: false
  FirstTick: 0
  LastTick: 0
  ShowWires: true
  ShowCathode: true
  ShowTpcSets: []
  ShowGrid: true
  Title: "Raw ADC induction view 2"
  PlotTitle: "Run %RUN% event %EVENT% %UTCTIME2% UTC (%TRIGNAME% trigger)"
  FileName: "detraw-run%0RUN%-evt%0EVENT%-ind2.{png,tpad}"
}

# Prepared data.
tools.preparedAdcDetectorPlotColl: {
  tool_type: AdcDetectorPlotter
  LogLevel: 1
  WireAngle: 0.0
  DataType: 0
  Tick0: @local::data.pd_Tick0
  DriftSpeed: 0.08
  XMin:  400.0
  XMax: -400.0
  ZMin:  -20.0
  ZMax:  720.0
  SignalThreshold: 5
  SkipBadChannels: true
  ShowAllTicks: false
  FirstTick: 0
  LastTick: 0
  ShowWires: true
  ShowCathode: true
  ShowTpcSets: []
  ShowGrid: true
  Title: "Prepared ADC collection view"
  PlotTitle: "Run %RUN% event %EVENT% %UTCTIME2% UTC (%TRIGNAME% trigger)"
  FileName: "detprep-run%0RUN%-evt%0EVENT%-coll.{png,tpad}"
}
tools.preparedAdcDetectorPlotInd1: {
  tool_type: AdcDetectorPlotter
  LogLevel: 1
  WireAngle: 0.623
  DataType: 0
  Tick0: @local::data.pd_Tick0
  DriftSpeed: 0.08
  XMin:  400.0
  XMax: -400.0
  ZMin:  -20.0
  ZMax:  940.0
  SignalThreshold: 5
  SkipBadChannels: true
  ShowAllTicks: false
  FirstTick: 0
  LastTick: 0
  ShowWires: true
  ShowCathode: true
  ShowTpcSets: []
  ShowGrid: true
  Title: "Prepared ADC induction view 1"
  PlotTitle: "Run %RUN% event %EVENT% %UTCTIME2% UTC (%TRIGNAME% trigger)"
  FileName: "detprep-run%0RUN%-evt%0EVENT%-ind1.{png,tpad}"
}
tools.preparedAdcDetectorPlotInd2: {
  tool_type: AdcDetectorPlotter
  LogLevel: 1
  WireAngle: -0.623
  DataType: 0
  Tick0: @local::data.pd_Tick0
  DriftSpeed: 0.08
  XMin:  400.0
  XMax: -400.0
  ZMin: -380.0
  ZMax:  580.0
  SignalThreshold: 5
  SkipBadChannels: true
  ShowAllTicks: false
  FirstTick: 0
  LastTick: 0
  ShowWires: true
  ShowCathode: true
  ShowTpcSets: []
  ShowGrid: true
  Title: "Prepared ADC induction view 2"
  PlotTitle: "Run %RUN% event %EVENT% %UTCTIME2% UTC (%TRIGNAME% trigger)"
  FileName: "detprep-run%0RUN%-evt%0EVENT%-ind2.{png,tpad}"
}

################################################################################
# ADC channel-tick plots.
################################################################################

pdcht_template: {
  tool_type: AdcDataPlotter
  LogLevel: 1
  DataType: 1      # 0 for prepared, 1 for raw-pedestal, 2 is signal
  DataView: ""
  TickRange: plotTicks
  TickRebin: 1
  ChannelRanges: []
  ClockFactor: 0.0
  ClockOffset: 12524
  FembTickOffsets: []
  MaxSignal: 50
  SkipBadChannels: false
  EmptyColor: 18
  ChannelLineModulus: 2560
  ChannelLinePattern: []
  Palette: 2020
  HistName: "hadcraw_%CRNAME%_run%0RUN%_evt%0EVENT%"
  HistTitle: "Raw ADC"
  PlotTitle: "Run %RUN% event %EVENT% %UTCTIME2% UTC (%TRIGNAME% trigger)"
  PlotSizeX: 1400
  PlotSizeY: 1000
  PlotFileName: "adcraw_%CRNAME%_run%0RUN%_evt%0EVENT%.png"
  RootFileName: ""    # or "adc_evt%EVENT%.root"
}

# One plot for the full detector.
tools.pdcht_All: @local::pdcht_template
tools.pdcht_All.ChannelRanges: [all]
tools.pdcht_All.ChannelLinePattern: [0]

# Add location for the remaining plots.
pdcht_template.HistTitle: "Raw ADC for %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"

# One plot for each TPS (APA).
tools.pdcht_Apas: @local::pdcht_template
tools.pdcht_Apas.ChannelRanges: [tps0, tps1, tps2, tps3, tps4, tps5]
tools.pdcht_Apas.ChannelLinePattern: [800, 1600, 2080]

# One plot for each Z-plane. Z is the TPC-side collection plane.
tools.pdcht_Zplanes: @local::pdcht_template
tools.pdcht_Zplanes.ChannelRanges: [tpp0z, tpp1z, tpp2z, tpp3z, tpp4z, tpp5z]
tools.pdcht_Zplanes.ChannelLineModulus: 2560
tools.pdcht_Zplanes.ChannelLinePattern: [1648, 1696, 1744, 1792, 1840, 1888, 1936, 1984, 2032, 2080,
                                         2128, 2176, 2224, 2272, 2320, 2368, 2416, 2464, 2512]

# Plot APA3z (where the beam enters).
tools.pdcht_Apa3z: @local::tools.pdcht_Zplanes
tools.pdcht_Apa3z.ChannelRanges: [tpp0z]

# One plot for each C-plane. C is the cryostat-side collection plane.
tools.pdcht_Cplanes: @local::tools.pdcht_Zplanes
tools.pdcht_Cplanes.ChannelRanges: [tpp0c, tpp1c, tpp2c, tpp3c, tpp4c, tpp5c]

# One plot for each induction plane.
tools.pdcht_Iplanes: @local::pdcht_template
tools.pdcht_Iplanes.ChannelRanges: [tpp0u, tpp1u, tpp2u, tpp3u, tpp4u, tpp5u,
                                    tpp0v, tpp1v, tpp2v, tpp3v, tpp4v, tpp5v]
tools.pdcht_Iplanes.ChannelLineModulus: 40
tools.pdcht_Iplanes.ChannelLinePattern: [0]

# Plot APA3u (where the beam enters).
tools.pdcht_Apa3u: @local::tools.pdcht_Iplanes
tools.pdcht_Apa3u.ChannelRanges: [tpp0u]

# Plot APA3v (where the beam enters).
tools.pdcht_Apa3v: @local::tools.pdcht_Iplanes
tools.pdcht_Apa3v.ChannelRanges: [tpp0v]

# As above but for prepared data.

pdchtp_template: @local::pdcht_template
pdchtp_template.DataType: 2
pdchtp_template.MaxSignal: 50
pdchtp_template.SkipBadChannels: true
pdchtp_template.HistName: "hadcprp_%CRNAME%_run%0RUN%_evt%0EVENT%"
pdchtp_template. HistTitle: "Prepared ADC"
pdchtp_template.PlotFileName: "adcprp_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# One plot for the full detector.
tools.pdchtp_All: @local::pdchtp_template
tools.pdchtp_All.ChannelRanges: [all]
tools.pdchtp_All.ChannelLinePattern: [0]

# Add location for the remaining plots.
pdchtp_template.HistTitle: "Prepared ADC for %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"

# One plot for each Z-plane. Z is the TPC-side collection plane.
tools.pdchtp_Zplanes: @local::pdchtp_template
tools.pdchtp_Zplanes.ChannelRanges: [tpp0z, tpp1z, tpp2z, tpp3z, tpp4z, tpp5z]
tools.pdchtp_Zplanes.ChannelLineModulus: 2560
tools.pdchtp_Zplanes.ChannelLinePattern: [1648, 1696, 1744, 1792, 1840, 1888, 1936, 1984, 2032, 2080,
                                          2128, 2176, 2224, 2272, 2320, 2368, 2416, 2464, 2512]

# One plot for each C-plane. C is the cryostat-side collection plane.
tools.pdchtp_Cplanes: @local::tools.pdchtp_Zplanes
tools.pdchtp_Cplanes.ChannelRanges: [tpp0c, tpp1c, tpp2c, tpp3c, tpp4c, tpp5c]

# One plot for each induction plane.
tools.pdchtp_Iplanes: @local::pdchtp_template
tools.pdchtp_Iplanes.ChannelRanges: [tpp0u, tpp1u, tpp2u, tpp3u, tpp4u, tpp5u,
                                     tpp0v, tpp1v, tpp2v, tpp3v, tpp4v, tpp5v]
tools.pdchtp_Iplanes.ChannelLineModulus: 40
tools.pdchtp_Iplanes.ChannelLinePattern: [0]

# Plot APA3z (where the beam enters).
tools.pdchtp_Apa3z: @local::tools.pdchtp_Zplanes
tools.pdchtp_Apa3z.ChannelRanges: [tpp0z]

################################################################################
# ADC channel metric plotters.
################################################################################

# Template for metric plots by TPC set (APA)
chmet_pdtps_template: {
  tool_type: AdcChannelMetric
  LogLevel: 1
  DataView: ""
  PedestalReference: ""
  MetricSummaryView: "mean:dmean"
  MetricMin: 0.0
  MetricBins: 0
  ChannelRanges: [tps0, tps1, tps2, tps3, tps4, tps5]
  ChannelLineModulus: 2560
  ChannelLinePattern: [0, 800, 1600, 2080]
  PlotSizeX: 1400
  PlotSizeY:  500
  PlotUsesStatus: 1
  RootFileName: ""
}

# Template for metric plots by APA
chmet_pdapa_template: @local::chmet_pdtps_template
chmet_pdapa_template.ChannelRanges: [apa1, apa2, apa3, apa4, apa5, apa6]

# Template for metric plots by TPC plane
chmet_pdtpp_template: @local::chmet_pdtps_template
chmet_pdtpp_template.ChannelRanges: [tpp0u, tpp1u, tpp2u, tpp3u, tpp4u, tpp5u,
                                     tpp0v, tpp1v, tpp2v, tpp3v, tpp4v, tpp5v,
                                     tpp0z, tpp1z, tpp2z, tpp3z, tpp4z, tpp5z,
                                     tpp0c, tpp1c, tpp2c, tpp3c, tpp4c, tpp5c]
chmet_pdtpp_template.ChannelLinePattern: [        40,   80,  120,  160,  200,  240,  280,  320,  360,
                                           400,  440,  480,  520,  560,  600,  640,  680,  720,  760,
                                           800,  840,  880,  920,  960, 1000, 1040, 1080, 1120, 1160,
                                          1200, 1240, 1280, 1320, 1360, 1400, 1440, 1480, 1520, 1560,
                                          1600, 1648, 1696, 1744, 1792, 1840, 1888, 1936, 1984, 2032,
                                          2080, 2128, 2176, 2224, 2272, 2320, 2368, 2416, 2464, 2512]

#
# Pedestal for each channel.
pdwz_template: {
  tool_type: AdcChannelMetric
  LogLevel: 1
  DataView: ""
  PedestalReference: ""
  MetricSummaryView: "mean:dmean"
  MetricBins: 0
  MetricMin: 0.0
  ChannelRanges: [tpp0z, tpp1z, tpp2z, tpp3z, tpp4z, tpp5z]
  ChannelLineModulus: 2560
  ChannelLinePattern: [2128, 2176, 2224, 2272, 2320, 2368, 2416, 2464, 2512]
  PlotSizeX: 1400
  PlotSizeY:  500
  PlotUsesStatus: 1
  RootFileName: ""
}

######## Plots by APA #######

# FEMB ID for each TPS channel.
tools.pdtps_adcChannelFembPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelFembPlotter.Metric: fembID
tools.pdtps_adcChannelFembPlotter.MetricMax: 120
tools.pdtps_adcChannelFembPlotter.HistName: "hchpd%CRNAME%_femb_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelFembPlotter.HistTitle: "FEMB IDs for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelFembPlotter.MetricLabel: "FEMB ID"
tools.pdtps_adcChannelFembPlotter.PlotFileName: "chmet_femb_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# APA FEMB ID for each TPS channel.
tools.pdtps_adcChannelApaFembPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelApaFembPlotter.Metric: apaFembID
tools.pdtps_adcChannelApaFembPlotter.MetricMax: 20
tools.pdtps_adcChannelApaFembPlotter.HistName: "hchpd%CRNAME%_apafemb_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelApaFembPlotter.HistTitle: "APA FEMB IDs for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelApaFembPlotter.MetricLabel: "APA FEMB ID"
tools.pdtps_adcChannelApaFembPlotter.PlotFileName: "chmet_apafemb_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# FEMB channel for each TPS channel.
tools.pdtps_adcChannelFembChannelPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelFembChannelPlotter.Metric: fembChannel
tools.pdtps_adcChannelFembChannelPlotter.MetricMax: 128
tools.pdtps_adcChannelFembChannelPlotter.HistName: "hchpd%CRNAME%_fembchan_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelFembChannelPlotter.HistTitle: "FEMB channels for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelFembChannelPlotter.MetricLabel: "FEMB channel"
tools.pdtps_adcChannelFembChannelPlotter.PlotFileName: "chmet_fembchan_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Raw tick count for each TPS channel.
tools.pdtps_adcChannelNrawPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelNrawPlotter.Metric: nraw
tools.pdtps_adcChannelNrawPlotter.MetricMax: 6200
tools.pdtps_adcChannelNrawPlotter.HistName: "hchpd%CRNAME%_nraw_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelNrawPlotter.HistTitle: "Raw tick count for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelNrawPlotter.MetricLabel: "# ticks"
tools.pdtps_adcChannelNrawPlotter.PlotFileName: "chmet_nraw_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Pedestal for each TPS channel.
tools.pdtps_adcChannelPedestalPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalPlotter.Metric: pedestal
tools.pdtps_adcChannelPedestalPlotter.MetricMax: 4096
tools.pdtps_adcChannelPedestalPlotter.HistName: "hchpd%CRNAME%_ped_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalPlotter.HistTitle: "ADC pedestals for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalPlotter.MetricLabel: "Pedestal [ADC count]"
tools.pdtps_adcChannelPedestalPlotter.PlotFileName: "chmet_ped_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Digit pedestal for each TPS channel.
tools.pdtps_adcChannelPedestalInpPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalInpPlotter.Metric: inputPedestal
tools.pdtps_adcChannelPedestalInpPlotter.MetricMax: 4096
tools.pdtps_adcChannelPedestalInpPlotter.HistName: "hchpd%CRNAME%_pedinp_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalInpPlotter.HistTitle: "ADC input pedestals for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalInpPlotter.MetricLabel: "Pedestal [ADC count]"
tools.pdtps_adcChannelPedestalInpPlotter.PlotFileName: "chmet_pedinp_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Undershoot correction pedestal for each TPS channel.
tools.pdtps_adcChannelPedestalUscPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalUscPlotter.Metric: uscPedestal
tools.pdtps_adcChannelPedestalUscPlotter.MetricMin: -25
tools.pdtps_adcChannelPedestalUscPlotter.MetricMax:  25
tools.pdtps_adcChannelPedestalUscPlotter.HistName: "hchpd%CRNAME%_pedusc_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalUscPlotter.HistTitle: "ADC USC pedestals for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalUscPlotter.MetricLabel: "Pedestal offset [ADC count]"
tools.pdtps_adcChannelPedestalUscPlotter.PlotFileName: "chmet_pedusc_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Undershoot correction pedestal for each TPS channel.
tools.pdtps_adcChannelPedestalUscPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalUscPlotter.Metric: uscPedestalOffset
tools.pdtps_adcChannelPedestalUscPlotter.MetricMin: -25
tools.pdtps_adcChannelPedestalUscPlotter.MetricMax:  25
tools.pdtps_adcChannelPedestalUscPlotter.HistName: "hchpd%CRNAME%_pedoffusc_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalUscPlotter.HistTitle: "ADC USC pedestal offsets for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalUscPlotter.MetricLabel: "Pedestal offset [ADC count]"
tools.pdtps_adcChannelPedestalUscPlotter.PlotFileName: "chmet_pedoffusc_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Pedestal diff for each TPS channel.
tools.pdtps_adcChannelPedestalDiffPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalDiffPlotter.Metric: pedestalDiff
tools.pdtps_adcChannelPedestalDiffPlotter.MetricMin: -10
tools.pdtps_adcChannelPedestalDiffPlotter.MetricMax:  10
tools.pdtps_adcChannelPedestalDiffPlotter.HistName: "hchpd%CRNAME%_peddiff_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalDiffPlotter.HistTitle: "ADC pedestal diffs for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalDiffPlotter.MetricLabel: "#DeltaPedestal [ADC count]"
tools.pdtps_adcChannelPedestalDiffPlotter.PlotFileName: "chmet_peddiff_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Pedestal noise for each TPS channel.
tools.pdtps_adcChannelPedestalNoisePlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalNoisePlotter.Metric: pedestalRms
tools.pdtps_adcChannelPedestalNoisePlotter.MetricMax: 14
tools.pdtps_adcChannelPedestalNoisePlotter.HistName: "hchpd%CRNAME%_pednoise_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalNoisePlotter.HistTitle: "ADC pedestal noise for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalNoisePlotter.MetricLabel: "Pedestal noise [ADC count]"
tools.pdtps_adcChannelPedestalNoisePlotter.PlotFileName: "chmet_pednoise_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Peak out of range fraction for each TPS channel.
tools.pdtps_adcChannelPedestalOrfPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalOrfPlotter.Metric: "fitPedFractionLow+fitPedFractionHigh"
tools.pdtps_adcChannelPedestalOrfPlotter.MetricMax: 1.0
tools.pdtps_adcChannelPedestalOrfPlotter.HistName: "hchpd%CRNAME%_pedfracout_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalOrfPlotter.HistTitle: "ADC pedestal out-of-range fraction for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalOrfPlotter.MetricLabel: "Out-of-range fraction"
tools.pdtps_adcChannelPedestalOrfPlotter.PlotFileName: "chmet_pedorf_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Peak bin excess for each TPS channel.
tools.pdtps_adcChannelPedestalPeakBinFractionPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalPeakBinFractionPlotter.Metric: fitPedPeakBinFraction
tools.pdtps_adcChannelPedestalPeakBinFractionPlotter.MetricMax: 1.0
tools.pdtps_adcChannelPedestalPeakBinFractionPlotter.HistName: "hchpd%CRNAME%_pedpeakfrac_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalPeakBinFractionPlotter.HistTitle: "ADC pedestal peak bin fraction for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalPeakBinFractionPlotter.MetricLabel: "Peak fraction"
tools.pdtps_adcChannelPedestalPeakBinFractionPlotter.PlotFileName: "chmet_pedfrac_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Peak bin excess for each TPS channel.
tools.pdtps_adcChannelPedestalPeakBinExcessPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalPeakBinExcessPlotter.Metric: fitPedPeakBinExcess
tools.pdtps_adcChannelPedestalPeakBinExcessPlotter.MetricMax: 1.0
tools.pdtps_adcChannelPedestalPeakBinExcessPlotter.HistName: "hchpd%CRNAME%_pedpeakexc_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalPeakBinExcessPlotter.HistTitle: "ADC pedestal peak bin excess for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalPeakBinExcessPlotter.MetricLabel: "Peak excess fraction"
tools.pdtps_adcChannelPedestalPeakBinExcessPlotter.PlotFileName: "chmet_pedexc_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Pedestal RMS for each TPS channel.
tools.pdtps_adcChannelPedestalRawRmsPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalRawRmsPlotter.Metric: rawRms
tools.pdtps_adcChannelPedestalRawRmsPlotter.MetricMax: 40
tools.pdtps_adcChannelPedestalRawRmsPlotter.HistName: "hchpd%CRNAME%_rawrms_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalRawRmsPlotter.HistTitle: "ADC pedestal raw RMS for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalRawRmsPlotter.MetricLabel: "Pedestal raw RMS [ADC count]"
tools.pdtps_adcChannelPedestalRawRmsPlotter.PlotFileName: "chmet_pedrawrms_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Pedestal tail fraction for each TPS channel.
tools.pdtps_adcChannelPedestalRawTailPlotter: @local::chmet_pdtps_template
tools.pdtps_adcChannelPedestalRawTailPlotter.Metric: rawTailFraction
tools.pdtps_adcChannelPedestalRawTailPlotter.MetricMax: 0.5
tools.pdtps_adcChannelPedestalRawTailPlotter.HistName: "hchpd%CRNAME%_rawtail_%0RUN%_%0EVENT%"
tools.pdtps_adcChannelPedestalRawTailPlotter.HistTitle: "ADC pedestal raw tail fraction for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_adcChannelPedestalRawTailPlotter.MetricLabel: "Pedestal tail fraction"
tools.pdtps_adcChannelPedestalRawTailPlotter.PlotFileName: "chmet_pedrawtail_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# ---- Here and below merging events ----

# -- As above but including multiple events. --

# Pedestal.
tools.pdmtps_adcChannelPedestalPlotter: @local::tools.pdtps_adcChannelPedestalPlotter
tools.pdmtps_adcChannelPedestalPlotter.HistName: "hchpd%CRNAME%_ped_%0RUN%"
tools.pdmtps_adcChannelPedestalPlotter.HistTitle: "ADC pedestals for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdmtps_adcChannelPedestalPlotter.PlotFileName: "chmet_ped_%CRNAME%_run%0RUN%.png"

# Pedestal noise.
tools.pdmtps_adcChannelPedestalNoisePlotter: @local::tools.pdtps_adcChannelPedestalNoisePlotter
tools.pdmtps_adcChannelPedestalNoisePlotter.HistName: "hchpd%CRNAME%_pednoise_%0RUN%"
tools.pdmtps_adcChannelPedestalNoisePlotter.HistTitle: "ADC pedestal noise for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdmtps_adcChannelPedestalNoisePlotter.PlotFileName: "chmet_pednoise_%CRNAME%_run%0RUN%.png"

# Out of range fraction.
tools.pdmtps_adcChannelPedestalOrfPlotter: @local::tools.pdtps_adcChannelPedestalOrfPlotter
tools.pdmtps_adcChannelPedestalOrfPlotter.HistName: "hchpd%CRNAME%_pedorf_%0RUN%"
tools.pdmtps_adcChannelPedestalOrfPlotter.HistTitle: "ADC pedestal out-of-range fraction for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdmtps_adcChannelPedestalOrfPlotter.PlotFileName: "chmet_pedorf_%CRNAME%_run%0RUN%.png"

# Pedestal RMS.
tools.pdmtps_adcChannelPedestalRawRmsPlotter: @local::tools.pdtps_adcChannelPedestalRawRmsPlotter
tools.pdmtps_adcChannelPedestalRawRmsPlotter.HistName: "hchpd%CRNAME%_pedrawrms_%0RUN%"
tools.pdmtps_adcChannelPedestalRawRmsPlotter.HistTitle: "ADC pedestal raw RMS for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdmtps_adcChannelPedestalRawRmsPlotter.PlotFileName: "chmet_pedrawrms_%CRNAME%_run%0RUN%.png"

# Pedestal tail fraction.
tools.pdmtps_adcChannelPedestalRawTailPlotter: @local::tools.pdtps_adcChannelPedestalRawTailPlotter
tools.pdmtps_adcChannelPedestalRawTailPlotter.HistName: "hchpd%CRNAME%_pedrawtail_%0RUN%"
tools.pdmtps_adcChannelPedestalRawTailPlotter.HistTitle: "ADC pedestal raw tail fraction for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdmtps_adcChannelPedestalRawTailPlotter.PlotFileName: "chmet_pedrawtail_%CRNAME%_run%0RUN%.png"

# Pedestal peak bin excess.
tools.pdmtps_adcChannelPedestalPeakBinExcessPlotter: @local::tools.pdtps_adcChannelPedestalPeakBinExcessPlotter
tools.pdmtps_adcChannelPedestalPeakBinExcessPlotter.HistName: "hchpd%CRNAME%_pedexc_%0RUN%"
tools.pdmtps_adcChannelPedestalPeakBinExcessPlotter.HistTitle: "ADC pedestal peak bin excess for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdmtps_adcChannelPedestalPeakBinExcessPlotter.PlotFileName: "chmet_pedexc_%CRNAME%_run%0RUN%.png"

# -- Noise signal finder plots --

# Noise signal finder noise level at ADC scale.
tools.pdtps_nsfNoise: @local::chmet_pdtps_template
tools.pdtps_nsfNoise.Metric: nsfNoise
tools.pdtps_nsfNoise.MetricMax: 14
tools.pdtps_nsfNoise.MetricLabel: "Noise [(ADC count)/tick]"
tools.pdtps_nsfNoise.HistName: "hchpd%CRNAME%_nsfnoise_%0RUN%"
tools.pdtps_nsfNoise.HistTitle: "NSF noise for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_nsfNoise.PlotFileName: "chmet_nsfnoise_%CRNAME%_run%0RUN%.png"

# Noise signal finder threshold at ADC scale.
tools.pdtps_nsfThresh: @local::chmet_pdtps_template
tools.pdtps_nsfThresh.Metric: nsfThreshold
tools.pdtps_nsfThresh.MetricMax: 100
tools.pdtps_nsfThresh.MetricLabel: "Threshold [ADC count]"
tools.pdtps_nsfThresh.HistName: "hchpd%CRNAME%_nsfthresh_%0RUN%"
tools.pdtps_nsfThresh.HistTitle: "NSF threshold for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_nsfThresh.PlotFileName: "chmet_nsfthresh_%CRNAME%_run%0RUN%.png"

# Noise signal finder signal fraction.
tools.pdtps_nsfSigFrac: @local::chmet_pdtps_template
tools.pdtps_nsfSigFrac.Metric: nsfSigFrac
tools.pdtps_nsfSigFrac.MetricMax: 0.25
tools.pdtps_nsfSigFrac.MetricLabel: "Signal fraction"
tools.pdtps_nsfSigFrac.HistName: "hchpd%CRNAME%_nsfsigfrac_%0RUN%"
tools.pdtps_nsfSigFrac.HistTitle: "NSF signal fraction for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_nsfSigFrac.PlotFileName: "chmet_nsfsigfrac_%CRNAME%_run%0RUN%.png"

# Noise signal finder loop count.
tools.pdtps_nsfNloop: @local::chmet_pdtps_template
tools.pdtps_nsfNloop.Metric: nsfLoopCount
tools.pdtps_nsfNloop.MetricMax: 21
tools.pdtps_nsfNloop.MetricLabel: "# loops"
tools.pdtps_nsfNloop.HistName: "hchpd%CRNAME%_nsfnloop_%0RUN%"
tools.pdtps_nsfNloop.HistTitle: "NSF loop count for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_nsfNloop.PlotFileName: "chmet_nsfnloop_%CRNAME%_run%0RUN%.png"

# Noise signal finder loop count.
tools.pdtps_nsfNroi: @local::chmet_pdtps_template
tools.pdtps_nsfNroi.Metric: nsfRoiCount
tools.pdtps_nsfNroi.MetricMax: 12
tools.pdtps_nsfNroi.MetricLabel: "# ROI"
tools.pdtps_nsfNroi.HistName: "hchpd%CRNAME%_nsfnroi_%0RUN%"
tools.pdtps_nsfNroi.HistTitle: "NSF ROI count for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdtps_nsfNroi.PlotFileName: "chmet_nsfnroi_%CRNAME%_run%0RUN%.png"

# ---- End merging events ----

# Event plots by z wire plane

# Pedestal for each z-plane channel.
tools.pdwz_adcChannelPedestalPlotter: @local::tools.pdtps_adcChannelPedestalPlotter
tools.pdwz_adcChannelPedestalPlotter.ChannelRanges: @local::pdwz_template.ChannelRanges
tools.pdwz_adcChannelPedestalPlotter.ChannelLinePattern: @local::pdwz_template.ChannelLinePattern

# Pedestal diff for each z-plane channel.
tools.pdwz_adcChannelPedestalDiffPlotter: @local::tools.pdtps_adcChannelPedestalDiffPlotter
tools.pdwz_adcChannelPedestalDiffPlotter.ChannelRanges: @local::pdwz_template.ChannelRanges
tools.pdwz_adcChannelPedestalDiffPlotter.ChannelLinePattern: @local::pdwz_template.ChannelLinePattern

# Pedestal raw RMS for each z-plane channel.
tools.pdwz_adcChannelPedestalRawRmsPlotter: @local::tools.pdtps_adcChannelPedestalRawRmsPlotter
tools.pdwz_adcChannelPedestalRawRmsPlotter.ChannelRanges: @local::pdwz_template.ChannelRanges
tools.pdwz_adcChannelPedestalRawRmsPlotter.ChannelLinePattern: @local::pdwz_template.ChannelLinePattern

# Pedestal noise for each TPS channel.
tools.pdwz_adcChannelPedestalNoisePlotter: @local::tools.pdtps_adcChannelPedestalNoisePlotter
tools.pdwz_adcChannelPedestalNoisePlotter.ChannelRanges: @local::pdwz_template.ChannelRanges
tools.pdwz_adcChannelPedestalNoisePlotter.ChannelLinePattern: @local::pdwz_template.ChannelLinePattern

# Pedestal peak bin fraction for each z-plane channel.
tools.pdwz_adcChannelPedestalPeakBinFractionPlotter: @local::tools.pdtps_adcChannelPedestalPeakBinFractionPlotter
tools.pdwz_adcChannelPedestalPeakBinFractionPlotter.ChannelRanges: @local::pdwz_template.ChannelRanges
tools.pdwz_adcChannelPedestalPeakBinFractionPlotter.ChannelLinePattern: @local::pdwz_template.ChannelLinePattern

# Pedestal peak bin excess for each channel.
tools.pdwz_adcChannelPedestalPeakBinExcessPlotter: @local::tools.pdtps_adcChannelPedestalPeakBinExcessPlotter
tools.pdwz_adcChannelPedestalPeakBinExcessPlotter.ChannelRanges: @local::pdwz_template.ChannelRanges
tools.pdwz_adcChannelPedestalPeakBinExcessPlotter.ChannelLinePattern: @local::pdwz_template.ChannelLinePattern

# Summary plots by wire plane.

# Pedestal
tools.pdwzs_adcChannelPedestalPlotter: @local::tools.pdwz_adcChannelPedestalPlotter
tools.pdwzs_adcChannelPedestalPlotter.HistName: "hchspd%CRNAME%_ped_%0RUN%"
tools.pdwzs_adcChannelPedestalPlotter.HistTitle: "ADC pedestals for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdwzs_adcChannelPedestalPlotter.PlotFileName: "chmet_ped_%CRNAME%_run%0RUN%.png"

# Pedestal diff
tools.pdwzs_adcChannelPedestalDiffPlotter: @local::tools.pdwz_adcChannelPedestalDiffPlotter
tools.pdwzs_adcChannelPedestalDiffPlotter.HistName: "hchspd%CRNAME%_pedd_%0RUN%"
tools.pdwzs_adcChannelPedestalDiffPlotter.HistTitle: "ADC pedestal diffs for run %RUN% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdwzs_adcChannelPedestalDiffPlotter.PlotFileName: "chmet_pedd_%CRNAME%_run%0RUN%.png"

################################################################################

pdmet_template: {
  tool_type: AdcChannelMetric
  LogLevel: 1
  DataView: ""
  MetricSummaryView: ""
  MetricBins: 100
  MetricMin: 0.0
  ChannelRanges: [tps0, tps1, tps2, tps3, tps4, tps5]
  ChannelLineModulus: 2560
  ChannelLinePattern: [800, 1600, 2080]
  PlotSizeX:  700
  PlotSizeY:  500
  PlotUsesStatus: 1
  RootFileName: ""
}

# Pedestal for each TPS channel.
tools.pdmet_adcChannelPedestalPlotter: @local::pdmet_template
tools.pdmet_adcChannelPedestalPlotter.Metric: pedestal
tools.pdmet_adcChannelPedestalPlotter.MetricMax: 4096
tools.pdmet_adcChannelPedestalPlotter.HistName: "hpdmet%CRNAME%_ped_%0RUN%_%0EVENT%"
tools.pdmet_adcChannelPedestalPlotter.HistTitle: "ADC pedestals for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdmet_adcChannelPedestalPlotter.MetricLabel: "Pedestal [ADC count]"
tools.pdmet_adcChannelPedestalPlotter.PlotFileName: "pdmet_ped_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

# Pedestal noise for each TPS channel.
tools.pdmet_adcChannelPedestalNoisePlotter: @local::pdmet_template
tools.pdmet_adcChannelPedestalNoisePlotter.Metric: pedestalRms
tools.pdmet_adcChannelPedestalNoisePlotter.MetricMax: 50
tools.pdmet_adcChannelPedestalNoisePlotter.HistName: "hpdmet%CRNAME%_pednoise_%0RUN%_%0EVENT%"
tools.pdmet_adcChannelPedestalNoisePlotter.HistTitle: "ADC pedestal noise for run %RUN% event %EVENT% %CRLABEL% (%CRLABEL2%: %CRLABEL1%)"
tools.pdmet_adcChannelPedestalNoisePlotter.MetricLabel: "Pedestal noise [ADC count]"
tools.pdmet_adcChannelPedestalNoisePlotter.PlotFileName: "pdmet_pednoise_%CRNAME%_run%0RUN%_evt%0EVENT%.png"

################################################################################
# Tickmod viewer.
################################################################################

# Read in the tick offset
# 26sep2018 dla: Set phase to 1. It appears protoDUNE has been using this
# phase up til now and will presumably keep it.
# If not, we will have to start using run data.
tools.pd_tickOffset_sep26: {
  tool_type: TimingRawDecoderOffsetTool
  LogLevel: 1
  TpcTickPhase: 1
  Unit: tick
  FembScaleIds: []
  FembScaleValues: []
  RunDataTool: ""
}

# 15nov2018 dla: It appears the phase is 23 for the pulser runs taken Oct 25.
tools.pd_tickOffset_oct25: @local::tools.pd_tickOffset_sep26
tools.pd_tickOffset_oct25.TpcTickPhase: 23

tools.pd_tickOffset: @local::tools.pd_tickOffset_oct25

# Add timing scale correction for FEMB302.
tools.pd_tickOffsetCorr: @local::tools.pd_tickOffset
tools.pd_tickOffsetCorr.FembScaleIds: [1]
tools.pd_tickOffsetCorr.FembScaleValues: [0.999293]

# March 2019 from run 6690 (DLA)
tools.pd_tickOffsetCorr6690: @local::tools.pd_tickOffsetCorr
tools.pd_tickOffsetCorr6690.FembScaleValues: [0.9992930]

# March 2019 from run 6036 (DLA)
tools.pd_tickOffsetCorr6036: @local::tools.pd_tickOffsetCorr
tools.pd_tickOffsetCorr6036.FembScaleValues: [0.9992927]

# March 2019 from run 5531 (and 5526, 5540) (DLA)
tools.pd_tickOffsetCorr5531: @local::tools.pd_tickOffsetCorr
tools.pd_tickOffsetCorr5531.FembScaleValues: [0.9992961]

# March 2019 from run 5954 (DLA)
tools.pd_tickOffsetCorr5954: @local::tools.pd_tickOffsetCorr
tools.pd_tickOffsetCorr5954.FembScaleValues: [0.9992875]

# Build tickmod spectra.
tools.pd_tickmodViewer: {
  tool_type: AdcTickModViewer
  LogLevel: 1
  TickModPeriod: 497
  TimeOffsetTool: pd_tickOffsetCorr
  FitSigmaMin:  2.0
  FitSigmaMax: 20.0
  HistName: "adctm_ch%0CHAN%_tm%0TICKMOD%"
  HistTitle: "ADC spectrum for channel %CHAN% tickmod %TICKMOD%"
  HistChannelCount: 100
  PlotChannels: []
  AllPlotFileName: ""
  MinPlotFileName: ""
  MaxPlotFileName: ""
  PhasePlotFileName: ""
  RootFileName: ""
  TreeFileName: ""
  PlotSizeX:  1400
  PlotSizeY:  1000
  PlotShowFit:   1
  PlotSplitX:    4
  PlotSplitY:    0
  PlotFrequency: 0
  PhaseVariable: phase
  PhaseGrouping: channel
  PhasePlotSizeX:  1400
  PhasePlotSizeY:  1000
  PhasePlotSplitX:    4
  PhasePlotSplitY:    0
}

# Remove coherent noise and high frequency noise with local
# ROI finding at ADC scale.
tools.pdsp_noiseRemovalAdc: {
  tool_type: PdspNoiseRemoval
  LogLevel: 1
  RemoveHighFrequency: true
  RemoveCoherent: true
  CutoffFrequency: 400              # cutoff frequency in kHz for Butterworth low-pass filter
  CorrMode: "median"                # mean or median waveform for coherent noise determination
  CoherentOffline16: false          # remove coherent noise for every 16 offline channels
  CoherentOffline16Groups: []       # remove coherent noise for all groups if list is empty
  CoherentDaq8: false               # remove coherent noise for every 8 online DAQ channels on the same ASIC
  CoherentDaq8Groups: []            # remove coherent noise for all groups if list is empty
  CoherentDaq16: false              # remove coherent noise for every 16 online DAQ channels on the same chip
  CoherentDaq16Groups: []           # remove coherent noise for all groups if list is empty
  CoherentFEMB128: true             # remove coherent noise for every 128 online DAQ channels on the same FEMB
  CoherentFEMB128Groups: []         # remove coherent noise for all groups if list is empty
  UseBasicROIForCNR: true           # use simple threshold ROI finder
  RoiStartThreshold: 20             # threshold on the leading edge
  RoiEndThreshold: 20               # threshold on the trailing edge
  RoiPadLow: 8                      # low bin extension  
  RoiPadHigh: 20                    # high bin extension
}

# Remove coherent noise and high frequency noise with local
# ROI finding at ke scale.
tools.pdsp_noiseRemovalKe: @local::tools.pdsp_noiseRemovalAdc
tools.pdsp_noiseRemovalKe.RoiStartThreshold: 0.5
tools.pdsp_noiseRemovalKe.RoiEndThreshold:   0.5

# Remove only coherent noise (no high frequency filter).
tools.pdsp_fembNoiseRemovalKe: @local::tools.pdsp_noiseRemovalKe
tools.pdsp_fembNoiseRemovalKe.RemoveHighFrequency: false

# Remove coherent noise and high frequency noise with ROIs taken
# from data.
tools.pdsp_noiseRemovalData: @local::tools.pdsp_noiseRemovalAdc
tools.pdsp_noiseRemovalData.UseBasicROIForCNR: false

tools.pdsp_noiseRemoval: @local::tools.pdsp_noiseRemovalAdc

tools.pdsp_RemoveBadChannels: {
  tool_type: RemoveBadChannels
  LogLevel: 1
  RemoveBadChs: true
  RemoveNoisyChs: false
}

################################################################################
# Other diagnostics.

# Set uniform length for DFT analysis.
tools.pdsp_setSampleLength: {
  tool_type: AdcChannelTrimmer
  LogLevel: 1
  Length: 6000
  MaxTrim: 100
}

################################################################################


################################################################################
# stickycodes_pdsp.fcl
#
# David Adams
# October 2018
#
# Sticky codes for protoDUNE single phase.

tools.pdsp_sticky_codes_ped: {
  tool_type: FclStickyCodeFlagger
  LogLevel: 1
  StickyCode: 11
  StickyCodes: {
    ##### APA 3 #####
    # femb311u
    # femb312u
    # femb313u
    # femb314u
    # femb315u
    # femb316u
    chan00215: [2200]
    chan00232: [2458]
    chan00237: [2303]
    # femb317u
    # femb318u
    # femb319u
    # femb320u
    # femb301u
    chan00418: [2367]
    chan00426: [2433, 2452, 2456]
    # femb302u
    chan00440: [2495, 2527]
    chan00441: [2559]
    #chan00442: [2431]    # Always stuck at this value!
    chan00443: [2368, 2383]
    chan00444: [2367, 2431]
    chan00446: [2559]
    chan00448: [2431, 2432, 2495]
    chan00451: [2431, 2432, 2488, 2495]
    chan00452: [2303, 2307, 2335]
    chan00455: []   # Low off scale
    chan00456: [2303, 2304, 2333, 2337]
    chan00458: [2335]
    chan00459: [2367, 2424, 2431]
    chan00461: [2495]
    chan00462: [2239]
    chan00465: [2431]
    chan00471: [2495]
    # femb303u
    # femb304u
    chan00520: [2368]
    # femb305u
    # femb306u
    # femb307u
    # femb308u
    chan00719: [2367]
    # femb309u
    chan00720: [2367]
    # femb310u
    # femb320v
    chan00821: [2303]
    # femb319v
    # femb318v
    # femb317v
    chan00923: [2304, 2320, 2324]
    chan00951: [2304]
    # femb316v
    # femb315v
    # femb314v
    # femb313v
    # femb312v
    # femb311v
    # femb310v
    # femb309v
    chan01247: [2305, 2330]
    chan01255: [2304, 2309, 2310, 2311, 2313, 2330]
    # femb308v
    # femb307v
    # femb306v
    chan01396: [2431, 2443]
    # femb305v
    # femb304v
    # femb303v
    # femb302v
    chan01520: [2303]
    chan01536: [2303]
    chan01537: [2303]
    chan01538: [2303]
    chan01540: [2296, 2303]
    chan01541: [2431, 2495]
    chan01542: [2240, 2303]
    chan01543: [2303]
    chan01544: [2303]
    chan01545: [2367]
    chan01548: [2423, 2424, 2425, 2431]
    chan01549: [2303]
    chan01552: [2367]
    chan01555: [2431]
    chan01557: [2367]
    chan01558: [2303]
    # femb320x
    chan01625: [1088]
    chan01632: [ 831, 895, 960, 1024]
    # femb319x
    # femb318x
    chan01729: [ 895]
    # femb317x
    # femb315x
    chan01864: [ 959]
    chan01865: [1023]
    # femb314x
    # femb313x
    # femb312x
    # femb311x
    chan01996: [ 965,  966]
    chan02015: [ 960]
    chan02017: [ 960]
    # femb301x
    chan02109: [ 896]
    # femb302x
    chan02128: [1023]
    chan02130: [1023]
    chan02131: [ 959]
    chan02133: [ 959]
    chan02135: [ 959]
    chan02136: [1017, 1023]
    chan02137: [ 952,  959]
    chan02140: [ 952,  959]
    chan02141: [ 952,  959]
    chan02142: [ 959]
    chan02143: [ 959]
    chan02145: [ 959]
    chan02147: [ 959]
    chan02148: [1023]
    chan02149: [ 959]
    chan02150: [ 991]
    chan02151: [ 959]
    chan02152: [ 895]
    chan02153: [ 959]
    chan02153: [ 959]
    chan02159: [ 895]
    chan02162: [ 959]
    chan02175: [ 959]
    # femb303x
    # femb304x
    # femb305x
    chan02289: [ 895]
    chan02291: [ 960]
    chan02298: [ 966]
    chan02306: [1036]
    chan02318: [1023]
    # femb306x
    chan02330: [1023]
    chan02333: [ 960]
    # femb308x
    chan02461: [ 960,  961]
    # femb309x
    # femb310x
    ##### APA 5 #####
    # femb511u
    # femb512u
    # femb513u
    # femb514u
    # femb515u
    # femb516u
    # femb517u
    chan02806: [2367]
    # femb518u
    chan02863: [2431]
    chan02867: [2559]
    chan02873: [2623]
    chan02875: [2369]
    chan02876: [2303]
    chan02877: [2303]
    chan02878: [2303]
    # femb519u
    # femb520u
    chan02928: [2367]
    # femb501u
    # femb502u
    # femb503u
    # femb504u
    # femb505u
    chan03159: [2367, 2373, 2375]
    # femb506u
    # femb507u
    # femb508u
    # femb509u
    # femb510u
    # femb520v
    # femb519v
    chan03405: [2303, 2311]
    # femb518v
    chan03449: [2303]
    chan03456: [2303]
    # femb517v
    # femb516v  (2 channels bad)
    # femb515v
    # femb514v
    # femb513v  (2 channels bad)
    # femb512v
    # femb511v
    # femb510v
    chan03789: [2239]
    # femb509v
    # femb508v
    # femb507v
    # femb506v
    # femb505v
    chan03999: [2368]
    # femb504v
    # femb503v  (2 channels bad)
    # femb502v
    chan04092: [2303]
    chan04111: [2241]
    # femb501v  (2 channels bad)
    # femb520x (TPC side)
    chan04173: [ 960]
    # femb519x
    # femb518x
    chan04260: [ 895,  896]
    chan04261: [ 959]
    chan04264: [ 895]
    chan04269: [1023]
    chan04274: [ 895]
    # femb517x
    chan04336: [ 960,  961]
    # femb516x (5 bad, 1 noisy)
    # femb515x
    chan04426: [ 896,  897]
    # femb514x
    chan04456: [ 896]
    # femb513x (6 bad)
    # femb512x
    # femb511x
    # femb501x (3 bad, 3 noisy, cryo side)
    chan04642: [ 959]
    # femb502x
    chan04688: [ 895]
    # femb503x (5 bad, 1 noisy)
    # femb504x
    chan04808: [ 968,  969]
    chan04814: [1024]
    chan04816: [ 960,  974]
    # femb505x
    # femb506x
    chan04892: [ 961]
    chan04917: [ 896]
    # femb507x
    chan04942: [ 960]
    # femb508x
    chan04980: [ 960, 961]
    chan04990: [ 960]
    # femb509x
    # femb510x
    chan05119: [ 960]
    ##### APA 2 #####
    # femb211u
    # femb212u
    # femb213u
    # femb214u
    chan05267: [2431]
    chan05277: [2368, 2369]
    # femb215u
    # femb216u (1 bad channel)
    # femb217u
    chan05379: [2384]
    # femb218u
    chan05420: [2431, 2482]
    chan05421: [2303]
    chan05423: [2303, 2330]
    chan05424: [2367]
    chan05425: [2303]
    chan05427: [2239]
    chan05430: [2431]
    chan05434: [2367]
    chan05438: [2431]
    # femb219u
    chan05441: [2623, 2625, 2627]
    # femb220u
    # femb201u
    # femb202u
    # femb203u
    # femb204u
    # femb205u
    chan05695: [2561, 2565, 2567, 2574, 2575]
    chan05701: [2559]
    chan05718: [2437, 2438, 2439]
    # femb206u
    # femb207u
    # femb208u
    # femb209u
    chan05851: [2495]
    # femb210u
    # femb220v
    chan05941: [2239, 2240]
    # femb219v
    # femb218v
    chan06000: [2367]
    chan06006: [2370, 2371, 2372]
    chan06008: [2367]
    chan06009: [2343, 2344, 2345]
    chan06017: [2367]
    # femb217v
    chan06055: [2367]
    # femb216v
    # femb215v
    chan06137: [2240, 2260]
    # femb214v
    # femb213v
    # femb212v
    chan06277: [2320, 2322]
    # femb211v
    # femb210v
    chan06333: [2239]
    # femb209v
    # femb208v
    # femb207v
    # femb206v
    # femb205v
    # femb204v
    chan06590: [2304, 2305]
    # femb203v
    # femb202v
    # femb201v
    # femb220x
    chan06765: [ 960]
    # femb219x
    # femb218x
    chan06819: [ 959, 1007, 1008, 1016, 1017]
    chan06821: [ 959,  960]
    chan06827: [ 959,  960]
    chan06829: [1023]
    # femb217x
    # femb216x
    chan06931: [ 959]
    # femb215x
    chan06997: [1088]
    # femb201x
    #.. chan07200 # No signal (space charge offset?)
    #.. chan07201 # No signal (space charge offset?)
    chan07202: [ 961]
    #.. chan07220 # Pedestal stuck on 980
    # femb202x
    chan07251: [ 959]
    chan07271: [ 960]
    chan07279: [ 959]
    # femb203x
    chan07334: [ 895]
    # femb204x
    # femb205x
    chan07406: [ 960,  961]
    chan07407: [ 959,  960]
    # femb206x
    chan07443: [ 959,  960]
    # femb207x
    chan07500: [ 959,  960]
    chan07500: [ 897,  898]
    chan07510: [ 1088, 1089, 1090]
    # femb208x
    # chan07551: # bad
    chan07578: [ 896]
    chan07582: [ 959, 1024]
    # femb209x
    # femb210x
    chan07635: [ 960]
    chan07675: [ 895]
    ##### APA 6 #####
    # femb611u (2 bad)
    chan07699: [2367, 2432]
    # femb612u
    # femb613u
    chan07790: [2431, 2432, 2433, 2495]
    # femb614u
    # femb615u
    # femb616u (1 bad)
    chan07891: [2495, 2519, 2520, 2524, 2536]
    # femb617u
    # femb618u
    # femb619u
    # femb620u
    # femb601u
    chan08111: [2559, 2560, 2563, 2564]
    # femb602u
    chan08138: [2367]
    # femb603u
    chan08172: [2368, 2375]
    # femb604u
    chan08207: [2303]
    # femb605u
    # femb606u
    chan08290: [2495]
    # femb607u
    chan08320: [2303]
    chan08341: [2431, 2432]
    # femb608u
    chan08365: [2305]
    chan08377: [2495, 2496, 2498, 2536, 2544]
    # femb609u
    # femb610u
    # femb620v (3 bad)
    chan08494: [2303]
    # femb619v
    chan08551: [2495]
    # femb618v
    # femb617v
    # femb616v
    # femb615v
    # femb614v
    # femb613v
    # femb612v (2 bad)
    # femb611v
    # femb610v
    # femb609v
    # femb608v
    # femb607v
    chan09000: [2303]
    # femb606v
    # femb605v
    chan09081: [2240, 2241, 2245]
    chan09099: [2304, 2310]
    chan09108: [2501, 2502, 2503]
    # femb604v
    # femb603v
    chan09166: [2111, 2175, 2176]
    # femb602v
    chan09213: [2496]
    # femb601v (2 bad)
    chan09274: [2432, 2433, 2434]
    # femb620x (8 bad)
    # femb619x
    # femb618x
    # femb617x
    chan09428: [ 959]
    # femb616x
    # femb615x
    chan09526: [ 960, 961]
    chan09552: [ 895, 896]
    # femb614x
    chan09569: [ 959, 1024, 1025]
    chan09603: [ 960]
    # femb613x
    # femb612x (6 bad)
    chan09677: [1010, 1011, 1012, 1013]
    chan09684: [ 959]
    chan09697: [ 896]
    # femb612x
    chan09731: [ 959]
    chan09739: [1088, 1089]
    # femb611x
    # femb601x
    # femb602x
    chan09810: [ 960]
    chan09831: [1025]
    # femb603x
    chan09856: [ 960]
    chan09899: [ 895]
    # femb604x
    chan09941: [ 895]
    # femb605x
    chan09954: [ 959]
    chan09979: [ 959]
    chan09996: [ 959]
    # femb606x
    # femb607x
    chan10093: [ 960]
    # femb608x
    chan10113: [ 959, 1024]
    chan10124: [ 895,  960]
    # femb609x (1 bad)
    # femb610x
    ##### APA 1 #####
    # femb111u
    chan10241: [2495, 2496, 2497, 2498, 2499, 2500, 2501, 2502]
    chan10242: [2175]
    chan10273: [2367, 2368]
    chan10278: [2239]
    # femb112u
    # femb113u
    chan10339: [2303, 2304, 2305, 2306, 2307]
    # femb114u
    # femb115u
    # femb116u
    chan10459: [2175]
    # femb117u
    # femb118u
    chan10529: [2303]
    # femb119u
    chan10560: [2240, 2241, 2242]
    chan10575: [2462, 2463, 2464, 2465, 2466, 2467, 2468]
    # femb120u
    # femb101u
    # femb102u
    chan10686: [2175, 2176, 2177]
    chan10689: [2431]
    # femb103u
    chan10721: [2495]
    # femb104u
    # femb105u (1 bad)
    chan10835: [2495]
    # femb106u
    # femb107u (1 bad)
    chan10897: [2303]
    #chan10907: [2239]  # Flagged as bad
    # femb108u
    # femb109u
    # femb110u (1 bad)
    chan11019: [2175, 2176, 2182, 2183]
    # femb120v
    # femb119v
    chan11091: [2240]
    chan11096: [2352, 2353, 2359]
    # femb118v
    chan11140: [2328]
    # femb117v
    # femb116v (1 bad)
    # femb115v (1 bad)
    # femb114v
    # femb113v
    chan11284: [2320, 2325]
    # femb112v
    chan11394: [2239, 2240]
    # femb111v
    # femb110v
    chan11472: [2303]
    # femb109v
    chan11491: [2112, 2113, 2114]
    # femb108v
    # femb107v
    # femb106v
    # femb105v
    # femb104v
    # femb103v
    chan11741: [2368]
    chan11746: [2367, 2368]
    # femb102v
    chan11773: [2112, 2136, 2137]
    # femb101v
    chan11814: [2367]
    chan11821: [2175, 2240]
    chan11825: [2304, 2308]
    # femb120x (1 bad)
    # femb119x (1 bad)
    chan11922: [ 969]
    # femb118x
    # femb117x
    chan12008: [ 960]
    # femb116x
    chan12046: [ 831]
    chan12052: [ 831, 896]
    # femb115x
    chan12093: [1023, 1024, 1025, 1026]
    chan12094: [ 897]
    chan12105: [1024, 1025]
    # femb114x
    chan12162: [ 896]
    # femb113x
    # femb112x
    chan12252: [ 831]
    # femb111x
    chan12297: [1088]
    chan12306: [ 961]
    chan12308: [ 895, 897]
    # femb101x
    chan12357: [ 960]
    # femb102x
    chan12382: [ 895, 959, 1024]
    chan12407: [ 831, 896]
    # femb103x
    chan12426: [1024, 1025, 1034, 1035]
    # femb104x
    # femb105x
    chan12546: [1024, 1030, 1031, 1032]
    chan12550: [ 902]
    chan12558: [ 959, 1023]
    # femb106x
    chan12581: [ 895]
    chan12592: [ 960]
    # femb107x
    # femb108x
    # femb109x (1 bad)
    chan12729: [ 897, 898]
    # femb110x (1 bad)
    ##### APA 4 #####
    # femb411u (1 bad)
    chan12831: [2523]
    # femb412u
    chan12846: [2176, 2183, 2192]
    # femb413u
    # femb414u
    chan12923: [2444, 2461]
    # femb415u
    chan12979: [2239, 2240]
    # femb416u (1 bad)
    # femb417u
    chan13055: [2431]
    # femb418u (1 bad)
    # femb419u
    # femb420u
    # femb401u
    chan13204: [2240]
    # femb402u
    chan13263: [2368]
    # femb403u
    chan13285: [2303, 2367, 2368]
    chan13317: [2368]
    # femb404u
    chan13321: [2559]
    # femb405u (1 bad)
    chan13389: [2495]
    # femb406u
    chan13410: [2559, 2560]
    chan13426: [2240, 2241]
    chan13433: [2328]
    # femb407u
    chan13479: [2431, 2432]
    # femb408u
    chan13481: [2566, 2567]
    chan13515: [2303]
    # femb409u
    # femb410u
    # femb420v
    # femb419v
    # femb418v
    chan13708: [2304]
    # femb417v
    chan13739: [2373]
    chan13749: [2176]
    # femb416v
    # femb415v
    chan13829: [2431]
    # femb414v
    # femb413v
    # femb412v
    chan13929: [2176, 2177]
    # femb411v
    # femb410v
    # femb409v
    # femb408v
    # femb407v
    # femb406v
    chan14192: [2367, 2368]
    # femb405v
    # femb404v
    # femb403v
    # femb402v
    # femb401v
    chan14367: [2303]
    # femb420x
    chan14419: [ 960]
    chan14439: [ 895]
    # femb419x
    # femb418x
    # femb417x
    chan14579: [ 960]
    # femb416x
    chan14621: [ 960]
    # femb415x
    chan14640: [1019, 1024]
    # femb414x
    # femb413x
    chan14740: [ 896]
    chan14763: [ 960]
    chan14765: [ 959,  960]
    chan14769: [ 960]
    # femb412x
    # femb411x
    # femb401x
    chan14911: [ 960]
    # femb402x
    # femb403x
    chan14980: [ 960]
    # femb404x
    chan15030: [ 895]
    chan15035: [ 959]
    # femb405x
    chan15084: [ 896]
    # femb406x
    chan15124: [ 960]
    chan15134: [ 960]
    chan15143: [ 895]
    # femb407x
    chan15182: [ 960]
    chan15183: [ 960]
    chan15208: [ 895]
    # femb408x
    # femb409x
    chan15268: [ 895]
    chan15272: [ 959]
    # femb410x
    chan15316: [ 959,  960]
    chan15338: [ 961]
    chan15343: [ 960,  961]
  }
  StickyRanges: {
  }
}

tools.pdsp_sticky_codes_notped: {
  tool_type: FclStickyCodeFlagger
  LogLevel: 1
  StickyCode: 12
  StickyCodes: {
  }
  StickyRanges: {
  }
}
# calibs_pdsp.fcl
#
# David Adams
# February 2019
# Dec 2019: Add calib based on Nov 2019 data.
# May 2020: Add new calib based on Dec 2018 data.

#####################################################################

# Dec 2019 ProtoDUNE area charge calibration.
# Based on Dec 2018 data with narrow ROI window.
tools.areaGain_calib20191213_dec18ext: {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "areaGain_calib20191213_dec18ext"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20191213_dec18ext/areaGain_apa3z.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa3c.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa3u.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa3v.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa5z.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa5c.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa5u.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa5v.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa2z.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa2c.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa2u.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa2v.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa6z.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa6c.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa6u.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa6v.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa1z.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa1c.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa1u.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa1v.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa4z.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa4c.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa4u.fcl",
    "calib/protodune/calib20191213_dec18ext/areaGain_apa4v.fcl"
  ]
}

# Dec 2019 ProtoDUNE height charge calibration.
# Based on Dec 2018 data.
tools.heightGain_calib20191213_dec18ext: {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "heightGain_calib20191213_dec18ext"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20191213_dec18ext/heightGain_apa3z.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa3c.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa3u.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa3v.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa5z.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa5c.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa5u.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa5v.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa2z.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa2c.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa2u.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa2v.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa6z.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa6c.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa6u.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa6v.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa1z.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa1c.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa1u.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa1v.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa4z.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa4c.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa4u.fcl",
    "calib/protodune/calib20191213_dec18ext/heightGain_apa4v.fcl"
  ]
}

# Dec 2019 shaping time calibration.
# Based on Dec 2019 data.
tools.shapingTime_calib20191213_dec18ext: {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "shapingTime_calib20191213_dec18ext"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa3z.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa3c.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa3u.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa3v.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa5z.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa5c.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa5u.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa5v.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa2z.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa2c.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa2u.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa2v.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa6z.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa6c.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa6u.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa6v.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa1z.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa1c.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa1u.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa1v.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa4z.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa4c.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa4u.fcl",
    "calib/protodune/calib20191213_dec18ext/shapingTime_apa4v.fcl"
  ]
}

#####################################################################

# Dec 2019 ProtoDUNE area charge calibration.
# Based on Dec 2018 data.
tools.areaGain_calib20191206_dec18ext: {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "areaGain_calib20191206_dec18ext"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20191206_dec18ext/areaGain_apa3z.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa3c.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa3u.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa3v.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa5z.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa5c.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa5u.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa5v.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa2z.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa2c.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa2u.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa2v.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa6z.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa6c.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa6u.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa6v.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa1z.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa1c.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa1u.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa1v.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa4z.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa4c.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa4u.fcl",
    "calib/protodune/calib20191206_dec18ext/areaGain_apa4v.fcl"
  ]
}

# Dec 2019 ProtoDUNE height charge calibration.
# Based on Dec 2018 data.
tools.heightGain_calib20191206_dec18ext: {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "heightGain_calib20191206_dec18ext"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20191206_dec18ext/heightGain_apa3z.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa3c.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa3u.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa3v.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa5z.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa5c.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa5u.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa5v.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa2z.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa2c.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa2u.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa2v.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa6z.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa6c.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa6u.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa6v.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa1z.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa1c.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa1u.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa1v.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa4z.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa4c.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa4u.fcl",
    "calib/protodune/calib20191206_dec18ext/heightGain_apa4v.fcl"
  ]
}

# Dec 2019 shaping time calibration.
# Based on Dec 2019 data.
tools.shapingTime_calib20191206_dec18ext: {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "shapingTime_calib20191206_dec18ext"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa3z.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa3c.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa3u.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa3v.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa5z.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa5c.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa5u.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa5v.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa2z.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa2c.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa2u.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa2v.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa6z.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa6c.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa6u.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa6v.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa1z.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa1c.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa1u.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa1v.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa4z.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa4c.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa4u.fcl",
    "calib/protodune/calib20191206_dec18ext/shapingTime_apa4v.fcl"
  ]
}

#####################################################################

# Dec 2019 ProtoDUNE charge calibration.
# Based on Nov 2019 data.
tools.areaGain_calib20191203 : {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "areaGain_calib20191203"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20191203/areaGain_apa3z.fcl",
    "calib/protodune/calib20191203/areaGain_apa3c.fcl",
    "calib/protodune/calib20191203/areaGain_apa3u.fcl",
    "calib/protodune/calib20191203/areaGain_apa3v.fcl",
    "calib/protodune/calib20191203/areaGain_apa5z.fcl",
    "calib/protodune/calib20191203/areaGain_apa5c.fcl",
    "calib/protodune/calib20191203/areaGain_apa5u.fcl",
    "calib/protodune/calib20191203/areaGain_apa5v.fcl",
    "calib/protodune/calib20191203/areaGain_apa2z.fcl",
    "calib/protodune/calib20191203/areaGain_apa2c.fcl",
    "calib/protodune/calib20191203/areaGain_apa2u.fcl",
    "calib/protodune/calib20191203/areaGain_apa2v.fcl",
    "calib/protodune/calib20191203/areaGain_apa6z.fcl",
    "calib/protodune/calib20191203/areaGain_apa6c.fcl",
    "calib/protodune/calib20191203/areaGain_apa6u.fcl",
    "calib/protodune/calib20191203/areaGain_apa6v.fcl",
    "calib/protodune/calib20191203/areaGain_apa1z.fcl",
    "calib/protodune/calib20191203/areaGain_apa1c.fcl",
    "calib/protodune/calib20191203/areaGain_apa1u.fcl",
    "calib/protodune/calib20191203/areaGain_apa1v.fcl",
    "calib/protodune/calib20191203/areaGain_apa4z.fcl",
    "calib/protodune/calib20191203/areaGain_apa4c.fcl",
    "calib/protodune/calib20191203/areaGain_apa4u.fcl",
    "calib/protodune/calib20191203/areaGain_apa4v.fcl"
  ]
}

# Dec 2019 shaping time calibration.
# Based on Dec 2019 data.
tools.shapingTime_calib20191203 : {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "shapingTime_calib20191203"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20191203/shapingTime_apa3z.fcl",
    "calib/protodune/calib20191203/shapingTime_apa3c.fcl",
    "calib/protodune/calib20191203/shapingTime_apa3u.fcl",
    "calib/protodune/calib20191203/shapingTime_apa3v.fcl",
    "calib/protodune/calib20191203/shapingTime_apa5z.fcl",
    "calib/protodune/calib20191203/shapingTime_apa5c.fcl",
    "calib/protodune/calib20191203/shapingTime_apa5u.fcl",
    "calib/protodune/calib20191203/shapingTime_apa5v.fcl",
    "calib/protodune/calib20191203/shapingTime_apa2z.fcl",
    "calib/protodune/calib20191203/shapingTime_apa2c.fcl",
    "calib/protodune/calib20191203/shapingTime_apa2u.fcl",
    "calib/protodune/calib20191203/shapingTime_apa2v.fcl",
    "calib/protodune/calib20191203/shapingTime_apa6z.fcl",
    "calib/protodune/calib20191203/shapingTime_apa6c.fcl",
    "calib/protodune/calib20191203/shapingTime_apa6u.fcl",
    "calib/protodune/calib20191203/shapingTime_apa6v.fcl",
    "calib/protodune/calib20191203/shapingTime_apa1z.fcl",
    "calib/protodune/calib20191203/shapingTime_apa1c.fcl",
    "calib/protodune/calib20191203/shapingTime_apa1u.fcl",
    "calib/protodune/calib20191203/shapingTime_apa1v.fcl",
    "calib/protodune/calib20191203/shapingTime_apa4z.fcl",
    "calib/protodune/calib20191203/shapingTime_apa4c.fcl",
    "calib/protodune/calib20191203/shapingTime_apa4u.fcl",
    "calib/protodune/calib20191203/shapingTime_apa4v.fcl"
  ]
}

#####################################################################

# Feb 2019 ProtoDUNE charge calibration.
# Based on Dec 2018 data.
tools.areaGain_calib20190205 : {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "areaGain_calib20190205"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20190205/areaGain_apa3z.fcl",
    "calib/protodune/calib20190205/areaGain_apa3c.fcl",
    "calib/protodune/calib20190205/areaGain_apa3u.fcl",
    "calib/protodune/calib20190205/areaGain_apa3v.fcl",
    "calib/protodune/calib20190205/areaGain_apa5z.fcl",
    "calib/protodune/calib20190205/areaGain_apa5c.fcl",
    "calib/protodune/calib20190205/areaGain_apa5u.fcl",
    "calib/protodune/calib20190205/areaGain_apa5v.fcl",
    "calib/protodune/calib20190205/areaGain_apa2z.fcl",
    "calib/protodune/calib20190205/areaGain_apa2c.fcl",
    "calib/protodune/calib20190205/areaGain_apa2u.fcl",
    "calib/protodune/calib20190205/areaGain_apa2v.fcl",
    "calib/protodune/calib20190205/areaGain_apa6z.fcl",
    "calib/protodune/calib20190205/areaGain_apa6c.fcl",
    "calib/protodune/calib20190205/areaGain_apa6u.fcl",
    "calib/protodune/calib20190205/areaGain_apa6v.fcl",
    "calib/protodune/calib20190205/areaGain_apa1z.fcl",
    "calib/protodune/calib20190205/areaGain_apa1c.fcl",
    "calib/protodune/calib20190205/areaGain_apa1u.fcl",
    "calib/protodune/calib20190205/areaGain_apa1v.fcl",
    "calib/protodune/calib20190205/areaGain_apa4z.fcl",
    "calib/protodune/calib20190205/areaGain_apa4c.fcl",
    "calib/protodune/calib20190205/areaGain_apa4u.fcl",
    "calib/protodune/calib20190205/areaGain_apa4v.fcl"
  ]
}

# Feb 2019 ProtoDUNE shaping time calibration.
# Based on Dec 2018 data.
tools.shapingTime_calib20190205 : {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "shapingTime_calib20190205"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/calib20190205/shapingTime_apa3z.fcl",
    "calib/protodune/calib20190205/shapingTime_apa3c.fcl",
    "calib/protodune/calib20190205/shapingTime_apa3u.fcl",
    "calib/protodune/calib20190205/shapingTime_apa3v.fcl",
    "calib/protodune/calib20190205/shapingTime_apa5z.fcl",
    "calib/protodune/calib20190205/shapingTime_apa5c.fcl",
    "calib/protodune/calib20190205/shapingTime_apa5u.fcl",
    "calib/protodune/calib20190205/shapingTime_apa5v.fcl",
    "calib/protodune/calib20190205/shapingTime_apa2z.fcl",
    "calib/protodune/calib20190205/shapingTime_apa2c.fcl",
    "calib/protodune/calib20190205/shapingTime_apa2u.fcl",
    "calib/protodune/calib20190205/shapingTime_apa2v.fcl",
    "calib/protodune/calib20190205/shapingTime_apa6z.fcl",
    "calib/protodune/calib20190205/shapingTime_apa6c.fcl",
    "calib/protodune/calib20190205/shapingTime_apa6u.fcl",
    "calib/protodune/calib20190205/shapingTime_apa6v.fcl",
    "calib/protodune/calib20190205/shapingTime_apa1z.fcl",
    "calib/protodune/calib20190205/shapingTime_apa1c.fcl",
    "calib/protodune/calib20190205/shapingTime_apa1u.fcl",
    "calib/protodune/calib20190205/shapingTime_apa1v.fcl",
    "calib/protodune/calib20190205/shapingTime_apa4z.fcl",
    "calib/protodune/calib20190205/shapingTime_apa4c.fcl",
    "calib/protodune/calib20190205/shapingTime_apa4u.fcl",
    "calib/protodune/calib20190205/shapingTime_apa4v.fcl"
  ]
}

#####################################################################

# Nov 2019 APA7 cold coldbox charge calibration.
tools.areaGain_cbnov19 : {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "areaGain_cbnov19"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/cbnov19/areaGain_apa7z.fcl",
    "calib/protodune/cbnov19/areaGain_apa7c.fcl",
    "calib/protodune/cbnov19/areaGain_apa7u.fcl",
    "calib/protodune/cbnov19/areaGain_apa7v.fcl"
  ]
}

# Nov 2019 APA7 cold coldbox shaping time calibration.
tools.shapingTime_cbnov19 : {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "shapingTime_cbnov19"
  DefaultValue: 0.0
  FileNames: [
    "calib/protodune/cbnov19/shapingTime_apa7z.fcl",
    "calib/protodune/cbnov19/shapingTime_apa7c.fcl",
    "calib/protodune/cbnov19/shapingTime_apa7u.fcl",
    "calib/protodune/cbnov19/shapingTime_apa7v.fcl"
  ]
}
# peds_pdsp.fcl
#
# David Adams
# February 2019
#
# Pedestals for protodune data.

# June 2019 evaluation using ADcPedestalFitter with run 6118.
tools.pedestals_run006118evts00000_01000 : {
  tool_type: FclFileFloatArray
  LogLevel: 1
  Label: "pedestals_run006118evts00000-01000"
  DefaultValue: 0.0
  FileNames: [
    "pedestal/protodune/run006118evts00000-01000/pedestals_apa1.fcl",
    "pedestal/protodune/run006118evts00000-01000/pedestals_apa2.fcl",
    "pedestal/protodune/run006118evts00000-01000/pedestals_apa3.fcl",
    "pedestal/protodune/run006118evts00000-01000/pedestals_apa4.fcl",
    "pedestal/protodune/run006118evts00000-01000/pedestals_apa5.fcl",
    "pedestal/protodune/run006118evts00000-01000/pedestals_apa6.fcl"
  ]
}
# badevents_pdsp.fcl
#
# David Adams
# June 2019
#
# Bad events for protoDUNE single phase.
# These are events that should be skipped in data processing
#
# The format for entries is [RUN, EVT1, EVT2, ...]

tools.pdsp_unpack_crash_events: {
  tool_type: FclIndexVectorMapTool
  LogLevel: 1
  Entries: [
    [4644, 116, 1177, 1620]      # Intermittent crashes 17-jun-2019
  ]
}


process_name: ModBoxModStudyMC

services:
{
  IFDH: {}
  TFileService: {fileName: "%ifb_result.root"}
  TimeTracker: {}
  MemoryTracker: {}
  RandomNumberGenerator: {}
  message:  @local::dune_message_services_prod_debug
  FileCatalogMetadata: @local::art_file_catalog_mc
  PdspChannelMapService:        @local::pdspchannelmap
  @table::protodune_services
  #@table::protodune_reco_services
  BackTrackerService: {
    BackTracker: {
      SimChannelModuleLabel: "tpcrawdecoder:simpleSC"
      G4ModuleLabel: "largeant"
      MinimumHitEnergyFraction: 1e-1
    }
  }
}

modboxmodstudyprod4:
{
  module_type:   "ModBoxModStudyMC"
  PFParticleTag: "pandora"
  SpacePointTag: "reco3d"
  TrackerTag:    "pandoraTrack"
  NNetTag:       "emtrkmichelid:emtrkmichel"
  minNumbMichelLikeHit:     5
  trackPitch:               0.75
  trackPitchTolerance:      0.1
  numberNeighbors:          2
  michelScoreThreshold:     0.7
  michelScoreThresholdAvg:  0.5
  selectAC:                 false
  selectCC:                 true
  SpacePointAlg:            @local::spacepointAlg
  StoppingMuonSelectionAlg: @local::stoppingmuonAlg
  CalorimetryHelper:        @local::caloHelper
  HitHelper:                @local::hitHelper
}

source:
{
  module_type:RootInput
  maxEvents: -1

}

physics:
{
  producers: {
    @table::protoDUNE_reco_data_stage1_producers
  }
  analyzers: {
    fabioana: @local::modboxmodstudyprod4
  }

ana: [fabioana]

end_paths: [ana]
}

physics.producers.emtrkmichelid.PointIdAlg.AdcMin: -10 # This was previously -50
physics.producers.emtrkmichelid.PointIdAlg.AdcMax: 30  # This was previously 150
#michel_study.minNumberSpacePoints: 3
#michel_study.SpacePointAlg.cilinderAxis:   50
#michel_study.SpacePointAlg.cilinderRadius: 5
#michel_study.SpacePointAlg.minNumberSpacePoints: 10
#michel_study.StoppingMuonSelectionAlg.TrackerTag: "pandoraTrack"
#michel_study.StoppingMuonSelectionAlg.PFParticleTag:   "pandora"
#michel_study.StoppingMuonSelectionAlg.length_cutoff_CC:               100
#michel_study.StoppingMuonSelectionAlg.offsetFiducialBounds_CC:        50
#michel_study.StoppingMuonSelectionAlg.thicknessStartVolume_CC:        40
#michel_study.StoppingMuonSelectionAlg.cutMinHitPeakTime_CC:           500
#michel_study.StoppingMuonSelectionAlg.cutMaxHitPeakTime_CC:           4800
#michel_study.StoppingMuonSelectionAlg.radiusBrokenTracksSearch_CC:    50
#michel_study.StoppingMuonSelectionAlg.cutCosAngleBrokenTracks_CC:     0.995
#michel_study.StoppingMuonSelectionAlg.cutCosAngleAlignment_CC:        0.995
#michel_study.StoppingMuonSelectionAlg.cutContourAPA_CC:               10
#michel_study.CalorimetryHelper.TrackerTag: "pandoraTrack"
#michel_study.CalorimetryHelper.CalorimetryTag: "pandoracalo"
#michel_study.CalorimetryHelper.PFParticleTag: "pandora"
#michel_study.HitHelper.electronEnergyFractionToCallMichelHits:   0.7
#michel_study.HitHelper.maxDistanceToCallMichelHits: 15
